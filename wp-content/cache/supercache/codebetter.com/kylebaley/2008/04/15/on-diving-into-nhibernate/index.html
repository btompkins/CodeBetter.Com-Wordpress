<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>On diving into NHibernate | Kyle Baley</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/kylebaley/xmlrpc.php" />
	                <link rel="stylesheet" href="http://codebetter.com/kylebaley/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='http://codebetter.com/kylebaley/wp-includes/js/l10n.js?ver=20101110'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/kylebaley/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://codebetter.com/kylebaley/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Kyle Baley' href='http://codebetter.com/kylebaley/' />
<link rel='start' title='The CodeBetter Hillbilly, or &quot;How to build a better banjo&quot;' href='http://codebetter.com/kylebaley/2007/12/13/the-codebetter-hillbilly-or-quot-how-to-build-a-better-banjo-quot/' />
<link rel='prev' title='jQuery and the ConventionController' href='http://codebetter.com/kylebaley/2008/04/13/jquery-and-the-conventioncontroller/' />
<link rel='next' title='How to convince your boss to let you go to DevTeach' href='http://codebetter.com/kylebaley/2008/04/16/how-to-convince-your-boss-to-let-you-go-to-devteach/' />
<meta name="generator" content="WordPress 3.1-beta1-16732" />
<link rel='canonical' href='http://codebetter.com/kylebaley/2008/04/15/on-diving-into-nhibernate/' />
<link rel='shortlink' href='http://codebetter.com/kylebaley/?p=63' />
<meta name="_awb_version" content="2.0.3" /><link rel="stylesheet" href="http://codebetter.com/kylebaley/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.0.6" type="text/css" media="screen" /><link rel="stylesheet" href="http://disqus.com/stylesheets/kylebaleycb/disqus.css?v=2.0" type="text/css" media="screen" /><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.1" />
                <script type="text/javascript" src="http://codebetter.com/kylebaley/wp-content/uploads/spacker-cache/a8046d2f1fc1c08af413701218a11c1d.js">/*Is Cache!*/</script>
                	<style type="text/css">body { padding-top:0px !important; }</style>

</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">			</div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-63" class="post-63 post type-post status-publish format-standard hentry category-nhibernate">
					<h1 class="entry-title">On diving into NHibernate</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/kylebaley/author/kylebaley/" title="View all posts by Kyle Baley">Kyle Baley</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/kylebaley/2008/04/15/on-diving-into-nhibernate/" title="11:23 pm" rel="bookmark"><span class="entry-date">April 15, 2008</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/kylebaley/feed/rss/"  rel="nofollow"><img src="http://codebetter.com/kylebaley/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/kylebaley/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><p>Here&#8217;s the thing with NHibernate: It&#8217;s hard. I&#8217;m mildly, bordering on moderately familiar with it and while it&#8217;s a powerful product, it&#8217;s a complicated one. This is due in no small part to the fragmented nature of the documentation. Some is on the <a href="http://www.hibernate.org/365.html" target="_blank">official site</a>, some in <a href="http://groups.google.com/group/nhusers?hl=en" target="_blank">discussion groups</a>, some in <a href="http://blogs.hibernatingrhinos.com/nhibernate/Default.aspx" target="_blank">FAQs</a>, and some in <a href="http://www.manning.com/kuate/" target="_blank">books</a>. It&#8217;s getting better but it is still a very daunting and frustrating task to do seemingly simple things when you aren&#8217;t a master.</p>
<p>We&#8217;ll look at the example that you knew was coming: Select all Jobs that have at least one Location with a Section = 15. Here is the SQL:</p>
<pre>SELECT		*
FROM		Job
WHERE 		JobID IN
	( SELECT 	JobID
	  FROM		Location
	  WHERE 	Section = 15 )</pre>
<p>Not too bad thanks to years of SQL that have been ingrained at the expense of remembering vital statistics and, on occasion, basic motor skills.</p>
<p>Now before I post a solution, I should point out that one of the reasons NHibernate is hard to figure out is that the domain does not lend itself well to Google. Take this example. I want to convert this SQL to ICriteria format. Searches for various combinations of NHibernate, Subqueries, Collections, and Children do not make one reach for the &quot;I&#8217;m feeling lucky&quot; link. I did find this <a href="http://www.nablasoft.com/Alkampfer/?p=152" target="_blank">somewhat helpful link</a> until I discovered that the whole thing could be replaced with an Expression.IsNotEmpty criteria.</p>
<p>I&#8217;ll show *a* solution to my problem:</p>
<pre>    var subquery = DetachedCriteria.For&lt;job&gt;( );
    subquery
        .SetProjection( Projections.Property( &quot;Id&quot; ) )
        .CreateCriteria( &quot;Locations&quot; )
            .Add( Property.ForName( &quot;Section&quot; ).Eq( &quot;15&quot; ) );

    var query = DetachedCriteria.For&lt;Job&gt;( );
    query
        .Add( Subqueries.PropertyIn( &quot;Id&quot;, subquery ) );</pre>
<p>I&#8217;m going to venture an opinion that this is *not* an intuitive piece of code when, in the back of your mind, you&#8217;re trying to map this to what you know of SQL.</p>
<p>Here is what is going on as I see it. The subquery is equivalent to the following:</p>
<pre>SELECT      JobID
FROM        Job j
INNER JOIN  Location l
ON          j.JobID = l.JobID
WHERE       l.Section = 15</pre>
<p>This is different than the subquery above and there is a reason for that, which I think I&#8217;ll get to. But first, here are some specific areas of confusion:</p>
<ul>
<li>SetProjection is essentially saying &quot;what fields do you want to return?&quot; If you ignore it, it will return whatever object the query is for (in this case, a list of Jobs). </li>
<li>CreateCriteria( &quot;Locations&quot; ) is used for the INNER JOIN on Job. The Add will create a criteria for the Location (which is why I indented it further).</li>
</ul>
<p>The reason for my confusion is the disconnect between the terms when mapping them to what I know of SQL. Could be my cursory knowledge of the underlying theory. Could be that it&#8217;s just hard coming up with names for these things.</p>
<p>Now we get to the reason why the subquery is on Job and not Location. In my domain model, Job contains a collection of Location objects. The Location objects do not have a reference back to the parent, nor do they have a JobId property. There is a JobId column for the table in the database but that&#8217;s used only by NHibernate to populate the collection of Locations for a particular Job.</p>
<p>If I were to create the subquery on Location, I have nothing to return in the Projection. There is no JobID property on the Location. And NHibernate deals with objects in its queries (mostly), not database schema. So I needed to create an INNER JOIN subquery solely so that I could return the ID property on a Job object.</p>
<p>Once that is finished, we create the main query, again on Job. The sole point of confusion I had here was that I saw In in the list of methods on Subqueries and tried to use that instead of PropertyIn.</p>
<p>It took an inordinate amount of time to get to this point compared to how much time I spend with other tools. Like I said, maybe it&#8217;s the problem domain. Maybe it&#8217;s the way my brain is wired for this type of problem.</p>
<p>The underlying point is&#8230;well, I&#8217;m not all too sure actually. Not sure what the recommendation is here. I&#8217;m not knocking NHibernate because the fact is, it does make my life easier for the 90% of the time I&#8217;m not doing stuff like this. The point isn&#8217;t really to stick with it either, though again, I think you should if you&#8217;ve tried it and dismissed it for being too complicated. Guess I just wanted to say I worked really hard today.</p>
<p>Concluding note: I&#8217;m aware of the existence of HQL. I&#8217;m building a search screen and the prospect of converting an arbitrary number of search parameters into HQL didn&#8217;t appeal to me.</p>
<p>Kyle the Unrelenting</p>
											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/kylebaley/category/nhibernate/" title="View all posts in NHibernate" rel="category tag">NHibernate</a>. Bookmark the <a href="http://codebetter.com/kylebaley/2008/04/15/on-diving-into-nhibernate/" title="Permalink to On diving into NHibernate" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/kylebaley/2008/04/15/on-diving-into-nhibernate/feed/" title="Comments RSS to On diving into NHibernate" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-63 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/kylebaley/2008/04/13/jquery-and-the-conventioncontroller/" rel="prev"><span class="meta-nav">&larr;</span> jQuery and the ConventionController</a></div>
					<div class="nav-next"><a href="http://codebetter.com/kylebaley/2008/04/16/how-to-convince-your-boss-to-let-you-go-to-devteach/" rel="next">How to convince your boss to let you go to DevTeach <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
					<div id="dsq-content">
			<ul id="dsq-comments">
					<li id="dsq-comment-372">
					<div id="dsq-comment-header-372" class="dsq-comment-header">
						<cite id="dsq-cite-372">
								<span id="dsq-author-user-372">Doug Mayer</span>
							</cite>
					</div>
					<div id="dsq-comment-body-372" class="dsq-comment-body">
						<div id="dsq-comment-message-372" class="dsq-comment-message"><p>I agree that NHibernate is very difficult to learn and the fractioned documentation doesn&#8217;t help (though those guys have been doing a great job on the blog you linked).  The model you&#8217;re required to work with is what makes it particularly difficult I think&#8230; it&#8217;s just not intuitive for someone who&#8217;s not intimately familiar with NHibernate.  While NHibernate.Linq is still in its infancy, I think we may be able to look to that it to bring the familiar LINQ syntax to (most of) our queries.</p>
<p>May I also say your blog is a particularly easy read&#8230; just the right amount of funnies to keep us entertained and still take away something.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-373">
					<div id="dsq-comment-header-373" class="dsq-comment-header">
						<cite id="dsq-cite-373">
	http://www.codesqueeze.com							<span id="dsq-author-user-373">Max Pool</span>
							</cite>
					</div>
					<div id="dsq-comment-body-373" class="dsq-comment-body">
						<div id="dsq-comment-message-373" class="dsq-comment-message"><p>You&#8217;re just going through the same crappy learning curve everyone else on NH has..just like TDD, you will push through it and be glad you did.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-374">
					<div id="dsq-comment-header-374" class="dsq-comment-header">
						<cite id="dsq-cite-374">
								<span id="dsq-author-user-374">Edgar Zavala</span>
							</cite>
					</div>
					<div id="dsq-comment-body-374" class="dsq-comment-body">
						<div id="dsq-comment-message-374" class="dsq-comment-message"><p>You always can use HQL and Native SQL, not always the best solution, declarative quering is good. But some times is better to create a native sql statement or an hql to do so (specialy in high optimized queries). I use NHibernate a lot (i use it in Java from some time ago and in .Net since it was ported) and is an excelent ORM (for me is one of the best tools from Java ported to .Net), but some times &#8230; just some times&#8230; is more complex to wath you expect on an ORM</p>
<p>Just my $0.02</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-375">
					<div id="dsq-comment-header-375" class="dsq-comment-header">
						<cite id="dsq-cite-375">
	http://blog.symbiotic-development.com							<span id="dsq-author-user-375">Symon Rottem</span>
							</cite>
					</div>
					<div id="dsq-comment-body-375" class="dsq-comment-body">
						<div id="dsq-comment-message-375" class="dsq-comment-message"><p>I think you&#8217;re taking the right approach; the criteria queries are ideal for the search screen type of problem you&#8217;re attaching &#8211; dynamically generating HQL is hard work and fragile.</p>
<p>The ICriteria interface does take some getting used to &#8211; it&#8217;s more difficult than HQL for the same reason programming is more difficult than writing a sentence; it&#8217;s not a natural way of thinking about a problem.  After doing it for a while it does become easier, just like writing code. <img src='http://codebetter.com/kylebaley/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> </p>
</div>
					</div>
				</li>
					<li id="dsq-comment-376">
					<div id="dsq-comment-header-376" class="dsq-comment-header">
						<cite id="dsq-cite-376">
								<span id="dsq-author-user-376">Kyle Baley</span>
							</cite>
					</div>
					<div id="dsq-comment-body-376" class="dsq-comment-body">
						<div id="dsq-comment-message-376" class="dsq-comment-message"><p>Reading the comments, I think I found a couple of points to the post. One was to get some sense that I was on the right track, which is often the underlying theme to most of my posts even if I don&#8217;t outright say it. Thanks to all for the encouragement.</p>
<p>But another is: how are we to encourage others to use a product like NHibernate when it is not only complicated but open source (which scares many companies, sometimes justifiably so)? Yes, it helps make things easier but many people will take it up just begging for an excuse to dump it at the first sign of trouble. And not everyone has the time luxury I currently do of being able to push through the learning curve.</p>
<p>Like Doug, I&#8217;m encouraged by NHibernate.Linq even if this post was the result of my dumping it in favour of a more &#8220;traditional&#8221; NHibernate approach. It&#8217;s simply not ready yet but at the rate it&#8217;s being developed, it will get there pretty quick. When that happens, here&#8217;s hoping it becomes more widely adopted.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-377">
					<div id="dsq-comment-header-377" class="dsq-comment-header">
						<cite id="dsq-cite-377">
	http://weblogs.asp.net/bsimser							<span id="dsq-author-user-377">Bil Simser</span>
							</cite>
					</div>
					<div id="dsq-comment-body-377" class="dsq-comment-body">
						<div id="dsq-comment-message-377" class="dsq-comment-message"><p>I have to respectfully disagree. NHibernate isn&#8217;t hard any more than software development isn&#8217;t hard. It&#8217;s new. If you haven&#8217;t used an ORM before then you&#8217;re in for a bit of learning curve. Much like picking up a new language, new tool, or new technology. Saying NHibernate is hard is like saying everything is hard (.NET, 3.5, lamda, LINQ, you name it).</p>
<p>I agree that the NH community is all over the place. Ask 3 developers using NH and get 5 different answers. Answers are scattered all over the place as you say. Again, this is nothing new to the NH community or the open source community. It&#8217;s just how it is.</p>
<p>Should every community have a &#8220;Go Here&#8221; site where all your questions will be answered? I challenge you to show me that for anything, programming or non-programming related. It&#8217;s just how humans diverse information. Everyone learns differently. Some from code samples, some from pairing, some from reading books, some from personal spikes and exploration. I don&#8217;t think NH or any tool is different here nor are we, as a community going to ever change it. And why would we? </p>
<p>It may not be optimal, but that&#8217;s part of the fun. If we wanted canned systems that always were done the same way there would be little room for creativity. For example how many different implementations of the Repository (DDD) pattern have you built or seen? Each time they&#8217;re all different. If Eric Evans came out with a snippet of code saying &#8220;use this code whenever you built a repository&#8221; development would be boring. It&#8217;s through challenges and learning that we extend and explore. It&#8217;s through these exercises that we discover and push the envelope, opening doors to new ideas. Without that exploration we&#8217;re all just mindless robots pushing bits.</p>
<p>I for one welcome our NH overlords and the times that are upon us.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-378">
					<div id="dsq-comment-header-378" class="dsq-comment-header">
						<cite id="dsq-cite-378">
								<span id="dsq-author-user-378">Kyle Baley</span>
							</cite>
					</div>
					<div id="dsq-comment-body-378" class="dsq-comment-body">
						<div id="dsq-comment-message-378" class="dsq-comment-message"><p>@Bil<br />
You could be right. But it *feels* harder to me. And that might be because I&#8217;ve been working with it on a cursory level for quite a while now and I feel like I should be able to work things like this out more easily by now. It wasn&#8217;t like dealing with Rhino Mocks or IoC containers where much of the hard part of the learning curve was up front.</p>
<p>That&#8217;s partially your fault by the way since my first exposure to NHibernate was on our project that already had it implemented and abstracted. For me to deal with it, I just needed to copy and paste an existing mapping file and muddle my way through modifying it for a new class. Everything else just worked.</p>
<p>Now, with me starting from scratch and having to build the infrastructure myself, I&#8217;m feeling like I should have these things figured out. It doesn&#8217;t help that I&#8217;m working solo without anyone to bounce ideas off of, at least not in real-time.</p>
<p>With all that said, I was able to get reasonably up-to-speed with LinQ and lambdas comparatively quickly. I&#8217;m no expert by any stretch but I feel like I can muddle through them more easily, probably because help is a little easier to come by.</p>
<p>And I don&#8217;t want to imply there should be a centralized &#8220;Click here&#8221; site for NHibernate. But I find that Googling for problems with Linq and lambdas (and even things like Rhino Mocks and Monorail) is much easier than for NHibernate. I don&#8217;t profess to know why that is or if it&#8217;s a general problem or just the way I think. Just noting it as an issue.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-379">
					<div id="dsq-comment-header-379" class="dsq-comment-header">
						<cite id="dsq-cite-379">
	http://weblogs.asp.net/bsimser							<span id="dsq-author-user-379">Bil Simser</span>
							</cite>
					</div>
					<div id="dsq-comment-body-379" class="dsq-comment-body">
						<div id="dsq-comment-message-379" class="dsq-comment-message"><p>I think it&#8217;s a general issue for everything. Even in MS land, there isn&#8217;t a single place to go for the best information. For me, the best information is either in my head (if I know it) or Google. Maybe that in itself is a sad state of the union from a social commentary.</p>
<p>And yes, I take full blame for leading you into the NHibernate path through a layer of abstractions. My bad. Had we been able to keep you around longer (my choice was to but powers that be overrode that) we would have got more to the heart of building out those abstractions.</p>
<p>Until next time we get to work together, we&#8217;ll just keep the fires burning with blogs and comments and emails my friend.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-380">
					<div id="dsq-comment-header-380" class="dsq-comment-header">
						<cite id="dsq-cite-380">
	http://www.ayende.com/Blog/							<span id="dsq-author-user-380">Ayende Rahien</span>
							</cite>
					</div>
					<div id="dsq-comment-body-380" class="dsq-comment-body">
						<div id="dsq-comment-message-380" class="dsq-comment-message"><p>Kyle,<br />
The code is trying to tell you something. You have a problem with the model if you have to have awkward queries there.<br />
Add a Job property to Location, in which case you could do:<br />
var subquery = DetachedCriteria.For<location>().SetProjection(Projection.Property(&#8220;Job.id&#8221;)).Add(Expression.Eq(&#8220;Section&#8221;, 15));</location></p>
</div>
					</div>
				</li>
					<li id="dsq-comment-381">
					<div id="dsq-comment-header-381" class="dsq-comment-header">
						<cite id="dsq-cite-381">
								<span id="dsq-author-user-381">Kyle Baley</span>
							</cite>
					</div>
					<div id="dsq-comment-body-381" class="dsq-comment-body">
						<div id="dsq-comment-message-381" class="dsq-comment-message"><p>@Ayende: Damn, you and your logic. I saw that way of doing things a while ago and dismissed it because my Location didn&#8217;t have a reference to its parent Job. Not realizing that I could change that&#8230;</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-382">
					<div id="dsq-comment-header-382" class="dsq-comment-header">
						<cite id="dsq-cite-382">
	http://www.castleproject.org							<span id="dsq-author-user-382">Ted Gifford</span>
							</cite>
					</div>
					<div id="dsq-comment-body-382" class="dsq-comment-body">
						<div id="dsq-comment-message-382" class="dsq-comment-message"><p>You can also use a (not) exists query. This query finds months that haven&#8217;t received a MonthlyUpdate for a given government.</p>
<p>DetachedCriteria criteria = DetachedCriteria.For<timedim>(&#8220;td&#8221;)<br />
    .AddOrder(Order.Desc(&#8220;StartTime&#8221;))              // Most recent month first<br />
    .Add(Expression.Eq(&#8220;TimeType&#8221;, TimeType.Month)) // Just months<br />
    .Add(Expression.Lt(&#8220;StartTime&#8221;, DateTime.Now))  // but not future months<br />
    .Add(Subqueries.NotExists(DetachedCriteria.For<monthlyupdate>(&#8220;mu&#8221;) // only months without an update<br />
        .SetProjection(Projections.Constant(1))     // (NHibernate requires a projection for sub-query, apparently)<br />
        .CreateAlias(&#8220;TimeDim&#8221;, &#8220;innerTd&#8221;)<br />
        .Add(Expression.EqProperty(&#8220;innerTd.id&#8221;, &#8220;td.id&#8221;))<br />
        .Add(Expression.Eq(&#8220;Government&#8221;, Government))  // for this government<br />
    ));</p>
<p>Pardon the over-engineered data model. A MonthlyUpdate has references to a TimeDim and Government. TimeDim contains specific instances of Year, Month, etc. (e.g. 2008 calendar year, or June 2008).</monthlyupdate></timedim></p>
</div>
					</div>
				</li>
				</ul>
		</div>
	</div>

<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

<script type="text/javascript">
/* <![CDATA[ */
	var disqus_url = 'http://codebetter.com/kylebaley/2008/04/15/on-diving-into-nhibernate/ ';
	var disqus_identifier = '63 /blogs/kyle.baley/archive/2008/04/15/on-diving-into-nhibernate.aspx';
	var disqus_container_id = 'disqus_thread';
	var disqus_domain = 'disqus.com';
	var disqus_shortname = 'kylebaleycb';
	var disqus_title = "On diving into NHibernate";
		var disqus_config = function () {
	    var config = this; // Access to the config object

	    /* 
	       All currently supported events:
	        * preData â€” fires just before we request for initial data
	        * preInit - fires after we get initial data but before we load any dependencies
	        * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
	        * afterRender - fires when template is rendered but before we show it
	        * onReady - everything is done
	     */

		config.callbacks.preData.push(function() {
			// clear out the container (its filled for SEO/legacy purposes)
			document.getElementById(disqus_container_id).innerHTML = '';
		});
				config.callbacks.onReady.push(function() {
			// sync comments in the background so we don't block the page
			DISQUS.request.get('?cf_action=sync_comments&post_id=63');
		});
					};
	var facebookXdReceiverPath = 'http://codebetter.com/kylebaley/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
	var DsqLocal = {
		'trackbacks': [
		],
		'trackback_url': "http:\/\/codebetter.com\/kylebaley\/2008\/04\/15\/on-diving-into-nhibernate\/trackback\/"	};
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
	var dsq = document.createElement('script'); dsq.type = 'text/javascript';
	dsq.async = true;
	dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.61';
	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
					<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-new-features?utm_source=cb&utm_medium=button&utm_term=4328&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="125" height="125" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/ANTSPP5_125x125_M1.gif"></a>
					<embed width="125" height="125" flashvars="clickTARGET=_blank&amp;clickTAG=http%3A%2F%2Fd1.openx.org%2Fck.php%3Foaparams%3D2__bannerid%3D62753__zoneid%3D29419__cb%3Da0471ce5e8__r_id%3Dd42118811971f057012db20aa261c5c1__r_ts%3Dldef6x__oadest%3Dhttp%253A%252F%252Fwww.jetbrains.com%252Fresharper%252F%253Frs4cb125" allowscriptaccess="always" quality="high" name="Advertisement" id="Advertisement" style="" src="http://s3.amazonaws.com/CodeBetter/Creative/tc_125x125_simple2.swf" type="application/x-shockwave-flash">
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				<script type="text/javascript" src="http://engine.theloungenet.com/z/15/adzerk1_2_5"></script>
				<div id="adzerk1"></div>
				
				<ul class="xoxo">		
									</ul>	
				
				<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-csharp?utm_source=cb&utm_medium=rectangle&utm_term=4327&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="300" height="250" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/APP6_Launch_C%23_Jun10_300x250_M1.gif?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1458095516&amp;Signature=BIBDilUaLnZe1uKfVKyyTBxr%2BvE%3D"></a>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/" title="Search Results">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="/blogs/products/pages/64386.aspx">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="/blogs/products/pages/64615.aspx">Telerik</a></li>
<li><a href="/blogs/products/pages/142174.aspx">JetBrains - ReSharper</a></li>
<li><a href="/blogs/products/pages/Beyond-Compare.aspx">Beyond Compare</a></li>
<li><a href="/blogs/products/pages/.NET-Memory-Profiler.aspx">.NET Memory Profiler</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a> &lt;-- NEW Friend!</li>

	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '11<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter//third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = false; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.785 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-01-18 10:18:25 -->
<!-- super cache -->