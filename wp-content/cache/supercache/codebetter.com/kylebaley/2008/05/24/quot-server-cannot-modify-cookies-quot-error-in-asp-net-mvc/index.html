<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>&quot;Server cannot modify cookies&quot; error in ASP.NET MVC | Kyle Baley</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/kylebaley/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css?v=3912785705" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js?ver=3.4.2'></script>
<script type='text/javascript' src='http://dtym7iokkjlif.cloudfront.net/dough/1.0/recipe.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/kylebaley/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Not all truths are self-evident&#8230;' href='http://codebetter.com/kylebaley/2008/05/21/not-all-truths-are-self-evident/' />
<link rel='next' title='DimeCasts.NET' href='http://codebetter.com/kylebaley/2008/05/27/dimecasts-net/' />
<meta name="generator" content="WordPress 3.4.2" />
<link rel='shortlink' href='http://codebetter.com/kylebaley/?p=77' />

<!-- All in One SEO Pack 1.6.13.2 by Michael Torbert of Semper Fi Web Design[83,164] -->
<link rel="canonical" href="http://codebetter.com/kylebaley/2008/05/24/quot-server-cannot-modify-cookies-quot-error-in-asp-net-mvc/" />
<!-- /all in one seo pack -->
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.3.3" type="text/css" media="screen" />

<!-- Start Shareaholic OgTags -->

	<!-- Shareaholic Notice: There is neither a featured nor gallery image set -->

<!-- End Shareaholic OgTags -->

<meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/dc168cf39155d7b5d39f696ca94d5980.js?v=5302176208">/*Is Cache!*/</script>
                	
	<script type='text/javascript' src='http://d1.openx.org/spcjs.php?id=7744&amp;target=_blank'></script>
	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>
<!-- BuySellAds Ad Code -->
<script type="text/javascript">
(function(){
  var bsa = document.createElement('script');
     bsa.type = 'text/javascript';
     bsa.async = true;
     bsa.src = 'http://s3.buysellads.com/ac/bsa.js';
  (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);
})();
</script>
<!-- End BuySellAds Ad Code -->
</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">
			<!-- BuySellAds Zone Code -->
<div id="bsap_1276080" class="bsarocks bsap_4fe632babdccc2b4b049e4f08cc3c549"></div>
<!-- End BuySellAds Zone Code --></div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-77" class="post-77 post type-post status-publish format-standard hentry category-asp-net-mvc">
					<h1 class="entry-title">&quot;Server cannot modify cookies&quot; error in ASP.NET MVC</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/kylebaley/author/kylebaley/" title="View all posts by Kyle Baley">Kyle Baley</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/kylebaley/2008/05/24/quot-server-cannot-modify-cookies-quot-error-in-asp-net-mvc/" title="4:41 pm" rel="bookmark"><span class="entry-date">May 24, 2008</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/kylebaley/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/kylebaley/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><!-- Start Shareaholic LikeButtonSetTop Automatic --><!-- End Shareaholic LikeButtonSetTop Automatic --><p>This post falls into the &quot;Google-able errors&quot; category and won&#8217;t be of much use to anyone who isn&#8217;t get the specific error.</p>
<p>Here&#8217;s the error I was getting: <strong>Server cannot modify cookies after http headers have been sent</strong></p>
<p>This is in my ASP.NET MVC application and the offending code was the last line of the following method:</p>
<pre>public void SignIn( User user )
{
    FormsAuthentication.SignOut( );

    var issued = DateTime.Now;
    var expires = issued.AddDays( 1 );
    var roles = &quot;Administrator&quot;;

    var ticket = new FormsAuthenticationTicket( 1, user.UserName, issued, expires, false, roles );
    var encryptedTicket = FormsAuthentication.Encrypt( ticket );
    var authCookie = new HttpCookie( FormsAuthentication.FormsCookieName, encryptedTicket )
        {
            Expires = ticket.Expiration
        };

    _httpContext.Response.Cookies.Add( authCookie );
}</pre>
<p>This is in a class called Authentication Service which is called from my LoginController. The authentication service is wired up to the LoginController using Dependency Injection via Windsor by way of MvcContrib. Consider that foreshadowing.</p>
<p>The key to the error is the _httpContext variable. It is set in the constructor of the AuthenticationService as follows:</p>
<pre>public AuthenticationService( ) : this( new HttpContextWrapper2( HttpContext.Current ) )
{
}

public AuthenticationService( HttpContextBase httpContext )
{
    _httpContext = httpContext;
}</pre>
<p>Some of you will recognize this as poor man&#8217;s dependency injection, used primarily because I didn&#8217;t feel like wrapping the HttpContextWrapper2 class (which is itself a wrapper) in an interface. Some of you will also note that even though I&#8217;m injecting the HttpContext into this class, it is still largely untestable because of the FormsAuthentication stuff. Frankly, I&#8217;m good with that which is why I didn&#8217;t bother with the interface.</p>
<p>During my debugging, one of the things I did was replace _httpContext with HttpContext.Current and lo! That works fine. So clearly, my poor man&#8217;s dependency injection had issues. My mentor application, CodeCampServer, went the extra step and created an IHttpContextProvider interface around HttpContextWrapper2 and used Windsor to wire it in:</p>
<pre>public AuthenticationService(IClock clock, IHttpContextProvider httpContextProvider)
{
    _clock = clock;
    _httpContextProvider = httpContextProvider;	        
}</pre>
<p>IHttpContextProvider has a pretty simply interface and implementation:</p>
<pre>public class HttpContextProvider : IHttpContextProvider
{
    public HttpContextBase GetCurrentHttpContext()
    {
        return new HttpContextWrapper2(HttpContext.Current);
    }
}</pre>
<p>So while I originally poo-poohed the extra layer of abstraction, CodeCampServer had a key feature that my application did not in that it&#8217;s login facility worked.</p>
<p>So I introduced an IHttpContextProvider interface and replaced my existing _httpContext with it and lo! I am able to log in successfully. Here is the updated AuthenticationService:</p>
<pre>public class AuthenticationService : IAuthenticationService
{
    private readonly IHttpContextProvider _httpContext;

    public AuthenticationService( IHttpContextProvider httpContext )
    {
        _httpContext = httpContext;
    }

    public void SignIn( User user )
    {
        FormsAuthentication.SignOut( );

        var issued = DateTime.Now;
        var expires = issued.AddDays( 1 );
        var roles = &quot;Administrator&quot;;

        var ticket = new FormsAuthenticationTicket( 1, user.UserName, issued, expires, false, roles );
        var encryptedTicket = FormsAuthentication.Encrypt( ticket );
        var authCookie = new HttpCookie( FormsAuthentication.FormsCookieName, encryptedTicket )
             {
                 Expires = ticket.Expiration
             };

        _httpContext.GetCurrentHttpContext( ).Response.Cookies.Add( authCookie );
    }
}</pre>
<p>One of the nice things that came out of this was that, thanks to my <a href="http://baley.codebetter.com/blogs/kyle.baley/archive/2008/05/18/auto-registration-in-asp-net-mvc.aspx">auto-registration code</a>, I didn&#8217;t need to do anything special to wire in the new IHttpContextProvider class. Just created it and it just worked. Who knew?</p>
<p>As for the cause of the error, I can only speculate. My guess is that it was using the wrong HttpContext. During my debugging, the constructor for AuthenticationService would get called during the first call to the Login page. That is, when the Login page was first rendered. So the class was storing a reference to *that* page&#8217;s HTTP context. When the user logged in, it would use that context and try to add the authentication cookie to it. Since that context had already been used and the headers written out, the error occurred. So it wasn&#8217;t actually getting the *current* HTTP context. It was using the previous request&#8217;s context.</p>
<p>Further proof of this theory: when I would see that error, my workaround was to go back to Visual Studio and do a full re-compile of the application. This clears out the cached version of the class, and more importantly, it&#8217;s reference to the previous request&#8217;s HTTP context. When I&#8217;d refresh the page, it would have to create a new instance of AuthenticationService and use the current request&#8217;s HTTP context, which hasn&#8217;t yet completed.</p>
<p>In the new version, every call to GetCurrentHttpContext will create a new HttpContextWrapper2 object based on the current request&#8217;s HTTP context. Ergo, we will always have the current context.</p>
<p>Whatever, as long as it works.</p>
<p>Kyle the Theoretical</p>
<div class="shr-publisher-77"></div><!-- Start Shareaholic LikeButtonSetBottom Automatic --><!-- End Shareaholic LikeButtonSetBottom Automatic -->											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/kylebaley/category/asp-net-mvc/" title="View all posts in ASP.NET MVC" rel="category tag">ASP.NET MVC</a>. Bookmark the <a href="http://codebetter.com/kylebaley/2008/05/24/quot-server-cannot-modify-cookies-quot-error-in-asp-net-mvc/" title="Permalink to &quot;Server cannot modify cookies&quot; error in ASP.NET MVC" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/kylebaley/2008/05/24/quot-server-cannot-modify-cookies-quot-error-in-asp-net-mvc/feed/" title="Comments RSS to &quot;Server cannot modify cookies&quot; error in ASP.NET MVC" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-77 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/kylebaley/2008/05/21/not-all-truths-are-self-evident/" rel="prev"><span class="meta-nav">&larr;</span> Not all truths are self-evident&#8230;</a></div>
					<div class="nav-next"><a href="http://codebetter.com/kylebaley/2008/05/27/dimecasts-net/" rel="next">DimeCasts.NET <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
                    <div id="dsq-content">
            <ul id="dsq-comments">
                    <li id="dsq-comment-431">
                    <div id="dsq-comment-header-431" class="dsq-comment-header">
                        <cite id="dsq-cite-431">
                                <span id="dsq-author-user-431">Joe</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-431" class="dsq-comment-body">
                        <div id="dsq-comment-message-431" class="dsq-comment-message"><p>Why are you using FormsAuthentication?</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-432">
                    <div id="dsq-comment-header-432" class="dsq-comment-header">
                        <cite id="dsq-cite-432">
                                <span id="dsq-author-user-432">Kyle Baley</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-432" class="dsq-comment-body">
                        <div id="dsq-comment-message-432" class="dsq-comment-message"><p>@Joe: Although the app is meant to be used internally, the company is small enough that they don&#8217;t have the infrastructure in place to host it internally. Hence, it will be hosted externally.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-433">
                    <div id="dsq-comment-header-433" class="dsq-comment-header">
                        <cite id="dsq-cite-433">
                                <span id="dsq-author-user-433">Joe</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-433" class="dsq-comment-body">
                        <div id="dsq-comment-message-433" class="dsq-comment-message"><p>Ok&#8230;but what&#8217;s that got to do with FormsAuthentication? I&#8217;m just curious as in why you&#8217;re using it if the whole concept of forms doesn&#8217;t even exist in MVC.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-434">
                    <div id="dsq-comment-header-434" class="dsq-comment-header">
                        <cite id="dsq-cite-434">
                                <span id="dsq-author-user-434">Kyle Baley</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-434" class="dsq-comment-body">
                        <div id="dsq-comment-message-434" class="dsq-comment-message"><p>MVC obviates the need for a lot of things but authentication is not one of them. I still have the need to store a user&#8217;s identity across a session. And FormsAuthentication is still useful in this regard. </p>
<p>Note that FormsAuthentication doesn&#8217;t make use of ViewState, the chief target of MVC-proponents. It&#8217;s an abstraction over cookies. Without it, I&#8217;d have to manage the cookies used for authentication myself.</p>
<p>I sound a lot more confident than I really am in this regard. In reality, I stole the code from CodeCampServer</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-435">
                    <div id="dsq-comment-header-435" class="dsq-comment-header">
                        <cite id="dsq-cite-435">
                                <span id="dsq-author-user-435">Kyle Baley</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-435" class="dsq-comment-body">
                        <div id="dsq-comment-message-435" class="dsq-comment-message"><p>Oh, and the concept of forms *does* exist in MVC. It&#8217;s WebForms, the abstraction over HTTP forms, that MVC tosses out.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-436">
                    <div id="dsq-comment-header-436" class="dsq-comment-header">
                        <cite id="dsq-cite-436">
                                <span id="dsq-author-user-436">Andy Hitchman</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-436" class="dsq-comment-body">
                        <div id="dsq-comment-message-436" class="dsq-comment-message"><p>Your original implementation of the AuthenticationService was stateful.<br />
I&#8217;d guess that you need to mark the component as transient so Windsor constructs a new instance per resolution. By default (IIRC), it caches component instances which effectively act as singletons.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-437">
                    <div id="dsq-comment-header-437" class="dsq-comment-header">
                        <cite id="dsq-cite-437">
                                <span id="dsq-author-user-437">Kyle Baley</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-437" class="dsq-comment-body">
                        <div id="dsq-comment-message-437" class="dsq-comment-message"><p>@Andy: My original implementation didn&#8217;t use Windsor at all. It used poor man&#8217;s dependency injection. But yes, it was stateful. Really, I could have fixed this by not creating an HttpContextWrapper2 object in the constructor but in the SignIn method itself. When I switched to using Windsor, it worked because my auto-registration code adds objects as transient.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-438">
                    <div id="dsq-comment-header-438" class="dsq-comment-header">
                        <cite id="dsq-cite-438">
                                <span id="dsq-author-user-438">Joe</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-438" class="dsq-comment-body">
                        <div id="dsq-comment-message-438" class="dsq-comment-message"><p>I just don&#8217;t know why there&#8217;s a need for FormsAuthentication. You can set the cookie yourself and validate it&#8217;s existence before each action call (via some inherited controller).</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-439">
                    <div id="dsq-comment-header-439" class="dsq-comment-header">
                        <cite id="dsq-cite-439">
                                <span id="dsq-author-user-439">Kyle Baley</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-439" class="dsq-comment-body">
                        <div id="dsq-comment-message-439" class="dsq-comment-message"><p>As I mentioned, managing the cookie yourself is a possibility. But that&#8217;s what FormsAuthentication is there for, to do it for you. To check if someone is authenticated, you need only call: HttpContext.Current.User.Identity.IsAuthenticated.</p>
<p>FormsAuthentication is an entirely separate concept from WebForms and MVC. It doesn&#8217;t use the ASP.NET Lifecycle, which is the typical target for people moving away from WebForms. You could just as easily manage the cookies yourself in WebForms.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-440">
                    <div id="dsq-comment-header-440" class="dsq-comment-header">
                        <cite id="dsq-cite-440">
    http://huntjason.spaces.live.com                            <span id="dsq-author-user-440">JH</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-440" class="dsq-comment-body">
                        <div id="dsq-comment-message-440" class="dsq-comment-message"><p>Kyle,<br />
   Not certain if you&#8217;ve already come across it already, but the MVC Membership Starter Kit has give us a good headstart on authentication stuff on our project.</p>
<p><a href="http://www.codeplex.com/MvcMembership" rel="nofollow">http://www.codeplex.com/MvcMembership</a></p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-441">
                    <div id="dsq-comment-header-441" class="dsq-comment-header">
                        <cite id="dsq-cite-441">
                                <span id="dsq-author-user-441">Kyle Baley</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-441" class="dsq-comment-body">
                        <div id="dsq-comment-message-441" class="dsq-comment-message"><p>@Jason: I had not seen that. Looks interesting though perhaps a little bit of overkill for my requirements, especially since I&#8217;ve already got the authentication working. Will take a look when my requirements get more complex though.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-442">
                    <div id="dsq-comment-header-442" class="dsq-comment-header">
                        <cite id="dsq-cite-442">
                                <span id="dsq-author-user-442">Paul</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-442" class="dsq-comment-body">
                        <div id="dsq-comment-message-442" class="dsq-comment-message"><p>Just SAVED my life. Thanks!</p>
</div>
                    </div>
                </li>
                </ul>
        </div>
    </div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://codebetter.com/kylebaley/2008/05/24/quot-server-cannot-modify-cookies-quot-error-in-asp-net-mvc/';
    var disqus_identifier = '77 /blogs/kyle.baley/archive/2008/05/24/quot-server-cannot-modify-cookies-quot-error-in-asp-net-mvc.aspx';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'kylebaleycb';
    var disqus_title = "&quot;Server cannot modify cookies&quot; error in ASP.NET MVC";
        var disqus_config = function () {
        var config = this; // Access to the config object

        /* 
           All currently supported events:
            * preData — fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            DISQUS.request.get('?cf_action=sync_comments&post_id=77');
        });
                    };
    var facebookXdReceiverPath = 'http://cdn1.codebetter.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
        ],
        'trackback_url': "http:\/\/codebetter.com\/kylebaley\/2008\/05\/24\/quot-server-cannot-modify-cookies-quot-error-in-asp-net-mvc\/trackback\/"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.67';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29416);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=2782afb'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29416&amp;n=2782afb' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29417);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=e94cea6'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29417&amp;n=e94cea6' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29418);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=9ba3022'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29418&amp;n=9ba3022' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29419);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=f467b52'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29419&amp;n=f467b52' /></a></noscript>
				</div>
			
				<li id="text-3" class="widget-container widget_text"><h3 class="widget-title">What am I working on?</h3>			<div class="textwidget">Check out the next generation of online scheduling<br />
<a href="http://getbookedin.com/?cid=16"><img src="http://getbookedin.com/a/images/logo2.png" /></a></div>
		</li><li id="tag_cloud-3" class="widget-container widget_tag_cloud"><h3 class="widget-title">Categories</h3><div class="tagcloud"><a href='http://codebetter.com/kylebaley/category/alt-net/' class='tag-link-1362' title='4 topics' style='font-size: 12.705882352941pt;'>alt.net</a>
<a href='http://codebetter.com/kylebaley/category/asp-net-mvc/' class='tag-link-2007' title='30 topics' style='font-size: 22pt;'>ASP.NET MVC</a>
<a href='http://codebetter.com/kylebaley/category/bahanet/' class='tag-link-5979' title='9 topics' style='font-size: 16.235294117647pt;'>Bahanet</a>
<a href='http://codebetter.com/kylebaley/category/bdd/' class='tag-link-2123' title='3 topics' style='font-size: 11.529411764706pt;'>BDD</a>
<a href='http://codebetter.com/kylebaley/category/bookedin/' class='tag-link-5996' title='6 topics' style='font-size: 14.470588235294pt;'>BookedIN</a>
<a href='http://codebetter.com/kylebaley/category/brownfield/' class='tag-link-5961' title='20 topics' style='font-size: 20pt;'>Brownfield</a>
<a href='http://codebetter.com/kylebaley/category/career/' class='tag-link-5964' title='10 topics' style='font-size: 16.705882352941pt;'>Career</a>
<a href='http://codebetter.com/kylebaley/category/castle/' class='tag-link-3989' title='1 topic' style='font-size: 8pt;'>Castle</a>
<a href='http://codebetter.com/kylebaley/category/code-coverage/' class='tag-link-5962' title='1 topic' style='font-size: 8pt;'>Code coverage</a>
<a href='http://codebetter.com/kylebaley/category/code-review/' class='tag-link-5994' title='3 topics' style='font-size: 11.529411764706pt;'>Code review</a>
<a href='http://codebetter.com/kylebaley/category/coding-style/' class='tag-link-5959' title='6 topics' style='font-size: 14.470588235294pt;'>Coding Style</a>
<a href='http://codebetter.com/kylebaley/category/community/' class='tag-link-2532' title='20 topics' style='font-size: 20pt;'>Community</a>
<a href='http://codebetter.com/kylebaley/category/conscientious-coding/' class='tag-link-5978' title='19 topics' style='font-size: 19.764705882353pt;'>Conscientious Coding</a>
<a href='http://codebetter.com/kylebaley/category/continuous-integration/' class='tag-link-1347' title='15 topics' style='font-size: 18.588235294118pt;'>Continuous Integration</a>
<a href='http://codebetter.com/kylebaley/category/estimating/' class='tag-link-5972' title='1 topic' style='font-size: 8pt;'>Estimating</a>
<a href='http://codebetter.com/kylebaley/category/featured/' class='tag-link-1356' title='14 topics' style='font-size: 18.352941176471pt;'>Featured</a>
<a href='http://codebetter.com/kylebaley/category/google-app-engine/' class='tag-link-5993' title='11 topics' style='font-size: 17.176470588235pt;'>Google App Engine</a>
<a href='http://codebetter.com/kylebaley/category/gwt/' class='tag-link-5992' title='18 topics' style='font-size: 19.529411764706pt;'>GWT</a>
<a href='http://codebetter.com/kylebaley/category/hardware/' class='tag-link-4927' title='2 topics' style='font-size: 10.117647058824pt;'>Hardware</a>
<a href='http://codebetter.com/kylebaley/category/java/' class='tag-link-5991' title='3 topics' style='font-size: 11.529411764706pt;'>Java</a>
<a href='http://codebetter.com/kylebaley/category/javascript/' class='tag-link-1732' title='9 topics' style='font-size: 16.235294117647pt;'>Javascript</a>
<a href='http://codebetter.com/kylebaley/category/linq/' class='tag-link-1741' title='2 topics' style='font-size: 10.117647058824pt;'>Linq</a>
<a href='http://codebetter.com/kylebaley/category/lucene-net/' class='tag-link-5989' title='2 topics' style='font-size: 10.117647058824pt;'>Lucene.NET</a>
<a href='http://codebetter.com/kylebaley/category/mbunit/' class='tag-link-5960' title='1 topic' style='font-size: 8pt;'>MbUnit</a>
<a href='http://codebetter.com/kylebaley/category/metrics/' class='tag-link-2529' title='1 topic' style='font-size: 8pt;'>Metrics</a>
<a href='http://codebetter.com/kylebaley/category/mocking/' class='tag-link-2119' title='4 topics' style='font-size: 12.705882352941pt;'>Mocking</a>
<a href='http://codebetter.com/kylebaley/category/nant/' class='tag-link-2621' title='4 topics' style='font-size: 12.705882352941pt;'>NAnt</a>
<a href='http://codebetter.com/kylebaley/category/nhibernate/' class='tag-link-2527' title='13 topics' style='font-size: 18pt;'>NHibernate</a>
<a href='http://codebetter.com/kylebaley/category/ninject/' class='tag-link-5983' title='1 topic' style='font-size: 8pt;'>NInject</a>
<a href='http://codebetter.com/kylebaley/category/open-rasta/' class='tag-link-5990' title='1 topic' style='font-size: 8pt;'>Open Rasta</a>
<a href='http://codebetter.com/kylebaley/category/presenting/' class='tag-link-5969' title='14 topics' style='font-size: 18.352941176471pt;'>Presenting</a>
<a href='http://codebetter.com/kylebaley/category/refactoring/' class='tag-link-4737' title='10 topics' style='font-size: 16.705882352941pt;'>Refactoring</a>
<a href='http://codebetter.com/kylebaley/category/resharper/' class='tag-link-2131' title='6 topics' style='font-size: 14.470588235294pt;'>ReSharper</a>
<a href='http://codebetter.com/kylebaley/category/rest/' class='tag-link-5987' title='3 topics' style='font-size: 11.529411764706pt;'>REST</a>
<a href='http://codebetter.com/kylebaley/category/ruby/' class='tag-link-1723' title='1 topic' style='font-size: 8pt;'>Ruby</a>
<a href='http://codebetter.com/kylebaley/category/sarp-architecture/' class='tag-link-5982' title='5 topics' style='font-size: 13.647058823529pt;'>S#arp Architecture</a>
<a href='http://codebetter.com/kylebaley/category/sundry/' class='tag-link-5971' title='20 topics' style='font-size: 20pt;'>Sundry</a>
<a href='http://codebetter.com/kylebaley/category/tdd/' class='tag-link-2572' title='6 topics' style='font-size: 14.470588235294pt;'>TDD</a>
<a href='http://codebetter.com/kylebaley/category/teamcity/' class='tag-link-2135' title='7 topics' style='font-size: 15.058823529412pt;'>TeamCity</a>
<a href='http://codebetter.com/kylebaley/category/tools/' class='tag-link-1998' title='5 topics' style='font-size: 13.647058823529pt;'>Tools</a>
<a href='http://codebetter.com/kylebaley/category/uncategorized/' class='tag-link-1044' title='16 topics' style='font-size: 18.941176470588pt;'>Uncategorized</a>
<a href='http://codebetter.com/kylebaley/category/user-interface/' class='tag-link-5980' title='6 topics' style='font-size: 14.470588235294pt;'>User Interface</a>
<a href='http://codebetter.com/kylebaley/category/utilities/' class='tag-link-5957' title='8 topics' style='font-size: 15.647058823529pt;'>Utilities</a>
<a href='http://codebetter.com/kylebaley/category/working-remotely/' class='tag-link-5963' title='9 topics' style='font-size: 16.235294117647pt;'>Working Remotely</a>
<a href='http://codebetter.com/kylebaley/category/youtrack/' class='tag-link-5995' title='1 topic' style='font-size: 8pt;'>YouTrack</a></div>
</li><li id="archives-2" class="widget-container widget_archive"><h3 class="widget-title">Archives</h3>		<ul>
			<li><a href='http://codebetter.com/kylebaley/2012/04/' title='April 2012'>April 2012</a></li>
	<li><a href='http://codebetter.com/kylebaley/2012/03/' title='March 2012'>March 2012</a></li>
	<li><a href='http://codebetter.com/kylebaley/2012/01/' title='January 2012'>January 2012</a></li>
	<li><a href='http://codebetter.com/kylebaley/2011/11/' title='November 2011'>November 2011</a></li>
	<li><a href='http://codebetter.com/kylebaley/2011/08/' title='August 2011'>August 2011</a></li>
	<li><a href='http://codebetter.com/kylebaley/2011/07/' title='July 2011'>July 2011</a></li>
	<li><a href='http://codebetter.com/kylebaley/2011/05/' title='May 2011'>May 2011</a></li>
	<li><a href='http://codebetter.com/kylebaley/2011/04/' title='April 2011'>April 2011</a></li>
	<li><a href='http://codebetter.com/kylebaley/2011/03/' title='March 2011'>March 2011</a></li>
	<li><a href='http://codebetter.com/kylebaley/2011/02/' title='February 2011'>February 2011</a></li>
	<li><a href='http://codebetter.com/kylebaley/2010/10/' title='October 2010'>October 2010</a></li>
	<li><a href='http://codebetter.com/kylebaley/2010/09/' title='September 2010'>September 2010</a></li>
	<li><a href='http://codebetter.com/kylebaley/2010/08/' title='August 2010'>August 2010</a></li>
	<li><a href='http://codebetter.com/kylebaley/2010/07/' title='July 2010'>July 2010</a></li>
	<li><a href='http://codebetter.com/kylebaley/2010/06/' title='June 2010'>June 2010</a></li>
	<li><a href='http://codebetter.com/kylebaley/2010/05/' title='May 2010'>May 2010</a></li>
	<li><a href='http://codebetter.com/kylebaley/2010/04/' title='April 2010'>April 2010</a></li>
	<li><a href='http://codebetter.com/kylebaley/2010/03/' title='March 2010'>March 2010</a></li>
	<li><a href='http://codebetter.com/kylebaley/2010/02/' title='February 2010'>February 2010</a></li>
	<li><a href='http://codebetter.com/kylebaley/2010/01/' title='January 2010'>January 2010</a></li>
	<li><a href='http://codebetter.com/kylebaley/2009/12/' title='December 2009'>December 2009</a></li>
	<li><a href='http://codebetter.com/kylebaley/2009/11/' title='November 2009'>November 2009</a></li>
	<li><a href='http://codebetter.com/kylebaley/2009/09/' title='September 2009'>September 2009</a></li>
	<li><a href='http://codebetter.com/kylebaley/2009/08/' title='August 2009'>August 2009</a></li>
	<li><a href='http://codebetter.com/kylebaley/2009/07/' title='July 2009'>July 2009</a></li>
	<li><a href='http://codebetter.com/kylebaley/2009/06/' title='June 2009'>June 2009</a></li>
	<li><a href='http://codebetter.com/kylebaley/2009/05/' title='May 2009'>May 2009</a></li>
	<li><a href='http://codebetter.com/kylebaley/2009/04/' title='April 2009'>April 2009</a></li>
	<li><a href='http://codebetter.com/kylebaley/2009/03/' title='March 2009'>March 2009</a></li>
	<li><a href='http://codebetter.com/kylebaley/2009/02/' title='February 2009'>February 2009</a></li>
	<li><a href='http://codebetter.com/kylebaley/2009/01/' title='January 2009'>January 2009</a></li>
	<li><a href='http://codebetter.com/kylebaley/2008/12/' title='December 2008'>December 2008</a></li>
	<li><a href='http://codebetter.com/kylebaley/2008/11/' title='November 2008'>November 2008</a></li>
	<li><a href='http://codebetter.com/kylebaley/2008/10/' title='October 2008'>October 2008</a></li>
	<li><a href='http://codebetter.com/kylebaley/2008/09/' title='September 2008'>September 2008</a></li>
	<li><a href='http://codebetter.com/kylebaley/2008/08/' title='August 2008'>August 2008</a></li>
	<li><a href='http://codebetter.com/kylebaley/2008/07/' title='July 2008'>July 2008</a></li>
	<li><a href='http://codebetter.com/kylebaley/2008/06/' title='June 2008'>June 2008</a></li>
	<li><a href='http://codebetter.com/kylebaley/2008/05/' title='May 2008'>May 2008</a></li>
	<li><a href='http://codebetter.com/kylebaley/2008/04/' title='April 2008'>April 2008</a></li>
	<li><a href='http://codebetter.com/kylebaley/2008/03/' title='March 2008'>March 2008</a></li>
	<li><a href='http://codebetter.com/kylebaley/2008/02/' title='February 2008'>February 2008</a></li>
	<li><a href='http://codebetter.com/kylebaley/2008/01/' title='January 2008'>January 2008</a></li>
	<li><a href='http://codebetter.com/kylebaley/2007/12/' title='December 2007'>December 2007</a></li>
		</ul>
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(220407);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=68b8307'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=220407&amp;n=68b8307' /></a></noscript>				
				
				<ul class="xoxo">		
									</ul>	
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29421);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=3f8e353'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29421&amp;n=3f8e353' /></a></noscript>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="http://red-gate.com/">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="http://telerik.com">Telerik .NET Tools</a></li>
<li><a href="http://jetbrains.com/resharper/">JetBrains - ReSharper</a></li>
<li><a href="http://scootersoftware.com">Beyond Compare</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a></li>
<li><a href="http://umbraco.com" target="_blank">Umbraco</a></li>
<li><a href="http://nservicebus.com" target="_blank">NServiceBus</a></li>
<li><a href="http://ravendb.net" target="_blank">RavenDb</a></li>
<li><a href="http://www.websequencediagrams.com/" target="_blank">Web Sequence Diagrams</a></li>
	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '12<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPython.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = true; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>

<script type='text/javascript'>//<![CDATA[
    if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.4.2.min.js' type='text/javascript' %3E%3C/script%3E"));
    }//]]></script>
<script type='text/javascript' language='Javascript' src='http://s1.lqcdn.com/m.min.js?dt=2.3.110202.1'></script>
<script type='text/javascript' language='Javascript'> if(jQuery.LqmAds)jQuery.LqmAds();</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.492 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2012-11-09 14:45:13 -->
<!-- super cache -->