<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Architecting LINQ to SQL applications, part 3 | Ian Cooper</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/iancooper/xmlrpc.php" />
	                <link rel="stylesheet" href="http://codebetter.com/iancooper/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='http://codebetter.com/iancooper/wp-includes/js/l10n.js?ver=20101110'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/iancooper/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://codebetter.com/iancooper/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Ian Cooper' href='http://codebetter.com/iancooper/' />
<link rel='start' title='Hello World' href='http://codebetter.com/iancooper/2007/11/17/hello-world-2/' />
<link rel='prev' title='Architecting LINQ to SQL applications, part 2' href='http://codebetter.com/iancooper/2007/11/30/architecting-linq-to-sql-applications-part-2/' />
<link rel='next' title='Architecting LINQ to SQL applications, part 4' href='http://codebetter.com/iancooper/2007/12/04/architecting-linq-to-sql-applications-part-4/' />
<meta name="generator" content="WordPress 3.1-beta1-16732" />
<link rel='canonical' href='http://codebetter.com/iancooper/2007/12/02/architecting-linq-to-sql-applications-part-3/' />
<link rel='shortlink' href='http://codebetter.com/iancooper/?p=11' />
<link rel="stylesheet" href="http://codebetter.com/iancooper/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.0.7" type="text/css" media="screen" /><link rel="stylesheet" href="http://disqus.com/stylesheets/codebetteriancooper/disqus.css?v=2.0" type="text/css" media="screen" /><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.1" />
                <script type="text/javascript" src="http://codebetter.com/iancooper/wp-content/uploads/spacker-cache/a8046d2f1fc1c08af413701218a11c1d.js">/*Is Cache!*/</script>
                	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>

</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">			</div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-11" class="post-11 post type-post status-publish format-standard hentry category-linq category-tdd">
					<h1 class="entry-title">Architecting LINQ to SQL applications, part 3</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/iancooper/author/iancooper/" title="View all posts by Ian Cooper">Ian Cooper</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/iancooper/2007/12/02/architecting-linq-to-sql-applications-part-3/" title="11:31 pm" rel="bookmark"><span class="entry-date">December 2, 2007</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/iancooper/feed/rss/"  rel="nofollow"><img src="http://codebetter.com/iancooper/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/iancooper/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><h2 style="margin: 10pt 0cm 0pt"><span><font size="4"><font color="#4f81bd"><font face="Times New Roman">DAOs and Repositories</font></font></font></span></h2>
<p><span lang="EN-GB"><font face="Times New Roman">One of the concerns we want to separate our domain from, is how we persist the domain model. The domain should not need to where: file, database, service etc. or how. In the specific context of an RDBMS, because we do not want the domain to be relational database or its schema we do not want any SQL statements or ADO.NET objects within our domain. It is not just that the external schema may change but also that there may a mismatch when mapping between the two, the </font></span><a href="http://en.wikipedia.org/wiki/Object-Relational_impedance_mismatch"><span lang="EN-GB"><font color="#0000ff" face="Times New Roman">impedance mismatch problem</font></span></a><span lang="EN-GB"><font face="Times New Roman">.</font></span> </p>
<h3 style="margin: 10pt 0cm 0pt"><span lang="EN-GB"><font size="2"><font color="#4f81bd"><font face="Times New Roman">DAO</font></font></font></span></h3>
<p><span lang="EN-GB"><font face="Times New Roman">A Data Access Object (</font></span><a href="http://java.sun.com/blueprints/corej2eepatterns/Patterns/DataAccessObject.html"><span lang="EN-GB"><font color="#0000ff" face="Times New Roman">DAO</font></span></a><span lang="EN-GB"><font face="Times New Roman">) is a pattern for encapsulating data access. A DAO is an abstraction that provides services for retrieving, inserting, updating, and deleting objects from a persistent store.&nbsp; </font></span><span lang="EN-GB"><font face="Times New Roman">Fowler calls a DAO a </font></span><a href="http://martinfowler.com/eaaCatalog/dataMapper.html"><span lang="EN-GB"><font color="#0000ff" face="Times New Roman">Data Mapper</font></span></a><font face="Times New Roman">. We will use this term from now on, because the term DAO means different things to different people.</font></p>
<p><img src="/blogs/ian_cooper/datamapper.jpg" style="width: 627px;height: 168px" alt="Data Mapper" height="168" width="627"></p>
<p><font face="Times New Roman">Because the Data Mapper knows the details of RDBMS, how to connect to a DB, relational schemas, SQL etc. it cannot live in the domain, instead it is an infrastructure service. Because we do not want our domain to depend on concrete classes, we need to provide an interface for the Data Mapper, so that we can depend on an abstraction from the domain. <span lang="EN-GB">We want to be insulated from change in either the persistence mechanism or medium. </span></font></p>
<p><font face="Times New Roman"><span lang="EN-GB">Test-first development will drive out this abstraction, because we want to replace the dependency on the DB at runtime (to both prevent issues with shared fixtures and slow tests).</span></font><span lang="EN-GB"><font face="Times New Roman">The domain, or an application service, uses the Data Mapper for persistence. </font></span></p>
<p><span lang="EN-GB"><font face="Times New Roman">Most hand-rolled or code-generation Data Mappers are the simplest form using hard-coding, configuration files, or reflection to map between a class in the domain and a table in the RDBMS. Within .NET, a Data Mapper often contains ADO.NET code, using dynamic SQL or stored procedures. Internally a Data Mapper tends to use a DataReader for performance. Of course the Data Mapper does not have to be abstracting a DB, and we might be using XMLDocument etc. under the hood. </font></span></p>
<p><span lang="EN-GB"><font face="Times New Roman"></font></span><span lang="EN-GB"><font face="Times New Roman">The biggest advantages to the Data Mapper pattern are </font></span><span style="font-family: Symbol" lang="EN-GB"><span>&nbsp;</span></span> </p>
<ul>
<li><span style="font-family: Symbol" lang="EN-GB"><span></span></span><span lang="EN-GB"><font face="Times New Roman">Simplicity: it leaves us with a clean domain model where the orthogonal concern of persistence is separated out of from the domain classes. </font></span><span style="font-family: Symbol" lang="EN-GB"><span>&nbsp;</span></span></li>
<li><span style="font-family: Symbol" lang="EN-GB"><span></span></span><span lang="EN-GB"><font face="Times New Roman">Extensibility:<span>&nbsp; </span>By depending on an abstraction, instead of a concrete type, we can swap implementations (through a factory or IoC container) which allows us the flexibility to meet new needs, such as support for multiple vendors SQL implementations.</font></span><span style="font-family: Symbol" lang="EN-GB"><span>&nbsp;</span></span></li>
<li><span style="font-family: Symbol" lang="EN-GB"><span></span></span><span lang="EN-GB"><font face="Times New Roman">Maintainability: Having all of the data access code for a class in one place, reduces duplication and shotgun surgery when we need to update our data access code.</font></span></li>
</ul>
<p><span lang="EN-GB"><font face="Times New Roman"></font></span><span lang="EN-GB"><font face="Times New Roman">There are a number of complimentary patterns we can add when we use a Data Mapper:</font></span> </p>
<ul>
<li><span lang="EN-GB"><font face="Times New Roman"></font></span><a href="http://www.martinfowler.com/eaaCatalog/identityMap.html"><span lang="EN-GB"><font color="#0000ff" face="Times New Roman">Identity Map</font></span></a><span lang="EN-GB"><font face="Times New Roman">: When we load an entity we want future loads of that same entity to return the same reference. This is not for performance, a happy side effect, but ensures that we don’t lose any pending changes next time we reload, and allows us to compare for equality by address.</font></span></li>
<li><span lang="EN-GB"><font face="Times New Roman"></font></span><a href="http://www.martinfowler.com/eaaCatalog/unitOfWork.html"><span lang="EN-GB"><font color="#0000ff" face="Times New Roman">Unit of Work</font></span></a><span lang="EN-GB"><font face="Times New Roman">: Records the deltas between an object when loaded and when persisted so that we only update with changes not everything. The unit of work also allows us to bundle up changes and make them together, so as to improve performance.</font></span></li>
<li><span lang="EN-GB"><font face="Times New Roman"></font></span><a href="http://www.martinfowler.com/eaaCatalog/queryObject.html"><span lang="EN-GB"><font color="#0000ff" face="Times New Roman">Query Object</font></span></a><span lang="EN-GB"><font face="Times New Roman">: We don’t want to pollute our domain space with SQL when we want to perform dynamic queries so we need an alternative way of representing a query.</font></span><span lang="EN-GB"><font face="Times New Roman">Instead of rolling-our-own for a Data Mapper we can adopt the expedient of buying an off-the-shelf product in the RDBMS space called an Object Relational Mapping Tool.</font></span> </li>
</ul>
<h3 style="margin: 10pt 0cm 0pt"><span lang="EN-GB"><font size="2"><font color="#4f81bd"><font face="Times New Roman">Repository</font></font></font></span></h3>
<p><span lang="EN-GB"><font face="Times New Roman">If we have a hand rolled Data Mapper, or ORM, although we can make calls to it from the domain, we still want to encapsulate that interaction. </font></span></p>
<p><span lang="EN-GB"><font face="Times New Roman"><img src="/blogs/ian_cooper/repository.jpg" style="width: 627px;height: 168px" alt="repository" height="168" width="627">&nbsp;</font></span></p>
<p><span lang="EN-GB"><font face="Times New Roman">There are a number of reasons for this but the most important are:</font></span></p>
<ul>
<li><span lang="EN-GB"><font face="Times New Roman">DRY: We don’t want repeated code, setting up a Query object to do a common query for example, so by encapsulating into a single method we prevent that.</font></span><span style="font-family: Symbol" lang="EN-GB"><span>&nbsp;</span></span></li>
<li><span style="font-family: Symbol" lang="EN-GB"><span></span></span><span lang="EN-GB"><font face="Times New Roman">Shotgun Surgery: We don’t want to have to modify our calls to the Data Mapper in many places, so by adding the code to a single class we don’t have to go for searching it out within our application.</font></span><span style="font-family: Symbol" lang="EN-GB"><span>&nbsp;</span></span></li>
<li><span style="font-family: Symbol" lang="EN-GB"><span></span></span><span lang="EN-GB"><font face="Times New Roman">Gateway: We might want to change our ORM at some point in the future. Encapsulating the calls to the ORM allows us to limit the modifications we have to make to the classes that are implemented using the ORM.</font></span></li>
</ul>
<p><span lang="EN-GB"><font face="Times New Roman"></font></span><span lang="EN-GB"><font face="Times New Roman">The </font></span><a href="http://martinfowler.com/eaaCatalog/repository.html"><span lang="EN-GB"><font color="#0000ff" face="Times New Roman">Repository pattern</font></span></a><span><font face="Times New Roman"> <span lang="EN-GB">looks and feels like a collection to the domain. This makes it clear and simple to work with. <span>&nbsp;</span>The unit of work often remains outside of the repository, because we may want to update multiple elements on a repository or multiple repositories at once. </span></font></span><span><font face="Times New Roman"><span lang="EN-GB">The repository is implemented by calls to the Data Mapper. </span></font></span><span></span><span lang="EN-GB"></span><span lang="EN-GB"><font face="Times New Roman">Building a repository with LINQ is almost trivial:</font></span> </p>
<p><span lang="EN-GB">public class NorthwindRepository <br />{<br />&nbsp;&nbsp;&nbsp; private IQueryable&lt;Customer&gt; customers;<br />&nbsp;&nbsp;&nbsp; public NorthwindRepository(DataContext context)<br />&nbsp;&nbsp;&nbsp; {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; customers = context.GetTable&lt;Customer&gt;();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp; }</span></p>
<p><span lang="EN-GB">&nbsp;&nbsp;&nbsp; public Customer FindCustomer(string customerId)<br />&nbsp;&nbsp;&nbsp; {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return (from c in customers <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; where c.CustomerID == customerId<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; select c).Single&lt;Customer&gt;();<br />&nbsp;&nbsp;&nbsp; }<br />} <br /></span></p>
<p><span style="font-family: Consolas" lang="EN-GB"></span><span style="font-family: Consolas"></span><span lang="EN-GB"><font face="Times New Roman">There are two alternatives to testability with a repository: the simplest is to have the repository implement an abstraction (i.e. an interface), which you then provide an in-memory stub for, for testing purposes. The other is to provide an abstraction for the Data Mapper that your repository depends upon and provide a test stub for that. The advantage here is if you want to confirm querying logic within your repository. </font></span></p>
<p><span lang="EN-GB">public class CustomerRepository<br />{<br />&nbsp;&nbsp;&nbsp; private IUnitofWork workspace;<br />&nbsp;&nbsp;&nbsp; public CustomerRepository(IUnitofWork workspace)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.workspace = workspace;<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp; public Customer FindCustomer(string customerId)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return (from c in workspace.Customers<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; where c.CustomerID == customerId<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; select c).Single&lt;Customer&gt;();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp; }<br />}<br /></span></p>
<p><span style="font-family: Consolas"></span><span lang="EN-GB"><font face="Times New Roman">&nbsp;</font></span><span lang="EN-GB"><font face="Times New Roman">Jimmy Nilsson shows an example of this in his book: Applying Domain Driven-Design and Patterns and I talk more about testability in </font><a href="http://iancooper.spaces.live.com/Blog/cns%21844BD2811F9ABE9C%21397.entry"><font face="Times New Roman">Being Ignorant with LINQ to SQL</font></a><font face="Times New Roman">.</font></span> </p>
<h3 style="margin: 10pt 0cm 0pt"><span lang="EN-GB"><font size="2"><font color="#4f81bd"><font face="Times New Roman">Roles in LINQ to SQL</font></font></font></span></h3>
<p><span lang="EN-GB"><font face="Times New Roman">LINQ to SQL provides an ORM tool for use with .NET. Components within LINQ to SQL map to ORM patterns:</font></span><span></span><span lang="EN-GB"></span><span lang="EN-GB"><font face="Times New Roman">&nbsp;</font></span><span lang="EN-GB"><font face="Times New Roman">LINQ to SQL’s DataContext contains an Identity Map that holds objects already loaded from the database. It also acts as a unit of work: you call the DataContext to submit your changes and it figures out the SQL statements necessary to figure out what has changed from the version last loaded. Note that LINQ to SQL optimizes queries that are against the primary key, by returning directly from the map rather than re-querying. For anything else, it cannot know what the returned set will be in advance, so it has to return them</font></span><span lang="EN-GB"><font face="Times New Roman">My first piece of advice around LINQ to SQL, based on existing ORM practice, would be: </font></span><b><i><span lang="EN-GB"><font face="Times New Roman">LINQ to SQL is an ORM and may be safely called from within the domain layer. Calls to LINQ to SQL do <span>&nbsp;</span>not need to be placed in the infrastructure layer (sometimes called data access layer in this role). LINQ to SQL fulfils the role of a Data Mapper within the infrastructure layer already, so this would just be a repetition of the abstraction. However, do consider wrapping interaction with the LINQ to SQL ORM within a Repository, instead of using it throughout the domain to simplify testing and maintenance.</font></span></i></b> </p>
<p><font face="Times New Roman">Next time we&#8217;ll talk about dynamic queries.</font></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
											</div><!-- .entry-content -->

					<div id="entry-author-info">
						<div id="author-avatar">
							<img alt='' src='http://1.gravatar.com/avatar/b033a6c1af4ee8d7a734f3684225ea8a?s=60&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=R' class='avatar avatar-60 photo' height='60' width='60' />						</div><!-- #author-avatar 	-->
						<div id="author-description">
							<h2>About Ian Cooper</h2>
							Ian Cooper has over 18 years of experience delivering Microsoft platform solutions in government, healthcare, and finance. During that time he has worked for the DTi, Reuters, Sungard, Misys and Beazley delivering everything from bespoke enterpise solutions to 'shrink-wrapped' products to thousands of customers. Ian is a passionate exponent of the benefits of OO and Agile. He is test-infected and contagious. When he is not writing C# code he is also the and founder of the London .NET user group. http://www.dnug.org.uk							<div id="author-link">
								<a href="http://codebetter.com/iancooper/author/iancooper/" title="View all posts by Ian Cooper">View all posts by Ian Cooper &rarr;</a>
							</div><!-- #author-link	-->
						</div><!-- #author-description	-->
					</div><!-- .entry-author-info -->

					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/iancooper/category/linq/" title="View all posts in LINQ" rel="category tag">LINQ</a>, <a href="http://codebetter.com/iancooper/category/tdd/" title="View all posts in TDD" rel="category tag">TDD</a>. Bookmark the <a href="http://codebetter.com/iancooper/2007/12/02/architecting-linq-to-sql-applications-part-3/" title="Permalink to Architecting LINQ to SQL applications, part 3" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/iancooper/2007/12/02/architecting-linq-to-sql-applications-part-3/feed/" title="Comments RSS to Architecting LINQ to SQL applications, part 3" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-11 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/iancooper/2007/11/30/architecting-linq-to-sql-applications-part-2/" rel="prev"><span class="meta-nav">&larr;</span> Architecting LINQ to SQL applications, part 2</a></div>
					<div class="nav-next"><a href="http://codebetter.com/iancooper/2007/12/04/architecting-linq-to-sql-applications-part-4/" rel="next">Architecting LINQ to SQL applications, part 4 <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
					<div id="dsq-content">
			<ul id="dsq-comments">
					<li id="dsq-comment-83">
					<div id="dsq-comment-header-83" class="dsq-comment-header">
						<cite id="dsq-cite-83">
								<span id="dsq-author-user-83">Al</span>
							</cite>
					</div>
					<div id="dsq-comment-body-83" class="dsq-comment-body">
						<div id="dsq-comment-message-83" class="dsq-comment-message"><p>I am reading your Architecting LINQ to SQL applications series with interest and hoping to find some answers to my questions. Here is a typical application layer:</p>
<p>Data<br />
&#8212;&#8212;-<br />
Respository<br />
DataMapper</p>
<p>Business<br />
&#8212;&#8212;&#8212;&#8212;-<br />
Facade<br />
Domain</p>
<p>Presentation<br />
&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;<br />
View</p>
<p>Now, I have my domain objects such as Person, Order. Presentation access domain objects through a Facade for operations; database for this example. Facade accesses the Repository, repository accesses the DataMapper which would map my domain object to a Data Access Object which will be the Linq entity that represents a Person table.</p>
<p>Since my domain object is not one to one match to a Person entitiy, I will call my Linq to Sql generated entity PersonDAO. I will be mapping the PersonDAO to my Person object.</p>
<p>I know I am missing something here but is this how this is supposed to work? How can I keep my domain objects clean without this kind of mapping?</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-84">
					<div id="dsq-comment-header-84" class="dsq-comment-header">
						<cite id="dsq-cite-84">
								<span id="dsq-author-user-84">Ian Cooper</span>
							</cite>
					</div>
					<div id="dsq-comment-body-84" class="dsq-comment-body">
						<div id="dsq-comment-message-84" class="dsq-comment-message"><p>Hi Al,</p>
<p>Sadly I think that the designers with LINQ are causing some of this confusion, because people imagine that their generated entities are not the domain level objects. They are, or should be, because only the .NET SDK implementation of Table<t> and DataContext are within the infrastructure, the generated classes are domain level. What  the designers are trying to do for you is to generate your domain model.  Note that the classes are partial, so you can extend them for the required behavior by adding your own partial classes.</p>
<p>The problem is that the usage pattern for the designers, is: design your data schema, and then generate your entities. This is the wrong way around. design your domain first, then map your schema from it. That is the key to an easy life with an ORM tool. (Bear in mind that if you want some sort of optimized schema for reporting you might need to consider separating your OLTP store and OLAP store anyway, so it should not worry you overly, to have your schema close to your domain model).</p>
<p>What you should be doing is designing your domain layer, and then either attributing the class or using an XML file to map that domain to a schema. If you have a non-legacy scenario the domain should come first. I would suggest dumping the use of the designer. I think it is another case where an MS supplied designer makes then problem more, not less, complicated.</p>
<p>I&#8217;ll have a lot more to say about this in a  future post. But for now I would urge you all to work with the domain you want, then mark it up for persistence. </p>
<p> Note that in legacy scenarios you may hit walls around some of the mapping options in LINQ to SQL (same as you would in, for example, Wilson O/R Mapper) and you need to think about using something like NHibernate instead.</p>
<p>Again I&#8217;ll talk more about this in a future post, but the optimal scenarios for the mapping options provided by LINQ to SQL are where you have a greenfield application and the schema can be broadly similar to the domain model. Legacy schemas will tend to cause you grief.</t></p>
</div>
					</div>
				</li>
					<li id="dsq-comment-85">
					<div id="dsq-comment-header-85" class="dsq-comment-header">
						<cite id="dsq-cite-85">
								<span id="dsq-author-user-85">Al</span>
							</cite>
					</div>
					<div id="dsq-comment-body-85" class="dsq-comment-body">
						<div id="dsq-comment-message-85" class="dsq-comment-message"><p>Thanks Ian,</p>
<p>XML mapping (SourceMapping) to classes makes sense to use my domain object. Is SqlMetal capable of creating the XML file for mapping? If not, it manual mapping the only option? IS MS going to provide a tool for creating the XML file for mapping?</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-86">
					<div id="dsq-comment-header-86" class="dsq-comment-header">
						<cite id="dsq-cite-86">
	http://blogs.msdn.com/mattwar							<span id="dsq-author-user-86">Matt Warren</span>
							</cite>
					</div>
					<div id="dsq-comment-body-86" class="dsq-comment-body">
						<div id="dsq-comment-message-86" class="dsq-comment-message"><p>SQLMetal can in fact create the XML mapping file for you.  It is one of the output options.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-87">
					<div id="dsq-comment-header-87" class="dsq-comment-header">
						<cite id="dsq-cite-87">
	http://pretzelsteelersfan.blogspot.com/							<span id="dsq-author-user-87">Paul Brown</span>
							</cite>
					</div>
					<div id="dsq-comment-body-87" class="dsq-comment-body">
						<div id="dsq-comment-message-87" class="dsq-comment-message"><p>Hey Ian,</p>
<p>The LinqDataSource requires that the DataContext be exposed and actually forms the query effectively putting the them in the presentation layer. Dinesh seems to <a href="http://blogs.msdn.com/dinesh.kulkarni/archive/2007/10/15/dtos-or-business-objects.aspx">argue that this is ok</a> in small-medium apps and I tend to agree (especially I legacy apps that are highly stable). Your thoughts?</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-88">
					<div id="dsq-comment-header-88" class="dsq-comment-header">
						<cite id="dsq-cite-88">
								<span id="dsq-author-user-88">SteveG</span>
							</cite>
					</div>
					<div id="dsq-comment-body-88" class="dsq-comment-body">
						<div id="dsq-comment-message-88" class="dsq-comment-message"><p>I&#8217;d like you to expand on this unit of work sample code.  I think you ran over it quite quickly and I&#8217;m not making the connection to what it is accomplishing in your code snippet above.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-89">
					<div id="dsq-comment-header-89" class="dsq-comment-header">
						<cite id="dsq-cite-89">
								<span id="dsq-author-user-89">SteveG</span>
							</cite>
					</div>
					<div id="dsq-comment-body-89" class="dsq-comment-body">
						<div id="dsq-comment-message-89" class="dsq-comment-message"><p>I should add: isn&#8217;t the, ie.  ISession(NH) or DataContext (LSQL) the Unit of work here?</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-90">
					<div id="dsq-comment-header-90" class="dsq-comment-header">
						<cite id="dsq-cite-90">
								<span id="dsq-author-user-90">Mohammad Azam</span>
							</cite>
					</div>
					<div id="dsq-comment-body-90" class="dsq-comment-body">
						<div id="dsq-comment-message-90" class="dsq-comment-message"><p>Hi, </p>
<p>So, how are you initializing the DataContext and from where are you sending the context. </p>
<p>public class NorthwindRepository<br />
{<br />
    private IQueryable<customer> customers;<br />
    public NorthwindRepository(DataContext context)<br />
    {<br />
        customers = context.GetTable</customer><customer>();<br />
    }</p>
<p>    public Customer FindCustomer(string customerId)<br />
    {<br />
        return (from c in customers<br />
            where c.CustomerID == customerId<br />
            select c).Single</customer><customer>();<br />
    }<br />
}</customer></p>
</div>
					</div>
				</li>
					<li id="dsq-comment-91">
					<div id="dsq-comment-header-91" class="dsq-comment-header">
						<cite id="dsq-cite-91">
	http://www.game4power.com							<span id="dsq-author-user-91">buy wow gold</span>
							</cite>
					</div>
					<div id="dsq-comment-body-91" class="dsq-comment-body">
						<div id="dsq-comment-message-91" class="dsq-comment-message"><p>WoW shares many <a href="http://www.game4power.com/">wow gold</a> of its features with previously launched games. Essentially, you battle with <a href="http://www.game4power.com/buy-gold/">Cheapest wow gold</a> monsters and traverse the countryside, by yourself or as a <a href="http://www.game4power.com/buy-gold/">buy cheap wow gold</a> team, find challenging tasks, and go on to higher <a href="http://www.wowgoldone.com/"> Cheap Wow Gold </a> levels as you gain skill and experience. In the course of your journey, you will be gaining new powers that are increased as your skill rating goes up. All the same, in terms of its features and quality, that is a ture stroy for this.WoW is far ahead of all other games of the genre the <a href="http://www.gamelevelup.com/">wow power leveling</a> game undoubtedly is in a league of its own and <a href="http://www.wowgoldone.com/">cheapest wow gold </a> playing it is another experience altogether.<br />
Even though WoW is a <a href="http://www.game4power.com/buy-gold">wow gold cheap </a> rather complicated game, the controls and interface are done in <a href="http://www.bestwarhammer.com/"> buy warhammer gold</a> such a way that you don&#8217;t feel the complexity. A good feature of the game is that it <a href="http://www.itemstores.com/">buy wow items</a> does not put off people with lengthy manuals. The instructions cannot be simpler and the pop up tips can help you start playing the game <a href="http://www.itemchannel.com/">World Of Warcraft Gold </a> immediately. If on the other hand, you need a detailed manual, the instructions are there for you to access. Buy wow gold in this site,good for you ,<a href=http://www.meinwowgold.com/>WoW Gold, <a href="http://www.game4power.com/">BUY WOW GOLD</a>.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-92">
					<div id="dsq-comment-header-92" class="dsq-comment-header">
						<cite id="dsq-cite-92">
	http://www.faysale.com							<span id="dsq-author-user-92">wow gold</span>
							</cite>
					</div>
					<div id="dsq-comment-body-92" class="dsq-comment-body">
						<div id="dsq-comment-message-92" class="dsq-comment-message"><p><a href="http://www.faysale.com" rel="nofollow">http://www.faysale.com</a><br />
<a href="http://www.mmorpgvip.com" rel="nofollow">http://www.mmorpgvip.com</a></p>
</div>
					</div>
				</li>
					<li id="dsq-comment-93">
					<div id="dsq-comment-header-93" class="dsq-comment-header">
						<cite id="dsq-cite-93">
	http://www.metin2.mobi							<span id="dsq-author-user-93">metin2 yang</span>
							</cite>
					</div>
					<div id="dsq-comment-body-93" class="dsq-comment-body">
						<div id="dsq-comment-message-93" class="dsq-comment-message"><p>metin2 yang<br />
metin2 yang</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-94">
					<div id="dsq-comment-header-94" class="dsq-comment-header">
						<cite id="dsq-cite-94">
	http://www.worldofwarcraftwowgold.com							<span id="dsq-author-user-94">wow gold cheap</span>
							</cite>
					</div>
					<div id="dsq-comment-body-94" class="dsq-comment-body">
						<div id="dsq-comment-message-94" class="dsq-comment-message"><p>You can read them and get the main points you need fast wow gold. Which is an extremely usable spell that can be cast wow gold instant every three minutes, the Shaman will find that their instant wow gold and mana will drain faster. fast gold world of the popular and wonderful WOW online game is now mass market. If you need some wow gold cheap and WOW powerleveling, just as come to our website.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-95">
					<div id="dsq-comment-header-95" class="dsq-comment-header">
						<cite id="dsq-cite-95">
	http://makemoneyonline18.blogspot.com							<span id="dsq-author-user-95">zyxu cubar tyoue</span>
							</cite>
					</div>
					<div id="dsq-comment-body-95" class="dsq-comment-body">
						<div id="dsq-comment-message-95" class="dsq-comment-message"><p>this is a very good post</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-96">
					<div id="dsq-comment-header-96" class="dsq-comment-header">
						<cite id="dsq-cite-96">
	http://www.heychristianlouboutin.com							<span id="dsq-author-user-96">Christian Louboutin On Sale</span>
							</cite>
					</div>
					<div id="dsq-comment-body-96" class="dsq-comment-body">
						<div id="dsq-comment-message-96" class="dsq-comment-message"><p>what&#8217;s your name? bmx</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-97">
					<div id="dsq-comment-header-97" class="dsq-comment-header">
						<cite id="dsq-cite-97">
								<span id="dsq-author-user-97">wulijun</span>
							</cite>
					</div>
					<div id="dsq-comment-body-97" class="dsq-comment-body">
						<div id="dsq-comment-message-97" class="dsq-comment-message"><p>hgfhfdhdhd</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-98">
					<div id="dsq-comment-header-98" class="dsq-comment-header">
						<cite id="dsq-cite-98">
								<span id="dsq-author-user-98">wulijun</span>
							</cite>
					</div>
					<div id="dsq-comment-body-98" class="dsq-comment-body">
						<div id="dsq-comment-message-98" class="dsq-comment-message"><p>fhfchfgf</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-99">
					<div id="dsq-comment-header-99" class="dsq-comment-header">
						<cite id="dsq-cite-99">
	http://www.metin2market.com							<span id="dsq-author-user-99">metin2 yang</span>
							</cite>
					</div>
					<div id="dsq-comment-body-99" class="dsq-comment-body">
						<div id="dsq-comment-message-99" class="dsq-comment-message"><p>nice posts</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-100">
					<div id="dsq-comment-header-100" class="dsq-comment-header">
						<cite id="dsq-cite-100">
	http://www.examplemag.com							<span id="dsq-author-user-100">ExampleMag</span>
							</cite>
					</div>
					<div id="dsq-comment-body-100" class="dsq-comment-body">
						<div id="dsq-comment-message-100" class="dsq-comment-message"><p>Thanks for a nice solution, really needed some help with LINQ.</p>
</div>
					</div>
				</li>
				</ul>
		</div>
	</div>

<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

<script type="text/javascript">
/* <![CDATA[ */
	var disqus_url = 'http://codebetter.com/iancooper/2007/12/02/architecting-linq-to-sql-applications-part-3/ ';
	var disqus_identifier = '11 /blogs/ian_cooper/archive/2007/12/02/architecting-linq-to-sql-applications-part-3.aspx';
	var disqus_container_id = 'disqus_thread';
	var disqus_domain = 'disqus.com';
	var disqus_shortname = 'codebetteriancooper';
	var disqus_title = "Architecting LINQ to SQL applications, part 3";
		var disqus_config = function () {
	    var config = this; // Access to the config object

	    /* 
	       All currently supported events:
	        * preData — fires just before we request for initial data
	        * preInit - fires after we get initial data but before we load any dependencies
	        * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
	        * afterRender - fires when template is rendered but before we show it
	        * onReady - everything is done
	     */

		config.callbacks.preData.push(function() {
			// clear out the container (its filled for SEO/legacy purposes)
			document.getElementById(disqus_container_id).innerHTML = '';
		});
				config.callbacks.onReady.push(function() {
			// sync comments in the background so we don't block the page
			DISQUS.request.get('?cf_action=sync_comments&post_id=11');
		});
					};
	var facebookXdReceiverPath = 'http://codebetter.com/iancooper/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
	var DsqLocal = {
		'trackbacks': [
		],
		'trackback_url': "http:\/\/codebetter.com\/iancooper\/2007\/12\/02\/architecting-linq-to-sql-applications-part-3\/trackback\/"	};
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
	var dsq = document.createElement('script'); dsq.type = 'text/javascript';
	dsq.async = true;
	dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.61';
	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
					<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-new-features?utm_source=cb&utm_medium=button&utm_term=4328&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="125" height="125" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/ANTSPP5_125x125_M1.gif"></a>
					<embed width="125" height="125" flashvars="clickTARGET=_blank&amp;clickTAG=http%3A%2F%2Fd1.openx.org%2Fck.php%3Foaparams%3D2__bannerid%3D62753__zoneid%3D29419__cb%3Da0471ce5e8__r_id%3Dd42118811971f057012db20aa261c5c1__r_ts%3Dldef6x__oadest%3Dhttp%253A%252F%252Fwww.jetbrains.com%252Fresharper%252F%253Frs4cb125" allowscriptaccess="always" quality="high" name="Advertisement" id="Advertisement" style="" src="http://s3.amazonaws.com/CodeBetter/Creative/tc_125x125_simple2.swf" type="application/x-shockwave-flash">
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				<script type="text/javascript" src="http://engine.theloungenet.com/z/15/adzerk1_2_5"></script>
				<div id="adzerk1"></div>
				
				<ul class="xoxo">		
									</ul>	
				
				<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-csharp?utm_source=cb&utm_medium=rectangle&utm_term=4327&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="300" height="250" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/APP6_Launch_C%23_Jun10_300x250_M1.gif?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1458095516&amp;Signature=BIBDilUaLnZe1uKfVKyyTBxr%2BvE%3D"></a>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/" title="Search Results">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="/blogs/products/pages/64386.aspx">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="/blogs/products/pages/64615.aspx">Telerik</a></li>
<li><a href="/blogs/products/pages/142174.aspx">JetBrains - ReSharper</a></li>
<li><a href="/blogs/products/pages/Beyond-Compare.aspx">Beyond Compare</a></li>
<li><a href="/blogs/products/pages/.NET-Memory-Profiler.aspx">.NET Memory Profiler</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a> &lt;-- NEW Friend!</li>

	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '11<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = false; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.799 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-01-27 12:40:41 -->
<!-- super cache -->