<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Architecting LINQ To SQL Applications, part 7 | Ian Cooper</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/iancooper/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css?v=3912785705" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js?ver=3.4.2'></script>
<script type='text/javascript' src='http://dtym7iokkjlif.cloudfront.net/dough/1.0/recipe.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/iancooper/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Architecting LINQ To SQL Applications, part 6' href='http://codebetter.com/iancooper/2008/03/09/previous-architecting-linq-to-sql-applications-part-5/' />
<link rel='next' title='Architecting LINQ To SQL Applications, part 8' href='http://codebetter.com/iancooper/2008/04/06/architecting-linq-to-sql-applications-part-8/' />
<meta name="generator" content="WordPress 3.4.2" />
<link rel='shortlink' href='http://codebetter.com/iancooper/?p=27' />

<!-- All in One SEO Pack 1.6.13.2 by Michael Torbert of Semper Fi Web Design[83,148] -->
<link rel="canonical" href="http://codebetter.com/iancooper/2008/03/09/architecting-linq-to-sql-applications-part-7/" />
<!-- /all in one seo pack -->
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.3.3" type="text/css" media="screen" />

<!-- Start Shareaholic OgTags -->

	<!-- Shareaholic Notice: There is neither a featured nor gallery image set -->

<!-- End Shareaholic OgTags -->

<meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/dc168cf39155d7b5d39f696ca94d5980.js?v=5302176208">/*Is Cache!*/</script>
                	
	<script type='text/javascript' src='http://d1.openx.org/spcjs.php?id=7744&amp;target=_blank'></script>
	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>
<!-- BuySellAds Ad Code -->
<script type="text/javascript">
(function(){
  var bsa = document.createElement('script');
     bsa.type = 'text/javascript';
     bsa.async = true;
     bsa.src = 'http://s3.buysellads.com/ac/bsa.js';
  (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);
})();
</script>
<!-- End BuySellAds Ad Code -->
</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">
			<!-- BuySellAds Zone Code -->
<div id="bsap_1276080" class="bsarocks bsap_4fe632babdccc2b4b049e4f08cc3c549"></div>
<!-- End BuySellAds Zone Code --></div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-27" class="post-27 post type-post status-publish format-standard hentry category-featured category-linq">
					<h1 class="entry-title">Architecting LINQ To SQL Applications, part 7</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/iancooper/author/iancooper/" title="View all posts by Ian Cooper">Ian Cooper</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/iancooper/2008/03/09/architecting-linq-to-sql-applications-part-7/" title="6:55 pm" rel="bookmark"><span class="entry-date">March 9, 2008</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/iancooper/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/iancooper/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><!-- Start Shareaholic LikeButtonSetTop Automatic --><!-- End Shareaholic LikeButtonSetTop Automatic --><p><P>Previously: <A class="" href="http://codebetter.com/blogs/ian_cooper/archive/2008/03/09/previous-architecting-linq-to-sql-applications-part-5.aspx">Architecting LINQ To SQL Applications, part 6</A></P><br />
<P>The topic of managing entity lifetimes&nbsp;is an important one as many of the issues that people have when using an ORM for the first time relate to a lack of understanding of how an ORM manages objects loaded from the Db, or that&nbsp;are to be inserted into the Db. In addition over the next few installments we will&nbsp;begin to talk about some of the issues related to multi-tier&nbsp;scenarios. It is important to understand how lifetime is managed because many of the issues people have come from working against the ORM rather than with it in these circumstances.</P><br />
<H3>What are Entity and Value types</H3><br />
<P>An <EM>Entity</EM> is a type which has an identity that remains unique and consistent throughout its lifetime. It is a unique in the sense in that it must always be possible to distinguish one entity from another. It is consistent in that even if the attributes change, the entity will still retain its identity. Consider a Customer type. As an entity we must be able to distinguish one customer from another. We need to somehow define Customer identity through a member. We avoid using natural members like Name because they are not individually unique and may change over time.&nbsp;Instead we base the identity of our entity&nbsp;on a surrogate member that gives us identity instead. In this case we might define an Id member for our Customer that assigns them a unique&nbsp;value within our organization.&nbsp; </P><br />
<P>Within the Db a primary key field distinguishes an entity, which is represented by a row on a table. LINQ To SQL piggybacks on this to provide support for an Entity, via a type mapped via a Table attribute or mapping, that corresponds to a table that has a primary key. So we map our Customer class to a Customer table and our Id member to an Id&nbsp;primary key field on that table. Again&nbsp;natural keys are allowed, but should be avoided in favour of surrogates to ensure&nbsp;that our entity remains unique and identifiable throughout its lifetime.</P><br />
<P>The counterpart to an Entity type is a <EM>Value</EM> type. A Value type takes its identity from the value of its attributes. Two entities that have the same attributes, compare the same. For example two postcodes that have the value &#8220;ABC 123&#8243; compare the same so we consider them to have the same identity. A value type might have just the one attribute, as with our postcode example, but also might have multiple attributes. An example of a value type with multiple attributes&nbsp;would be a&nbsp;Money type that has both an Amount and a Currency. We want to compare two instances of Money for GBP 123.74 as equal.</P><br />
<P>Within the DB a Value is represented as one or more columns within the row of an entity. LINQ To SQL only supports primitives as Values i.e. string, int, etc. and has no support for mapping user-defined value types. Thus there&nbsp;is no direct support in LINQ To SQL&nbsp;for types like Money. Hopefully this is a limitation that will be addressed in future versions.</P><br />
<H3>Entity Lifetime</H3><br />
<P>A data context is a unit of work. It tracks changes and submits updates to the Db when flushed. Because of this you should only keep it around long enough to do the work &#8230;but no longer. When working with a DataContext we need to distinguish between, to borrow Hibernate terminology, <EM>transient</EM> and <EM>persistent</EM> entities. </P><br />
<P>Persistent objects have been loaded by LINQ To SQL and we have a reference to them in the DataContext’s identity map. The DataContext tracks changes for the persistent entity against the time that they were loaded. Future requests for that object, will return the object in the cache. Changes to that entity can be submitted to the Db.&nbsp; Lazy Loading of associations, uses the same DataContext we loaded the entity with originally.</P><br />
<P>An entity that is not in the identity map of the DataContext is a transient entity. It has a lifetime equivalent to the running application. To ensure that the entity persists we need to add it the matching table on the DataContext using InsertOnSubmit and flush it using SubmitChanges on the DataContext, causing the entity to become persistent.</P><br />
<P><STRONG>MyContext context = new MyContext();</STRONG></P><br />
<P><STRONG>//persistent object<BR>MyObject myOldObject = context.MyObjects.Where(m =&gt; m.Name == &#8220;Old&#8221;).Single();<BR>//changes are tracked<BR>myOldObject.Name = &#8220;Changed Name&#8221;;</STRONG></P><br />
<P><STRONG>//new entity; transient<BR>MyObject myNewobject = new MyObject();<BR>//no need to track; no Db row to update yet<BR>myNew.Name = &#8220;New Name&#8221;;</STRONG></P><br />
<P><STRONG>//make new object persistent and flush changes to old objects<BR>context.SubmitChanges(); </STRONG></P><br />
<P>This is not always intuitive:</P><br />
<P><STRONG>MyContext anotherContext= new MyContext();</STRONG></P><br />
<P><STRONG>//new entity; transient<BR>MyObject myNewobject = new MyObject();<BR>myNew.Name = &#8220;New Name&#8221;;</STRONG></P><br />
<P><STRONG>//new entity is still transient until we actually submit<BR>anotherContext.MyObjects.InsertOnSubmit(myNewobject);</STRONG></P><br />
<P><STRONG>//not persistent, won&#8217;t be found<BR>var results = anotherContext.MyObjects.Where(m =&gt; m.Name == &#8220;Old&#8221;);</STRONG></P><br />
<P>It is important to note that although an identity map is sometimes called a first-level cache its purpose is not to optimize retrieval of entities from the Db. Because the ORM, such as LINQ To SQL does not know the results of a query it cannot determine whether two calls to a query (even if it is the same query as other users may have updated the Db) will return the same result set. For this reason it must always bring the result set back, and then check for the existence of those entities within the identity map. If the map contains the item, we must return that instance instead because you might have made changes to the entity and we want to preserve them througout the unit of work. For this reason the cache is not about optimisation but about ensuring you do not lose changes during your unit of work. It is possible that queries that request an entity by primary key could be retrieved from the map directly, where they are already loaded, but you should not rely on this optimization.</P><br />
<P>Because we hold the object within the identity map for the lifetime of the unit of work there is a danger of concurrency errors, where another user updates the Db while we have the object. For this reason the identity map stores the original version of our object as well as the current one. This allows LINQ To SQL to compare the original against the state of the Db when it issues an update or delete query and raise an optimistic concurrency violation error if it has changed. Of course if you use a timestamp and set <STRONG>Update.Never</STRONG> on your mapping to inform LINQ To SQL that it should not check that field when looking for concurrency errors you can optimize this feature as well. However the optimal SQL issues by LINQ To SQL during an update still depends on knowing what has changed.</P><br />
<P>LINQ To SQL supports a Refresh method on its DataContext to force a reload of an entity or attributes of an entity. The purpose here is to allow you to resolve optimistic concurrency errors or to reload an object during a unit of work if you are aware that the Db has been changed by a mechanism outside of the purview of LINQ To SQL. The Refresh just goes back to the Db to find the latest version of your object. Note that refresh targets specific objects in the map or a set of objects.</P><br />
<P>You can disable use of the identity map by setting <STRONG>ObjectTrackingEnabled</STRONG> to false. The purpose here is to optimize when you are loading read-only collections i.e. you never want to submit changes on these objects back to the Db. Remember though that another DataContext will consider these to be transient objects, so avoid assigning references loaded this way into entities loaded via DataContexts which&nbsp;are tracking.</P><br />
<H3>Attaching Entities</H3><br />
<P>Sometimes we have an entity that is in the backing store but not in the identity cache of our DataContext. To make our DataContext aware that this is a persistent and not transient entity we need to Attach it to our DataContext. This puts it in our cache. However, our context&nbsp;cannot know if the entity is the same as the representation on the backing store, so it must assume so and change tracking will consider your object to be in the ‘original’ state.&nbsp; If your object has changed and you try to save those errors, you will get optimistic concurrency errors. This is because when we compare your ‘original’ to the Db, they do not match, which fools LINQ To SQL into thinking another user has changed it since we loaded it. </P><br />
<P>One option to avoid you must tell the DataContext what the original state in the Db was or set your columns as <STRONG>UpdateCheck.Never</STRONG>. If you have a Timestamp column, you can rely on that to do the right thing for you. Sometimes people suggest an&nbsp;<STRONG>Update.Never</STRONG> on every column strategy, where you cannot use a timestamp,&nbsp;but the danger is that&nbsp;we can overwrite genuine changes by another user. </P><br />
<P>Otherwise we need to either provide the original, by maintaining the original state for any objects we may choose to detach, or adopt a load and replay strategy for detached objects where we load the current representation from the Db and then write our changes over it. </P><br />
<P>Think carefully before heading down the detached objects route as it multiplies the complexity of what you are doing. This issue most often raises its head in multi-tier scenarios. We will talk about how to handle those in a future blog post, but for now recognize that the unit of work implies that the framework will not help you track changes outside of that context.</P><br />
<H3>Managing DataContexts</H3><br />
<P>Do not try to work with two different contexts at the same time. This is because what are persistent entities for one look like transient entities to the other because it does not have them in its identity map, as it did not load them.</P><br />
<P>Do not try to access an object graph loaded via LINQ To SQL outside of its DataContext if it has lazy loaded properties. This is because LINQ To SQL will access the original DataContext to load the entities.&nbsp; Trying to lazy load within another context falls foul of our earlier rule not to mix our contexts.</P><br />
<P>Finally, assume that a DataContext is not thread safe i.e. work with a DataContext only on one thread and do not try to pass entities retrieved via a DataContext on one thread, to another thread.</P><br />
<P>When working with a web application consider creating a DataContext per http request, using it to retrieve and then submit any changes required by the session. For a client-side application consider using a DataContext for each application transaction. </P><br />
<P>While a DataContext is disposable, only dispose of it when you finish your request or application/transaction and are finished with the persistent entities that it loaded.</P><br />
<P>Exercise caution around caching entities that were loaded via a DataContext. This is because when you access those elements they may still refer to the DataContext if they contain a lazy loaded association. If you want to use LINQ To SQL to load cached data, make sure you load objects that are not coupled to the DataContext, by not using EntitySet&lt;&gt; and EntityRef&lt;&gt; for associations, and disabling deferred loading on the context that you use to load them. This can be appropriate for reference data, in which case, you can also disable change tracking. </P><br />
<P><STRONG>Is LINQ To SQL deficient here?</STRONG></P><br />
<P>I&nbsp;read&nbsp; a fair number of opinions that are suprised by the behavior of LINQ To SQL. However, having used ORMs for a number of years, I find LINQ To SQL conforms to my expectations as to how an ORM should behave.&nbsp;Indeed a reading of something as old now as Martin Fowler&#8217;s <A class="" href="http://www.amazon.com/Enterprise-Application-Architecture-Addison-Wesley-Signature/dp/0321127420">Patterns of Enteprise Application Architecture</A> and you will find exactly this pattern of behavior for an ORM discussed. Indeed <A class="" href="http://code.google.com/p/wilsonormapper/">WORM</A> (Wilson O/R Mapper now open source BTW) and <A class="" href="http://www.hibernate.org/343.html">NHibernate</A> both behave in a similar fashion. So some of this seems to be based on expectations that don&#8217;t come from experience of using ORM tools. On a recent <A class="" href="http://www.dotnetrocks.com/default.aspx?showNum=90">.NET Rocks</A> there was an opinion expressed that LINQ To SQL was somehow only fit to be a RAD tool because of multi-tier issues. I can&#8217;t agree with this opinion at all. LINQ To SQL has a similar feature set to WORM, on which I have built distributed enterprise applications. Its limitations relate to the diversity of mappings that it supports (table per concrete class in an inheritance hierachy or value types for example) and its lack of support for multiple Db vendors, not some percieved issues around the unit of work and identity map patterns which it implements. </P></p>
<div class="shr-publisher-27"></div><!-- Start Shareaholic LikeButtonSetBottom Automatic --><!-- End Shareaholic LikeButtonSetBottom Automatic -->											</div><!-- .entry-content -->

					<div id="entry-author-info">
						<div id="author-avatar">
							<img alt='' src='http://1.gravatar.com/avatar/b033a6c1af4ee8d7a734f3684225ea8a?s=60&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=R' class='avatar avatar-60 photo' height='60' width='60' />						</div><!-- #author-avatar 	-->
						<div id="author-description">
							<h2>About Ian Cooper</h2>
							Ian Cooper has over 18 years of experience delivering Microsoft platform solutions in government, healthcare, and finance. During that time he has worked for the DTi, Reuters, Sungard, Misys and Beazley delivering everything from bespoke enterpise solutions to 'shrink-wrapped' products to thousands of customers. Ian is a passionate exponent of the benefits of OO and Agile. He is test-infected and contagious. When he is not writing C# code he is also the and founder of the London .NET user group. http://www.dnug.org.uk							<div id="author-link">
								<a href="http://codebetter.com/iancooper/author/iancooper/" title="View all posts by Ian Cooper">View all posts by Ian Cooper &rarr;</a>
							</div><!-- #author-link	-->
						</div><!-- #author-description	-->
					</div><!-- .entry-author-info -->

					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/iancooper/category/featured/" title="View all posts in Featured" rel="category tag">Featured</a>, <a href="http://codebetter.com/iancooper/category/linq/" title="View all posts in LINQ" rel="category tag">LINQ</a>. Bookmark the <a href="http://codebetter.com/iancooper/2008/03/09/architecting-linq-to-sql-applications-part-7/" title="Permalink to Architecting LINQ To SQL Applications, part 7" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/iancooper/2008/03/09/architecting-linq-to-sql-applications-part-7/feed/" title="Comments RSS to Architecting LINQ To SQL Applications, part 7" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-27 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/iancooper/2008/03/09/previous-architecting-linq-to-sql-applications-part-5/" rel="prev"><span class="meta-nav">&larr;</span> Architecting LINQ To SQL Applications, part 6</a></div>
					<div class="nav-next"><a href="http://codebetter.com/iancooper/2008/04/06/architecting-linq-to-sql-applications-part-8/" rel="next">Architecting LINQ To SQL Applications, part 8 <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
                    <div id="dsq-content">
            <ul id="dsq-comments">
                    <li id="dsq-comment-272">
                    <div id="dsq-comment-header-272" class="dsq-comment-header">
                        <cite id="dsq-cite-272">
                                <span id="dsq-author-user-272">David </span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-272" class="dsq-comment-body">
                        <div id="dsq-comment-message-272" class="dsq-comment-message"><p>Hi Ian,</p>
<p>Great series, keep up the good work, thanks!</p>
<p>David</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-273">
                    <div id="dsq-comment-header-273" class="dsq-comment-header">
                        <cite id="dsq-cite-273">
    http://sendhil.spaces.live.com                            <span id="dsq-author-user-273">Sendhil</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-273" class="dsq-comment-body">
                        <div id="dsq-comment-message-273" class="dsq-comment-message"><p>Does LINQ to SQL support attaching detached objects? Working with object graphs is a good feature.</p>
<p>Regards,<br />
Sendhil</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-274">
                    <div id="dsq-comment-header-274" class="dsq-comment-header">
                        <cite id="dsq-cite-274">
                                <span id="dsq-author-user-274">Hannes</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-274" class="dsq-comment-body">
                        <div id="dsq-comment-message-274" class="dsq-comment-message"><p>Hi Ian, very good blog series!<br />
The Linq DataContext class makes it possible to integrate business logic code via partial classes, according to ScottGu&#8217;s blog post (<a href="http://weblogs.asp.net/scottgu/archive/2007/07/11/linq-to-sql-part-4-updating-our-database.aspx" rel="nofollow">http://weblogs.asp.net/scottgu/archive/2007/07/11/linq-to-sql-part-4-updating-our-database.aspx</a> &#8211; Section &#8220;Custom Entity Insert/Update/Delete Method Validation&#8221;)</p>
<p>How do you classify this issue? What influence has this technique to the layer model? So can LINQ to sql be seen as a all-purpuse layer, inlcuding business logic?</p>
<p>Regards,<br />
Hannes<br />
Munich</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-275">
                    <div id="dsq-comment-header-275" class="dsq-comment-header">
                        <cite id="dsq-cite-275">
                                <span id="dsq-author-user-275">Daniel Fernandes</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-275" class="dsq-comment-body">
                        <div id="dsq-comment-message-275" class="dsq-comment-message"><p>Features I see that are &#8220;obviously&#8221; missing from Linq To Sql (hand coded or not) are:<br />
- no support of polymorphism for associations, CRUD and queries, at least with the generated code, I guess you can have polymorphic associations with hand coded mapping but that needs to be confirmed.<br />
- Lack of support to clearly configure cascade behaviour for either create, update or deletes (it&#8217;s my view that deletions should be handled by code near the domain model and not within the db).<br />
- Inability to create custom types built from sql datatypes.<br />
- No clean way to intercept calls to the db. On generated code one has to use partial methods to handle this, not sure how it would works for hand coded and I&#8217;m not sure how the GetChangeSet() command actually works, does it return the full set of entities that are going to be affected by the unit of work including entities that will be updated due to cascade ?</p>
<p>To me the one little gem in NHibernate is support of Many to Any relationship where something on the Many side can be linked to literally anything on the other side using a table in the middle providing all the necessary configuration to act as an object factory.</p>
<p>PS: I still do very much appreciate your series, I tried to do this very architecture with NHibernate but it didn&#8217;t quite work out, DDD was confusing me on a daily basis..!</p>
<p>Daniel</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-276">
                    <div id="dsq-comment-header-276" class="dsq-comment-header">
                        <cite id="dsq-cite-276">
                                <span id="dsq-author-user-276">Mike</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-276" class="dsq-comment-body">
                        <div id="dsq-comment-message-276" class="dsq-comment-message"><p>Hi Ian</p>
<p>I am really enjoying your articles on Linq to SQL &#8211; particularly the discussion about DataContext and layers.</p>
<p>I have plans to teach a first year undergrad  web dev. course based on  Linq to SQL in September and I have been struggling with these issues for a while &#8230;&#8230;</p>
<p>You mentioned that Linq to SQL has a similar pattern using DataContext to Paul Wilson&#8217;s ORM (WORM) and perhaps you could explain that it more detail. I have used WORM for many years in development and in teaching and thought I understood it &#8211; but I am struggling with Linq to SQL DataContext as I can&#8217;t seem to hide it &#8211; in the same way that WORM hides its equivalent.</p>
<p>WORM was ideal for students as I could hide all the ORM detail in the DAL and gradually expose parts as required (from a teaching perpective) but am finding this hard with DataContext </p>
<p>Thanks again</p>
<p>Mike </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-277">
                    <div id="dsq-comment-header-277" class="dsq-comment-header">
                        <cite id="dsq-cite-277">
                                <span id="dsq-author-user-277">Liam McLennan</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-277" class="dsq-comment-body">
                        <div id="dsq-comment-message-277" class="dsq-comment-message"><p>@Mike</p>
<p>Ian is spot on. Linq-to-sql is like WORM with linq support. You use the DataContext in the same way that you would use the WORM ObjectSpace. In both cases you need to specifically add new objects to the context. </p>
<p>Perhaps the biggest difference is that WORM allows/requires you to specify the object or object graph that you want to flush to the database. Linq-to-sql requires that the entire DataContext be flushed to the database in one operation (DataContext.SubmitChanges).</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-278">
                    <div id="dsq-comment-header-278" class="dsq-comment-header">
                        <cite id="dsq-cite-278">
    http://jnuxvrgv.com/                            <span id="dsq-author-user-278">Howgjnxb</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-278" class="dsq-comment-body">
                        <div id="dsq-comment-message-278" class="dsq-comment-message"><p>PpmG7W </p>
</div>
                    </div>
                </li>
                </ul>
        </div>
    </div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://codebetter.com/iancooper/2008/03/09/architecting-linq-to-sql-applications-part-7/';
    var disqus_identifier = '27 /blogs/ian_cooper/archive/2008/03/09/architecting-linq-to-sql-applications-part-7.aspx';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'codebetteriancooper';
    var disqus_title = "Architecting LINQ To SQL Applications, part 7";
        var disqus_config = function () {
        var config = this; // Access to the config object

        /* 
           All currently supported events:
            * preData — fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            DISQUS.request.get('?cf_action=sync_comments&post_id=27');
        });
                    };
    var facebookXdReceiverPath = 'http://cdn1.codebetter.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
        ],
        'trackback_url': "http:\/\/codebetter.com\/iancooper\/2008\/03\/09\/architecting-linq-to-sql-applications-part-7\/trackback\/"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.67';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29416);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=2782afb'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29416&amp;n=2782afb' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29417);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=e94cea6'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29417&amp;n=e94cea6' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29418);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=9ba3022'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29418&amp;n=9ba3022' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29419);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=f467b52'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29419&amp;n=f467b52' /></a></noscript>
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(220407);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=68b8307'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=220407&amp;n=68b8307' /></a></noscript>				
				
				<ul class="xoxo">		
									</ul>	
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29421);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=3f8e353'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29421&amp;n=3f8e353' /></a></noscript>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="http://red-gate.com/">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="http://telerik.com">Telerik .NET Tools</a></li>
<li><a href="http://jetbrains.com/resharper/">JetBrains - ReSharper</a></li>
<li><a href="http://scootersoftware.com">Beyond Compare</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a></li>
<li><a href="http://umbraco.com" target="_blank">Umbraco</a></li>
<li><a href="http://nservicebus.com" target="_blank">NServiceBus</a></li>
<li><a href="http://ravendb.net" target="_blank">RavenDb</a></li>
<li><a href="http://www.websequencediagrams.com/" target="_blank">Web Sequence Diagrams</a></li>
	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '12<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPython.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = true; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>

<script type='text/javascript'>//<![CDATA[
    if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.4.2.min.js' type='text/javascript' %3E%3C/script%3E"));
    }//]]></script>
<script type='text/javascript' language='Javascript' src='http://s1.lqcdn.com/m.min.js?dt=2.3.110202.1'></script>
<script type='text/javascript' language='Javascript'> if(jQuery.LqmAds)jQuery.LqmAds();</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.563 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2012-11-09 21:35:17 -->
<!-- super cache -->