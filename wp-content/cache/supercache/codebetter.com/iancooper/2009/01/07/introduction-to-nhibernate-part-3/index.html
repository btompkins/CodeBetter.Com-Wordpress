<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Introduction to NHibernate, Part 3 | Ian Cooper</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/iancooper/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css?v=3912785705" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js?ver=3.4.2'></script>
<script type='text/javascript' src='http://dtym7iokkjlif.cloudfront.net/dough/1.0/recipe.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/iancooper/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Introduction to NHibernate, Part 2' href='http://codebetter.com/iancooper/2008/12/12/introduction-to-nhibernate-part-2/' />
<link rel='next' title='Introduction to NHibernate, pt. 4' href='http://codebetter.com/iancooper/2009/01/21/introduction-to-nhibernate-pt-4/' />
<meta name="generator" content="WordPress 3.4.2" />
<link rel='shortlink' href='http://codebetter.com/iancooper/?p=50' />

<!-- All in One SEO Pack 1.6.13.2 by Michael Torbert of Semper Fi Web Design[83,137] -->
<link rel="canonical" href="http://codebetter.com/iancooper/2009/01/07/introduction-to-nhibernate-part-3/" />
<!-- /all in one seo pack -->
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.3.3" type="text/css" media="screen" />

<!-- Start Shareaholic OgTags -->

	<!-- Shareaholic Notice: There is neither a featured nor gallery image set -->

<!-- End Shareaholic OgTags -->

<meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/dc168cf39155d7b5d39f696ca94d5980.js?v=5302176208">/*Is Cache!*/</script>
                	
	<script type='text/javascript' src='http://d1.openx.org/spcjs.php?id=7744&amp;target=_blank'></script>
	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>
<!-- BuySellAds Ad Code -->
<script type="text/javascript">
(function(){
  var bsa = document.createElement('script');
     bsa.type = 'text/javascript';
     bsa.async = true;
     bsa.src = 'http://s3.buysellads.com/ac/bsa.js';
  (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);
})();
</script>
<!-- End BuySellAds Ad Code -->
</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">
			<!-- BuySellAds Zone Code -->
<div id="bsap_1276080" class="bsarocks bsap_4fe632babdccc2b4b049e4f08cc3c549"></div>
<!-- End BuySellAds Zone Code --></div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-50" class="post-50 post type-post status-publish format-standard hentry category-nhibernate category-orm">
					<h1 class="entry-title">Introduction to NHibernate, Part 3</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/iancooper/author/iancooper/" title="View all posts by Ian Cooper">Ian Cooper</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/iancooper/2009/01/07/introduction-to-nhibernate-part-3/" title="9:14 am" rel="bookmark"><span class="entry-date">January 7, 2009</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/iancooper/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/iancooper/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><!-- Start Shareaholic LikeButtonSetTop Automatic --><!-- End Shareaholic LikeButtonSetTop Automatic --></p>
<p><!--[if gte mso 10]&gt;--></p>
<p>&nbsp;</p>
<p><!--[endif]--></p>
<p>&nbsp;</p>
<p><a href="/blogs/ian_cooper/archive/2008/12/12/introduction-to-nhibernate-part-2.aspx">Last time</a> we looked at mapping an entity. This time we will look at mapping the entity&#8217;s relationships.
</p>
<h4><span lang="EN-US">Mapping Relationships</span></h4>
<p class="MsoNormal"><span>&nbsp;</span>The collection types<br />
that NHibernate understands are: &lt;set&gt;, &lt;list&gt;, &lt;map&gt;,<br />
&lt;bag&gt;, &lt;array&gt; and &lt;primitive-array&gt;</p>
<p>&nbsp;</p>
<p class="MsoNormal">&lt;set&gt; is the most commonly used solution as it<br />
represents what most people understand a child to be: an unordered collection<br />
with no duplicates. A &lt;bag&gt; is an unordered collection that allows<br />
duplicates. All other types are ordered, that is they require an index column<br />
in the Db representation. A &lt;map&gt; is indexed either by any NHibernate<br />
type or by an entity. A list or array is indexed by a sequential integer value.</p>
<p>&nbsp;</p>
<p class="MsoNormal">.NET does not come with a set type. So, NHibernate uses a<br />
library called Iesi.Collections which includes the interface ISet and many<br />
implementations (like HashedSet). NHibernate maps the bag type onto IList.</p>
<p>&nbsp;</p>
<p class="MsoNormal">The collections have differing performance characteristics.<br />
An indexed collection has the best update performance, because they are found<br />
by the foreign key and index. Sets find rows by the foreign key and element values,<br />
which is less performant, especially if they include large text fields. Sets<br />
also suffer in many-to-many associations because they do a delete and insert<br />
not an update. Bags are the worst-case for performance because they have no<br />
index and may contain duplicate elements. Arrays cannot be lazy loaded. For<br />
this reason the optimal choices are list, map, and set. NHibernate best<br />
practice is to default to sets to begin with.</p>
<p>&nbsp;</p>
<p class="MsoNormal">The attributes of the collection type are important.<br />
Everything needs the &lt;name&gt; attribute that corresponds to the property on<br />
the class. If you want to use lazy loading of your child collection then you<br />
need to set &lt;lazy=&#8221;true&#8221;&gt; as it defaults to false. If you want<br />
to cascade updates and deletes then you need to use the &lt;cascade&gt;<br />
attribute to control this. </p>
<p>&nbsp;</p>
<p class="MsoNormal">The &lt;inverse&gt; attribute is needed if your<br />
relationship is bi-directional. When we add a new child to a collection<br />
NHibernate adds an insert statement to add the new child row. But then it would<br />
issue an update statement, to update the foreign key on the child row, to be<br />
the primary key of the parent. This is not just inefficient, it may also be<br />
violate constraints which do not allow the foreign key to be null. To correct<br />
this we need to tell NHibernate that the child has a key we need to get from<br />
its parent. We do that by flagging the child as<br />
&lt;inverse=&#8221;true&#8221;&gt;. Then we only generate the insert statement.
</p>
<p>&nbsp;</p>
<p class="MsoNormal">We can also set a &lt;fetch&gt; strategy to use an outer-join when retrieving<br />
children. Usually we rely on setting the fetch strategy via the HQL or<br />
ICriteria instead.</p>
<p>&nbsp;</p>
<p class="MsoNormal">For any collection we need to add a &lt;key/&gt; child<br />
element. The key is the foreign key column on the child that maps to the<br />
primary key.</p>
<p>&nbsp;</p>
<p class="MsoNormal">If the collection is ordered then we need to add an<br />
&lt;index&gt; column. The index column includes the column name and the type of<br />
the column. If the index is an entity we need to use &lt;index-many-to-many&gt;.</p>
<p class="MsoNormal">We can map to elements instead of entities if we want to<br />
persist a collection of value types instead of entities.</p>
<p>&nbsp;</p>
<p class="MsoNormal">On the inverse side of a &lt;one-to-many&gt; relationship we<br />
need a &lt;many-to-one&gt; relationship. The &lt;many-to-one&gt; element<br />
identifies the &lt;name&gt; of the property that represents the parent and the<br />
&lt;column&gt; on the table row which provides the foreign key.</p>
<p class="MsoNormal">Our example is straightforward; we want a one-to-many<br />
association between company and customer that is bi-directional.</p>
<p>&nbsp;</p>
<p class="MsoNormal"><span lang="EN-US">&lt;<span style="color: #a31515">class</span> <span style="color: red">name</span>=&#8221;Company&#8221; <span style="color: red">table</span>=&#8221;Company&#8221;&gt;</span></p>
<p class="MsoNormal"><span lang="EN-US"><span>&nbsp;&nbsp;&nbsp; </span>&lt;<span style="color: #a31515">id</span> <span style="color: red">name</span>=&#8221;Id&#8221;<br />
<span style="color: red">type</span>=&#8221;Int32&#8243; <span style="color: red">unsaved-value</span>=&#8221;0&#8243;&gt;</span></p>
<p class="MsoNormal"><span lang="EN-US"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&lt;<span style="color: #a31515">generator</span> <span style="color: red">class</span>=&#8221;identity&#8221;/&gt;</span></p>
<p class="MsoNormal"><span lang="EN-US"><span>&nbsp;&nbsp;&nbsp; </span>&lt;/<span style="color: #a31515">id</span>&gt;</span></p>
<p class="MsoNormal"><span lang="EN-US"><span>&nbsp;&nbsp;&nbsp; </span>&lt;<span style="color: #a31515">version</span> <span style="color: red">name</span>=&#8221;Version&#8221;/&gt;</span></p>
<p class="MsoNormal"><span lang="EN-US"><span>&nbsp;&nbsp;&nbsp; </span>&lt;<span style="color: #a31515">property</span> <span style="color: red">name</span>=&#8221;Name&#8221;/&gt;</span></p>
<p class="MsoNormal"><span lang="EN-US"><span>&nbsp;&nbsp;&nbsp; </span>&lt;<span style="color: #a31515">set</span> <span style="color: red">name</span>=&#8221;Customers&#8221;<br />
<span style="color: red">inverse</span>=&#8221;true&#8221; <span style="color: red">lazy</span>=&#8221;true&#8221; &gt;</span></p>
<p class="MsoNormal"><span lang="EN-US"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&lt;<span style="color: #a31515">key</span> <span style="color: red">column</span>=&#8221;Id&#8221;/&gt;</span></p>
<p class="MsoNormal"><span lang="EN-US"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&lt;<span style="color: #a31515">one-to-many</span> <span style="color: red">class</span>=&#8221;Customer&#8221;/&gt;</span></p>
<p class="MsoNormal"><span lang="EN-US"><span>&nbsp;&nbsp;&nbsp; </span>&lt;/<span style="color: #a31515">set</span>&gt; </span></p>
<p>
</p>
<p class="MsoNormal"><span style="color: blue" lang="EN-US"><span>&nbsp;</span>&lt;/</span><span lang="EN-US">class<span style="color: blue">&gt;</span></span></p>
<p class="MsoNormal"><span lang="EN-US"><span>&nbsp; </span>&lt;<span style="color: #a31515">class</span> <span style="color: red">name</span>=&#8221;Customer&#8221;<br />
<span style="color: red">table</span>=&#8221;Customer&#8221;&gt;</span></p>
<p class="MsoNormal"><span lang="EN-US"><span>&nbsp;&nbsp;&nbsp; </span>&lt;<span style="color: #a31515">id</span> <span style="color: red">name</span>=&#8221;Id&#8221;<br />
<span style="color: red">type</span>=&#8221;Int32&#8243; <span style="color: red">unsaved-value</span>=&#8221;0&#8243;&gt;</span></p>
<p class="MsoNormal"><span lang="EN-US"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&lt;<span style="color: #a31515">generator</span> <span style="color: red">class</span>=&#8221;identity&#8221;/&gt;</span></p>
<p class="MsoNormal"><span lang="EN-US"><span>&nbsp;&nbsp;&nbsp; </span>&lt;/<span style="color: #a31515">id</span>&gt;</span></p>
<p class="MsoNormal"><span lang="EN-US"><span>&nbsp;&nbsp;&nbsp; </span>&lt;<span style="color: #a31515">version</span> <span style="color: red">name</span>=&#8221;Version&#8221;/&gt;</span></p>
<p class="MsoNormal"><span lang="EN-US"><span>&nbsp;&nbsp;&nbsp; </span>&lt;<span style="color: #a31515">property</span> <span style="color: red">name</span>=&#8221;DateOfBirth&#8221;/&gt;</span></p>
<p class="MsoNormal"><span lang="EN-US"><span>&nbsp;&nbsp;&nbsp; </span>&lt;<span style="color: #a31515">property</span> <span style="color: red">name</span>=&#8221;FirstName&#8221;/&gt;</span></p>
<p class="MsoNormal"><span lang="EN-US"><span>&nbsp;&nbsp;&nbsp; </span>&lt;<span style="color: #a31515">property</span> <span style="color: red">name</span>=&#8221;Surname&#8221;/&gt;</span></p>
<p class="MsoNormal"><span lang="EN-US"><span>&nbsp;&nbsp;&nbsp; </span>&lt;<span style="color: #a31515">many-to-one</span> <span style="color: red">name</span>=&#8221;Company&#8221;<br />
<span style="color: red">column</span>=&#8221;CompanyId&#8221; <span style="color: red">cascade</span>=&#8221;all-delete-orphan&#8221;/&gt;</span></p>
<p class="MsoNormal"><span lang="EN-US"><span>&nbsp; </span>&lt;/<span style="color: #a31515">class</span>&gt;</span></p>
<p>&nbsp;</p>
<p class="MsoNormal">&nbsp;And the classes that correspond to those collections are as follows.</p>
<p>&nbsp;</p>
<p class="MsoNormal">&nbsp;&nbsp; public class Company<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #region Fields<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private ISet&lt;Customer&gt; customers = new HashedSet&lt;Customer&gt;();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #endregion<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #region Properties <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int Id { get; set; } <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string Name { get; set; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public ISet&lt;Customer&gt; Customers<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return customers; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; customers = value;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int Version { get; set; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #endregion<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;</p>
<p class="MsoNormal">&nbsp;&nbsp;&nbsp; public class Customer<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Company Company { get; set; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public DateTime? DateOfBirth { get; set; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string FirstName {get;set;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int Id { get; set; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string Surname {get;set;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int Version { get; set; }<br />&nbsp;&nbsp;&nbsp; }</p>
<p class="MsoNormal">&nbsp;</p>
<p>&nbsp;</p>
<p class="MsoNormal">Not how we use ISet for our collection type.&nbsp; One mistake many developers beginning work with NHibernate make is to use an IList when they want an ISet. This is because they are used to using IList as an all-purpose collection type in .NET. An IList supports an index operator so you can use random access with elements of the collection i.e you can ask for them by position in the list. For a DB to support this it needs to use a column to store the index values, otherwise the order might change. ISet by contrast does not have an index operator and items in the collection have no order. </p>
<p>&nbsp;</p>
<p class="MsoNormal">The lack of index operator on an ISet annoys many developers who start working with NHibernate. Often though they were not genuinely using the index, in which case an IList would be find, but just using it to grab the first element in the list. In that case just use the LINQ extension method of First(), but be aware that no order is guaranteed.</p>
<p>&nbsp;</p>
<p class="MsoNormal">Only use an IList if you genuinely want a List or Bag semantics.</p>
<p>&nbsp;</p>
<p class="MsoNormal">Notice that the type of our collection is an interface. We need to use an interface and not the concrete type to allow NHibernate to&nbsp; supply us a proxy to a genuine collection at run time. This is essential to support lazy loading. To lazy load a collection we need to supply a proxy for the genuine collection so that when we do want to iterate over the collection the proxy can load our rows on demand. We will return to this in a later post, but this is also why you should use a unit of work pattern with an ORM, because the proxy will try to load your genuine collection from the Db using the same session that was extant when it was created. If that session is no longer available it will throw an error.</p>
<p>&nbsp;</p>
<p class="MsoNormal">Next Time&nbsp; we will look at mapping inheritance.</p>
<p>&nbsp;</p>
<p class="MsoNormal">&nbsp;</p>
<div class="shr-publisher-50"></div><!-- Start Shareaholic LikeButtonSetBottom Automatic --><!-- End Shareaholic LikeButtonSetBottom Automatic -->											</div><!-- .entry-content -->

					<div id="entry-author-info">
						<div id="author-avatar">
							<img alt='' src='http://1.gravatar.com/avatar/b033a6c1af4ee8d7a734f3684225ea8a?s=60&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=R' class='avatar avatar-60 photo' height='60' width='60' />						</div><!-- #author-avatar 	-->
						<div id="author-description">
							<h2>About Ian Cooper</h2>
							Ian Cooper has over 18 years of experience delivering Microsoft platform solutions in government, healthcare, and finance. During that time he has worked for the DTi, Reuters, Sungard, Misys and Beazley delivering everything from bespoke enterpise solutions to 'shrink-wrapped' products to thousands of customers. Ian is a passionate exponent of the benefits of OO and Agile. He is test-infected and contagious. When he is not writing C# code he is also the and founder of the London .NET user group. http://www.dnug.org.uk							<div id="author-link">
								<a href="http://codebetter.com/iancooper/author/iancooper/" title="View all posts by Ian Cooper">View all posts by Ian Cooper &rarr;</a>
							</div><!-- #author-link	-->
						</div><!-- #author-description	-->
					</div><!-- .entry-author-info -->

					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/iancooper/category/nhibernate/" title="View all posts in NHibernate" rel="category tag">NHibernate</a>, <a href="http://codebetter.com/iancooper/category/orm/" title="View all posts in ORM" rel="category tag">ORM</a>. Bookmark the <a href="http://codebetter.com/iancooper/2009/01/07/introduction-to-nhibernate-part-3/" title="Permalink to Introduction to NHibernate, Part 3" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/iancooper/2009/01/07/introduction-to-nhibernate-part-3/feed/" title="Comments RSS to Introduction to NHibernate, Part 3" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-50 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/iancooper/2008/12/12/introduction-to-nhibernate-part-2/" rel="prev"><span class="meta-nav">&larr;</span> Introduction to NHibernate, Part 2</a></div>
					<div class="nav-next"><a href="http://codebetter.com/iancooper/2009/01/21/introduction-to-nhibernate-pt-4/" rel="next">Introduction to NHibernate, pt. 4 <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
                    <div id="dsq-content">
            <ul id="dsq-comments">
                    <li id="dsq-comment-516">
                    <div id="dsq-comment-header-516" class="dsq-comment-header">
                        <cite id="dsq-cite-516">
    http://girldeveloper.com                            <span id="dsq-author-user-516">Sara Chipps</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-516" class="dsq-comment-body">
                        <div id="dsq-comment-message-516" class="dsq-comment-message"><p>Reading your post, it makes me understand that someone needs to do a &#8220;beginner&#8217;s guide too&#8230;&#8221; NHibernate seems much harder when you have never done it before. </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-517">
                    <div id="dsq-comment-header-517" class="dsq-comment-header">
                        <cite id="dsq-cite-517">
                                <span id="dsq-author-user-517">Ian Cooper</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-517" class="dsq-comment-body">
                        <div id="dsq-comment-message-517" class="dsq-comment-message"><p>@Sara I&#8217;m hoping this will help. Some of this complexity gets hidden by tools like Castle Active Record and Fluent NHibernate and I&#8217;ll cover those later, but I think its useful to understand what is happening under the hood before getting those productivity boosts.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-518">
                    <div id="dsq-comment-header-518" class="dsq-comment-header">
                        <cite id="dsq-cite-518">
                                <span id="dsq-author-user-518">A.Pedant</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-518" class="dsq-comment-body">
                        <div id="dsq-comment-message-518" class="dsq-comment-message"><p>>> .NET does not come with a set type.<br />
.NET 3.5 introduced HashSet. </p>
<p><a href="http://msdn.microsoft.com/en-us/library/bb359438.aspx" rel="nofollow">http://msdn.microsoft.com/en-us/library/bb359438.aspx</a></p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-519">
                    <div id="dsq-comment-header-519" class="dsq-comment-header">
                        <cite id="dsq-cite-519">
    http://gregdoesit.com                            <span id="dsq-author-user-519">Gergely Orosz</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-519" class="dsq-comment-body">
                        <div id="dsq-comment-message-519" class="dsq-comment-message"><p>&#8220;The lack of index operator on an ISet annoys many developers who start working with NHibernate.&#8221; So true, thats whyI chose to work with bags (even though I didn&#8217;t really need that semantics). Thanks for highlighting that out.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-520">
                    <div id="dsq-comment-header-520" class="dsq-comment-header">
                        <cite id="dsq-cite-520">
                                <span id="dsq-author-user-520">RichB</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-520" class="dsq-comment-body">
                        <div id="dsq-comment-message-520" class="dsq-comment-message"><p><set name="Customers" inverse="true" lazy="true" /></p>
<p>This should not be an empty element. You need to remove the /</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-521">
                    <div id="dsq-comment-header-521" class="dsq-comment-header">
                        <cite id="dsq-cite-521">
    http://bnzaxevl.com/                            <span id="dsq-author-user-521">Yknoryek</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-521" class="dsq-comment-body">
                        <div id="dsq-comment-message-521" class="dsq-comment-message"><p>8wXMuJ </p>
</div>
                    </div>
                </li>
                </ul>
        </div>
    </div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://codebetter.com/iancooper/2009/01/07/introduction-to-nhibernate-part-3/';
    var disqus_identifier = '50 /blogs/ian_cooper/archive/2009/01/07/introduction-to-nhibernate-part-3.aspx';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'codebetteriancooper';
    var disqus_title = "Introduction to NHibernate, Part 3";
        var disqus_config = function () {
        var config = this; // Access to the config object

        /* 
           All currently supported events:
            * preData — fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            DISQUS.request.get('?cf_action=sync_comments&post_id=50');
        });
                    };
    var facebookXdReceiverPath = 'http://cdn1.codebetter.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
        ],
        'trackback_url': "http:\/\/codebetter.com\/iancooper\/2009\/01\/07\/introduction-to-nhibernate-part-3\/trackback\/"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.67';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29416);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=2782afb'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29416&amp;n=2782afb' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29417);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=e94cea6'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29417&amp;n=e94cea6' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29418);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=9ba3022'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29418&amp;n=9ba3022' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29419);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=f467b52'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29419&amp;n=f467b52' /></a></noscript>
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(220407);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=68b8307'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=220407&amp;n=68b8307' /></a></noscript>				
				
				<ul class="xoxo">		
									</ul>	
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29421);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=3f8e353'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29421&amp;n=3f8e353' /></a></noscript>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="http://red-gate.com/">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="http://telerik.com">Telerik .NET Tools</a></li>
<li><a href="http://jetbrains.com/resharper/">JetBrains - ReSharper</a></li>
<li><a href="http://scootersoftware.com">Beyond Compare</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a></li>
<li><a href="http://umbraco.com" target="_blank">Umbraco</a></li>
<li><a href="http://nservicebus.com" target="_blank">NServiceBus</a></li>
<li><a href="http://ravendb.net" target="_blank">RavenDb</a></li>
<li><a href="http://www.websequencediagrams.com/" target="_blank">Web Sequence Diagrams</a></li>
	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '12<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPython.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = true; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>

<script type='text/javascript'>//<![CDATA[
    if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.4.2.min.js' type='text/javascript' %3E%3C/script%3E"));
    }//]]></script>
<script type='text/javascript' language='Javascript' src='http://s1.lqcdn.com/m.min.js?dt=2.3.110202.1'></script>
<script type='text/javascript' language='Javascript'> if(jQuery.LqmAds)jQuery.LqmAds();</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.442 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2012-11-09 19:20:42 -->
<!-- super cache -->