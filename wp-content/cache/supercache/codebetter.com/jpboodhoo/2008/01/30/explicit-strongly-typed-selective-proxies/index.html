<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Explicit Strongly Typed Selective Proxies | Jean-Paul S. Boodhoo</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/jpboodhoo/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css?v=3912785705" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js?ver=3.4.2'></script>
<script type='text/javascript' src='http://dtym7iokkjlif.cloudfront.net/dough/1.0/recipe.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/jpboodhoo/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='I see dead projects!!' href='http://codebetter.com/jpboodhoo/2008/01/30/i-see-dead-projects/' />
<link rel='next' title='Nothin But C# v3.5 with the Igloo Coder &#8211; Edmonton, AB (March 31st &#8211; April 4th)' href='http://codebetter.com/jpboodhoo/2008/01/30/nothin-but-c-v3-5-with-the-igloo-coder-edmonton-ab-march-31st-april-4th/' />
<meta name="generator" content="WordPress 3.4.2" />
<link rel='shortlink' href='http://codebetter.com/jpboodhoo/?p=109' />

<!-- All in One SEO Pack 1.6.13.2 by Michael Torbert of Semper Fi Web Design[83,154] -->
<link rel="canonical" href="http://codebetter.com/jpboodhoo/2008/01/30/explicit-strongly-typed-selective-proxies/" />
<!-- /all in one seo pack -->
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.3.3" type="text/css" media="screen" />

<!-- Start Shareaholic OgTags -->

	<!-- Shareaholic Notice: There is neither a featured nor gallery image set -->

<!-- End Shareaholic OgTags -->

<meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/dc168cf39155d7b5d39f696ca94d5980.js?v=5302176208">/*Is Cache!*/</script>
                	
	<script type='text/javascript' src='http://d1.openx.org/spcjs.php?id=7744&amp;target=_blank'></script>
	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>
<!-- BuySellAds Ad Code -->
<script type="text/javascript">
(function(){
  var bsa = document.createElement('script');
     bsa.type = 'text/javascript';
     bsa.async = true;
     bsa.src = 'http://s3.buysellads.com/ac/bsa.js';
  (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);
})();
</script>
<!-- End BuySellAds Ad Code -->
</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">
			<!-- BuySellAds Zone Code -->
<div id="bsap_1276080" class="bsarocks bsap_4fe632babdccc2b4b049e4f08cc3c549"></div>
<!-- End BuySellAds Zone Code --></div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-109" class="post-109 post type-post status-publish format-standard hentry category-c category-featured">
					<h1 class="entry-title">Explicit Strongly Typed Selective Proxies</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/jpboodhoo/author/jpboodhoo/" title="View all posts by jpboodhoo">jpboodhoo</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/jpboodhoo/2008/01/30/explicit-strongly-typed-selective-proxies/" title="9:19 am" rel="bookmark"><span class="entry-date">January 30, 2008</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/jpboodhoo/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/jpboodhoo/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><!-- Start Shareaholic LikeButtonSetTop Automatic --><!-- End Shareaholic LikeButtonSetTop Automatic --><p>Had the question the other day:</p>
<p>&ldquo;How could I dynamically create a proxy around an object (interface based proxies are not a problem) and then selectively apply interceptors at a method by method level if necessary&rdquo;.</p>
<p>Let&rsquo;s clear up a bit of terminology so that everyone is on the same page with regards to the problem at hand:</p>
<p>Proxy &ndash; An object that implements the same interface as a target object and intercepts methods calls to the target to perform some sort of pre and or post method invocation.</p>
<p>Interceptor &ndash; An object that can be plugged into a proxy to perform a pre/post method invocation step. Common example that most people are familiar with is a LoggingInterceptor.</p>
<p>Attacking the problem test first drove me down a fairly interesting path that I was pleased with for a first cut. I&rsquo;ll explain the details in a minute, but examples speak a lot louder than words. I created a couple of dummy interfaces and a simple object to demonstrate the proxying/interception capabilities. It should also be noted that I am making use of Castle DynamicProxy as I feel it is an much easier barrier of entry for people who want to take advantage of creating dynamic proxies vs dropping down to the wire and leveraging Reflection.Emit classes directly (though that is something that I strongly recommend playing with a couple of times, just so you have an understanding for it). Here are the interceptors that will be used in this example:</p>
<pre><div><span>    </span><span>public</span><span> </span><span>class</span><span> SomeInterceptor : IInterceptor
    {
        </span><span>public</span><span> </span><span>void</span><span> Intercept(IInvocation invocation)
        {
            Console.Out.WriteLine(</span><span>"</SPAN><SPAN style="color: #000000">Interception occured on method {0} with {1}</SPAN><SPAN style="color: #000000">"</span><span>,invocation.Method.Name,</span><span>this</span><span>.GetType().Name);
            invocation.Proceed();
        }
    }
</span></div></pre>
</p>
<pre><div><span>    </span><span>public</span><span> </span><span>class</span><span> SomeOtherInterceptor : IInterceptor
    {
        </span><span>public</span><span> </span><span>void</span><span> Intercept(IInvocation invocation)
        {
            Console.Out.WriteLine(</span><span>"</SPAN><SPAN style="color: #000000">Interception occured on method {0} with {1}</SPAN><SPAN style="color: #000000">"</span><span>,invocation.Method.Name,</span><span>this</span><span>.GetType().Name);
            invocation.Proceed();
        }
    }
</span></div></pre>
</p>
<p>As you can see. Both of these interceptors are ridiculously simple. They both implement the IInterceptor interface that comes from Castle.Core, the interface itself only has one method called Intercept which is the method that will get invoked by the proxy when a method call is intercepted. Both of these classes lived in a test fixture class file, so I was not concerned with the evident duplication. Here are the interface and implementation for the item that is going to be proxies:</p>
<pre><div><span>    </span><span>public</span><span> </span><span>interface</span><span> IAnInterface
    {
        </span><span>void</span><span> OneMethod();
        </span><span>void</span><span> SecondMethod();
        </span><span>int</span><span><font color="#0000ff"> </font>FirstValueReturningMethod();
        </span><span>int</span><span> ValueReturningMethodWithAnArgument(</span><span>int</span><span><font color="#0000ff"> </font>number);
    }

    </span><span>public</span><span> </span><span>class</span><span> SomeImplementation : IAnInterface
    {
        </span><span>public</span><span> </span><span>void</span><span> OneMethod()
        {
            Console.Out.WriteLine(</span><span>"</SPAN><SPAN style="color: #000000">Real work is being done in OneMethod</SPAN><SPAN style="color: #000000">"</span><span>);       
        }

        </span><span>public</span><span> </span><span>void</span><span> SecondMethod()
        {
            Console.Out.WriteLine(</span><span>"</SPAN><SPAN style="color: #000000">Real work is being done in SecondMethod</SPAN><SPAN style="color: #000000">"</span><span>);
        }

        </span><span>public</span><span> </span><span>int</span><span><font color="#0000ff"> </font>FirstValueReturningMethod()
        {
            Console.Out.WriteLine(</span><span>"</SPAN><SPAN style="color: #000000">Real work is being done in FirstValueReturningMethod</SPAN><SPAN style="color: #000000">"</span><span>);
            </span><span>return</span><span> </span><span>1</span><span>;
        }

        </span><span>public</span><span> </span><span>int</span><span><font color="#0000ff"> </font>ValueReturningMethodWithAnArgument(</span><span>int</span><span><font color="#0000ff"> </font>number)
        {
            Console.Out.WriteLine(</span><span>"</SPAN><SPAN style="color: #000000">Real work is being done in ValueReturningMethodWithAnArgument</SPAN><SPAN style="color: #000000">"</span><span>);
            </span><span>return</span><span> </span><span>1</span><span> </span><span>+</span><span> number;
        }
    }
</span></div></pre>
</p>
<p>Again, substitute this interface and implementation with any interface/implementation pair that you would want to create a proxy for in your own application. With all of those, I&rsquo;ll show you some usages of the final product before explaining the solution:</p>
<p><strong>Scenario 1 : Intercept on all method invocations with a SomeInterceptor</strong></p>
<pre><div><span>        [Test]
        </span><span>public</span><span> </span><span>void</span><span> Should_proxy_all_methods_with_some_interceptor()
        {            
            IAnInterface anImplementationOfTheInterfaceToProxy </span><span>=</span><span> </span><span>new</span><span> SomeImplementation();

            sut </span><span>=</span><span> </span><span>new</span><span> ProxyBuilder</span><span>&lt;</span><span>IAnInterface</span><span>&gt;</span><span>();
            sut.AddInterceptor</span><span>&lt;</span><span>SomeInterceptor</span><span>&gt;</span><span>();

            IAnInterface proxy </span><span>=</span><span> sut.CreateProxyFor(anImplementationOfTheInterfaceToProxy);
            proxy.OneMethod();
            proxy.SecondMethod();
        }
</span></div></pre>
</p>
<p>Which results in the following console output:
<pre>Interception occured on method OneMethod with SomeInterceptor
Real work is being done in OneMethod
Interception occured on method SecondMethod with SomeInterceptor
Real work is being done in SecondMethod</pre>
</p>
<p>Notice that the interceptor was leveraged on both method calls prior to the call on the underlying item being made.</p>
<p><strong>Scenario&nbsp;2 : Intercept on all method invocations with multiple interceptors</strong></p>
<pre><div><span>        [Test]
        </span><span>public</span><span> </span><span>void</span><span> Should_proxy_all_methods_with_multiple_interceptors()
        {
            IAnInterface anImplementationOfTheInterfaceToProxy </span><span>=</span><span> </span><span>new</span><span> SomeImplementation();

            sut </span><span>=</span><span> </span><span>new</span><span> ProxyBuilder</span><span>&lt;</span><span>IAnInterface</span><span>&gt;</span><span>();
            sut.AddInterceptor</span><span>&lt;</span><span>SomeInterceptor</span><span>&gt;</span><span>();
            sut.AddInterceptor</span><span>&lt;</span><span>SomeOtherInterceptor</span><span>&gt;</span><span>();

            IAnInterface proxy </span><span>=</span><span> sut.CreateProxyFor(anImplementationOfTheInterfaceToProxy);
            proxy.OneMethod();
            proxy.SecondMethod();
            
        }
</span></div></pre>
</p>
<p>Which produces the following console output:</p>
<pre>Interception occured on method OneMethod with SomeInterceptor
Interception occured on method OneMethod with SomeOtherInterceptor
Real work is being done in OneMethod
Interception occured on method SecondMethod with SomeInterceptor
Interception occured on method SecondMethod with SomeOtherInterceptor
Real work is being done in SecondMethod&nbsp;</pre>
</p>
<p>In this scenario both of the individual interceptors were invoked on any method call to the proxied item. Ok, so that was easy, lets try the next one:</p>
<p><strong>Scenario&nbsp;3 : Intercept on&nbsp;specific method invocations with a Single interceptor:</strong></p>
<p>&nbsp;</p>
<pre><div><span>        [Test]
        </span><span>public</span><span> </span><span>void</span><span> Should_proxy_only_targeted_methods_with_a_single_interceptor()
        {
            sut </span><span>=</span><span> </span><span>new</span><span> ProxyBuilder</span><span>&lt;</span><span>IAnInterface</span><span>&gt;</span><span>();
            anImplementation </span><span>=</span><span> </span><span>new</span><span> SomeImplementation();

            IInterceptorConstraint</span><span>&lt;</span><span>IAnInterface</span><span>&gt;</span><span> constraint </span><span>=</span><span> sut.AddInterceptor</span><span>&lt;</span><span>SomeInterceptor</span><span>&gt;</span><span>();
            constraint.InterceptOn.OneMethod();

            IAnInterface proxy </span><span>=</span><span> sut.CreateProxyFor(anImplementation);
            proxy.OneMethod();
            proxy.SecondMethod();
        }
</span></div></pre>
</p>
<p>Which produces the following output:</p>
<pre>Interception occured on method OneMethod with SomeInterceptor
Real work is being done in OneMethod
Real work is being done in SecondMethod&nbsp;</pre>
</p>
<p>Notice in the test above the use of the constraint that is returned from the Add method. Notice the call to the constraint.InterceptOn.OneMethod(). That is actually setting a filter to only enable the interceptor when that method is invoked on the proxy. For those familiar with Natural Mocks syntax (Rhino Mocks / TypeMock) this should look similar. It also has the nice benefit of not requiring the use of strings to specify which methods to filter on. Which means that it is also refactoring friendly. Notice that even though 2 method calls are made on the proxy, the interceptor only kicks in for the method that the constraint was configured for!!</p>
<p><strong>Scenario&nbsp;4 : Intercept on&nbsp;specific method invocations with differing interceptors:</strong></p>
<pre><div><span>        [Test]
        </span><span>public</span><span> </span><span>void</span><span> Should_proxy_only_targeted_methods_with_differing_interceptors()
        {
            sut </span><span>=</span><span> </span><span>new</span><span> ProxyBuilder</span><span>&lt;</span><span>IAnInterface</span><span>&gt;</span><span>();
            anImplementation </span><span>=</span><span> </span><span>new</span><span> SomeImplementation();

            IInterceptorConstraint</span><span>&lt;</span><span>IAnInterface</span><span>&gt;</span><span> constraint1 </span><span>=</span><span> sut.AddInterceptor</span><span>&lt;</span><span>SomeInterceptor</span><span>&gt;</span><span>();
            constraint1.InterceptOn.OneMethod();

            IInterceptorConstraint</span><span>&lt;</span><span>IAnInterface</span><span>&gt;</span><span> constraint2 </span><span>=</span><span> sut.AddInterceptor</span><span>&lt;</span><span>SomeOtherInterceptor</span><span>&gt;</span><span>();
            constraint2.InterceptOn.SecondMethod();

            IAnInterface proxy </span><span>=</span><span> sut.CreateProxyFor(anImplementation);
            proxy.OneMethod();
            proxy.SecondMethod();
        }
</span></div>
</pre>
</p>
<p>Which results in the following console output:</p>
<pre>Interception occured on method OneMethod with SomeInterceptor
Real work is being done in OneMethod
Interception occured on method SecondMethod with SomeOtherInterceptor
Real work is being done in SecondMethod&nbsp;</pre>
</p>
<p>Notice how in this example the interceptors are firing selectively for the methods that they were configured for.</p>
<p>Finally you can configure multiple method constraints at a time using the following syntax:</p>
<pre><div><span>            constraint.InterceptOnMethods(
                constraint.InterceptOn.FirstValueReturningMethod(),
                constraint.InterceptOn.ValueReturningMethodWithAnArgument(</span><span>0</span><span>));

</span></div></pre>
</p>
<p>Again, the syntax for this was heavily inspired by prolonged usage of Rhino Mocks. So let&rsquo;s inspect the players that come together to make this all work:</p>
<p>&nbsp;</p>
<pre><div><span>    </span><span>public</span><span> </span><span>class</span><span> ProxyBuilder</span><span>&lt;</span><span>T</span><span>&gt;</span><span> : IProxyBuilder</span><span>&lt;</span><span>T</span><span>&gt;</span><span>
    {
        </span><span>private</span><span> IProxyFactory proxyFactory;
        </span><span>private</span><span> IInterceptorConstraintSet constraintSet;


        </span><span>public</span><span> ProxyBuilder():</span><span>this</span><span>(</span><span>new</span><span> ProxyFactory(),</span><span>new</span><span> InterceptorConstraintSet())
        {
        }

        </span><span>public</span><span> ProxyBuilder(IProxyFactory proxyFactory, IInterceptorConstraintSet constraintSet)
        {
            </span><span>this</span><span>.proxyFactory </span><span>=</span><span> proxyFactory;
            </span><span>this</span><span>.constraintSet </span><span>=</span><span> constraintSet;            
        }

        </span><span>public</span><span> IInterceptorConstraint</span><span>&lt;</span><span>T</span><span>&gt;</span><span> AddInterceptor</span><span>&lt;</span><span>Interceptor</span><span>&gt;</span><span>() where Interceptor : IInterceptor,</span><span>new</span><span>()
        {
            constraintSet.AddConstraintFor</span><span>&lt;</span><span>Interceptor,T</span><span>&gt;</span><span>();
            </span><span>return</span><span> constraintSet.GetConstraintFor</span><span>&lt;</span><span>Interceptor,T</span><span>&gt;</span><span>();
        }


        </span><span>public</span><span> T CreateProxyFor</span><span>&lt;</span><span>T</span><span>&gt;</span><span>(T instance)
        {
            </span><span>return</span><span> proxyFactory.CreateProxyUsing</span><span>&lt;</span><span>T</span><span>&gt;</span><span>(instance, constraintSet);
        }
    }
</span></div></pre>
</p>
<p>This is entry point to the api used to create proxies and associate interceptors with them. Driving out the design in a test first manner really helped me push off responsibilities to the last possible moment. Which leaves the ProxyBuilder class fairly simple. It leverages both a ProxyFactory and an InterceptorContraintSet. The InterceptorConstraintSet is just a strongly typed collection of constraints with a little bit of smarts to it:</p>
<pre><div><span>    </span><span>public</span><span> </span><span>class</span><span> InterceptorConstraintSet : IInterceptorConstraintSet
    {
        </span><span>private</span><span> IDictionary</span><span>&lt;</span><span>Type, </span><span>object</span><span>&gt;</span><span> constraints;
        </span><span>private</span><span> IInterceptorConstraintFactory constraintFactory;


        </span><span>public</span><span> InterceptorConstraintSet():</span><span>this</span><span>(</span><span>new</span><span> Dictionary</span><span>&lt;</span><span>Type,</span><span>object</span><span>&gt;</span><span>(),</span><span>new</span><span> InterceptorConstraintFactory(</span><span>new</span><span> ProxyFactory()))
        {
            
        }

        </span><span>public</span><span> InterceptorConstraintSet(IDictionary</span><span>&lt;</span><span>Type, </span><span>object</span><span>&gt;</span><span> constraints, IInterceptorConstraintFactory constraintFactory)
        {
            </span><span>this</span><span>.constraints </span><span>=</span><span> constraints;
            </span><span>this</span><span>.constraintFactory </span><span>=</span><span> constraintFactory;
        }

        </span><span>public</span><span> </span><span>void</span><span> AddConstraintFor</span><span>&lt;</span><span>Interceptor, Target</span><span>&gt;</span><span>() where Interceptor : IInterceptor, </span><span>new</span><span>()
        {
            </span><span>if</span><span> (constraints.ContainsKey(</span><span>typeof</span><span>(Interceptor))) </span><span>return</span><span>;

            constraints.Add(</span><span>typeof</span><span><font color="#0000ff"> </font>(Interceptor), constraintFactory.CreateFor</span><span>&lt;</span><span>Interceptor, Target</span><span>&gt;</span><span>());
        }

        </span><span>public</span><span> IInterceptorConstraint</span><span>&lt;</span><span>Target</span><span>&gt;</span><span> GetConstraintFor</span><span>&lt;</span><span>Interceptor, Target</span><span>&gt;</span><span>() where Interceptor : IInterceptor, </span><span>new</span><span>()
        {
            </span><span>return</span><span> (IInterceptorConstraint</span><span>&lt;</span><span>Target</span><span>&gt;</span><span>) constraints[</span><span>typeof</span><span><font color="#0000ff"> </font>(Interceptor)];
        }


        </span><span>public</span><span> IInterceptor[] AllInterceptors</span><span>&lt;</span><span>Target</span><span>&gt;</span><span>()
        {
            </span><span>return</span><span> SetOfAllInterceptorsFor</span><span>&lt;</span><span>Target</span><span>&gt;</span><span>().AsList().ToArray();
        }


        </span><span>private</span><span> IEnumerable</span><span>&lt;</span><span>IInterceptor</span><span>&gt;</span><span> SetOfAllInterceptorsFor</span><span>&lt;</span><span>Target</span><span>&gt;</span><span>()
        {
            </span><span>foreach</span><span><font color="#0000ff"> </font>(IInterceptorConstraint</span><span>&lt;</span><span>Target</span><span>&gt;</span><span> constraint </span><span>in</span><span> constraints.Values)
            {
                </span><span>yield</span><span> </span><span>return</span><span> constraint.BuildInterceptor();
            }
        }

    }
</span></div></pre>
</p>
<p>The SetOfAllInterceptorsFor&lt;Target&gt; method is interesting as this is where the work to create the interceptors for a proxy is delegated to the constraint. The InterceptorConstraint and its accompanying collaborators is what allows for the natural syntax:</p>
<p>&nbsp;</p>
<pre><div><span>    </span><span>public</span><span> </span><span>class</span><span> InterceptorConstraint</span><span>&lt;</span><span>Target,Interceptor</span><span>&gt;</span><span> : IInterceptorConstraint</span><span>&lt;</span><span>Target</span><span>&gt;</span><span> where Interceptor : IInterceptor,</span><span>new</span><span>()
    {
        </span><span>private</span><span> </span><span>readonly</span><span><font color="#0000ff"> </font>IMethodCallTracker</span><span>&lt;</span><span>Target</span><span>&gt;</span><span> callTracker;


        </span><span>public</span><span> InterceptorConstraint(IMethodCallTracker</span><span>&lt;</span><span>Target</span><span>&gt;</span><span> callTracker)
        {
            </span><span>this</span><span>.callTracker </span><span>=</span><span> callTracker;
        }


        </span><span>public</span><span> Target InterceptOn
        {
            </span><span>get</span><span> { </span><span>return</span><span> callTracker.Target; }
        }

        </span><span>public</span><span> </span><span>void</span><span> InterceptOnMethods(</span><span>params</span><span><font color="#0000ff"> </font></span><span>object</span><span>[] makeMethodCallsUsingInterceptOnProperty)
        {

        }


        </span><span>public</span><span> </span><span>void</span><span> InterceptOnMethods(</span><span>params</span><span><font color="#0000ff"> </font>Action[] makeMethodCallsToInterceptOnPropertyInsideOfActionDelegate)
        {
            </span><span>foreach</span><span><font color="#0000ff"> </font>(Action action </span><span>in</span><span> makeMethodCallsToInterceptOnPropertyInsideOfActionDelegate)
            {
                action();
            }
        }

        </span><span>public</span><span> IInterceptor BuildInterceptor()
        {
            </span><span>if</span><span> (callTracker.CallsWereMade) </span><span>return</span><span> </span><span>new</span><span> SelectiveInterceptor(</span><span>new</span><span> Interceptor(), callTracker.AllMethods());

            </span><span>return</span><span> </span><span>new</span><span> Interceptor();
        }
    }
</span></div></pre>
</p>
<p>The work of doing the interceptor filtering is done in the BuildInterceptor method. The InterceptorConstraint makes use of a&nbsp;MethodCallTracker which keeps track of whether calls were made to filter on selective methods. If the client is requesting a filtered interceptor the InterceptorConstraint returns an instance of a SelectiveInterceptor. SelectiveInterceptor is a proxy for an Interceptor (I know that is a mouthful!!):</p>
<pre><div><span>    </span><span>public</span><span> </span><span>class</span><span> SelectiveInterceptor : IInterceptor
    {
        </span><span>private</span><span> IInterceptor interceptor;
        </span><span>private</span><span> IDictionary</span><span>&lt;</span><span>string</span><span>,</span><span>string</span><span>&gt;</span><span> methodsToInterceptOn;


        </span><span>public</span><span> SelectiveInterceptor(IInterceptor interceptor, IDictionary</span><span>&lt;</span><span>string</span><span>, </span><span>string</span><span>&gt;</span><span> methodsToInterceptOn)
        {
            </span><span>this</span><span>.interceptor </span><span>=</span><span> interceptor;
            </span><span>this</span><span>.methodsToInterceptOn </span><span>=</span><span> methodsToInterceptOn;
        }


        </span><span>public</span><span> </span><span>void</span><span> Intercept(IInvocation invocation)
        {
            </span><span>if</span><span> (methodsToInterceptOn.ContainsKey(invocation.Method.Name))
            {
                interceptor.Intercept(invocation);
                </span><span>return</span><span>;
            }
            invocation.Proceed();                        
        }
    }
</span></div></pre>
</p>
<p>Selective interceptor decides whether or not to forward the call onto the associated interceptor, if the method is not in the dictionary of methods to intercept on, it bypasses the interceptor and directly forwards the call onto the item to proxy.</p>
<p>Notice the user of : <span>new</span><span> Interceptor();<br /></span></p>
<p><span>This creates a new instance of whatever the interceptor type was that was specified by the AddInterceptor&lt;Interceptor&gt; method call back on ProxyBuilder. This works because of the generic constraint that ensured that the IInterceptor implementation also had a public no-arg constructor.</span></p>
<p><span>Last but not least, you are probably curious as to how the natural syntax is enabled? Take a look at the MethodCallTrackerFactory class:</span></p>
<p><span></p>
<p></span>
<pre><div><span>    </span><span>public</span><span> </span><span>class</span><span> MethodCallTrackerFactory : IMethodCallTrackerFactory
    {
        </span><span>private</span><span> ProxyGenerator proxyGenerator;

        </span><span>public</span><span> MethodCallTrackerFactory(ProxyGenerator proxyGenerator)
        {
            </span><span>this</span><span>.proxyGenerator </span><span>=</span><span> proxyGenerator;
        }

        </span><span>public</span><span> IMethodCallTracker</span><span>&lt;</span><span>T</span><span>&gt;</span><span> CreateFor</span><span>&lt;</span><span>T</span><span>&gt;</span><span>()
        {
            MethodCallTracker</span><span>&lt;</span><span>T</span><span>&gt;</span><span> methodCallTracker </span><span>=</span><span> </span><span>new</span><span> MethodCallTracker</span><span>&lt;</span><span>T</span><span>&gt;</span><span>();
            T target </span><span>=</span><span> proxyGenerator.CreateInterfaceProxyWithoutTarget</span><span>&lt;</span><span>T</span><span>&gt;</span><span>(methodCallTracker);
            methodCallTracker.Target </span><span>=</span><span> target;
            </span><span>return</span><span> methodCallTracker;
        }
    }
</span></div></pre>
</p>
<p>The ProxyGenerator class is supplied by Castle.DynamicProxy. I am using it to create a proxy around an interface without an actual underlying target:</p>
<p>T target <span>=</span><span> proxyGenerator.CreateInterfaceProxyWithoutTarget</span><span>&lt;</span><span>T</span><span>&gt;</span><span>(methodCallTracker);</span></p>
<p><span>Notice how after the MethodCallTracker is instantiated, it is passed in as an argument to the CreateInterfaceProxyWithoutTarget method? This method takes either a single or variable array of IInterceptor implementations. That&rsquo;s right. The MethodCallTracker is itself as IInterceptor implementation. It intercepts calls on its Target property so that it can store the calls to be used in the Interception filtering process:</span></p>
<pre><div><span>    </span><span>public</span><span> </span><span>class</span><span> MethodCallTracker</span><span>&lt;</span><span>T</span><span>&gt;</span><span> : IMethodCallTracker</span><span>&lt;</span><span>T</span><span>&gt;</span><span>
    {
        </span><span>public</span><span> T Target{</span><span>get</span><span>;</span><span>set</span><span>;}

        </span><span>private</span><span> IDictionary</span><span>&lt;</span><span>string</span><span>, </span><span>string</span><span>&gt;</span><span> methodNames;


        </span><span>public</span><span> MethodCallTracker() : </span><span>this</span><span>(</span><span>new</span><span> Dictionary</span><span>&lt;</span><span>string</span><span>, </span><span>string</span><span>&gt;</span><span>())
        {
        }

        </span><span>public</span><span> MethodCallTracker(IDictionary</span><span>&lt;</span><span>string</span><span>, </span><span>string</span><span>&gt;</span><span> methodNames)
        {
            </span><span>this</span><span>.methodNames </span><span>=</span><span> methodNames;
        }


        </span><span>public</span><span> </span><span>void</span><span> Intercept(IInvocation invocation)
        {
            SetReturnValueFor(invocation);

            </span><span>if</span><span> (methodNames.ContainsKey(invocation.Method.Name)) </span><span>return</span><span>;

            methodNames.Add(invocation.Method.Name, invocation.Method.Name);
        }

        </span><span>private</span><span> </span><span>void</span><span> SetReturnValueFor(IInvocation invocation)
        {
            Type returnType </span><span>=</span><span> invocation.Method.ReturnType;
            
            </span><span>if</span><span> (returnType </span><span>==</span><span> </span><span>typeof</span><span>(</span><span>void</span><span>)) </span><span>return</span><span>;
            
            invocation.ReturnValue </span><span>=</span><span> (returnType.IsValueType </span><span>?</span><span> Activator.CreateInstance(returnType) : </span><span>null</span><span>);
        }


        </span><span>public</span><span> </span><span>bool</span><span> CallsWereMade
        {
            </span><span>get</span><span> { </span><span>return</span><span> methodNames.Count </span><span>&gt;</span><span> </span><span>0</span><span>; }
        }


        </span><span>public</span><span> IDictionary</span><span>&lt;</span><span>string</span><span>, </span><span>string</span><span>&gt;</span><span> AllMethods()
        {
            </span><span>return</span><span> methodNames.Copy();
        }
    }
</span></div></pre>
</p>
<p>And finally, the glue that ties it all together. ProxyFactory, this class actually creates proxies instances leveraging the Castle ProxyGenerator as well as the completed InterceptorConstraintSet:</p>
<p>&nbsp;</p>
<pre><div><span>    </span><span>public</span><span> </span><span>class</span><span> ProxyFactory : IProxyFactory
    {
        </span><span>private</span><span> ProxyGenerator proxyGenerator;
        </span><span>private</span><span> IMethodCallTrackerFactory methodCallTrackerFactory;


        </span><span>public</span><span> ProxyFactory():</span><span>this</span><span>(</span><span>new</span><span> ProxyGenerator(),</span><span>new</span><span> MethodCallTrackerFactory(</span><span>new</span><span> ProxyGenerator()))
        {
        }

        </span><span>public</span><span> ProxyFactory(ProxyGenerator proxyGenerator, IMethodCallTrackerFactory methodCallTrackerFactory)
        {
            </span><span>this</span><span>.proxyGenerator </span><span>=</span><span> proxyGenerator;
            </span><span>this</span><span>.methodCallTrackerFactory </span><span>=</span><span> methodCallTrackerFactory;
        }

        </span><span>public</span><span> IMethodCallTracker</span><span>&lt;</span><span>T</span><span>&gt;</span><span> CreateMethodCallTracker</span><span>&lt;</span><span>T</span><span>&gt;</span><span>()
        {
            </span><span>return</span><span> methodCallTrackerFactory.CreateFor</span><span>&lt;</span><span>T</span><span>&gt;</span><span>();
        }

        </span><span>public</span><span> T CreateProxyUsing</span><span>&lt;</span><span>T</span><span>&gt;</span><span>(T instance, IInterceptorConstraintSet constraints)
        {
            </span><span>return</span><span> proxyGenerator.CreateInterfaceProxyWithTarget</span><span>&lt;</span><span>T</span><span>&gt;</span><span>(instance, constraints.AllInterceptors</span><span>&lt;</span><span>T</span><span>&gt;</span><span>());
        }
    }
</span></div></pre>
</p>
<p>People ask me why I love TDD? It&rsquo;s because you can start with a blank slate, drive out the components one at a time in isolation from another, isolating/deferring responsibilities as you go, and finally you can plug all of the pieces together. In all of the code samples above I added in the poor mans dependency injection so that people could see the concretes being injected into the dependent. In the actual source code, an IOC container is being used. As when driving out the solution the interfaces were used to defer responsiblity to another object that did not exist yet. Taking this code, it would not be hard to add the pre/post/both filter also so that you could choose when specifically to apply an interceptor!! And of course I could eliminate the method call tracker altogether if I made use of lambda expressions and parsed the expression tree to see what method was called. I&rsquo;ll leave that for another day!!</p>
<p>Develop With Passion!!</p>
<div class="shr-publisher-109"></div><!-- Start Shareaholic LikeButtonSetBottom Automatic --><!-- End Shareaholic LikeButtonSetBottom Automatic -->											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/jpboodhoo/category/c/" title="View all posts in C#" rel="category tag">C#</a>, <a href="http://codebetter.com/jpboodhoo/category/featured/" title="View all posts in Featured" rel="category tag">Featured</a>. Bookmark the <a href="http://codebetter.com/jpboodhoo/2008/01/30/explicit-strongly-typed-selective-proxies/" title="Permalink to Explicit Strongly Typed Selective Proxies" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/jpboodhoo/2008/01/30/explicit-strongly-typed-selective-proxies/feed/" title="Comments RSS to Explicit Strongly Typed Selective Proxies" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-109 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/jpboodhoo/2008/01/30/i-see-dead-projects/" rel="prev"><span class="meta-nav">&larr;</span> I see dead projects!!</a></div>
					<div class="nav-next"><a href="http://codebetter.com/jpboodhoo/2008/01/30/nothin-but-c-v3-5-with-the-igloo-coder-edmonton-ab-march-31st-april-4th/" rel="next">Nothin But C# v3.5 with the Igloo Coder &#8211; Edmonton, AB (March 31st &#8211; April 4th) <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

							<div id="comments">





								<div id="respond">
				<h3 id="reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/jpboodhoo/2008/01/30/explicit-strongly-typed-selective-proxies/#respond" style="display:none;">Cancel reply</a></small></h3>
									<p class="must-log-in">You must be <a href="http://codebetter.com/jpboodhoo/wp-login.php?redirect_to=http%3A%2F%2Fcodebetter.com%2Fjpboodhoo%2F2008%2F01%2F30%2Fexplicit-strongly-typed-selective-proxies%2F">logged in</a> to post a comment.</p>												</div><!-- #respond -->
						
</div><!-- #comments -->

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29416);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=2782afb'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29416&amp;n=2782afb' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29417);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=e94cea6'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29417&amp;n=e94cea6' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29418);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=9ba3022'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29418&amp;n=9ba3022' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29419);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=f467b52'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29419&amp;n=f467b52' /></a></noscript>
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(220407);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=68b8307'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=220407&amp;n=68b8307' /></a></noscript>				
				
				<ul class="xoxo">		
									</ul>	
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29421);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=3f8e353'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29421&amp;n=3f8e353' /></a></noscript>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="http://red-gate.com/">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="http://telerik.com">Telerik .NET Tools</a></li>
<li><a href="http://jetbrains.com/resharper/">JetBrains - ReSharper</a></li>
<li><a href="http://scootersoftware.com">Beyond Compare</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a></li>
<li><a href="http://umbraco.com" target="_blank">Umbraco</a></li>
<li><a href="http://nservicebus.com" target="_blank">NServiceBus</a></li>
<li><a href="http://ravendb.net" target="_blank">RavenDb</a></li>
<li><a href="http://www.websequencediagrams.com/" target="_blank">Web Sequence Diagrams</a></li>
	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '12<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPython.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = true; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>

<script type='text/javascript'>//<![CDATA[
    if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.4.2.min.js' type='text/javascript' %3E%3C/script%3E"));
    }//]]></script>
<script type='text/javascript' language='Javascript' src='http://s1.lqcdn.com/m.min.js?dt=2.3.110202.1'></script>
<script type='text/javascript' language='Javascript'> if(jQuery.LqmAds)jQuery.LqmAds();</script>
 
</body>
</html>
<!-- Dynamic page generated in 1.535 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2012-11-09 18:47:35 -->
<!-- super cache -->