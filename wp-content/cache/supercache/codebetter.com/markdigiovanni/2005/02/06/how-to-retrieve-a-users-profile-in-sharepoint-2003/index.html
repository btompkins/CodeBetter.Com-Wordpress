<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>How To Retrieve a User&#8217;s Profile in SharePoint 2003 | Mark DiGiovanni</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/markdigiovanni/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css?v=3912785705" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js?ver=3.4.2'></script>
<script type='text/javascript' src='http://dtym7iokkjlif.cloudfront.net/dough/1.0/recipe.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/markdigiovanni/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Fifty Invites from GMail' href='http://codebetter.com/markdigiovanni/2005/02/03/fifty-invites-from-gmail/' />
<link rel='next' title='Determine User Site Group (Role) Membership in SharePoint 2003' href='http://codebetter.com/markdigiovanni/2005/02/16/determine-user-site-group-role-membership-in-sharepoint-2003/' />
<meta name="generator" content="WordPress 3.4.2" />
<link rel='shortlink' href='http://codebetter.com/markdigiovanni/?p=84' />

<!-- All in One SEO Pack 1.6.13.2 by Michael Torbert of Semper Fi Web Design[83,165] -->
<link rel="canonical" href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/" />
<!-- /all in one seo pack -->
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.3.3" type="text/css" media="screen" />

<!-- Start Shareaholic OgTags -->

	<!-- Shareaholic Notice: There is neither a featured nor gallery image set -->

<!-- End Shareaholic OgTags -->

<meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/dc168cf39155d7b5d39f696ca94d5980.js?v=5302176208">/*Is Cache!*/</script>
                	
	<script type='text/javascript' src='http://d1.openx.org/spcjs.php?id=7744&amp;target=_blank'></script>
	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>
<!-- BuySellAds Ad Code -->
<script type="text/javascript">
(function(){
  var bsa = document.createElement('script');
     bsa.type = 'text/javascript';
     bsa.async = true;
     bsa.src = 'http://s3.buysellads.com/ac/bsa.js';
  (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);
})();
</script>
<!-- End BuySellAds Ad Code -->
</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">
			<!-- BuySellAds Zone Code -->
<div id="bsap_1276080" class="bsarocks bsap_4fe632babdccc2b4b049e4f08cc3c549"></div>
<!-- End BuySellAds Zone Code --></div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-84" class="post-84 post type-post status-publish format-standard hentry category-sharepoint">
					<h1 class="entry-title">How To Retrieve a User&#8217;s Profile in SharePoint 2003</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/markdigiovanni/author/markdigiovanni/" title="View all posts by markdigiovanni">markdigiovanni</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/" title="12:52 am" rel="bookmark"><span class="entry-date">February 6, 2005</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/markdigiovanni/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/markdigiovanni/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><!-- Start Shareaholic LikeButtonSetTop Automatic --><!-- End Shareaholic LikeButtonSetTop Automatic --><p>I am currently building a Web Part for our internal SharePoint 2003<br />
portal site that will return the employee directory complete with<br />
photo, email address, and home, work, and cell phone numbers. To do<br />
this, the web part needs to access to the users profile. Here is the C#<br />
code needed to get the user profiles.&nbsp; </p>
<p>*The below code does not represent a complete web part*</p>
<p>First, make sure that your web part has the appropriate code access<br />
security settings such as the SharePointPermission with the following<br />
setting: ObjectModel=True. For more information on Code Access Security<br />
and SharePoint, click <a title="Code Access Security" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/odc_SP2003_ta/html/sharepoint_wsscodeaccesssecurity.asp" target="_blank">here</a>. </p>
<p>Add the following using statements after the assemblies are referenced. </p>
<blockquote><p><font color="#0000ff" size="2">using</font><font size="2"> Microsoft.SharePoint.Portal;<br /></font><font color="#0000ff" size="2">using</font><font size="2"> Microsoft.SharePoint.Portal.Topology;</font> <br /><font color="#0000ff" size="2">using</font><font size="2"> Microsoft.SharePoint.Portal.UserProfiles;</font></p></blockquote>
<p>The root site will have to be retrieved to get the collection of users. Use the following method to get the base URL. </p>
<blockquote>
<p><font color="#0000ff" size="2">private <font color="#0000ff" size="2">string</font></font><font size="2"> GetRootUrl() <br />{ </font></p>
<blockquote>
<p><font color="#0000ff" size="2">string</font><font size="2"> url = Context.Request.Url.GetLeftPart(UriPartial.Authority) + </font><font color="#0000ff" size="2">this</font><font size="2">.ResolveUrl( Context.Request.ApplicationPath); <br /></font><font color="#0000ff" size="2">return</font><font size="2"> url;</font></p>
</blockquote>
<p dir="ltr"><font size="2">}</font></p>
</blockquote>
<p>*NOTE* If you are accessing the portal site via http://localhost/, you must add http://localhost/ as an alias for the site. </p>
<blockquote>
<p><font color="#808080" size="2">//Get the root URL and the PortalContext.</font> <br /><font size="2"></font><font color="#0000ff" size="2">string</font><font size="2"> url = GetRootUrl(); <br />SPSite rootSite = SPControl.GetContextSite(Context); <br />PortalContext portalContext = </font><font color="#0000ff" size="2">null</font><font size="2">; <br />Uri uri = </font><font color="#0000ff" size="2">new</font><font size="2"> Uri(url);</font> </p>
<p><font color="#808080" size="2">//Get the collection of portal sites by the URL.</font> <br /><font size="2">TopologyManager topologyManager = </font><font color="#0000ff" size="2">new</font><font size="2"> TopologyManager(); <br />PortalSiteCollection sites = topologyManager.PortalSites; <br />portalContext = PortalApplication.GetContext(sites[uri]);</font> </p>
<p><font color="#808080" size="2">//Get all the users that have access.</font> <br /><font size="2">SPUserCollection allUsers = rootSite.RootWeb.AllUsers; <br />UserProfileManager upm = </font><font color="#0000ff" size="2">new</font><font size="2"> UserProfileManager(portalContext); </font></p>
<p><font color="#808080" size="2">//Loop through the users to get their profile.</font> <br /><font size="2"></font><font color="#0000ff" size="2">foreach</font><font size="2"> (SPUser user </font><font color="#0000ff" size="2">in</font><font size="2"> allUsers) <br /></font><font size="2">{</font></p>
<blockquote>
<p><font size="2"><font color="#808080" size="2">//Do whatever needs to be done with the following properties.</font> <br />UserProfile up = upm.GetUserProfile(user.LoginName);</font> <br /><font color="#0000ff" size="2">string</font><font size="2"> fullName = up[</font><font color="#800000" size="2">"PreferredName"</font><font size="2">].ToString();</font> <br /><font color="#0000ff" size="2">string</font><font size="2"> emailAddress = up[</font><font color="#800000" size="2">"WorkEmail"</font><font size="2">].ToString();</font> <br /><font color="#0000ff" size="2">string</font><font size="2"> homePhone = up[</font><font color="#800000" size="2">"HomePhone"</font><font size="2">].ToString();</font> <br /><font color="#0000ff" size="2">string</font><font size="2"> cellPhone = up[</font><font color="#800000" size="2">"MobilePhone"</font><font size="2">].ToString();</font></p>
</blockquote>
<p><font size="2">}</font></p>
</blockquote>
<p>To see a list of property names available to you, navigate here:<br />
Site Settings &gt; Manage profile Database &gt; View profile<br />
properties. 
</p>
<p>For additional resources on SharePoint, visit the following sites: </p>
<p><a title="SharePoint and Code Access Security" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/odc_SP2003_ta/html/sharepoint_wsscodeaccesssecurity.asp" target="_blank">SharePoint and Code Access Security</a> <br /><a title="Lamont Harrington's SharePoint 2003 Resource Center" href="http://dotnetjunkies.com/WebLog/lamont_harrington/articles/12068.aspx" target="_blank">Lamont Harrington&#8217;s SharePoint 2003 Resource Center</a> <br /><a title="SharePoint University" href="http://www.sharepointu.com/" target="_blank">SharePoint University</a><br /><a href="http://www.devx.com/dotnet/Article/22387/1763/page/1" target="_blank">Push the Limits of SharePoint Customization</a></p>
<p>&#8211;Mark </p>
<div class="shr-publisher-84"></div><!-- Start Shareaholic LikeButtonSetBottom Automatic --><!-- End Shareaholic LikeButtonSetBottom Automatic -->											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/markdigiovanni/category/sharepoint/" title="View all posts in SharePoint" rel="category tag">SharePoint</a>. Bookmark the <a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/" title="Permalink to How To Retrieve a User&#8217;s Profile in SharePoint 2003" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/feed/" title="Comments RSS to How To Retrieve a User&#8217;s Profile in SharePoint 2003" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-84 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/markdigiovanni/2005/02/03/fifty-invites-from-gmail/" rel="prev"><span class="meta-nav">&larr;</span> Fifty Invites from GMail</a></div>
					<div class="nav-next"><a href="http://codebetter.com/markdigiovanni/2005/02/16/determine-user-site-group-role-membership-in-sharepoint-2003/" rel="next">Determine User Site Group (Role) Membership in SharePoint 2003 <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

							<div id="comments">


			<h3 id="comments-title">20 Responses to <em>How To Retrieve a User&#8217;s Profile in SharePoint 2003</em> </h3>


			<ol class="commentlist">
						<li class="comment even thread-even depth-1" id="li-comment-270">
		<div id="comment-270">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Gayathri</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/#comment-270">October 23, 2008 at 7:47 am</a></div>

		<div class="comment-body"><p>good one</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-269">
		<div id="comment-269">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://techdhaan.wordpress.com' rel='external nofollow' class='url'>Shankar</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/#comment-269">June 3, 2008 at 3:52 am</a></div>

		<div class="comment-body"><p>Here is a no-code solution<br />
<a href="http://techdhaan.wordpress.com/2008/06/03/moss-2007-employee-directory-web-part-using-search-and-data-view-web-parts/" rel="nofollow">http://techdhaan.wordpress.com/2008/06/03/moss-2007-employee-directory-web-part-using-search-and-data-view-web-parts/</a></p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-268">
		<div id="comment-268">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">M.V.S.RAVI KUMAR</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/#comment-268">February 19, 2008 at 3:06 pm</a></div>

		<div class="comment-body"><p>can you give me some idea how to access user profiles in MOSS? </p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-267">
		<div id="comment-267">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Christian</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/#comment-267">June 13, 2007 at 1:56 pm</a></div>

		<div class="comment-body"><p>Hi</p>
<p>Im looking for a webpart similar to the built in Contact Details but where one can show more fields than just Picture and Jobtitle. Anyone that can help me with this? </p>
<p>Attachments:    </p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-266">
		<div id="comment-266">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Anna</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/#comment-266">May 23, 2007 at 4:47 am</a></div>

		<div class="comment-body"><p>Can somebody tell me how to search users from the profile database and not from sharepoint which is illustrated in this example.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-265">
		<div id="comment-265">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">sush</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/#comment-265">May 15, 2007 at 5:50 am</a></div>

		<div class="comment-body"><p>hi Courtz..<br />
can you please tell me how to add users to the profile database&#8230;thnx</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-264">
		<div id="comment-264">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Taha</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/#comment-264">March 21, 2007 at 6:14 pm</a></div>

		<div class="comment-body"><p>some time its:</p>
<p>File or assembly name spsscheduler_net, or one of its dependencies, was not found. </p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-263">
		<div id="comment-263">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Taha</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/#comment-263">March 21, 2007 at 6:12 pm</a></div>

		<div class="comment-body"><p>I have a problem with defining TopologyManager<br />
it gives me error of<br />
File or assembly name Microsoft.SharePoint.Security, or one of its dependencies, was not found.<br />
any help</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-262">
		<div id="comment-262">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">mourinho</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/#comment-262">March 1, 2007 at 9:06 am</a></div>

		<div class="comment-body"><p>Hi Eva<br />
1. I have the same propblem with you, any suggestion? Thanks<br />
2. I want to learn more about security, for example<br />
<ipermission class="SecurityPermission"<br />
 version="1"<br />
Flags="Execution,UnmanagedCode,ControlPrincipal,ControlAppDomain,ControlEvidence"<br />
/></p>
<p>It very hard to understand, please let me know books or references about that, thanks.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-261">
		<div id="comment-261">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Pat</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/#comment-261">June 1, 2006 at 2:44 pm</a></div>

		<div class="comment-body"><p>Hey Mark,</p>
<p>I am doing the exact same thing which you have been looking for. My Profile database is being populated from AD and trying to build a webpart which basically works as a Phone Directory. This article seems to be good but I dont understand if it is pulling the users from the root or actually from the profile DB. If you found some more references for what you have doing please share it with me. </p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-260">
		<div id="comment-260">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Mark</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/#comment-260">May 26, 2006 at 3:03 pm</a></div>

		<div class="comment-body"><p>I&#8217;m with the other guy. I&#8217;m trying to build an employee database (skills, contact info, resume etc..) and want it to update the Sharepoint profile.  I&#8217;d rather not even build the database &#8211; maybe just extend Active Directory or Outlook contacts (or something).  Anyone ever do something similar?  How about sharing those webparts on gotdotnet?</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-259">
		<div id="comment-259">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Cameron Seibel</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/#comment-259">March 20, 2006 at 9:03 pm</a></div>

		<div class="comment-body"><p>Way of doing it without for-eaching through the user database (in VB)</p>
<p>    &#8216;This webpart will NOT work correctly if the site url is not in the<br />
    &#8216;alternate url list.  This is due to getting the site context.  If<br />
    &#8216;getting the site context or user profile fail, only the user account<br />
    &#8216;will be displyed.</p>
<p>    Private Function getSPPreferredName(ByVal userAccount As String) As String</p>
<p>        Try<br />
            &#8216;Some code taken from the SPPT SDK from the UserProfile Class<br />
            &#8216;Can also be found on the MSDN 2005 Library</p>
<p>            &#8216;*********** Error Here Requesting Context ***********<br />
            &#8216;*********** Testing on <a href="http://localhost:8080" rel="nofollow">http://localhost:8080</a> ***********<br />
            &#8216;*********** Was not in alternate url so it failed ***********<br />
            &#8216;*********** getting the site context ***********</p>
<p>            &#8216;get portal site context from topology<br />
            Dim strUrl As String = Context.Request.Url.GetLeftPart(UriPartial.Authority) &#038; Me.ResolveUrl(Context.Request.ApplicationPath)<br />
            Dim tm As New TopologyManager<br />
            Dim ps As PortalSite = tm.PortalSites(New Uri(strUrl))<br />
            Dim pc As PortalContext = PortalApplication.GetContext(ps)</p>
<p>            &#8216;initialize user profile config manager object<br />
            Dim upm As New UserProfileManager(pc)<br />
            &#8216;Check to see if the user exists in the Profile Database<br />
            If upm.UserExists(userAccount) Then<br />
                &#8216;Create an instance of the user profile with the specified account name<br />
                Dim userProf As UserProfile = upm.GetUserProfile(userAccount)<br />
                &#8216;Return the preferred name of the user<br />
                context.Trace.Warn(userProf(&#8220;PreferredName&#8221;).ToString())<br />
                Return userProf(&#8220;PreferredName&#8221;).ToString()<br />
            Else<br />
                &#8216;If the user doesn&#8217;t exist just return the user account<br />
                Return userAccount<br />
            End If</p>
<p>        Catch ex As Exception<br />
            &#8216;Write stacktrace for troubleshooting to tracing info if Try<br />
            &#8216;block fails<br />
            context.Trace.Warn(ex.StackTrace)<br />
            &#8216;Just return the userAccount if the GetContext or GetUserProfile<br />
            &#8216;fail.<br />
            Return userAccount<br />
        End Try<br />
    End Function</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-258">
		<div id="comment-258">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Edward</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/#comment-258">March 8, 2006 at 1:23 pm</a></div>

		<div class="comment-body"><p>U DA MAN!!!!</p>
<p>Just wanted to say thanks. I am doing something very similiar. Building Employee directory application and wanted to use the SharePoint profile database to get path to photos etc. Just saved me some time. Thanks.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-257">
		<div id="comment-257">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Asfar Sadewa</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/#comment-257">February 1, 2006 at 2:14 am</a></div>

		<div class="comment-body"><p>I got an error on this line.</p>
<p>SPUserCollection allUsers = rootSite.RootWeb.AllUsers; </p>
<p>the error was:<br />
The referenced virtual server is not on the config database.</p>
<p>how come??? can you diagnose my problem?? because i am sure that the value of the uri&#8217;s absolute path is correct and point to my portal address.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-256">
		<div id="comment-256">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Courtz</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/#comment-256">January 31, 2006 at 8:58 am</a></div>

		<div class="comment-body"><p>In this example you only search the users already added to sharepoint not the profile database, but do bring up user info for the existing (added) users from the profile database</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-255">
		<div id="comment-255">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Eve</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/#comment-255">December 14, 2005 at 6:35 pm</a></div>

		<div class="comment-body"><p>I&#8217;m trying what you suggested, but I&#8217;m getting the following error:</p>
<p>System.Security.SecurityException: Request failed. at Microsoft.SharePoint.Portal.Topology.TopologyManager.g() at Microsoft.SharePoint.Portal.Topology.TopologyManager..ctor() at WebPartLibrary.PhoneBook.CreateChildControls() in y:\webpartlibrary\webpartlibrary\phonebook.cs:line 129</p>
<p>I am using a custom trust file, but it doesn&#8217;t work with WSS_MediumTrust either.  It will only work when I set it to full trust, which I would rather not do.  Any suggestions?</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-254">
		<div id="comment-254">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://www.scarylittlemonkey.com' rel='external nofollow' class='url'>Nik</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/#comment-254">August 4, 2005 at 2:19 pm</a></div>

		<div class="comment-body"><p>I&#8217;m sure that no one wants to share the web part that they have created right? I&#8217;ve been trying to find something to do this for a while now, but I am not a developer, and VS.Net scares me.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-253">
		<div id="comment-253">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Share khan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/#comment-253">August 4, 2005 at 11:05 am</a></div>

		<div class="comment-body"><p>I have created a webpart based on your code.<br />
It works fine with the portal.<br />
My portal also has a host header name.<br />
When I access th site with this host header name the web part is not rendered</p>
<p>There is no hard coding of site name in the code.<br />
Any Idea??</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-252">
		<div id="comment-252">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Nick</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/#comment-252">June 14, 2005 at 2:57 pm</a></div>

		<div class="comment-body"><p>How do we update the user profile properties? Neither the web service nor referencing the DLL directly seems to allow this.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-251">
		<div id="comment-251">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">L Baudewijns</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/#comment-251">March 25, 2005 at 6:49 am</a></div>

		<div class="comment-body"><p>On the inside of my network, it works correctly (<a href="http://sharepoint" rel="nofollow">http://sharepoint</a>). But when i view the portal from the internet (eg. <a href="http://portal.sharepoint.nl" rel="nofollow">http://portal.sharepoint.nl</a>) then, the site url stays empty.</p>
<p>Any suggestions?</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
			</ol>



								<div id="respond">
				<h3 id="reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/markdigiovanni/2005/02/06/how-to-retrieve-a-users-profile-in-sharepoint-2003/#respond" style="display:none;">Cancel reply</a></small></h3>
									<p class="must-log-in">You must be <a href="http://codebetter.com/markdigiovanni/wp-login.php?redirect_to=http%3A%2F%2Fcodebetter.com%2Fmarkdigiovanni%2F2005%2F02%2F06%2Fhow-to-retrieve-a-users-profile-in-sharepoint-2003%2F">logged in</a> to post a comment.</p>												</div><!-- #respond -->
						
</div><!-- #comments -->

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29416);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=2782afb'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29416&amp;n=2782afb' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29417);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=e94cea6'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29417&amp;n=e94cea6' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29418);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=9ba3022'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29418&amp;n=9ba3022' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29419);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=f467b52'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29419&amp;n=f467b52' /></a></noscript>
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(220407);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=68b8307'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=220407&amp;n=68b8307' /></a></noscript>				
				
				<ul class="xoxo">		
									</ul>	
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29421);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=3f8e353'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29421&amp;n=3f8e353' /></a></noscript>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="http://red-gate.com/">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="http://telerik.com">Telerik .NET Tools</a></li>
<li><a href="http://jetbrains.com/resharper/">JetBrains - ReSharper</a></li>
<li><a href="http://scootersoftware.com">Beyond Compare</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a></li>
<li><a href="http://umbraco.com" target="_blank">Umbraco</a></li>
<li><a href="http://nservicebus.com" target="_blank">NServiceBus</a></li>
<li><a href="http://ravendb.net" target="_blank">RavenDb</a></li>
<li><a href="http://www.websequencediagrams.com/" target="_blank">Web Sequence Diagrams</a></li>
	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '12<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPython.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = true; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>

<script type='text/javascript'>//<![CDATA[
    if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.4.2.min.js' type='text/javascript' %3E%3C/script%3E"));
    }//]]></script>
<script type='text/javascript' language='Javascript' src='http://s1.lqcdn.com/m.min.js?dt=2.3.110202.1'></script>
<script type='text/javascript' language='Javascript'> if(jQuery.LqmAds)jQuery.LqmAds();</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.406 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2012-11-09 19:50:37 -->
<!-- super cache -->