<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Use GDI+ to Save Crystal-Clear GIF Images with .NET | Brendan Tompkins</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/brendantompkins/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css?v=3912785705" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js?ver=3.4.2'></script>
<script type='text/javascript' src='http://dtym7iokkjlif.cloudfront.net/dough/1.0/recipe.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/brendantompkins/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Create a SQL Server View of your AD Users' href='http://codebetter.com/brendantompkins/2003/12/19/create-a-sql-server-view-of-your-ad-users/' />
<link rel='next' title='Strongly-Type a DropDownList with Enumerated Types' href='http://codebetter.com/brendantompkins/2004/04/06/strongly-type-a-dropdownlist-with-enumerated-types/' />
<meta name="generator" content="WordPress 3.4.2" />
<link rel='shortlink' href='http://codebetter.com/brendantompkins/?p=52' />

<!-- All in One SEO Pack 1.6.13.2 by Michael Torbert of Semper Fi Web Design[83,160] -->
<link rel="canonical" href="http://codebetter.com/brendantompkins/2004/01/26/use-gdi-to-save-crystal-clear-gif-images-with-net/" />
<!-- /all in one seo pack -->
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.3.3" type="text/css" media="screen" />

<!-- Start Shareaholic OgTags -->

	<meta property='og:image' content='http://www.codebetter.com/bsblog/pmtzone_raw.gif' />

<!-- End Shareaholic OgTags -->

<meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/dc168cf39155d7b5d39f696ca94d5980.js?v=5302176208">/*Is Cache!*/</script>
                	
	<script type='text/javascript' src='http://d1.openx.org/spcjs.php?id=7744&amp;target=_blank'></script>
	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>
<!-- BuySellAds Ad Code -->
<script type="text/javascript">
(function(){
  var bsa = document.createElement('script');
     bsa.type = 'text/javascript';
     bsa.async = true;
     bsa.src = 'http://s3.buysellads.com/ac/bsa.js';
  (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);
})();
</script>
<!-- End BuySellAds Ad Code -->
</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">
			<!-- BuySellAds Zone Code -->
<div id="bsap_1276080" class="bsarocks bsap_4fe632babdccc2b4b049e4f08cc3c549"></div>
<!-- End BuySellAds Zone Code --></div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-52" class="post-52 post type-post status-publish format-standard hentry category-asp-net-tutorials category-most-popular">
					<h1 class="entry-title">Use GDI+ to Save Crystal-Clear GIF Images with .NET</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/brendantompkins/author/btompkins/" title="View all posts by Brendan Tompkins">Brendan Tompkins</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/brendantompkins/2004/01/26/use-gdi-to-save-crystal-clear-gif-images-with-net/" title="1:17 pm" rel="bookmark"><span class="entry-date">January 26, 2004</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/brendantompkins/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/brendantompkins/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><!-- Start Shareaholic LikeButtonSetTop Automatic --><!-- End Shareaholic LikeButtonSetTop Automatic --><p>In an effort to make our <a href="http://www.vit.org/TerminalCamera.aspx">gate camera images</a> visible on a ridiculously small cellphone screen, &nbsp;I spent the past couple of days learning about the process of image <i><b>Quantization</b></i>.&nbsp;&nbsp; GDI+ will allow you to take a full-color 32 bpp image and save it as a .gif file!&nbsp; This turns out to be quite simple, and you can even re-size the image before saving it, by using the CreateThumnailImage method.</p>
<p><font size="2">System.Drawing.Bitmap b = </font><font color="#0000ff" size="2">new</font><font size="2"> System.Drawing.Bitmap(“c:\\original_image.gif“</font><font size="2">); <br />System.Drawing.Image thmbnail = b.GetThumbnailImage(100,75,</font><font color="#0000ff" size="2">null</font><font size="2">,</font><font color="#0000ff" size="2">new</font><font size="2"> IntPtr());<br />thmbnail.Save(“c:\\thumnail.gif“, System.Drawing.Imaging.ImageFormat.Gif);</font></p>
<p>“Cool!“ You&#8217;re thinking to yourself, but&nbsp;don&#8217;t&nbsp;think too soon.&nbsp;&nbsp;You may be less-than-impressed by the dithery, grainy image produced by this technique.&nbsp; Here&#8217;s the output of this method with one of our gate camera images:&nbsp; </p>
<p><img src="http://www.codebetter.com/bsblog/pmtzone_raw.gif"> </p>
<p>So, what accounts for the grainy image?&nbsp; It has to do with <a href="http://www.faqs.org/faqs/jpeg-faq/part1/section-8.html">color quantization</a>,&nbsp;sometimes called “palettization”&nbsp;or simply, the process of slapping a 256 color palette onto a full-color image, thereby reducing the total colors (and file-size).&nbsp; The image is grainy because GDI+ by default uses the windows&nbsp;256-color&nbsp;palette, and doesn&#8217;t take into account the colors in the actual image.&nbsp; When I found this out I went in search of a better color quantization technique for saving .GIF images&#8230;&nbsp;</p>
<p>Personally I&#8217;ve found that <i><b>almost&nbsp;all</b></i> GIF images should be saved with an <b>adaptive palette.</b> These days, forget about the Web Palette, unless you&#8217;re doing icons or big areas of solid color.&nbsp; Most everyone will be running in at least&nbsp;16K colors, and if by some small chance they&#8217;re still running 256 colors, the browser will dither an adaptive image to a reasonable version anyhow.&nbsp; <u>An adaptive palette contains the 256&nbsp;most frequently used colors in the image.</u>&nbsp;Well, um sort of anyway.&nbsp;(As an aside, I tried to write my own “popularity palette” algorithm which used the most frequently used colors to build the palette, but my images looked worse than before!)&nbsp;&nbsp;A good quantization algorithm also takes into account spacing between colors and stores colors that are, say blue and very-nearly-blue as one color, freeing up more space for colors that the eye&nbsp;sees as separate.&nbsp; One such adaptive palette&nbsp;algorithm is called the “Octree“ algorithm.</p>
<p>I found two articles from Microsoft that helped out a great deal, <a href="http://support.microsoft.com/default.aspx?scid=kb;EN-US;Q319061">KB 319061</a>&nbsp; and <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnaspp/html/colorquant.asp">Optimizing Color Quantization for ASP.NET Images</a>&nbsp;by Morgan Skinner at MS.&nbsp; Morgan&#8217;s article had some great code samples, and&nbsp;really useful base class which will allow you to plug in your own algorithm to quantize images. I ended up pulling bits and pieces of code from the two articles to create a library of objects used for creating Octree&nbsp;and Grayscale palettes.&nbsp;&nbsp;Using the OctreeQuantizer object was easy, as you can see in this code snippet:</p>
<p><font size="2">System.Drawing.Bitmap b = <font color="#0000ff" size="2">new</font><font size="2"> System.Drawing.Bitmap(“c:\\original_image.gif“</font><font size="2">); <br />System.Drawing.Image thmbnail = b.GetThumbnailImage(100,75,</font><font color="#0000ff" size="2">null</font><font size="2">,</font><font color="#0000ff" size="2">new</font><font size="2"> IntPtr());<br /></font>OctreeQuantizer quantizer = </font><font color="#0000ff" size="2">new</font><font size="2"> OctreeQuantizer ( 255 , 8 ) ;<br /><font color="#0000ff" size="2">using</font><font size="2"> ( Bitmap quantized = quantizer.Quantize ( thmbnail ) )<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp; quantized.Save(“c:\\thumnail.gif“, System.Drawing.Imaging.ImageFormat.Gif);<br /></font></font><font size="2"><font size="2">}</font></font></p>
<p><font size="2">OctreeQuantizer grayquantizer = <font color="#0000ff">new</font> GrayscaleQuantizer ( ) ;<br /><font color="#0000ff">using</font> ( Bitmap quantized = grayquantizer.Quantize ( thmbnail ) )<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp; quantized.Save(“c:\\thumnail.gif“, System.Drawing.Imaging.ImageFormat.Gif);<br />}</font></p>
<p>This code produced the following beautiful (In this case, beauty truly is in the eye of the guy who just spent three days trying to get&nbsp;it to work!)&nbsp;thumbnails, one with an adaptive palette, and one in grayscale.&nbsp; </p>
<p><img src="http://www.codebetter.com/bsblog/pmtzone_octree.gif"> <img src="http://www.codebetter.com/bsblog/pmtzone_grayscale.gif"></p>
<p>If you&#8217;ve got a cellphone with web capabilities, go to <a href="http://mobile.vit.org/">http://mobile.vit.org/</a>&nbsp;and see the image in all its&nbsp;100 X 75 pixel glory.</p>
<p><b>UPDATE:&nbsp;</b></p>
<p><a href="/blogs/brendan.tompkins/archive/2007/06/14/gif-image-color-quantizer-now-with-safe-goodness.aspx">See this post here for the latest version of this library</a></p>
<p>&nbsp;</p>
<p>-Brendan </p>
<p>&nbsp;</p>
<div class="shr-publisher-52"></div><!-- Start Shareaholic LikeButtonSetBottom Automatic --><!-- End Shareaholic LikeButtonSetBottom Automatic -->											</div><!-- .entry-content -->

					<div id="entry-author-info">
						<div id="author-avatar">
							<img alt='' src='http://0.gravatar.com/avatar/c1de0fbc0dbc3fd24b285009c123d9b0?s=60&amp;d=http%3A%2F%2F0.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G' class='avatar avatar-60 photo' height='60' width='60' />						</div><!-- #author-avatar 	-->
						<div id="author-description">
							<h2>About Brendan Tompkins</h2>
							By day, I'm a software engineer working in the transportation and logistics industry... By night I'm a fabulous disco dancer.							<div id="author-link">
								<a href="http://codebetter.com/brendantompkins/author/btompkins/" title="View all posts by Brendan Tompkins">View all posts by Brendan Tompkins &rarr;</a>
							</div><!-- #author-link	-->
						</div><!-- #author-description	-->
					</div><!-- .entry-author-info -->

					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/brendantompkins/category/asp-net-tutorials/" title="View all posts in ASP.NET Tutorials" rel="category tag">ASP.NET Tutorials</a>, <a href="http://codebetter.com/brendantompkins/category/most-popular/" title="View all posts in Most Popular" rel="category tag">Most Popular</a>. Bookmark the <a href="http://codebetter.com/brendantompkins/2004/01/26/use-gdi-to-save-crystal-clear-gif-images-with-net/" title="Permalink to Use GDI+ to Save Crystal-Clear GIF Images with .NET" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/brendantompkins/2004/01/26/use-gdi-to-save-crystal-clear-gif-images-with-net/feed/" title="Comments RSS to Use GDI+ to Save Crystal-Clear GIF Images with .NET" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-52 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/brendantompkins/2003/12/19/create-a-sql-server-view-of-your-ad-users/" rel="prev"><span class="meta-nav">&larr;</span> Create a SQL Server View of your AD Users</a></div>
					<div class="nav-next"><a href="http://codebetter.com/brendantompkins/2004/04/06/strongly-type-a-dropdownlist-with-enumerated-types/" rel="next">Strongly-Type a DropDownList with Enumerated Types <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
                    <div id="dsq-content">
            <ul id="dsq-comments">
                    <li id="dsq-comment-314">
                    <div id="dsq-comment-header-314" class="dsq-comment-header">
                        <cite id="dsq-cite-314">
                                <span id="dsq-author-user-314">Paul Calderon</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-314" class="dsq-comment-body">
                        <div id="dsq-comment-message-314" class="dsq-comment-message"><p>I have problems with your code, with the dependencies of sistem.drawing</p>
<p>Can you help me please<br /></p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-315">
                    <div id="dsq-comment-header-315" class="dsq-comment-header">
                        <cite id="dsq-cite-315">
                                <span id="dsq-author-user-315">Brendan Tompkins</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-315" class="dsq-comment-body">
                        <div id="dsq-comment-message-315" class="dsq-comment-message"><p>Not sure Paul.  Are you opening my sln file directly?</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-316">
                    <div id="dsq-comment-header-316" class="dsq-comment-header">
                        <cite id="dsq-cite-316">
                                <span id="dsq-author-user-316">Chrei Verdend</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-316" class="dsq-comment-body">
                        <div id="dsq-comment-message-316" class="dsq-comment-message"><p>Please be patient &#8211; this is all new to me.</p>
<p>I am trying to create an aspx page, written in VB, that receives text from a form&#8217;s input box, then generates a gif of the text and saves it to file. Everything is working fine except that the default halftone palette is terrible. I understand that the GIF needs to be color quantized to make it look decent and I believe that is exactly what your code does.</p>
<p>Problem is, I downloaded your project and have absolutely NO IDEA how to implement it into my apsx page.  Your instructions say to &quot;change the namespace and you&#8217;ve got your own adaptive image quantizer.&quot; Can you please explain how to do that, or point me in the right direction?</p>
<p>Also, is it going to be a problem that my aspx page is written in VB? If so, do I need to convert my code to C# to run your script? (I have no idea how to do that, but I could try.) </p>
<p>Otherwise, do you have any other suggestions for how I might get this accomplished?</p>
<p>Thanks for any and all help!!</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-317">
                    <div id="dsq-comment-header-317" class="dsq-comment-header">
                        <cite id="dsq-cite-317">
                                <span id="dsq-author-user-317">Brendan Tompkins</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-317" class="dsq-comment-body">
                        <div id="dsq-comment-message-317" class="dsq-comment-message"><p>Chrei&#8230; No problem.  You can certainly use my assembly from VB.NET.  That&#8217;s the beauty of .NET IL!  I built the dll for you, here&#8217;s the download, with the PDB debug info too:</p>
<p><a target="_new" href="http://www.intrinsigo.com/bsblog/ImageQuantizationDll.zip">http://www.intrinsigo.com/bsblog/ImageQuantizationDll.zip</a></p>
<p>Drop this dll into your site&#8217;s bin directory, and add a project reference to the DLL.  You should then be able to create an instance of the ImageQuantizer from your aspx vb code, and call its Quantize method.</p>
<p>-Brendan</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-318">
                    <div id="dsq-comment-header-318" class="dsq-comment-header">
                        <cite id="dsq-cite-318">
                                <span id="dsq-author-user-318">Brendan Tompkins</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-318" class="dsq-comment-body">
                        <div id="dsq-comment-message-318" class="dsq-comment-message"><p>Sorry Chrei, you need to create an instance of the PaletteQuantizer object</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-319">
                    <div id="dsq-comment-header-319" class="dsq-comment-header">
                        <cite id="dsq-cite-319">
                                <span id="dsq-author-user-319">Cheri Verdend (yes, I mistyped my name before)</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-319" class="dsq-comment-body">
                        <div id="dsq-comment-message-319" class="dsq-comment-message"><p>Hi Brendan,</p>
<p>Thank you for responding so quickly! I&#8217;m trying to do what you told me to do&#8230; but I&#8217;m still a bit lost. (This is my first experience with .cs files, and I&#8217;m doing this in a text editor, not VS).</p>
<p>I&#8217;ve created an IIS virtual directory, in which I have a directory named &quot;bin&quot; (I hope that is all I need to do to create a bin directoy). In the bin directory I have saved the &quot;ImageQuantization.dll&quot; and the &quot;ImageQuantization.pdb&quot; files. I also saved my aspx file and all the files from your ImageQuantization.zip into the root of my virtual directory. </p>
<p>Below is the code for my aspx file. Right now it creates and saves a GIF with ugly colors. Would you please tell me exactly what code to insert and where to insert it to: add a project reference to the DLL and to create an instance of the PaletteQuantizer object.</p>
<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br />
<br />aspx code starts here<br />
<br />~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br />
<br />&lt;%@ Page Language=&quot;VB&quot; Debug=&quot;true&quot; %&gt;<br />
<br />&lt;%@ Import Namespace=&quot;System.Drawing&quot;%&gt;<br />
<br />&lt;%@ Import Namespace=&quot;System.Drawing.Text&quot;%&gt;<br />
<br />&lt;%@ Import Namespace=&quot;System.Drawing.Imaging&quot;%&gt;<br />
<br />&lt;%@ Import Namespace=&quot;System.Drawing.Drawing2D&quot;%&gt;</p>
<p>&lt;script language=&quot;VB&quot; runat=&quot;server&quot;&gt;</p>
<p>Sub Page_Load(sender As Object, e As EventArgs)<br />
<br />  If Request(&quot;StringToDisplay&quot;)&lt;&gt;&quot;&quot; then<br />
<br />	&#8216;Create the bitmap<br />
<br />		Response.Clear( )<br />
<br />		Dim objBitmap As New Bitmap(180,30, pixelformat.Format32bppArgb)<br />
<br />		Dim objGraphic as Graphics = Graphics.FromImage(objBitmap)<br />
<br />	        objGraphic.Clear(Color.FromArgb(0, 255, 255, 255))<br />
<br />	        objGraphic.SmoothingMode = SmoothingMode.AntiAlias<br />
<br />	        objGraphic.TextRenderingHint = System.Drawing.Text.TextRenderingHint.AntiAlias<br />
<br />		Dim textBrush   As New SolidBrush(Color.FromArgb(255, 51, 0, 102))<br />
<br />		Dim bgBrush  As New SolidBrush(Color.white)<br />
<br />			objGraphic.FillRectangle(bgBrush, 0, 0, 180, 30)<br />
<br />		Dim objPoint As New PointF(0,0)<br />
<br />		Dim objFont  As New Font(&quot;Arial&quot;, 11, FontStyle.Bold)<br />
<br />			objGraphic.DrawString(Request(&quot;StringToDisplay&quot;), objFont, textBrush, objPoint)<br />
<br />	&#8216;Save the image to file<br />
<br />		objBitmap.Save(server.mappath(&quot;Image.gif&quot;), System.Drawing.Imaging.ImageFormat.Gif)<br />
<br />	objGraphic.Dispose( )<br />
<br />	objBitmap.Dispose( )<br />
<br />  End if<br />
<br />End Sub<br />
<br />&lt;/script&gt;</p>
<p>&lt;html&gt;&lt;head&gt;&lt;title&gt;Text creation test&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;BR&gt;&lt;BR&gt;<br />
<br />  &lt;form method=&quot;POST&quot; action=&quot;test.aspx&quot;&gt;<br />
<br />  String to write: &lt;input type=&quot;text&quot; name=&quot;StringToDisplay&quot;&gt;<br />
<br />  &lt;input type=&quot;submit&quot; value=&quot;Submit Text&quot;&gt;<br />
<br />  &lt;/form&gt;<br />
<br />&lt;/BODY&gt;&lt;/html&gt;</p>
<p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
<p>After several days of searching and searching for a solution, I feel like I&#8217;m very close. You are a life-saver. Thank you, again, for your help! </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-320">
                    <div id="dsq-comment-header-320" class="dsq-comment-header">
                        <cite id="dsq-cite-320">
                                <span id="dsq-author-user-320">Brendan Tompkins</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-320" class="dsq-comment-body">
                        <div id="dsq-comment-message-320" class="dsq-comment-message"><p>As to where to add this code&#8230; Try replacing this line of code from your original source with the above code:</p>
<p>objBitmap.Save(server.mappath(&quot;Image.gif&quot;), System.Drawing.Imaging.ImageFormat.Gif)<br /></p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-321">
                    <div id="dsq-comment-header-321" class="dsq-comment-header">
                        <cite id="dsq-cite-321">
                                <span id="dsq-author-user-321">Cheri Verdend</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-321" class="dsq-comment-body">
                        <div id="dsq-comment-message-321" class="dsq-comment-message"><p>Brendan, </p>
<p>Ah! I finally got it working. Something was wrong with my .NET installation. Even though the dll was in the bin directory, I continued to get errors that that the namespace could not be found. After a myriad of false starts I finally uninstalled and reinstalled .NET &#8211; and now it works perfectly!</p>
<p>Thank you so much for your help! </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-322">
                    <div id="dsq-comment-header-322" class="dsq-comment-header">
                        <cite id="dsq-cite-322">
                                <span id="dsq-author-user-322">Gary Peluso</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-322" class="dsq-comment-body">
                        <div id="dsq-comment-message-322" class="dsq-comment-message"><p>Is there a way to set the transparent color? It defaults to black, but I need it to be white. </p>
<p>Thanks</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-323">
                    <div id="dsq-comment-header-323" class="dsq-comment-header">
                        <cite id="dsq-cite-323">
                                <span id="dsq-author-user-323">Homam</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-323" class="dsq-comment-body">
                        <div id="dsq-comment-message-323" class="dsq-comment-message"><p>Thanks! It&#8217;s very useful.<br />
<br />Is there any way for quantization Jpeg images? I mean how can i save a jpeg image in a differrent quality?</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-324">
                    <div id="dsq-comment-header-324" class="dsq-comment-header">
                        <cite id="dsq-cite-324">
                                <span id="dsq-author-user-324">Brendan Tompkins</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-324" class="dsq-comment-body">
                        <div id="dsq-comment-message-324" class="dsq-comment-message"><p>Right. JPEG images aren&#8217;t quantized, because each pixel&#8217;s color value is mathematically determined, not taken from a palette.  There&#8217;s got to be a way to set the level of compression, which relates to image quality. Not sure how to do this, however&#8230;</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-325">
                    <div id="dsq-comment-header-325" class="dsq-comment-header">
                        <cite id="dsq-cite-325">
                                <span id="dsq-author-user-325">Groves</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-325" class="dsq-comment-body">
                        <div id="dsq-comment-message-325" class="dsq-comment-message"><p>Just wanted to thank you for your hard work. That library works like a charm &#8212; I was having trouble with the standard ImageFormat.GIF exporting transparent, but yours works great.</p>
<p>Oh, and to Gary who&#8217;d asked about the transparency. If you haven&#8217;t found it yet, try &lt;b&gt;MyImage.MakeTransparent(Color.White)&lt;/b&gt;</p>
<p>Thanks, again,<br />
<br />Groves</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-326">
                    <div id="dsq-comment-header-326" class="dsq-comment-header">
                        <cite id="dsq-cite-326">
                                <span id="dsq-author-user-326">Fred Thieme</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-326" class="dsq-comment-body">
                        <div id="dsq-comment-message-326" class="dsq-comment-message"><p>Brendan</p>
<p>Thanks for the very useful color reduction code/dll.  I came across your work while doing research for a pet project of mine.  I was just gearing to do what you have already done I even read the same MSDN article that you site in your intro.  I had your dll working in a VB test project in about 5 min.  One Question &#8212; Have you made any improvements or fixed any Bugs since posting the code and dll that I downloaded today 4/8/2004.  Thanks again.</p>
<p>Fred<br /></p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-327">
                    <div id="dsq-comment-header-327" class="dsq-comment-header">
                        <cite id="dsq-cite-327">
                                <span id="dsq-author-user-327">Brendan Tompkins</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-327" class="dsq-comment-body">
                        <div id="dsq-comment-message-327" class="dsq-comment-message"><p>Fred,</p>
<p>What&#8217;s out there is the latest.  I&#8217;m not aware of any glaring bugs.  I have the dll in production on a server and it seems to be chugging along. </p>
<p>-B</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-328">
                    <div id="dsq-comment-header-328" class="dsq-comment-header">
                        <cite id="dsq-cite-328">
                                <span id="dsq-author-user-328">Fred Thieme</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-328" class="dsq-comment-body">
                        <div id="dsq-comment-message-328" class="dsq-comment-message"><p>Great &#8212; thanks for responding.  I will plug it in and see how it goes. </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-329">
                    <div id="dsq-comment-header-329" class="dsq-comment-header">
                        <cite id="dsq-cite-329">
                                <span id="dsq-author-user-329">Fred Thieme</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-329" class="dsq-comment-body">
                        <div id="dsq-comment-message-329" class="dsq-comment-message"><p>Brendon:<br />
<br />Here is a method to set the transparent color for the gif file.  First your dll optimizes the palette.  Then before saving the file call the SetTransparentColor method on the optimized palette.  The .NET Gif encoder will use the slightly modified palette to actually set the transparent color in the file.  None of the color values are actually changed just the Alpha values.  Check it out &#8212; it works.</p>
<p>Private Sub ConvertToGif()<br />
<br />        &#8221;load image to convert<br />
<br />        Dim BMPQuantized As Bitmap<br />
<br />        Dim BMPSource As Drawing.Image = Image.FromFile(&quot;C:\Ant.bmp&quot;)</p>
<p>        &#8221;optimize the palette<br />
<br />        Dim quantizer As New OctreeQuantizer(255, 8)<br />
<br />        BMPQuantized = quantizer.Quantize(BMPSource)</p>
<p>        &#8221;set the transpatent color where Color.Black is the desired transparent color<br />
<br />        BMPQuantized.Palette = SetTransparentColor(BMPQuantized.Palette, 255, Color.Black)</p>
<p>        &#8221;save as new .gif<br />
<br />        BMPQuantized.Save(&quot;C:\AntConverted.gif&quot;, System.Drawing.Imaging.ImageFormat.Gif)<br />
<br />        MsgBox(&quot;end&quot;)<br />
<br />    End Sub</p>
<p>Private Function SetTransparentColor(ByRef SrcPal As ColorPalette, ByVal nColors As Integer, ByVal cT As Drawing.Color) As ColorPalette<br />
<br />        &#8221;set the trans color in SrcPal<br />
<br />        Dim i As Integer<br />
<br />        Dim C As Drawing.Color<br />
<br />        Dim Clrs() As Drawing.Color = SrcPal.Entries<br />
<br />        For i = 0 To nColors<br />
<br />            C = Clrs(i)<br />
<br />            If (C.R = cT.R) And (C.G = cT.G) And (C.B = cT.B) Then      &#8221;match<br />
<br />                SrcPal.Entries(i) = Color.FromArgb(0, C.R, C.G, C.B)    &#8221;trans<br />
<br />            Else<br />
<br />                SrcPal.Entries(i) = Color.FromArgb(255, C.R, C.G, C.B)  &#8221;opaic<br />
<br />            End If<br />
<br />        Next i<br />
<br />        Return SrcPal<br />
<br />    End Function</p>
<p> </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-330">
                    <div id="dsq-comment-header-330" class="dsq-comment-header">
                        <cite id="dsq-cite-330">
                                <span id="dsq-author-user-330">Tommaso</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-330" class="dsq-comment-body">
                        <div id="dsq-comment-message-330" class="dsq-comment-message"><p>And if i want a optimized color reduced gif ?</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-331">
                    <div id="dsq-comment-header-331" class="dsq-comment-header">
                        <cite id="dsq-cite-331">
                                <span id="dsq-author-user-331">Tommaso</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-331" class="dsq-comment-body">
                        <div id="dsq-comment-message-331" class="dsq-comment-message"><p>eS: 16 color&#8230;</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-332">
                    <div id="dsq-comment-header-332" class="dsq-comment-header">
                        <cite id="dsq-cite-332">
                                <span id="dsq-author-user-332">Brendan Tompkins</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-332" class="dsq-comment-body">
                        <div id="dsq-comment-message-332" class="dsq-comment-message"><p>Well, I haven&#8217;t poked around in the code in a while, but I think it&#8217;s just a matter of overloading a method to pass in the bit depth you are looking for&#8230;</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-333">
                    <div id="dsq-comment-header-333" class="dsq-comment-header">
                        <cite id="dsq-cite-333">
                                <span id="dsq-author-user-333">Herb</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-333" class="dsq-comment-body">
                        <div id="dsq-comment-message-333" class="dsq-comment-message"><p>Brendan &#8211; Great work. Just came across your article while trying to fix this problem in outputting gifs, downloaded your dll, and five minutes later my gifs look beautiful. Thanks so much for your contribution.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-334">
                    <div id="dsq-comment-header-334" class="dsq-comment-header">
                        <cite id="dsq-cite-334">
                                <span id="dsq-author-user-334">Brendan Tompkins</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-334" class="dsq-comment-body">
                        <div id="dsq-comment-message-334" class="dsq-comment-message"><p>Herb&#8230; Glad to have helped!</p>
<p>Brendan</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-335">
                    <div id="dsq-comment-header-335" class="dsq-comment-header">
                        <cite id="dsq-cite-335">
                                <span id="dsq-author-user-335">Daniel</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-335" class="dsq-comment-body">
                        <div id="dsq-comment-message-335" class="dsq-comment-message"><p>This class worked perfectly for me. I have a few classes that I always keep nearby because they are so damn good: ImageQuantizer is now one of them.</p>
<p>Thank you thank you thank you thank you &#8230;</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-336">
                    <div id="dsq-comment-header-336" class="dsq-comment-header">
                        <cite id="dsq-cite-336">
                                <span id="dsq-author-user-336">Brendan Tompkins</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-336" class="dsq-comment-body">
                        <div id="dsq-comment-message-336" class="dsq-comment-message"><p>Glad to have helped Daniel.  Good luck!</p>
<p>B</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-337">
                    <div id="dsq-comment-header-337" class="dsq-comment-header">
                        <cite id="dsq-cite-337">
                                <span id="dsq-author-user-337">Linus Betschart</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-337" class="dsq-comment-body">
                        <div id="dsq-comment-message-337" class="dsq-comment-message"><p>Hello</p>
<p>is it possible to save BMP Bitmaps with this class in 16 to 256 colours? With .net itself it&#8217;s as I know not possible to save in different colour formats&#8230;</p>
<p>thx<br />
<br />LB</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-338">
                    <div id="dsq-comment-header-338" class="dsq-comment-header">
                        <cite id="dsq-cite-338">
                                <span id="dsq-author-user-338">Jerry Spaeder</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-338" class="dsq-comment-body">
                        <div id="dsq-comment-message-338" class="dsq-comment-message"><p>I downloaded the DLL you created for Cheri Verdend. Works great!</p>
<p>Thanks,<br />
<br />Jerry<br /></p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-339">
                    <div id="dsq-comment-header-339" class="dsq-comment-header">
                        <cite id="dsq-cite-339">
                                <span id="dsq-author-user-339">Christoph Pecher</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-339" class="dsq-comment-body">
                        <div id="dsq-comment-message-339" class="dsq-comment-message"><p>The quantization algorithm is not enough. I have problems with areas slowly changing color(gradients). I found an article concerning that issue, but no code that i cound translate to c-sharp. Anyone knows about how to implement the Error Diffusion Dithing in the second pass of the octree quantization? <a target="_new" href="http://www.leptonica.com/applications.html#COLOR-QUANTIZATION">http://www.leptonica.com/applications.html#COLOR-QUANTIZATION</a></p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-340">
                    <div id="dsq-comment-header-340" class="dsq-comment-header">
                        <cite id="dsq-cite-340">
                                <span id="dsq-author-user-340">NatoCM</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-340" class="dsq-comment-body">
                        <div id="dsq-comment-message-340" class="dsq-comment-message"><p>Brendan, thank you so much for your code. It worked just fine! Regards from Brazil!</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-341">
                    <div id="dsq-comment-header-341" class="dsq-comment-header">
                        <cite id="dsq-cite-341">
                                <span id="dsq-author-user-341">Andrew</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-341" class="dsq-comment-body">
                        <div id="dsq-comment-message-341" class="dsq-comment-message"><p>Great code, saved me from trying to do the same thing myself and wasting hours of time!<br />
<br />Thanks!</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-342">
                    <div id="dsq-comment-header-342" class="dsq-comment-header">
                        <cite id="dsq-cite-342">
                                <span id="dsq-author-user-342">Avalon</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-342" class="dsq-comment-body">
                        <div id="dsq-comment-message-342" class="dsq-comment-message"><p>Briliant&#8230;. there i was trying to work out a formual to correct the darkening of Png images in IE when i came across this little wonder code <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' />  Life saver, Still need to fixteh png problem sometime though, Also does you code work with png transparency too&#8230; i ahve yet to test it.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-343">
                    <div id="dsq-comment-header-343" class="dsq-comment-header">
                        <cite id="dsq-cite-343">
                                <span id="dsq-author-user-343">darrel</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-343" class="dsq-comment-body">
                        <div id="dsq-comment-message-343" class="dsq-comment-message"><p>THANK YOU! I spent the last couple of days searching for a way to fix the GIF saving problems. I finally stumbled across the Quantizer article on MSDN but that was a tad over my head to get working. That finally led your DLL which couldn&#8217;t have been easier!</p>
<p>I&#8217;m rather amazed that the default GIF behaviour in .net is based on the windows pallet, but, then again, maybe it&#8217;s not that surprising. ;o)</p>
<p>As for the person with the JPG question, you need to set the codec compression rate. Here&#8217;s what I&#8217;m using (VB.NET):</p>
<p>====================</p>
<p>myImageCodecInfo = GetEncoderInfo(&quot;image/jpeg&quot;)<br />
<br />Dim myEncoderParameters As EncoderParameters = New EncoderParameters(1)<br />
<br />&#8216; this line sets the JPG compression quality<br />
<br />&#8216;(100 = best quality, 0 = most compression)<br />
<br />Dim myEncoderParameter As EncoderParameter = New EncoderParameter(myEncoder, 90)<br />
<br />myEncoderParameters.Param(0) = myEncoderParameter<br />
<br />imgOutput.Save([your path], myImageCodecInfo, myEncoderParameters)<br />
<br />imgOutput.Dispose()</p>
<p>========================</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-344">
                    <div id="dsq-comment-header-344" class="dsq-comment-header">
                        <cite id="dsq-cite-344">
                                <span id="dsq-author-user-344">James</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-344" class="dsq-comment-body">
                        <div id="dsq-comment-message-344" class="dsq-comment-message"><p>Brendan,<br />
<br />Lovely little library &#8211; thanks very much for posting this.</p>
<p>What is the difference between the PalleteQuantizer and the OctetQuantizer?</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-345">
                    <div id="dsq-comment-header-345" class="dsq-comment-header">
                        <cite id="dsq-cite-345">
                                <span id="dsq-author-user-345">Ry</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-345" class="dsq-comment-body">
                        <div id="dsq-comment-message-345" class="dsq-comment-message"><p>Quick and easy for me to use. Thanks for putting this out there for us!!!</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-346">
                    <div id="dsq-comment-header-346" class="dsq-comment-header">
                        <cite id="dsq-cite-346">
                                <span id="dsq-author-user-346">Ian Kevan</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-346" class="dsq-comment-body">
                        <div id="dsq-comment-message-346" class="dsq-comment-message"><p>Hi Brendan,</p>
<p>Thanks for the quantization code. I have the same problem as one of your other users in that when applying the Octree quantization to a captured windows XP form, because of the complex gradients in the title bar and toolbar, you end up with a very blocky looking graphic. Have you had any joy determining a way or applying error diffussion to the Octree quantization method?</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-347">
                    <div id="dsq-comment-header-347" class="dsq-comment-header">
                        <cite id="dsq-cite-347">
                                <span id="dsq-author-user-347">Brendan Tompkins</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-347" class="dsq-comment-body">
                        <div id="dsq-comment-message-347" class="dsq-comment-message"><p>Hi Ian,</p>
<p>I&#8217;m sorry to say that I haven&#8217;t delved into other quantization methods since I first worked with this code.  You should be able to plug a different quantizer in, however, if you find the algorithm out there somewhere.  </p>
<p>Good luck.</p>
<p>Brendan</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-348">
                    <div id="dsq-comment-header-348" class="dsq-comment-header">
                        <cite id="dsq-cite-348">
                                <span id="dsq-author-user-348">Ian Kevan</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-348" class="dsq-comment-body">
                        <div id="dsq-comment-message-348" class="dsq-comment-message"><p>Tnaks Brendan, I will continue my search.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-349">
                    <div id="dsq-comment-header-349" class="dsq-comment-header">
                        <cite id="dsq-cite-349">
                                <span id="dsq-author-user-349">Ross Presser</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-349" class="dsq-comment-body">
                        <div id="dsq-comment-message-349" class="dsq-comment-message"><p>Hi Brendan,</p>
<p>I&#8217;ve been working with you quantization code, and I have hit a most confusing problem.</p>
<p>On many images it works perfectly; but on this image, I am getting this exception:</p>
<p>Unhandled Exception: System.ArgumentException: &#8216;-169&#8242; is not a valid value for &#8216;red&#8217;. &#8216;red&#8217; should be greater than or equal to 0 and<br />
<br /> less than or equal to 255.<br />
<br />   at System.Drawing.Color.CheckByte(Int32 value, String name)<br />
<br />   at System.Drawing.Color.FromArgb(Int32 alpha, Int32 red, Int32 green, Int32 blue)<br />
<br />   at System.Drawing.Color.FromArgb(Int32 red, Int32 green, Int32 blue)<br />
<br />   at ImageQuantization.OctreeNode.ConstructPalette(ArrayList palette, Int32&amp; paletteIndex) in C:\Documents and Settings\btompkins\Desktop\ImageQuantization\OctreeQuantizer.cs:line 454</p>
<p>It&#8217;s almost as if there is so much red in this image that the _red member (which was declared as an int) went negative?</p>
<p>I&#8217;ll try isolating and maybe fixing this, but I&#8217;m not good with C#&#8230; I&#8217;ll let you know what if anything I discover.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-350">
                    <div id="dsq-comment-header-350" class="dsq-comment-header">
                        <cite id="dsq-cite-350">
                                <span id="dsq-author-user-350">Brendan Tompkins</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-350" class="dsq-comment-body">
                        <div id="dsq-comment-message-350" class="dsq-comment-message"><p>Man, that&#8217;s strange.  Looks like possibly the image is corrupt, and it&#8217;s trying to read image data where it can&#8217;t find any?</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-351">
                    <div id="dsq-comment-header-351" class="dsq-comment-header">
                        <cite id="dsq-cite-351">
                                <span id="dsq-author-user-351">Ross Presser</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-351" class="dsq-comment-body">
                        <div id="dsq-comment-message-351" class="dsq-comment-message"><p>I was right.  Recompiling with /check+ and running my test case caused it to throw an arithmetic overflow exception in OctreeNode.Increment. I changed the definitions of _red, _green, _blue and _pixelcount from &quot;int&quot; to &quot;ulong&quot;, and made this change to compensate, in OctreeNode.ConstructPalette:</p>
<p>// And set the color of the palette entry<br />
<br />palette.Add ( Color.FromArgb ( (int)(_red / _pixelCount) , (int)(_green / _pixelCount) , (int)(_blue / _pixelCount) ) ) ;</p>
<p>Now it works on all my images.</p>
<p>Thanks again for the code!</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-352">
                    <div id="dsq-comment-header-352" class="dsq-comment-header">
                        <cite id="dsq-cite-352">
                                <span id="dsq-author-user-352">Ross Presser</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-352" class="dsq-comment-body">
                        <div id="dsq-comment-message-352" class="dsq-comment-message"><p>Maybe this never cropped up before because I was just using larger images than you&#8217;re used to. My images are 1500&#215;1650 pixels; they&#8217;re geographical maps that we put into trip routing books that you get from your auto club.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-353">
                    <div id="dsq-comment-header-353" class="dsq-comment-header">
                        <cite id="dsq-cite-353">
                                <span id="dsq-author-user-353">Brendan Tompkins</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-353" class="dsq-comment-body">
                        <div id="dsq-comment-message-353" class="dsq-comment-message"><p>Ah&#8230; Cool. Can you send me the code that you updated, so that I can post it?</p>
<p>Thanks!<br /></p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-354">
                    <div id="dsq-comment-header-354" class="dsq-comment-header">
                        <cite id="dsq-cite-354">
                                <span id="dsq-author-user-354">Ross Presser</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-354" class="dsq-comment-body">
                        <div id="dsq-comment-message-354" class="dsq-comment-message"><p>Can&#8217;t find an email address for you &#8230; grab it at http: // <a href="http://www.imtek.com" rel="nofollow">http://www.imtek.com</a> /images/updatedcode.zip  [remove spaces to fix the deliberately broken link I typed]</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-355">
                    <div id="dsq-comment-header-355" class="dsq-comment-header">
                        <cite id="dsq-cite-355">
                                <span id="dsq-author-user-355">Anthony Ruggeri</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-355" class="dsq-comment-body">
                        <div id="dsq-comment-message-355" class="dsq-comment-message"><p>Great work on this library, it saved me a ton of time adapting an automatic graphics generator from using PNGs to GIFs due to a color interpretation bug in IE6. Let me know if you take any payments or contributions!</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-356">
                    <div id="dsq-comment-header-356" class="dsq-comment-header">
                        <cite id="dsq-cite-356">
                                <span id="dsq-author-user-356">Brendan Tompkins</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-356" class="dsq-comment-body">
                        <div id="dsq-comment-message-356" class="dsq-comment-message"><p>Nope.  Thanks is plenty!</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-357">
                    <div id="dsq-comment-header-357" class="dsq-comment-header">
                        <cite id="dsq-cite-357">
                                <span id="dsq-author-user-357">Ross Presser</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-357" class="dsq-comment-body">
                        <div id="dsq-comment-message-357" class="dsq-comment-message"><p>Did you ever grab my updated code? If not, could you email your email address to me at rpresser AT imtek DOT com so I can mail it to you?</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-358">
                    <div id="dsq-comment-header-358" class="dsq-comment-header">
                        <cite id="dsq-cite-358">
                                <span id="dsq-author-user-358">Pasquale Alfonso (aka)Bklynjava</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-358" class="dsq-comment-body">
                        <div id="dsq-comment-message-358" class="dsq-comment-message"><p>Nice work, although I have numerous errors opening with C#.</p>
<p>Any advice is appreciated.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-359">
                    <div id="dsq-comment-header-359" class="dsq-comment-header">
                        <cite id="dsq-cite-359">
                                <span id="dsq-author-user-359">Hugo</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-359" class="dsq-comment-body">
                        <div id="dsq-comment-message-359" class="dsq-comment-message"><p>Thanks and thanks again! I&#8217;ve been trying to find something like this for days!</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-360">
                    <div id="dsq-comment-header-360" class="dsq-comment-header">
                        <cite id="dsq-cite-360">
                                <span id="dsq-author-user-360">Murray</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-360" class="dsq-comment-body">
                        <div id="dsq-comment-message-360" class="dsq-comment-message"><p>Cool<br />
<br />But what if my hosting environment doesn&#8217;t like unsafe code? is there a safe version?<br />
<br />I realise it may be slower, but it only runs infrequently as a batch job.</p>
<p>Cheers.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-361">
                    <div id="dsq-comment-header-361" class="dsq-comment-header">
                        <cite id="dsq-cite-361">
                                <span id="dsq-author-user-361">Brendan Tompkins</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-361" class="dsq-comment-body">
                        <div id="dsq-comment-message-361" class="dsq-comment-message"><p>Murray, the unsafe is there so that we can pass a pointer to the quantizer ie (Color32* pixel) I&#8217;m not sure how to rework this in managed code without looking and getting into the details.  You could try passing the Color32 by ref, and see where you get.</p>
<p>-Brendan</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-362">
                    <div id="dsq-comment-header-362" class="dsq-comment-header">
                        <cite id="dsq-cite-362">
                                <span id="dsq-author-user-362">brendan &#8211; you&#8217;re a star</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-362" class="dsq-comment-body">
                        <div id="dsq-comment-message-362" class="dsq-comment-message"><p>thanks mate, just what i needed&#8230;and better than i was looking for. </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-363">
                    <div id="dsq-comment-header-363" class="dsq-comment-header">
                        <cite id="dsq-cite-363">
                                <span id="dsq-author-user-363">Chris Lewis</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-363" class="dsq-comment-body">
                        <div id="dsq-comment-message-363" class="dsq-comment-message"><p>&#8230;have been searching for some time for what you&#8217;ve done here &#8211; thanks a lot.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-364">
                    <div id="dsq-comment-header-364" class="dsq-comment-header">
                        <cite id="dsq-cite-364">
    http://www.sageoak.com                            <span id="dsq-author-user-364">Doug Weems</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-364" class="dsq-comment-body">
                        <div id="dsq-comment-message-364" class="dsq-comment-message"><p>Thanks Brendan,</p>
<p>This was very helpful.  You are one of the good guys. <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' /> </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-365">
                    <div id="dsq-comment-header-365" class="dsq-comment-header">
                        <cite id="dsq-cite-365">
    http://john.hamm.com                            <span id="dsq-author-user-365">John Hamm</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-365" class="dsq-comment-body">
                        <div id="dsq-comment-message-365" class="dsq-comment-message"><p>I have modified the Quantizer class in that I can now pass the Quantize method a PixelFormt parameter so I can produce 4-bit images.</p>
<p>The problem, though, is that I think there is something odd going on in the OctreeQuantizer class &#8211; the bitmap that is produced has every other vertical row blank, and that widens the image, and cuts off half the image.  </p>
<p>I think the problem may lie somewhere in FirstPass and SecondPass methods, I don&#8217;t know enough about it to be sure though.  Is traversing the pixels the same in a 4-bit image in memory as it is an 8-bit image?</p>
<p>Any ideas?</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-366">
                    <div id="dsq-comment-header-366" class="dsq-comment-header">
                        <cite id="dsq-cite-366">
    http://john.hamm.com                            <span id="dsq-author-user-366">John Hamm</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-366" class="dsq-comment-body">
                        <div id="dsq-comment-message-366" class="dsq-comment-message"><p>I meant to say &quot;every other vertical column&quot;</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-367">
                    <div id="dsq-comment-header-367" class="dsq-comment-header">
                        <cite id="dsq-cite-367">
    http://codbetter.com/blogs/brendan.tompkins                            <span id="dsq-author-user-367">Brendan Tompkins</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-367" class="dsq-comment-body">
                        <div id="dsq-comment-message-367" class="dsq-comment-message"><p>John,</p>
<p>Which Quantizer did you modify? The correct way to do this would have been to create a new class deriving from Quantizer called FourBitQuantizer or something, and then modify the QuantizePixel and InitialQuantizePixel methods.  </p>
<p>I&#8217;m not surprized that it cut the image in half and only rendered every other line.  Everything was based on 8 and you substitued 4!</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-368">
                    <div id="dsq-comment-header-368" class="dsq-comment-header">
                        <cite id="dsq-cite-368">
                                <span id="dsq-author-user-368">Daniel</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-368" class="dsq-comment-body">
                        <div id="dsq-comment-message-368" class="dsq-comment-message"><p>Is there a smart way to crop a created image, to eliminate all the space surrounding the rendered text?</p>
<p>&quot;objGraphic.MeasureString(sText, objFont).Width&quot; usually adds a lot of space, especially when using large font sizes. That extra margin causes rendered headlines to not line up well with body text.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-369">
                    <div id="dsq-comment-header-369" class="dsq-comment-header">
                        <cite id="dsq-cite-369">
                                <span id="dsq-author-user-369">Bill Oscott</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-369" class="dsq-comment-body">
                        <div id="dsq-comment-message-369" class="dsq-comment-message"><p>Hi</p>
<p>This dll is cool, I had program running in VB.net that accessed its functions in 5mins. Thing is I would also like to use VB6 to access the dll. Is there anything I can do?? </p>
<p>Thanks</p>
<p>Bill</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-370">
                    <div id="dsq-comment-header-370" class="dsq-comment-header">
                        <cite id="dsq-cite-370">
    http://www.sapphire-erm.com                            <span id="dsq-author-user-370">Hubris Sonic</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-370" class="dsq-comment-body">
                        <div id="dsq-comment-message-370" class="dsq-comment-message"><p>niiiiiiiiiiiiiiiice dude!</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-371">
                    <div id="dsq-comment-header-371" class="dsq-comment-header">
                        <cite id="dsq-cite-371">
                                <span id="dsq-author-user-371">Max</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-371" class="dsq-comment-body">
                        <div id="dsq-comment-message-371" class="dsq-comment-message"><p>Well done!  I had little-to-no trouble implementing this into my system.</p>
<p>(What I want to know is why the current version of .NET doesn&#8217;t already support this properly &#8212; this seems like a common thing to do with graphics!)</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-372">
                    <div id="dsq-comment-header-372" class="dsq-comment-header">
                        <cite id="dsq-cite-372">
                                <span id="dsq-author-user-372">Peter M</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-372" class="dsq-comment-body">
                        <div id="dsq-comment-message-372" class="dsq-comment-message"><p>First of all, thanks very much for your efforts. This code was exactly what I&#8217;ve been looking for. <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' />  </p>
<p>I&#8217;m using it to return gif images through the Response.OutputStream of an aspx page. The weird thing is that the transparency is working fine with some images and not with others although they all come from the same source.</p>
<p>Any thoughts would be greatly appreciated.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-373">
                    <div id="dsq-comment-header-373" class="dsq-comment-header">
                        <cite id="dsq-cite-373">
                                <span id="dsq-author-user-373">Ganesha</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-373" class="dsq-comment-body">
                        <div id="dsq-comment-message-373" class="dsq-comment-message"><p>Thank you for the dll, my map image looks better now. Best regards from Jakarta.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-374">
                    <div id="dsq-comment-header-374" class="dsq-comment-header">
                        <cite id="dsq-cite-374">
                                <span id="dsq-author-user-374">Yukiko</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-374" class="dsq-comment-body">
                        <div id="dsq-comment-message-374" class="dsq-comment-message"><p>I still not quite understand the whole thing and how to use it after downloading? Can someone please help me?</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-375">
                    <div id="dsq-comment-header-375" class="dsq-comment-header">
                        <cite id="dsq-cite-375">
                                <span id="dsq-author-user-375">Dave</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-375" class="dsq-comment-body">
                        <div id="dsq-comment-message-375" class="dsq-comment-message"><p>This is awesome.  Just about to try to write my own version, found this site, five minutes later I have crystal clear images.</p>
<p>Thank you.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-376">
                    <div id="dsq-comment-header-376" class="dsq-comment-header">
                        <cite id="dsq-cite-376">
                                <span id="dsq-author-user-376">phil</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-376" class="dsq-comment-body">
                        <div id="dsq-comment-message-376" class="dsq-comment-message"><p>Using Quantizer to reduce size of bitmap when saved to file. Works perfectly. Thanks.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-377">
                    <div id="dsq-comment-header-377" class="dsq-comment-header">
                        <cite id="dsq-cite-377">
                                <span id="dsq-author-user-377">srounsroun</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-377" class="dsq-comment-body">
                        <div id="dsq-comment-message-377" class="dsq-comment-message"><p>Hi, </p>
<p>I&#8217;m working on gif files, the link for the dll doesn&#8217;t work. Can someone could send me thte .zip file in my hotmail box ? thanks a lot, Hope this will resolve my optimization problem <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> </p>
<p>here my hotmail box: <a href="mailto:srounsroun@msn.com">srounsroun@msn.com</a></p>
<p>thanks</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-378">
                    <div id="dsq-comment-header-378" class="dsq-comment-header">
                        <cite id="dsq-cite-378">
                                <span id="dsq-author-user-378">srounsroun</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-378" class="dsq-comment-body">
                        <div id="dsq-comment-message-378" class="dsq-comment-message"><p>lol, sorry I found it on the zip file up there </p>
<p>check in bin/debug to get the DLL.</p>
<p>by all and thanks a lot</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-379">
                    <div id="dsq-comment-header-379" class="dsq-comment-header">
                        <cite id="dsq-cite-379">
    http://codebetter.com/blogs/brendan.tompkins                            <span id="dsq-author-user-379">Brendan Tompkins</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-379" class="dsq-comment-body">
                        <div id="dsq-comment-message-379" class="dsq-comment-message"><p>Here&#8217;s the correct link</p>
<p><a href="http://codebetter.com/bsblog/ImageQuantizationDll.zip" rel="nofollow">http://codebetter.com/bsblog/ImageQuantizationDll.zip</a> </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-380">
                    <div id="dsq-comment-header-380" class="dsq-comment-header">
                        <cite id="dsq-cite-380">
    http://www.abdicate.net                            <span id="dsq-author-user-380">Bill</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-380" class="dsq-comment-body">
                        <div id="dsq-comment-message-380" class="dsq-comment-message"><p>I&#8217;ve been working on my site to generate Hebrew characters and though I could force someone to download a font to view them, I wanted to dynamically generate the images. You&#8217;re DLL is the best and got rid of those pesky &#8220;white&#8221; dots around the characters. Do you have the code in VB? Thanks,</p>
<p>Bill</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-381">
                    <div id="dsq-comment-header-381" class="dsq-comment-header">
                        <cite id="dsq-cite-381">
                                <span id="dsq-author-user-381">Lee</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-381" class="dsq-comment-body">
                        <div id="dsq-comment-message-381" class="dsq-comment-message"><p>Tried the original dll as well as this dll, all works beautifully on my machine locally, when I uploaded to my hosting, permission deneid. I&#8217;m guess the Quantizier is referencing system managed classes.. darn. what a shame. </p>
<p>really really loved this class. </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-382">
                    <div id="dsq-comment-header-382" class="dsq-comment-header">
                        <cite id="dsq-cite-382">
                                <span id="dsq-author-user-382">Sebastian Krampe</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-382" class="dsq-comment-body">
                        <div id="dsq-comment-message-382" class="dsq-comment-message"><p>Thanks for the classes, Brendan. They work great!</p>
<p>And Fred: Thanks to you for the transparent palette method.<br />
Here&#8217;s the version in c#:</p>
<p>ColorPalette SetTransparentColor(ColorPalette SrcPal, int nColors, System.Drawing.Color cT)<br />
		{<br />
			System.Drawing.Color C;<br />
			System.Drawing.Color[] Clrs = SrcPal.Entries;<br />
			for (int i = 0; i < nColors; i++)<br />
			{<br />
				C = Clrs[i];<br />
				if (C.R == cT.R &#038;&#038; C.G == cT.G &#038;&#038; C.B == cT.B)<br />
				{<br />
					SrcPal.Entries[i] = Color.FromArgb(0, C.R, C.G, C.B);<br />
				}<br />
				else<br />
				{<br />
					SrcPal.Entries[i] = Color.FromArgb(255, C.R, C.G, C.B);<br />
				}<br />
			}<br />
			return SrcPal;<br />
		}</p>
<p>Regards<br />
Sebastian</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-383">
                    <div id="dsq-comment-header-383" class="dsq-comment-header">
                        <cite id="dsq-cite-383">
    http://fromchina                            <span id="dsq-author-user-383">xuefeng yu</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-383" class="dsq-comment-body">
                        <div id="dsq-comment-message-383" class="dsq-comment-message"><p>this is gread work!!!<br />
thanks</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-384">
                    <div id="dsq-comment-header-384" class="dsq-comment-header">
                        <cite id="dsq-cite-384">
                                <span id="dsq-author-user-384">Jimbob</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-384" class="dsq-comment-body">
                        <div id="dsq-comment-message-384" class="dsq-comment-message"><p>Great stuff mate. I would have expected this to be part of GDI+ to be honest, as MS have done such a good job with the rest of it.</p>
<p>Thanks again.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-385">
                    <div id="dsq-comment-header-385" class="dsq-comment-header">
                        <cite id="dsq-cite-385">
                                <span id="dsq-author-user-385">Chris K</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-385" class="dsq-comment-body">
                        <div id="dsq-comment-message-385" class="dsq-comment-message"><p>Hello, this stuff is awesome. Fortunatly I found this page, when this problem occured in my program.</p>
<p>What i wanted to ask: Is there any solution to save partly transparent (Opacity: 50%, or something like this) areas? pixels with alpha=255 are saved transparent, but when the alpha value is less then 255, these pixel are black!</p>
<p>Chris</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-386">
                    <div id="dsq-comment-header-386" class="dsq-comment-header">
                        <cite id="dsq-cite-386">
                                <span id="dsq-author-user-386">Steve</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-386" class="dsq-comment-body">
                        <div id="dsq-comment-message-386" class="dsq-comment-message"><p>Hello,</p>
<p>I really would like to be able to use you code but Im not sure if I can. So far I have an image being displayed using a .ashx file. This file basicaly gets an jpeg image from a database and makes it into a trnasparent gif but obviously the gif looks terrible.</p>
<p>Can I use your code? And if so how? I&#8217;ve never used a .dll file like this before.</p>
<p>Thanks in advance,<br />
Steve</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-387">
                    <div id="dsq-comment-header-387" class="dsq-comment-header">
                        <cite id="dsq-cite-387">
    http://www.regthesledge.net                            <span id="dsq-author-user-387">Will</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-387" class="dsq-comment-body">
                        <div id="dsq-comment-message-387" class="dsq-comment-message"><p>Thanks a million.</p>
<p>Like many others here, I was reluctantly bracing myself to do battle with the MSDN code and you&#8217;ve saved me ages.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-388">
                    <div id="dsq-comment-header-388" class="dsq-comment-header">
                        <cite id="dsq-cite-388">
                                <span id="dsq-author-user-388">Ariel</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-388" class="dsq-comment-body">
                        <div id="dsq-comment-message-388" class="dsq-comment-message"><p>Hi brendan, i congratulate you for your project.. i&#8217;m trying to use it but i can&#8217;t make it work.. i&#8217;m creating dynamic images with text (drawstring with a Graphics), and i&#8217;m not sure where to use the quantizer, if i modify the bitmap before the &#8220;Graphics graph =Graphics.FromImage(bm)&#8221; it throws an exception liek this: &#8220;A Graphics object cannot be created from an image that has an indexed pixel format. &#8220;, if i put it after then it remains black at the end..<br />
Just in case i post the function i made to create the Graphics:<br />
public Graphics openGraph(ref Bitmap bm,string bgcolor)<br />
{<br />
         if(bgcolor==&#8221;Transparent&#8221;)<br />
         {<br />
	OctreeQuantizer quant=new OctreeQuantizer(255,8);<br />
	bm=quant.Quantize(bm);<br />
         }<br />
         Graphics graph = Graphics.FromImage(bm);<br />
         graph.TextRenderingHint = System.Drawing.Text.TextRenderingHint.SingleBitPerPixelGridFit;graph.InterpolationMode=System.Drawing.Drawing2D.InterpolationMode.Bilinear;<br />
         graph.Clear(Color.FromName(bgcolor));<br />
           return graph;<br />
}</p>
<p>(i&#8217;ve already tried this one with it too:<br />
&#8220;bm.MakeTransparent(Color.FromName(drpBackcolor.SelectedItem.Text));<br />
bm.Save(&#8230;&#8230;)&#8221;)</p>
<p>but nothing..plz if someone can answer me, i&#8217;d appreciate that thx..(if you can, mail me plz to <a href="mailto:flesler@hotmail.com">flesler@hotmail.com</a>)</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-389">
                    <div id="dsq-comment-header-389" class="dsq-comment-header">
                        <cite id="dsq-cite-389">
                                <span id="dsq-author-user-389">Ariel</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-389" class="dsq-comment-body">
                        <div id="dsq-comment-message-389" class="dsq-comment-message"><p>I tried doing it at the end of the drawing, just before saving and it improves the quality, but no transparent background.. plz can some1 ask me as soon as possible? I really need it</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-390">
                    <div id="dsq-comment-header-390" class="dsq-comment-header">
                        <cite id="dsq-cite-390">
                                <span id="dsq-author-user-390">Ariel</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-390" class="dsq-comment-body">
                        <div id="dsq-comment-message-390" class="dsq-comment-message"><p>I tried doing it at the end of the drawing, just before saving and it improves the quality, but no transparent background.. plz can some1 ask me as soon as possible? I really need it</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-391">
                    <div id="dsq-comment-header-391" class="dsq-comment-header">
                        <cite id="dsq-cite-391">
    http://www.ellisys.com                            <span id="dsq-author-user-391">Sylvain Fasel</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-391" class="dsq-comment-body">
                        <div id="dsq-comment-message-391" class="dsq-comment-message"><p>Hi,</p>
<p>thank you very much for this wonderful piece of code, seeminglessly integrated into my project. </p>
<p>For what I need it to do, it works perfectly, and the images are perfect.</p>
<p>So cool to share this freely!</p>
<p>Best regards.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-392">
                    <div id="dsq-comment-header-392" class="dsq-comment-header">
                        <cite id="dsq-cite-392">
                                <span id="dsq-author-user-392">Shaun Llewelyn</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-392" class="dsq-comment-body">
                        <div id="dsq-comment-message-392" class="dsq-comment-message"><p>Thanks, I was getting grainy gifs. Worked a treat. Brilliant!</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-393">
                    <div id="dsq-comment-header-393" class="dsq-comment-header">
                        <cite id="dsq-cite-393">
                                <span id="dsq-author-user-393">Barry</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-393" class="dsq-comment-body">
                        <div id="dsq-comment-message-393" class="dsq-comment-message"><p>Hello.</p>
<p>***I am a newbie who needs help! ***</p>
<p>This looks like the perfect program I would need to convert a 256 color GIF that is located on my web server in a folder called temp, into a 16 color GIF.<br />
After it is converted, I want to save it with the same name and path.<br />
I have Visual Web Developer 2005 Express.<br />
Please help me set this up.<br />
I have no .aspx file yet.<br />
(Also, I have no experience yet).<br />
I will be coming from an asp page that has the filename in the url like my_page.asp?file_name=image_256.gif<br />
I am used to vbscript, so I would get the filename with:<br />
file_name= Request.QueryString(&#8220;file_name&#8221;)</p>
<p>I have placed all files (from the download above) in a web folder called gif_16<br />
Any help to figure this out would be appreciated.</p>
<p>Thanks in advance!!!<br />
Barry in Ottawa, CANADA.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-394">
                    <div id="dsq-comment-header-394" class="dsq-comment-header">
                        <cite id="dsq-cite-394">
                                <span id="dsq-author-user-394">btompkins</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-394" class="dsq-comment-body">
                        <div id="dsq-comment-message-394" class="dsq-comment-message"><p>Barry, </p>
<p>The quantizer code should produce a 16-color gif using the following command:</p>
<p>OctreeQuantizer quantizer = new OctreeQuantizer ( 15 , 4 ) ;</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-395">
                    <div id="dsq-comment-header-395" class="dsq-comment-header">
                        <cite id="dsq-cite-395">
                                <span id="dsq-author-user-395">Barry</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-395" class="dsq-comment-body">
                        <div id="dsq-comment-message-395" class="dsq-comment-message"><p>Hey Brendan. It has been snowing here in CANADA. Looks like it isn&#8217;t  there!<br />
Thanks for the reply!!<br />
That&#8217;s great that the code can do it!!</p>
<p>Which lines of code are required to do what I want?<br />
Can you help me set it up?<br />
I see some lines at the top starting with:<br />
System.Drawing.Bitmap b = new System.Drawing.Bitmap(“c:\\original_image.gif“);</p>
<p>I also downloaded your project, do I need it all?<br />
Is there an aspx page missing?</p>
<p>Which files/folders do I need to upload to my web server to get this to work?<br />
I&#8217;m a slow newbie.</p>
<p>Please help.</p>
<p>Barry</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-396">
                    <div id="dsq-comment-header-396" class="dsq-comment-header">
                        <cite id="dsq-cite-396">
                                <span id="dsq-author-user-396">Tuan Nguyen</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-396" class="dsq-comment-body">
                        <div id="dsq-comment-message-396" class="dsq-comment-message"><p>can anyone please post the safe managed Code for this?</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-397">
                    <div id="dsq-comment-header-397" class="dsq-comment-header">
                        <cite id="dsq-cite-397">
                                <span id="dsq-author-user-397">Anonymous</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-397" class="dsq-comment-body">
                        <div id="dsq-comment-message-397" class="dsq-comment-message"><p>this guy is selling component based on OctreeQuantizer.cs</p>
<p><a href="http://www.amarantin.se/" rel="nofollow">http://www.amarantin.se/</a></p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-398">
                    <div id="dsq-comment-header-398" class="dsq-comment-header">
                        <cite id="dsq-cite-398">
                                <span id="dsq-author-user-398">Manso</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-398" class="dsq-comment-body">
                        <div id="dsq-comment-message-398" class="dsq-comment-message"><p>Hi,</p>
<p>Thanks for an excellent component. </p>
<p>We&#8217;re trying to use it in a medium trust environment, does anyone have any experience in how to make it work? We are getting &#8220;PolicyException: Required permissions cannot be acquired.&#8221;, can someone provide us with some hints if/how we can make this work?</p>
<p>Many thanks,<br />
Manso</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-399">
                    <div id="dsq-comment-header-399" class="dsq-comment-header">
                        <cite id="dsq-cite-399">
                                <span id="dsq-author-user-399">James Maeding</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-399" class="dsq-comment-body">
                        <div id="dsq-comment-message-399" class="dsq-comment-message"><p>Dang, best code I have seen for images with .net so far.<br />
I am killing myself with IMageMagick and other command line progs, and no one seems to make it easy to make good images from 24 bit to 8 bit optimized palette.<br />
This was just what I needed.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-400">
                    <div id="dsq-comment-header-400" class="dsq-comment-header">
                        <cite id="dsq-cite-400">
                                <span id="dsq-author-user-400">James Maeding</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-400" class="dsq-comment-body">
                        <div id="dsq-comment-message-400" class="dsq-comment-message"><p>I just read the previous comments and am wondeeing if the code and dll that we can download, have all the fixes in them?<br />
There was the definitions of _red, _green, _blue and _pixelcount from &#8220;int&#8221; to &#8220;ulong&#8221;,<br />
as well as the Transparent palette code (bug or feature?&#8230;).</p>
<p>Also, I open the code in VS2005 and it gives errors on build. It says:<br />
Unsafe code may only appear if compiling with /unsafe.</p>
<p>I assume I need to add a flag somewhere to fix that, I think the orig code was from VS2003, and VS2005 wants a flag&#8230;<br />
thanks</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-401">
                    <div id="dsq-comment-header-401" class="dsq-comment-header">
                        <cite id="dsq-cite-401">
                                <span id="dsq-author-user-401">James Maeding</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-401" class="dsq-comment-body">
                        <div id="dsq-comment-message-401" class="dsq-comment-message"><p>ok, had to check the allow unsafe code in build options,<br />
also added suggested changes myself except for transparent option.<br />
If anyone had improved things, please post <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-402">
                    <div id="dsq-comment-header-402" class="dsq-comment-header">
                        <cite id="dsq-cite-402">
                                <span id="dsq-author-user-402">Allan The Dane</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-402" class="dsq-comment-body">
                        <div id="dsq-comment-message-402" class="dsq-comment-message"><p>Preserving Transparency?</p>
<p>I&#8217;m converting a transparent Gif to grayscale using you code. But the transparency seems to be lost during conversion. Is there any way to preserve the transparency in the new image? I&#8217;m using the following code, which is basically just a conversion from your C# code to VB:</p>
<p>Dim objBitmap As New Bitmap(&#8220;Transparent.Gif&#8221;)<br />
Dim objNewThumb As Drawing.Image = objBitmap.GetThumbnailImage(objBitmap.Width, objBitmap.Height, Nothing, New IntPtr())<br />
Dim objGrayQuantizer As New GrayscaleQuantizer()<br />
With objGrayQuantizer.Quantize(objNewThumb)<br />
   .Save(&#8220;GrayNoSoTransparent.gif&#8221;)<br />
End With</p>
<p>Any advice would be appreciated.</p>
<p>BTW &#8211; Great work! <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> </p>
<p>Allan From Denmark</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-403">
                    <div id="dsq-comment-header-403" class="dsq-comment-header">
                        <cite id="dsq-cite-403">
    http://www.somej.net                            <span id="dsq-author-user-403">Justin Wignall</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-403" class="dsq-comment-body">
                        <div id="dsq-comment-message-403" class="dsq-comment-message"><p>Three years later and still really useful! Great stuff Brendan, Thanks!</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-404">
                    <div id="dsq-comment-header-404" class="dsq-comment-header">
                        <cite id="dsq-cite-404">
                                <span id="dsq-author-user-404">James Maeding</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-404" class="dsq-comment-body">
                        <div id="dsq-comment-message-404" class="dsq-comment-message"><p>there was code to modify the palette posted by Fred Thieme, see previous posts.<br />
I am currently figuring out how to plug that into things, I am a bit new at the .net objects.  I&#8217;ll post it when I figure it out.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-405">
                    <div id="dsq-comment-header-405" class="dsq-comment-header">
                        <cite id="dsq-cite-405">
                                <span id="dsq-author-user-405">RS</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-405" class="dsq-comment-body">
                        <div id="dsq-comment-message-405" class="dsq-comment-message"><p>So, how do I make this work:</p>
<p>1. Include the dll (tried both the pre-built version and my own version) in my own web-project.<br />
2. Build error: Failed to grant minimum permission requests.</p>
<p>But I can&#8217;t even find where to set permissions (in the project, or IIS, or?) ?</p>
<p>Thanks!<br />
RS</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-406">
                    <div id="dsq-comment-header-406" class="dsq-comment-header">
                        <cite id="dsq-cite-406">
                                <span id="dsq-author-user-406">Pablo</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-406" class="dsq-comment-body">
                        <div id="dsq-comment-message-406" class="dsq-comment-message"><p>Eres el puto amo!</p>
<p>You&#8217;re the master, you saved us many hours.</p>
<p>Thanks from Spain!</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-407">
                    <div id="dsq-comment-header-407" class="dsq-comment-header">
                        <cite id="dsq-cite-407">
    http://best-soft.ru/                            <span id="dsq-author-user-407">ca1</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-407" class="dsq-comment-body">
                        <div id="dsq-comment-message-407" class="dsq-comment-message"><p>Thank you!</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-408">
                    <div id="dsq-comment-header-408" class="dsq-comment-header">
                        <cite id="dsq-cite-408">
                                <span id="dsq-author-user-408">Andrey</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-408" class="dsq-comment-body">
                        <div id="dsq-comment-message-408" class="dsq-comment-message"><p>The best! Thank you very much for this!</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-409">
                    <div id="dsq-comment-header-409" class="dsq-comment-header">
                        <cite id="dsq-cite-409">
    http://www.bluwavedesign.co.uk/                            <span id="dsq-author-user-409">Matt Eason</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-409" class="dsq-comment-body">
                        <div id="dsq-comment-message-409" class="dsq-comment-message"><p>Fantastic stuff. Dropped it into my project and it worked first time, no problems. Thanks!</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-410">
                    <div id="dsq-comment-header-410" class="dsq-comment-header">
                        <cite id="dsq-cite-410">
    http://futurefog.altervista.org                            <span id="dsq-author-user-410">Marco</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-410" class="dsq-comment-body">
                        <div id="dsq-comment-message-410" class="dsq-comment-message"><p>GIF TRANSPARENCY&#8230; ANOTHER SOLUTION:</p>
<p>First of all, thanks for this great work!</p>
<p>Second, I&#8217;ve found a solution for preserving GIF transparency when invoking Image::Save(&#8230;). The .NET (tested on v2.0) GIF encoder considers transparent the first color found in the palette, so I&#8217;ve changed some methods (replace them with the supplied ones):</p>
<p>// METHOD: OctreeQuantizer::QuantizePixel(Color32* pixel)</p>
<p>protected override byte QuantizePixel(Color32* pixel)<br />
{<br />
	byte paletteIndex = (byte)0;	// The color at [0] is set to transparent</p>
<p>	// Get the palette index if this non-transparent<br />
	if(pixel->Alpha > 0)<br />
		paletteIndex = (byte)(_octree.GetPaletteIndex(pixel) + 1);</p>
<p>	return paletteIndex;<br />
}</p>
<p>// METHOD: OctreeQuantizer::GetPalette(ColorPalette original)</p>
<p>protected override ColorPalette GetPalette(ColorPalette original)<br />
{<br />
	// First off convert the octree to _maxColors colors<br />
	ArrayList palette = _octree.Palletize(_maxColors &#8211; 1);</p>
<p>	// Add the transparent color<br />
	palette.Insert(0, Color.FromArgb(0, 0, 0, 0));</p>
<p>	// Then convert the palette based on those colors<br />
	for(int index = 0; index < palette.Count; index++)<br />
		original.Entries[index] = (Color)palette[index];</p>
<p>	return original;<br />
}</p>
<p>// CONSTRUCTOR: GrayscaleQuantizer::GrayscaleQuantizer()</p>
<p>public GrayscaleQuantizer()<br />
	: base(new ArrayList())<br />
{<br />
	_colors = new Color[256];</p>
<p>	int nColors = 256;</p>
<p>	// Initialize a new color table with entries that are determined<br />
	// by some optimal palette-finding algorithm; for demonstration<br />
	// purposes, use a grayscale.<br />
	for(uint i = 0; i < nColors; i++)<br />
	{<br />
		uint Alpha = (uint)((i == 0) ? 0&#215;00 : 0xFF);                    // Colors are opaque (except the first).<br />
		uint Intensity = Convert.ToUInt32(i * 0xFF / (nColors &#8211; 1));    // Even distribution. </p>
<p>		// The GIF encoder makes the first entry in the palette<br />
		// that has a ZERO alpha the transparent color in the GIF.<br />
		// Pick the first one arbitrarily, for demonstration purposes.</p>
<p>		// Create a gray scale for demonstration purposes.<br />
		// Otherwise, use your favorite color reduction algorithm<br />
		// and an optimum palette for that algorithm generated here.<br />
		// For example, a color histogram, or a median cut palette.<br />
		_colors[i] = Color.FromArgb((int)Alpha,<br />
			(int)Intensity,<br />
			(int)Intensity,<br />
			(int)Intensity);<br />
	}<br />
}</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-411">
                    <div id="dsq-comment-header-411" class="dsq-comment-header">
                        <cite id="dsq-cite-411">
                                <span id="dsq-author-user-411">Andrew</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-411" class="dsq-comment-body">
                        <div id="dsq-comment-message-411" class="dsq-comment-message"><p>I&#8217;m also having a permissions error in a medium trust environment (shared server hosting environment).</p>
<p>Can&#8217;t we have a fix for this please? It&#8217;s such a great library! Best there is out there, just this one little problem preventing it from being more widely used. <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_sad.gif' alt=':(' class='wp-smiley' /> </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-412">
                    <div id="dsq-comment-header-412" class="dsq-comment-header">
                        <cite id="dsq-cite-412">
                                <span id="dsq-author-user-412">liz</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-412" class="dsq-comment-body">
                        <div id="dsq-comment-message-412" class="dsq-comment-message"><p>everytime i go to save a picture it always saves under &#8221; bmp &#8221; and not &#8221; gif &#8221; so the picture doesn&#8217;t move when it&#8217;s suppose to !! </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-413">
                    <div id="dsq-comment-header-413" class="dsq-comment-header">
                        <cite id="dsq-cite-413">
    http://www.timdown.co.uk                            <span id="dsq-author-user-413">Tim Down</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-413" class="dsq-comment-body">
                        <div id="dsq-comment-message-413" class="dsq-comment-message"><p>Just wanted to add my own thanks to the many who have posted theirs. This is absolutely perfect for what I need &#8211; it&#8217;s fixed both my problems, namely that I was jumping through hoops to get transparency and that the default colour palette was making my images look terrible. So, many thanks.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-414">
                    <div id="dsq-comment-header-414" class="dsq-comment-header">
                        <cite id="dsq-cite-414">
    http://www.in-gender.com                            <span id="dsq-author-user-414">Maureen</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-414" class="dsq-comment-body">
                        <div id="dsq-comment-message-414" class="dsq-comment-message"><p>I think I love you!  This worked perfectly &#8212; now my gif&#8217;s are beautiful and I can remove the annoying disclaimer that &#8220;this preview image is grainy but your final product will be lovely&#8221;.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-415">
                    <div id="dsq-comment-header-415" class="dsq-comment-header">
                        <cite id="dsq-cite-415">
    http://barbaros1420@hotmail.com                            <span id="dsq-author-user-415">kral oyunlar</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-415" class="dsq-comment-body">
                        <div id="dsq-comment-message-415" class="dsq-comment-message"><p>Thank you!.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-416">
                    <div id="dsq-comment-header-416" class="dsq-comment-header">
                        <cite id="dsq-cite-416">
                                <span id="dsq-author-user-416">Roy Thomas</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-416" class="dsq-comment-body">
                        <div id="dsq-comment-message-416" class="dsq-comment-message"><p>Can anybody advise  vb or vc code to refresh a real time (Gif file)  from a website and archive it in the local machine every one minute,    Can it be done using using Microsoft web browser control?</p>
<p>please email to    <a href="mailto:roy.thomas@cegelec.com.sg">roy.thomas@cegelec.com.sg</a></p>
<p>thanks</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-417">
                    <div id="dsq-comment-header-417" class="dsq-comment-header">
                        <cite id="dsq-cite-417">
                                <span id="dsq-author-user-417">Andy</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-417" class="dsq-comment-body">
                        <div id="dsq-comment-message-417" class="dsq-comment-message"><p>I have tried to implement some of the suggested transparent gif solutions but did not get any of them to work</p>
<p>I can use the one described by microsft at<br />
<a href="http://support.microsoft.com/kb/319061" rel="nofollow">http://support.microsoft.com/kb/319061</a></p>
<p>But this is not giving me the results I was hoping for&#8230;   Does anyone know how to flatter non transparent pixels that still have an alpha value to a matte color and then cut the rest of the out?  Sort of like Photoshop&#8217;s saving of a gif?</p>
<p>brendan Do you have version that works with transparencies?</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-418">
                    <div id="dsq-comment-header-418" class="dsq-comment-header">
                        <cite id="dsq-cite-418">
                                <span id="dsq-author-user-418">Gretchen</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-418" class="dsq-comment-body">
                        <div id="dsq-comment-message-418" class="dsq-comment-message"><p>Thank you so much for sharing your wonderful work with &#8216;us&#8217;. My charts are now perfect!</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-419">
                    <div id="dsq-comment-header-419" class="dsq-comment-header">
                        <cite id="dsq-cite-419">
    http://www.verycomics.com                            <span id="dsq-author-user-419">hugo oyunlari </span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-419" class="dsq-comment-body">
                        <div id="dsq-comment-message-419" class="dsq-comment-message"><p>l love dhis blog it is very nice</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-420">
                    <div id="dsq-comment-header-420" class="dsq-comment-header">
                        <cite id="dsq-cite-420">
    http://www.kral27.com                            <span id="dsq-author-user-420">barbie oyulari</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-420" class="dsq-comment-body">
                        <div id="dsq-comment-message-420" class="dsq-comment-message"><p>yes it is</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-421">
                    <div id="dsq-comment-header-421" class="dsq-comment-header">
                        <cite id="dsq-cite-421">
                                <span id="dsq-author-user-421">AR</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-421" class="dsq-comment-body">
                        <div id="dsq-comment-message-421" class="dsq-comment-message"><p>this is great stuff, however i am facing an issue, can someone help. I am using this quantizer to save a bitmap image into a gif format (so that i donot loose the quality and the image is small), however for images with some specific colors it gives weird results, like for example if the color is Red, half of the image is good and the second half turns black. It also happens with some other colors like Cyan, Blue etc. Has someone faced this issue, can you guys point me in some direction to debug this.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-422">
                    <div id="dsq-comment-header-422" class="dsq-comment-header">
                        <cite id="dsq-cite-422">
    http://www.islamiruyatabirleri.com                            <span id="dsq-author-user-422">R&#252;ya Tabirleri</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-422" class="dsq-comment-body">
                        <div id="dsq-comment-message-422" class="dsq-comment-message"><p>what is the problem?<br />
what is this posts? spam?</p>
<p>why dont you delete it?</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-423">
                    <div id="dsq-comment-header-423" class="dsq-comment-header">
                        <cite id="dsq-cite-423">
                                <span id="dsq-author-user-423">Greg</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-423" class="dsq-comment-body">
                        <div id="dsq-comment-message-423" class="dsq-comment-message"><p>Tried the assembly (downloaded latest dll). Works fine on a local box. But on shared server end up with the error on: </p>
<p>Dim quantizer As OctreeQuantizer = New OctreeQuantizer(255, 4)</p>
<p>System.Security.SecurityException: Request for the permission of type &#8216;System.Security.Permissions.SecurityPermission, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&#8242; failed.</p>
<p>Using in ASP.NET. </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-424">
                    <div id="dsq-comment-header-424" class="dsq-comment-header">
                        <cite id="dsq-cite-424">
    http://www.mersinim.net                            <span id="dsq-author-user-424">mersin</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-424" class="dsq-comment-body">
                        <div id="dsq-comment-message-424" class="dsq-comment-message"><p>thaks </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-425">
                    <div id="dsq-comment-header-425" class="dsq-comment-header">
                        <cite id="dsq-cite-425">
    http://www.mersinim.net                            <span id="dsq-author-user-425">mersin</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-425" class="dsq-comment-body">
                        <div id="dsq-comment-message-425" class="dsq-comment-message"><p>Dim quantizer As OctreeQuantizer = New OctreeQuantizer(255, 4)</p>
<p>System.Security.SecurityException: Request for the permission of type &#8216;System.Security.Permissions.SecurityPermission, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&#8242; failed.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-426">
                    <div id="dsq-comment-header-426" class="dsq-comment-header">
                        <cite id="dsq-cite-426">
    http://www.eceoyun.com                            <span id="dsq-author-user-426">kral oyun</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-426" class="dsq-comment-body">
                        <div id="dsq-comment-message-426" class="dsq-comment-message"><p>Great code, saved me from trying to do the same thing myself and wasting hours of time!<br />
Thanks!</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-427">
                    <div id="dsq-comment-header-427" class="dsq-comment-header">
                        <cite id="dsq-cite-427">
    http://www.eceoyun.com                            <span id="dsq-author-user-427">kral oyun</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-427" class="dsq-comment-body">
                        <div id="dsq-comment-message-427" class="dsq-comment-message"><p>Great code, saved me from trying to do the same thing myself and wasting hours of time!<br />
Thanks!&#8230;.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-428">
                    <div id="dsq-comment-header-428" class="dsq-comment-header">
                        <cite id="dsq-cite-428">
    http://youtube.oku.gen.tr                            <span id="dsq-author-user-428">youtube</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-428" class="dsq-comment-body">
                        <div id="dsq-comment-message-428" class="dsq-comment-message"><p>Tried the assembly (downloaded latest dll). Works fine on a local box. But on shared server end up with the error on: </p>
<p>Dim quantizer As OctreeQuantizer = New OctreeQuantizer(255, 4)</p>
<p>System.Security.SecurityException: Request for the permission of type &#8216;System.Security.Permissions.SecurityPermission, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&#8242; failed&#8230;..</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-429">
                    <div id="dsq-comment-header-429" class="dsq-comment-header">
                        <cite id="dsq-cite-429">
    http://www.tercumehizmeti.com                            <span id="dsq-author-user-429">Terc&#252;me</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-429" class="dsq-comment-body">
                        <div id="dsq-comment-message-429" class="dsq-comment-message"><p>Thanks</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-430">
                    <div id="dsq-comment-header-430" class="dsq-comment-header">
                        <cite id="dsq-cite-430">
    http://msdn2.microsoft.com/en-us/library/aa479306.aspx                            <span id="dsq-author-user-430">st3v3n</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-430" class="dsq-comment-body">
                        <div id="dsq-comment-message-430" class="dsq-comment-message"><p>The &#8220;Optimization&#8230;&#8221;article at the MS site has moved, to here;<br />
<a href="http://msdn2.microsoft.com/en-us/library/aa479306.aspx" rel="nofollow">http://msdn2.microsoft.com/en-us/library/aa479306.aspx</a></p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-431">
                    <div id="dsq-comment-header-431" class="dsq-comment-header">
                        <cite id="dsq-cite-431">
    http://www.balikavi.info                            <span id="dsq-author-user-431">balık avı</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-431" class="dsq-comment-body">
                        <div id="dsq-comment-message-431" class="dsq-comment-message"><p>süperrrrrrrrrrrrr</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-432">
                    <div id="dsq-comment-header-432" class="dsq-comment-header">
                        <cite id="dsq-cite-432">
    http://www.youtube7.net                            <span id="dsq-author-user-432">youtube</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-432" class="dsq-comment-body">
                        <div id="dsq-comment-message-432" class="dsq-comment-message"><p>The &#8220;Optimization&#8230;&#8221;article at the MS site has moved, to here;</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-433">
                    <div id="dsq-comment-header-433" class="dsq-comment-header">
                        <cite id="dsq-cite-433">
    http://www.oyunambari.com                            <span id="dsq-author-user-433">Oyun</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-433" class="dsq-comment-body">
                        <div id="dsq-comment-message-433" class="dsq-comment-message"><p>Great &#8212; thanks for responding. I will plug it in and see how it goes..Again Thanks</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-434">
                    <div id="dsq-comment-header-434" class="dsq-comment-header">
                        <cite id="dsq-cite-434">
    http://www.youtubeizle1.com                            <span id="dsq-author-user-434">youtube</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-434" class="dsq-comment-body">
                        <div id="dsq-comment-message-434" class="dsq-comment-message"><p>thanks a lot</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-3211">
                    <div id="dsq-comment-header-3211" class="dsq-comment-header">
                        <cite id="dsq-cite-3211">
                                <span id="dsq-author-user-3211">Peter</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-3211" class="dsq-comment-body">
                        <div id="dsq-comment-message-3211" class="dsq-comment-message"><p>Thank you for the code! I managed to find a solution for keeping transparency after edit, with the following code (C#)</p>
<p>public class OctreeQuantizer : Quantizer<br />
{<br />
      &#8230;&#8230;&#8230;&#8230;&#8230;&#8230;&#8230;.<br />
        protected override byte QuantizePixel(Color32 pixel)<br />
        {<br />
            byte paletteIndex = (byte)_maxColors;    // The color at [_maxColors] is set to transparent</p>
<p>            // Get the palette index if this non-transparent<br />
            if (pixel.Alpha &gt; 0)<br />
                paletteIndex = (byte)_octree.GetPaletteIndex(pixel);</p>
<p>            return paletteIndex;<br />
        }</p>
<p>        protected override ColorPalette GetPalette(ColorPalette original)<br />
        {<br />
            // First off convert the octree to _maxColors colors<br />
            ArrayList palette = _octree.Palletize(_maxColors &#8211; 1);</p>
<p>            // Then convert the palette based on those colors<br />
            for (int index = 0; index &lt; palette.Count; index++)<br />
            {<br />
                Color TestColor = (Color)palette[index];<br />
                //Test set transparent color when color transparency used<br />
                if (TestColor.ToArgb() == Color.Transparent.ToArgb())<br />
                {<br />
                    TestColor = Color.FromArgb(0, 0, 0, 0);<br />
                }<br />
                original.Entries[index] = TestColor;<br />
            }<br />
            //Clear unused palette entries<br />
            for (int index = palette.Count; index &lt; _maxColors; index++)<br />
            {<br />
                original.Entries[index] = Color.FromArgb(255, 0, 0, 0);<br />
            }<br />
            // Add the transparent color when alpha transparency used<br />
            original.Entries[_maxColors] = Color.FromArgb(0, Color.Transparent);<br />
            return original;<br />
        }<br />
      &#8230;&#8230;&#8230;&#8230;&#8230;&#8230;&#8230;.<br />
}</p>
<p>public abstract class Quantizer<br />
{</p>
<p>      &#8230;&#8230;&#8230;&#8230;&#8230;&#8230;&#8230;&#8230;..</p>
<p>protected virtual void SecondPass(BitmapData sourceData, Bitmap output, int width, int height, Rectangle bounds)<br />
        {<br />
              &#8230;&#8230;&#8230;&#8230;&#8230;&#8230;&#8230;&#8230;&#8230;&#8230;&#8230;</p>
<p> <br />
                        // Check if this is the same as the last pixel. If so use that value<br />
                        // rather than calculating it again. This is an inexpensive optimisation.<br />
                        if (Marshal.ReadInt32(pPreviousPixel) != Marshal.ReadInt32(pSourcePixel))<br />
                        {<br />
                            // Quantize the pixel<br />
                            pixelValue = QuantizePixel(new Color32(pSourcePixel));</p>
<p>                            // And setup the previous pointer<br />
                            pPreviousPixel = pSourcePixel;<br />
                        }</p>
<p>              &#8230;&#8230;&#8230;&#8230;&#8230;&#8230;&#8230;&#8230;&#8230;&#8230;&#8230;<br />
       }</p>
<p>      &#8230;&#8230;&#8230;&#8230;&#8230;&#8230;&#8230;&#8230;..</p>
<p>}<br />
 </p>
</div>
                    </div>
                </li>
                </ul>
        </div>
    </div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://codebetter.com/brendantompkins/2004/01/26/use-gdi-to-save-crystal-clear-gif-images-with-net/';
    var disqus_identifier = '52 /blogs/brendan.tompkins/archive/2004/01/26/use-gdi-to-save-crystal-clear-gif-images-with-net.aspx';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'brendantompkins';
    var disqus_title = "Use GDI+ to Save Crystal-Clear GIF Images with .NET";
        var disqus_config = function () {
        var config = this; // Access to the config object

        /* 
           All currently supported events:
            * preData — fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            DISQUS.request.get('?cf_action=sync_comments&post_id=52');
        });
                    };
    var facebookXdReceiverPath = 'http://cdn1.codebetter.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
        ],
        'trackback_url': "http:\/\/codebetter.com\/brendantompkins\/2004\/01\/26\/use-gdi-to-save-crystal-clear-gif-images-with-net\/trackback\/"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.67';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29416);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=2782afb'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29416&amp;n=2782afb' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29417);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=e94cea6'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29417&amp;n=e94cea6' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29418);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=9ba3022'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29418&amp;n=9ba3022' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29419);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=f467b52'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29419&amp;n=f467b52' /></a></noscript>
				</div>
			
				<li id="archives-2" class="widget-container widget_archive"><h3 class="widget-title">Archives</h3>		<ul>
			<li><a href='http://codebetter.com/brendantompkins/2011/02/' title='February 2011'>February 2011</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2009/12/' title='December 2009'>December 2009</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2008/03/' title='March 2008'>March 2008</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2007/07/' title='July 2007'>July 2007</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2007/06/' title='June 2007'>June 2007</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2006/12/' title='December 2006'>December 2006</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2006/11/' title='November 2006'>November 2006</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2006/10/' title='October 2006'>October 2006</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2006/09/' title='September 2006'>September 2006</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2006/06/' title='June 2006'>June 2006</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2006/05/' title='May 2006'>May 2006</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2005/09/' title='September 2005'>September 2005</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2005/06/' title='June 2005'>June 2005</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2004/12/' title='December 2004'>December 2004</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2004/10/' title='October 2004'>October 2004</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2004/09/' title='September 2004'>September 2004</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2004/07/' title='July 2004'>July 2004</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2004/06/' title='June 2004'>June 2004</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2004/05/' title='May 2004'>May 2004</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2004/04/' title='April 2004'>April 2004</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2004/01/' title='January 2004'>January 2004</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2003/12/' title='December 2003'>December 2003</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2003/11/' title='November 2003'>November 2003</a></li>
	<li><a href='http://codebetter.com/brendantompkins/2003/10/' title='October 2003'>October 2003</a></li>
		</ul>
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(220407);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=68b8307'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=220407&amp;n=68b8307' /></a></noscript>				
				
				<ul class="xoxo">		
									</ul>	
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29421);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=3f8e353'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29421&amp;n=3f8e353' /></a></noscript>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="http://red-gate.com/">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="http://telerik.com">Telerik .NET Tools</a></li>
<li><a href="http://jetbrains.com/resharper/">JetBrains - ReSharper</a></li>
<li><a href="http://scootersoftware.com">Beyond Compare</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a></li>
<li><a href="http://umbraco.com" target="_blank">Umbraco</a></li>
<li><a href="http://nservicebus.com" target="_blank">NServiceBus</a></li>
<li><a href="http://ravendb.net" target="_blank">RavenDb</a></li>
<li><a href="http://www.websequencediagrams.com/" target="_blank">Web Sequence Diagrams</a></li>
	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '12<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPython.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = true; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>

<script type='text/javascript'>//<![CDATA[
    if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.4.2.min.js' type='text/javascript' %3E%3C/script%3E"));
    }//]]></script>
<script type='text/javascript' language='Javascript' src='http://s1.lqcdn.com/m.min.js?dt=2.3.110202.1'></script>
<script type='text/javascript' language='Javascript'> if(jQuery.LqmAds)jQuery.LqmAds();</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.723 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2012-11-09 20:24:51 -->
<!-- super cache -->