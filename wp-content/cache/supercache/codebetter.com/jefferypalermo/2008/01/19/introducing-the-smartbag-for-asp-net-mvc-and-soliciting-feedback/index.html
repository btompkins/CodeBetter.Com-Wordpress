<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Introducing the SmartBag for ASP.NET MVC. . . and soliciting feedback | Jeffery Palermo</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/jefferypalermo/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css?v=3912785705" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js?ver=3.4.2'></script>
<script type='text/javascript' src='http://dtym7iokkjlif.cloudfront.net/dough/1.0/recipe.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/jefferypalermo/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Austin Code Camp 2008 scheduled for May 17, 2008' href='http://codebetter.com/jefferypalermo/2008/01/15/austin-code-camp-2008-scheduled-for-may-17-2008/' />
<link rel='next' title='How to write stories _before_ the project kicks off' href='http://codebetter.com/jefferypalermo/2008/01/24/how-to-write-stories-before-the-project-kicks-off/' />
<meta name="generator" content="WordPress 3.4.2" />
<link rel='shortlink' href='http://codebetter.com/jefferypalermo/?p=600' />

<!-- All in One SEO Pack 1.6.13.2 by Michael Torbert of Semper Fi Web Design[83,177] -->
<link rel="canonical" href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/" />
<!-- /all in one seo pack -->
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.3.3" type="text/css" media="screen" />

<!-- Start Shareaholic OgTags -->

	<!-- Shareaholic Notice: There is neither a featured nor gallery image set -->

<!-- End Shareaholic OgTags -->

<meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/dc168cf39155d7b5d39f696ca94d5980.js?v=5302176208">/*Is Cache!*/</script>
                	
	<script type='text/javascript' src='http://d1.openx.org/spcjs.php?id=7744&amp;target=_blank'></script>
	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>
<!-- BuySellAds Ad Code -->
<script type="text/javascript">
(function(){
  var bsa = document.createElement('script');
     bsa.type = 'text/javascript';
     bsa.async = true;
     bsa.src = 'http://s3.buysellads.com/ac/bsa.js';
  (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);
})();
</script>
<!-- End BuySellAds Ad Code -->
</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">
			<!-- BuySellAds Zone Code -->
<div id="bsap_1276080" class="bsarocks bsap_4fe632babdccc2b4b049e4f08cc3c549"></div>
<!-- End BuySellAds Zone Code --></div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-600" class="post-600 post type-post status-publish format-standard hentry category-featured">
					<h1 class="entry-title">Introducing the SmartBag for ASP.NET MVC. . . and soliciting feedback</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/jefferypalermo/author/jefferypalermo/" title="View all posts by jefferypalermo">jefferypalermo</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/" title="5:50 pm" rel="bookmark"><span class="entry-date">January 19, 2008</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/jefferypalermo/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/jefferypalermo/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><!-- Start Shareaholic LikeButtonSetTop Automatic --><!-- End Shareaholic LikeButtonSetTop Automatic --><p>To get objects from an ASP.NET MVC controller to a view, you put the objects in a dictionary of sorts called ViewData.&nbsp; ViewData is sort of a misnomer because it&#8217;s not meant to contain data at all.&nbsp; It&#8217;s meant to contain objects.&nbsp;&nbsp; By the way, if you like this post, you can subscribe to my RSS at <a href="http://feeds.feedburner.com/jeffreypalermo">http://feeds.feedburner.com/jeffreypalermo</a>.</p>
<p>There are some challenges with ViewData as it stands now:</p>
<ul>
<li>A key is required for every object, both in the controller and view.<br />ViewData.Add(&#8220;conference&#8221;, conference);</li>
<li>A cast is required to pull out object by key.<br />(ScheduledConference)ViewData["conference"]</li>
<li>The ViewPage&lt;T&gt; solution discards the valuable flexibility of the objectbag being passed to the view.<br />&lt;%=ViewData.DaysUntilStart.ToString() %&gt; where ViewData is of type ScheduledConference</li>
</ul>
<p>Facts (or my strong opinions):</p>
<ul>
<li>Repeated keys from controller and view increase chance for typos and runtime errors.</li>
<li>Casting every extraction of an object in the view is annoying.</li>
<li>Strong-typing ViewPage only works for trivial scenarios.<br />- For instance, suppose once logged in, every view will need the currently logged in user.&nbsp; Perhaps the user name is displayed at the top right of the screen in the layout (master page).&nbsp; Since the layout shares the viewdata with the page, we immediately have the need for a flexible container that supports multiple objects.&nbsp; A strongly typed ViewPage&lt;T&gt; won&#8217;t work without an elaborate hierarchy of presentation object that are themselves flexible object containers able to support everything needed.&nbsp; Once you get there, you are almost back to the initial dictionary.</li>
</ul>
<p>My proposed draft solution, the <b>SmartBag:&nbsp; (and a <a href="/blogs/jeffrey.palermo/archive/2008/01/24/smartbag-for-asp-net-mvc-take-two.aspx">follow-up here</a>)<br /></b></p>
<ul>
<li>The SmartBag is currently only in CodeCampServer, but when it has proven it&#8217;s worth, I&#8217;ll move it into MvcContrib.&nbsp; It&#8217;s used in the ConferenceController and the ShowSchedule view.&nbsp; You can check out CodeCampServer at <a href="http://codecampserver.org">http://codecampserver.org</a>.</li>
<li></li>
<div>
<pre><span>public</span> <span>class</span> SmartBag : Hashtable<br />{<br />    <span>public</span> T Get&lt;T&gt;()<br />    {<br />        <span>return</span> (T)Get(<span>typeof</span>(T));<br />    }<br /><br />    <span>public</span> <span>object</span> Get(Type type)<br />    {<br />        <span>if</span> (!ContainsKey(type))<br />        {<br />            <span>string</span> message = <span>string</span>.Format(<span>"No object exists that is of type '{0}'."</span>, type);<br />            <span>throw</span> <span>new</span> ArgumentException(message);<br />        }<br /><br />        <span>return</span> <span>this</span>[type];<br />    }<br /><br />    <span>public</span> <span>void</span> Add(<span>object</span> anObject)<br />    {<br />        Type type = anObject.GetType();<br />        <span>if</span> (ContainsKey(type))<br />        {<br />            <span>string</span> message = <span>string</span>.Format(<span>"You can only add one default object for type '{0}'."</span>, type);<br />            <span>throw</span> <span>new</span> ArgumentException(message);<br />        }<br /><br />        Add(type, anObject);<br />    }<br /><br />    <span>public</span> <span>bool</span> Contains&lt;T&gt;()<br />    {<br />        <span>return</span> ContainsKey(<span>typeof</span> (T));<br />    }</pre>
</div>
<li>The smartbag implements IDictionary through HashTable, so it&#8217;s flexible, just like ViewData, but it has a powerful convention:&nbsp; If you are passing one object/type to the view, we don&#8217;t need a key because the SmartBag can use the type as the key.&nbsp; If you really need a Top conference and a Bottom conference, then you are back to using your keys, but for 80% (statistic I pulled out of my behind) cases, this works.</li>
<li>If we introduce a layer supertype for our views, then we can just use it:</li>
<li></li>
<div>
<pre><span>public</span> <span>class</span> ViewBase : ViewPage&lt;SmartBag&gt;<br />{<br />    <br />}</pre>
</div>
<li>Then, all my views inherit from ViewPage&lt;SmartBag&gt;.</li>
</ul>
<p><b>I&#8217;d appreciate feedback on this solution.&nbsp; To me, it seems to be a good foundation and convention, but I&#8217;m sure it can be improved.&nbsp; If this solution hasn&#8217;t been proven to be worthless, I&#8217;ll port it to MvcContrib so it can be used by MvcContrib clients.</b></p>
<div class="shr-publisher-600"></div><!-- Start Shareaholic LikeButtonSetBottom Automatic --><!-- End Shareaholic LikeButtonSetBottom Automatic -->											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/jefferypalermo/category/featured/" title="View all posts in Featured" rel="category tag">Featured</a>. Bookmark the <a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/" title="Permalink to Introducing the SmartBag for ASP.NET MVC. . . and soliciting feedback" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/feed/" title="Comments RSS to Introducing the SmartBag for ASP.NET MVC. . . and soliciting feedback" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-600 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/jefferypalermo/2008/01/15/austin-code-camp-2008-scheduled-for-may-17-2008/" rel="prev"><span class="meta-nav">&larr;</span> Austin Code Camp 2008 scheduled for May 17, 2008</a></div>
					<div class="nav-next"><a href="http://codebetter.com/jefferypalermo/2008/01/24/how-to-write-stories-before-the-project-kicks-off/" rel="next">How to write stories _before_ the project kicks off <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

							<div id="comments">


			<h3 id="comments-title">25 Responses to <em>Introducing the SmartBag for ASP.NET MVC. . . and soliciting feedback</em> </h3>


			<ol class="commentlist">
						<li class="comment even thread-even depth-1" id="li-comment-2246">
		<div id="comment-2246">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://www.jeffreypalermo.com' rel='external nofollow' class='url'>Jeffrey Palermo</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2246">January 25, 2008 at 1:08 pm</a></div>

		<div class="comment-body"><p>@Greg,<br />
Check out my follow-up to see if I have it now.<br />
<a href="http://codebetter.com/blogs/jeffrey.palermo/archive/2008/01/24/smartbag-for-asp-net-mvc-take-two.aspx" rel="nofollow">http://codebetter.com/blogs/jeffrey.palermo/archive/2008/01/24/smartbag-for-asp-net-mvc-take-two.aspx</a></p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2245">
		<div id="comment-2245">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://www.JeffHandley.com' rel='external nofollow' class='url'>Jeff Handley</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2245">January 25, 2008 at 2:29 am</a></div>

		<div class="comment-body"><p>This is excellent.  Second time sitting down to work on my first ASP.NET MVC project, I spent the entire evening trying to create a specific solution to this problem, not thinking about it being a generic problem.  The &#8216;Current User&#8217; scenario is dead on&#8230; there&#8217;s no reason for every Model passed down to have to know that the UI needs to have a User object.  We&#8217;re going to end up having too much UI embedded into our Model that way.</p>
<p>I agree with sticking with the single model.  If you need to put multiple objects of the same type into the View, then just wrap those objects into a dictionary or array yourself and stick that collection into the bag.</p>
<p>Thanks!</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2244">
		<div id="comment-2244">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://www.jeffreypalermo.com' rel='external nofollow' class='url'>Jeffrey Palermo</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2244">January 24, 2008 at 3:32 pm</a></div>

		<div class="comment-body"><p>@Jeremy,<br />
Done.</p>
<p>Single model:  No, realistic views are going to need a flexible number of objects, so we need a flexible container to pass.  One object is only sufficient if you have a presentation DTO for every view OR you have a trivial view.</p>
<p>ConventionController is alive and well in the MvcContrib project (<a href="http://mvccontrib.org" rel="nofollow">http://mvccontrib.org</a>)</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2243">
		<div id="comment-2243">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://codebetter.com/blogs/jeremy.miller' rel='external nofollow' class='url'>Jeremy D. Miller</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2243">January 22, 2008 at 6:38 pm</a></div>

		<div class="comment-body"><p>@Jeffrey,</p>
<p>If I can make a suggestion that *might* satisfy Greg.</p>
<p>Make it:</p>
<p>T Bag.Get<t>() or T Bag.Get</t><t>(key),</p>
<p>but not:</p>
<p>object Bag.Get(key)</p>
<p>To stay a little more true to the MVC theme, shouldn&#8217;t you always be passing a single Model object to the View?  Passing a hashtable just seems like a great way to get yourself into trouble.  What&#8217;s going on with the ConventionController idea?</t></p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2242">
		<div id="comment-2242">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://www.jeffreypalermo.com' rel='external nofollow' class='url'>Jeffrey Palermo</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2242">January 22, 2008 at 6:04 pm</a></div>

		<div class="comment-body"><p>@Greg,<br />
Let me try again.  It is a hashtable, so<br />
Bag["Foo777"] = Something is a perfectly valid scenario.</p>
<p>If you need the full flexibility of the IDictionary, then it is there to use.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2241">
		<div id="comment-2241">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Greg</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2241">January 22, 2008 at 5:52 pm</a></div>

		<div class="comment-body"><p>jeffrey: you miss my point &#8230; if it IS a hashtable what prevents me from saying</p>
<p>Bag["Foo777"] = Something </p>
<p>or</p>
<p>myBag.Add(&#8220;Bar&#8221;, new object());</p>
<p>.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2240">
		<div id="comment-2240">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://www.jeffreypalermo.com' rel='external nofollow' class='url'>Jeffrey Palermo</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2240">January 22, 2008 at 5:02 pm</a></div>

		<div class="comment-body"><p>@Greg,<br />
I think it IS an IDictionary, and Hashtable gives us that.  All Hashtable operations are still valid.</p>
<p>Regarding the adding as type:  You are completely correct.  This should support proxies, so we&#8217;ll have to change it to store as explicit type and not derive the type of the actual object.  We need to be able to support polymorphism.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2239">
		<div id="comment-2239">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Greg</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2239">January 21, 2008 at 5:10 pm</a></div>

		<div class="comment-body"><p>shouldn&#8217;t this be encapsulating a hashtable/dictionary instead of BEING a hashtable/dictionary? Perhaps even meeting the interface? i.e. in the above how do I insure my invariant that there aren&#8217;t &#8220;other things&#8221; in my dictionary since it is exposed?</p>
<p>also since this is to be used so often it could really benefit from being a dictionary where it could avoid dual lookups (contains then get etc) on every operation &#8230;.</p>
<p>further &#8230; I need to be able to say StoreThisObjectAsThisType as opposed to it always using GetType() &#8230; otherwise it defeats the purpose of polymorphism &#8230; it would really suck that I want to add a proxy to AnObject and my view mysteriously start failing.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2238">
		<div id="comment-2238">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://www.kenegozi.com/blog' rel='external nofollow' class='url'>Ken Egozi</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2238">January 21, 2008 at 2:20 pm</a></div>

		<div class="comment-body"><p>I&#8217;ll second Adam.<br />
Imo, every view should have an interface anyway. Having that, the use of the DictionaryAdapter is most natural.</p>
<p>So, you&#8217;d declare ViewBase<iview> { &#8230; IView view = dictionaryAdapter.GetAdapter</iview><iview>(ViewData); }<br />
and have the dictionary adapter injected to your page with your IoC container of choice.</p>
<p>here:<br />
<a href="http://www.kenegozi.com/Blog/2007/10/17/typed-view-properties-in-monorail-and-aspview.aspx" rel="nofollow">http://www.kenegozi.com/Blog/2007/10/17/typed-view-properties-in-monorail-and-aspview.aspx</a><br />
is a sample for MonoRail/AspView.  This could be easily adapted to ASPNET.MVC (just swap propertybag with ViewData)<br />
</iview></p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2237">
		<div id="comment-2237">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://mhinze.com' rel='external nofollow' class='url'>Matt Hinze</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2237">January 21, 2008 at 1:50 pm</a></div>

		<div class="comment-body"><p>I&#8217;ve been trying to get a more robust option for ViewData implemented.  I like the SmartBag.  But using a Type based key isn&#8217;t as beneficial as you might think.  It&#8217;s very common to have multiple objects of the same type in the collection.  The first will populate the main page and a second for an associated viewlet.  Think a page for all products vs. a viewlet for My Products in the sidebar. They both use ProductsPresentationCollection or whatever. I had to extend the SmartBag to handle object based keys too. </p>
<p> [Test]<br />
        public void ShouldRetrieveSingleObjectByKey()<br />
        {<br />
            SmartBag bag = new SmartBag();<br />
            Guid guid = new Guid();<br />
            Guid guid2 = new Guid();<br />
            bag.Add(guid);<br />
            bag.Add(&#8220;key&#8221;, guid2);</p>
<p>            Assert.That(bag.Get<guid>(&#8220;key&#8221;), Is.EqualTo(guid2));<br />
        }</p>
<p>and </p>
<p>	public class SmartBag : Hashtable<br />
	{<br />
		// &#8230;</p>
<p>        public T Get<t>(object key)<br />
        {<br />
            if (!ContainsKey(key))<br />
            {<br />
                string message = string.Format(&#8220;No object exists with key &#8216;{0}&#8217;.&#8221;, key);<br />
                throw new ArgumentException(message);<br />
            }<br />
            return (T) this[key];<br />
        }</p>
<p>by the way, this is sort of similar to my PageData</t><t> class which inherits from ViewData class and has a ViewData generic property and an IDictionary(string,object) collection as a property called ViewletData.  It worked quite well because it nicely segregated the viewdata from the viewlet data.  See the Issue6 thread on the ccs-discuss list for more info. </p>
<p>Either way &#8211; there is some funny business occurring as the controller does more than control.  We now need a centralized contact-based mechanism for creating this massive SmartBag..  Certain site-wide presentation objects need to be added to the SmartBag even in seemingly unrelated controllers.  Which concerns me, as I do not want my repos querying for every request. </p>
<p>It&#8217;s a fine solution for what we have now Jeremy.  But I think in the long run that RenderAction is a lot less messy and even, as our SmartBag gets bigger than we&#8217;d like to admit now that it will, more &#8220;performant&#8221;</p>
<p>The onus </p>
<p>I think enhanced viewdata like SmartBag or PageData</t></guid></p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2236">
		<div id="comment-2236">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://www.jeffreypalermo.com' rel='external nofollow' class='url'>Jeffrey Palermo</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2236">January 21, 2008 at 3:08 am</a></div>

		<div class="comment-body"><p>I&#8217;ve posted an update in CodeCampServer and converted all the conference views and actions to use it.  I think it comes out pretty clean.  Please comment on the new usage.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2235">
		<div id="comment-2235">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Garry Shutler</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2235">January 21, 2008 at 12:11 am</a></div>

		<div class="comment-body"><p>I was going to make a similar suggestion to Hernan, basically making it support enumerations by each entry being a List of the type. Then the Get<t> would get the first element and there would be an EnumerationOf</t><t> method as well. </p>
<p>I personally don&#8217;t see why you would need to retrieve elements by their index if you are using DTOs for the data you want to display.</t></p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2234">
		<div id="comment-2234">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://blog.latrompa.com' rel='external nofollow' class='url'>Hernan</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2234">January 20, 2008 at 10:01 pm</a></div>

		<div class="comment-body"><p>What bout this, instead of store the object in the hashtable directly, store an array of objects of the given type.<br />
That way we won&#8217;t need to use keys to get those objects.</p>
<p>Get<t>(index);<br />
I also provide a First</t><t> method that returns the first one just to make client notation cleaner.</p>
<p>I also provide a CountOf</t><t> method (not crazy about the name but I don&#8217;t want to override Count from the hashtable, this method returns the number of a given object.</p>
<p>What do you think?<br />
Code below.</p>
<p>    public class SmartBag : Hashtable<br />
    {<br />
        public T First</t><t>()<br />
        {<br />
            return (T)this.Get(typeof(T), 0);<br />
        }</p>
<p>        public int CountOf</t><t>()<br />
        {<br />
            Type type = typeof(T);<br />
            if (!ContainsKey(type))<br />
            {<br />
                string message = string.Format(&#8220;No object exists that is of type &#8216;{0}&#8217;.&#8221;, type);<br />
                throw new ArgumentException(message);<br />
            }</p>
<p>            return ((ArrayList)this[type]).Count;<br />
        }</p>
<p>        public T Get</t><t>(int index)<br />
        {<br />
            return (T)this.Get(typeof(T), index);<br />
        }</p>
<p>        private object Get(Type type, int index)<br />
        {<br />
            if (!ContainsKey(type))<br />
            {<br />
                string message = string.Format(&#8220;No object exists that is of type &#8216;{0}&#8217;.&#8221;, type);<br />
                throw new ArgumentException(message);<br />
            }</p>
<p>            return ((ArrayList)this[type])[index];<br />
        }</p>
<p>        public void Add(object anObject)<br />
        {<br />
            Type type = anObject.GetType();<br />
            this.Add(type, anObject);<br />
        }</p>
<p>        public override void  Add(object key, object value)<br />
        {<br />
            if (ContainsKey(key))<br />
            {<br />
                ((ArrayList)this[key]).Add(value);<br />
            }<br />
            else<br />
            {<br />
                ArrayList al = new ArrayList();<br />
                al.Add(value);<br />
                base.Add(key, al);<br />
            }<br />
        }</p>
<p>        public bool Contains</t><t>()<br />
        {<br />
            return ContainsKey(typeof(T));<br />
        }<br />
    }<br />
</t></p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2233">
		<div id="comment-2233">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://weblogs.asp.net/kevinisom' rel='external nofollow' class='url'>Kevin Isom</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2233">January 20, 2008 at 8:23 pm</a></div>

		<div class="comment-body"><p>I must agree with what Eric said about the Monorail DictionaryAdaptor. Definately a nice way to do it.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2232">
		<div id="comment-2232">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">eric hexter</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2232">January 20, 2008 at 2:22 pm</a></div>

		<div class="comment-body"><p>I like the idea of this.  I would rather see it called TypedBag rather than smart bag.    The idea of making anything key based really feels like a smell to me.   I would rather see the creation of a DTO that includes all of the objects that are needed for a view / viewlet / component.  Than you can create a composite view by including multiple DTOs in the SmartBag. </p>
<p>I do like the Castle DictionaryAdaptor approach in that you could define your DTOs as interfaces and you never have to create concrete types.  The adaptor does that work for you.  You might want to look at that object to get a better feel for what it can do.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2231">
		<div id="comment-2231">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://blog.latrompa.com' rel='external nofollow' class='url'>Hernan</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2231">January 20, 2008 at 6:25 am</a></div>

		<div class="comment-body"><p>It sounds like a very good solution for me. The casting and the key&#8217;s are a problem. I guest there is no way to avoid them altogether as Evan mention we still will need the key if we have to objects of the same type.<br />
I will love to see this solution inside MvcContrib, it still bothers me that you may access to (let&#8217;s say) Users objects one doing Get<user>() and another one doing Get</user><user>(&#8220;key&#8221;);. Not sure why, but I&#8217;m thinking on a third person reading the code three month later and trying to figure out why sometimes we pass a key and sometimes we don&#8217;t.</user></p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2230">
		<div id="comment-2230">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://www.jeffreypalermo.com' rel='external nofollow' class='url'>Jeffrey Palermo</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2230">January 20, 2008 at 5:30 am</a></div>

		<div class="comment-body"><p>@Bill,<br />
This is different because with SmartBag, we can pass many objects to the view and use no key if we have only one of each type.  If we have two objects of the same type passed, then we&#8217;ll have to use a key.</p>
<p>@Evan,<br />
You are right.  I missed that method.  I&#8217;ll be adding it.  </p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2229">
		<div id="comment-2229">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Andy</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2229">January 19, 2008 at 10:16 pm</a></div>

		<div class="comment-body"><p>Looks a great idea for MVCContrib. Perhaps it could be called ConventionViewData to accompany ConventionController? Though I suppose SmartBag sounds quite funky!</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2228">
		<div id="comment-2228">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://codebetter.com/blogs/kyle.baley' rel='external nofollow' class='url'>Kyle Baley</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2228">January 19, 2008 at 10:05 pm</a></div>

		<div class="comment-body"><p>Good idea and not just for passing ViewData. Seems like a good pattern whenever you need to pass any collection of heterogeneous objects around.</p>
<p>Have you seen PowerCollections: <a href="http://www.codeplex.com/PowerCollections" rel="nofollow">http://www.codeplex.com/PowerCollections</a></p>
<p>I haven&#8217;t looked into it myself but reading through your code made me think of it. It may have something similar that you could pilfer.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2227">
		<div id="comment-2227">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://blechie.com/wpierce/' rel='external nofollow' class='url'>Bill Pierce</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2227">January 19, 2008 at 9:11 pm</a></div>

		<div class="comment-body"><p>&#8220;If you are passing one object/type to the view, we don&#8217;t need a key because the SmartBag can use the type as the key&#8221;</p>
<p>How is this different than the current support for strongly typed ViewData?</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2226">
		<div id="comment-2226">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://abombss.com' rel='external nofollow' class='url'>Adam Tybor</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2226">January 19, 2008 at 8:55 pm</a></div>

		<div class="comment-body"><p>It seems more simple than Castle&#8217;s DictionaryAdapter and could cover, like you say, 80% of cases, but its still forcing you to create strongly typed viewdata objects.  </p>
<p>I prefer the DictionaryAdaper because I can just create my interfaces and use primitives like strings, and ints, and not have to worry about keys.  The advantage of interfaces over strongly typed objects is you can achieve multiple inheritance very easily.</p>
<p>You can certainly achieve the same thing with the SmartBag, it just adds extra line noise with the generic parameter and the get method.</p>
<p>ViewData.Get<siteheader>().Title as opposed to ViewData.SiteHeader with the DictionaryAdapter.</p>
<p>+1 to adding it to mvc contrib.</p>
<p>@Evan, I like that extension too.<br />
</siteheader></p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2225">
		<div id="comment-2225">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://www.evanhoff.com/' rel='external nofollow' class='url'>Evan</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2225">January 19, 2008 at 8:04 pm</a></div>

		<div class="comment-body"><p>You might think about adding an overload to allow passing in a key.. Your current design only allows passing 1 value per type in the bag..</p>
<p>T Get(); //use the type-specific default key<br />
T Get(string key); // use a type-specific prefix + key</p>
<p>void Set<t>();  // use the type-specific default key<br />
void Set</t><t>(string key); // use the type-specific prefix + key</t></p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2224">
		<div id="comment-2224">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Brian Sullivan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2224">January 19, 2008 at 7:14 pm</a></div>

		<div class="comment-body"><p>Sounds good to me.  Anything that would keep me from using string-keyed collections and casting would be a plus.  That just gives me the willies.  Even if it turns out not to be the best solution, getting it out there in the ecosystem can only be beneficial.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2223">
		<div id="comment-2223">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Oren Novotny</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2223">January 19, 2008 at 7:04 pm</a></div>

		<div class="comment-body"><p>I&#8217;d come up with something similar when writing  LINQ provider &#8212; the major difference is that it implements ICustomTypeDescriptor and which allows it to be databound easily w/o extracting the items:</p>
<p>public class ObjectSet : ICustomTypeDescriptor<br />
    {<br />
        Dictionary<type , object> _typeMap;</p>
<p>        private ObjectSet()<br />
        {<br />
        }</p>
<p>        public ObjectSet(params object[] objects)<br />
        {<br />
            _typeMap = new Dictionary</type><type , object>();<br />
            _typeMap = objects.ToDictionary(o => o.GetType());<br />
        }</p>
<p>        public T GetObject<t>()<br />
        {<br />
            return (T)_typeMap[typeof(T)];<br />
        }</p>
<p>        public bool Contains</t><t>()<br />
        {<br />
            return _typeMap.ContainsKey(typeof(T));<br />
        }</p>
<p>        ///<br />
<summary>
        /// Returns a new ObjectSet with the object added in<br />
        /// </summary>
<p>        ///
<param name="obj"></param>
        /// <returns></returns><br />
        public ObjectSet AddOrUpdate(object obj)<br />
        {<br />
            if(obj == null)<br />
                throw new ArgumentNullException(&#8220;obj&#8221;);</p>
<p>            var cs = new ObjectSet();</p>
<p>            cs._typeMap = new Dictionary<type , object>(_typeMap);<br />
            cs._typeMap[obj.GetType()] = obj;</p>
<p>            return cs;<br />
        }</p>
<p>        ///<br />
<summary>
        /// Returns a new ObjectSet without the object<br />
        /// </summary>
<p>        ///
<param name="obj"></param>
        /// <returns></returns><br />
        public ObjectSet Remove(object obj)<br />
        {<br />
            if (obj == null)<br />
                throw new ArgumentNullException(&#8220;obj&#8221;);</p>
<p>            var cs = new ObjectSet();</p>
<p>            cs._typeMap = new Dictionary</type><type , object>(_typeMap);<br />
            cs._typeMap.Remove(obj.GetType());</p>
<p>            return cs;<br />
        }</p>
<p>        #region ICustomTypeDescriptor Members</p>
<p>        AttributeCollection ICustomTypeDescriptor.GetAttributes()<br />
        {<br />
            return TypeDescriptor.GetAttributes(this, true);<br />
        }</p>
<p>        string ICustomTypeDescriptor.GetClassName()<br />
        {<br />
            return TypeDescriptor.GetClassName(this, true);<br />
        }</p>
<p>        string ICustomTypeDescriptor.GetComponentName()<br />
        {<br />
            return TypeDescriptor.GetComponentName(this, true);<br />
        }</p>
<p>        TypeConverter ICustomTypeDescriptor.GetConverter()<br />
        {<br />
            return TypeDescriptor.GetConverter(this, true);<br />
        }</p>
<p>        EventDescriptor ICustomTypeDescriptor.GetDefaultEvent()<br />
        {<br />
            return TypeDescriptor.GetDefaultEvent(this, true);<br />
        }</p>
<p>        PropertyDescriptor ICustomTypeDescriptor.GetDefaultProperty()<br />
        {<br />
            return TypeDescriptor.GetDefaultProperty(this, true);<br />
        }</p>
<p>        object ICustomTypeDescriptor.GetEditor(Type editorBaseType)<br />
        {<br />
            return TypeDescriptor.GetEditor(this, editorBaseType, true);<br />
        }</p>
<p>        EventDescriptorCollection ICustomTypeDescriptor.GetEvents(Attribute[] attributes)<br />
        {<br />
            var eds = from kvp in _typeMap<br />
                      from ed in TypeDescriptor.GetEvents(kvp.Value, attributes).Cast<eventdescriptor>()<br />
                      select new KeyValuePair</eventdescriptor><eventdescriptor , Type>(ed, kvp.Value.GetType());</p>
<p>            return WrapEvents(eds);<br />
        }</p>
<p>        EventDescriptorCollection ICustomTypeDescriptor.GetEvents()<br />
        {<br />
            var eds = from kvp in _typeMap<br />
                      from ed in TypeDescriptor.GetEvents(kvp.Value).Cast</eventdescriptor><eventdescriptor>()<br />
                      select new KeyValuePair</eventdescriptor><eventdescriptor , Type>(ed, kvp.Value.GetType());</p>
<p>            return WrapEvents(eds);<br />
        }</p>
<p>        PropertyDescriptorCollection ICustomTypeDescriptor.GetProperties(Attribute[] attributes)<br />
        {</p>
<p>            var pds = from kvp in _typeMap<br />
                      from pd in TypeDescriptor.GetProperties(kvp.Value, attributes).Cast
<propertydescriptor>()<br />
                      select new KeyValuePair</propertydescriptor>
<propertydescriptor , Type>(pd, kvp.Value.GetType());</p>
<p>            return WrapProperties(pds);<br />
        }</p>
<p>        PropertyDescriptorCollection ICustomTypeDescriptor.GetProperties()<br />
        {</p>
<p>            var pds = from kvp in _typeMap<br />
                      from pd in TypeDescriptor.GetProperties(kvp.Value).Cast</propertydescriptor>
<propertydescriptor>()<br />
                      select new KeyValuePair</propertydescriptor>
<propertydescriptor , Type>(pd, kvp.Value.GetType());</p>
<p>            return WrapProperties(pds);<br />
        }</p>
<p>        object ICustomTypeDescriptor.GetPropertyOwner(PropertyDescriptor pd)<br />
        {<br />
            return this;<br />
        }</p>
<p>        private static PropertyDescriptorCollection WrapProperties(IEnumerable<keyvaluepair <PropertyDescriptor, Type>> source)<br />
        {<br />
            var s = source.Select(kvp => new ObjectSetPropertyDescriptor(kvp.Key, kvp.Value)).ToArray();</p>
<p>            return new PropertyDescriptorCollection(s);<br />
        }</p>
<p>        private static EventDescriptorCollection WrapEvents(IEnumerable</keyvaluepair><keyvaluepair <EventDescriptor, Type>> source)<br />
        {<br />
            var s = source.Select(kvp => new ObjectSetEventDescriptor(kvp.Key, kvp.Value)).ToArray();</p>
<p>            return new EventDescriptorCollection(s);<br />
        }</p>
<p>        #endregion</p>
<p>        private sealed class ObjectSetEventDescriptor : EventDescriptor<br />
        {<br />
            private EventDescriptor _baseDesc;<br />
            private Type _ownerType;</p>
<p>            public ObjectSetEventDescriptor(EventDescriptor ed, Type ownerType)<br />
                : base(ed)<br />
            {<br />
                if(ed == null)<br />
                    throw new ArgumentNullException(&#8220;ed&#8221;);<br />
                if (ownerType == null)<br />
                    throw new ArgumentNullException(&#8220;ownerType&#8221;);</p>
<p>                _ownerType = ownerType;<br />
                _baseDesc = ed;<br />
            }</p>
<p>            private object GetTarget(object source)<br />
            {<br />
                if (source == null)<br />
                    throw new ArgumentNullException(&#8220;source&#8221;);</p>
<p>                ObjectSet os = source as ObjectSet;<br />
                if (os != null)<br />
                    return os._typeMap[_ownerType];</p>
<p>                if (source.GetType().Equals(_ownerType))<br />
                    return source;</p>
<p>                throw new ArgumentException(string.Format(&#8220;Type mismatch.  Source must be of Type {0}.&#8221;, _ownerType), &#8220;source&#8221;);<br />
            }</p>
<p>            public override void AddEventHandler(object component, Delegate value)<br />
            {<br />
                _baseDesc.AddEventHandler(GetTarget(component), value);<br />
            }</p>
<p>            public override Type ComponentType<br />
            {<br />
                get { return _baseDesc.ComponentType; }<br />
            }</p>
<p>            public override Type EventType<br />
            {<br />
                get { return _baseDesc.EventType; }<br />
            }</p>
<p>            public override bool IsMulticast<br />
            {<br />
                get { return _baseDesc.IsMulticast; }<br />
            }</p>
<p>            public override void RemoveEventHandler(object component, Delegate value)<br />
            {<br />
                _baseDesc.RemoveEventHandler(GetTarget(component), value);<br />
            }</p>
<p>            public override string DisplayName<br />
            {<br />
                get<br />
                {<br />
                    return string.Concat(_ownerType.Name, &#8220;.&#8221;, base.DisplayName);<br />
                }<br />
            }<br />
        }</p>
<p>        private sealed class ObjectSetPropertyDescriptor : PropertyDescriptor<br />
        {<br />
            private PropertyDescriptor _baseDesc;<br />
            private Type _ownerType;</p>
<p>            public ObjectSetPropertyDescriptor(PropertyDescriptor pd, Type ownerType) : base(pd)<br />
            {<br />
                if (pd == null)<br />
                    throw new ArgumentNullException(&#8220;pd&#8221;);</p>
<p>                if (ownerType == null)<br />
                    throw new ArgumentNullException(&#8220;ownerType&#8221;);</p>
<p>                _ownerType = ownerType;<br />
                _baseDesc = pd;<br />
            }</p>
<p>            private object GetTarget(object source)<br />
            {<br />
                if(source == null)<br />
                    throw new ArgumentNullException(&#8220;source&#8221;);</p>
<p>                ObjectSet os = source as ObjectSet;<br />
                if (os != null)<br />
                    return os._typeMap[_ownerType];</p>
<p>                if (source.GetType().Equals(_ownerType))<br />
                    return source;</p>
<p>                throw new ArgumentException(string.Format(&#8220;Type mismatch.  Source must be of Type {0}.&#8221;, _ownerType), &#8220;source&#8221;);<br />
            }</p>
<p>            public override bool CanResetValue(object component)<br />
            {<br />
                return _baseDesc.CanResetValue(GetTarget(component));<br />
            }</p>
<p>            public override Type ComponentType<br />
            {<br />
                get<br />
                {<br />
                    return _baseDesc.ComponentType;<br />
                }<br />
            }</p>
<p>            public override object GetValue(object component)<br />
            {<br />
                return _baseDesc.GetValue(GetTarget(component));<br />
            }</p>
<p>            public override bool IsReadOnly<br />
            {<br />
                get { return _baseDesc.IsReadOnly; }<br />
            }</p>
<p>            public override Type PropertyType<br />
            {<br />
                get { return _baseDesc.PropertyType; }<br />
            }</p>
<p>            public override void ResetValue(object component)<br />
            {<br />
                _baseDesc.ResetValue(GetTarget(component));<br />
            }</p>
<p>            public override void SetValue(object component, object value)<br />
            {<br />
                _baseDesc.SetValue(GetTarget(component), value);<br />
            }</p>
<p>            public override bool ShouldSerializeValue(object component)<br />
            {<br />
                return _baseDesc.ShouldSerializeValue(GetTarget(component));<br />
            }</p>
<p>            public override string DisplayName<br />
            {<br />
                get<br />
                {<br />
                    return string.Concat(_ownerType.Name, &#8220;.&#8221;, base.DisplayName);<br />
                }<br />
            }<br />
        }<br />
    }</keyvaluepair></propertydescriptor></eventdescriptor></type></t></type></p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2222">
		<div id="comment-2222">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://blog.lozanotek.com' rel='external nofollow' class='url'>Javier Lozano</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#comment-2222">January 19, 2008 at 6:46 pm</a></div>

		<div class="comment-body"><p>Why did you choose Hashtable rather than Dictionary<tkey , TValue> to implement SmartBag?</tkey></p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
			</ol>



								<div id="respond">
				<h3 id="reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/jefferypalermo/2008/01/19/introducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback/#respond" style="display:none;">Cancel reply</a></small></h3>
									<p class="must-log-in">You must be <a href="http://codebetter.com/jefferypalermo/wp-login.php?redirect_to=http%3A%2F%2Fcodebetter.com%2Fjefferypalermo%2F2008%2F01%2F19%2Fintroducing-the-smartbag-for-asp-net-mvc-and-soliciting-feedback%2F">logged in</a> to post a comment.</p>												</div><!-- #respond -->
						
</div><!-- #comments -->

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29416);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=2782afb'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29416&amp;n=2782afb' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29417);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=e94cea6'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29417&amp;n=e94cea6' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29418);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=9ba3022'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29418&amp;n=9ba3022' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29419);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=f467b52'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29419&amp;n=f467b52' /></a></noscript>
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(220407);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=68b8307'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=220407&amp;n=68b8307' /></a></noscript>				
				
				<ul class="xoxo">		
									</ul>	
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29421);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=3f8e353'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29421&amp;n=3f8e353' /></a></noscript>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="http://red-gate.com/">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="http://telerik.com">Telerik .NET Tools</a></li>
<li><a href="http://jetbrains.com/resharper/">JetBrains - ReSharper</a></li>
<li><a href="http://scootersoftware.com">Beyond Compare</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a></li>
<li><a href="http://umbraco.com" target="_blank">Umbraco</a></li>
<li><a href="http://nservicebus.com" target="_blank">NServiceBus</a></li>
<li><a href="http://ravendb.net" target="_blank">RavenDb</a></li>
<li><a href="http://www.websequencediagrams.com/" target="_blank">Web Sequence Diagrams</a></li>
	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '12<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPython.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = true; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>

<script type='text/javascript'>//<![CDATA[
    if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.4.2.min.js' type='text/javascript' %3E%3C/script%3E"));
    }//]]></script>
<script type='text/javascript' language='Javascript' src='http://s1.lqcdn.com/m.min.js?dt=2.3.110202.1'></script>
<script type='text/javascript' language='Javascript'> if(jQuery.LqmAds)jQuery.LqmAds();</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.410 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2012-11-09 18:46:30 -->
<!-- super cache -->