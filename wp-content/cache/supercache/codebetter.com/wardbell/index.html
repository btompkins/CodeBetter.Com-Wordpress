<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Ward Bell | CodeBetter.Com &#8211; Stuff you need to Code Better!</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/wardbell/xmlrpc.php" />
	                <link rel="stylesheet" href="http://codebetter.com/wardbell/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='http://codebetter.com/wardbell/wp-includes/js/l10n.js?ver=20101110'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/wardbell/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://codebetter.com/wardbell/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Ward Bell' href='http://codebetter.com/wardbell/' />
<meta name="generator" content="WordPress 3.1-beta1-16732" />
<link rel="stylesheet" href="http://codebetter.com/wardbell/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.0.7" type="text/css" media="screen" /><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.1" />
                <script type="text/javascript" src="http://codebetter.com/wardbell/wp-content/uploads/spacker-cache/3e52f3b292da95601a0d3fbd9775ac0e.js">/*Is Cache!*/</script>
                	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>

</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">			</div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content">
			<div id="main" class="grid_8">
			<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/wardbell/feed/rss/"  rel="nofollow"><img src="http://codebetter.com/wardbell/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/wardbell/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div>			
	<div id="nav-above" class="navigation">
		<div class="nav-next"><a href="?page=1" > Next Page &raquo;</a></div>
		
	</div><!-- #nav-above -->


				
			<div id="post-10" class="post-10 post type-post status-publish format-standard hentry category-uncategorized">
			<h2 class="entry-title"><a href="http://codebetter.com/wardbell/2010/03/31/of-tailors-and-tooling-rant/" title="Permalink to Of Tailors and Tooling (rant)" rel="bookmark">Of Tailors and Tooling (rant)</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/wardbell/2010/03/31/of-tailors-and-tooling-rant/" title="8:32 pm" rel="bookmark"><span class="entry-date">March 31, 2010</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/wardbell" title="View all posts by wardbell">wardbell</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>Daniel asks a tailor to make him a suit. The tailor measures him and says “come back in three days.” </p>
<p>Daniel returns to try on the suit. “<em>The left sleeve is too short</em>” he complains. The tailor says “<em>Raise your right shoulder and drop the left shoulder and you’ll look great.</em>” Daniel does and, sure enough, the two sleeves meet properly at the wrist.</p>
<p>“<em>The left pant leg is too long</em>” cries Daniel. “<em>No problem</em>” says the tailor. “<em>Lift your left hip and walk on your toes.</em>” Sure enough, both pant legs break beautifully just above the ankles. </p>
<p>Daniel pays the tailor and ambles out to the street wearing his new suit. Another man approaches him and exclaims “<em>Wow, great suit! Who’s your tailor?</em>”. Daniel beams and points to the tailor shop. “<em>He must be a terrific tailor</em>,” says the man, “<em>to be able to fit a cripple like you!</em>”</p>
<p>I’m feeling like Daniel a lot lately. A number of us have been exploring implementation patterns for MVVM in complex, composite business applications. Just as we start getting somewhere promising … someone stops us short and says:</p>
<p>“<strong><font color="#0000ff"><em>You can’t do that because it doesn’t work in Blend.</em></font></strong>”</p>
<p>Let me be clear. I think Blend is grand and am learning to appreciate its power. I desperately want to facilitate the best possible UX. I know I can’t design the visuals worth a damn. I realize the people who can are not programmers and shouldn’t be asked to become programmers. I get it. I will do what it takes to make Blendable Views … including adjusting my posture.</p>
<p>But I’m not happy with show-stopper arguments like “<em>It won’t work in Blend.</em>” That may be the reality today but it need not be my future. </p>
<p>We should be honest about the consequences of saying “<em>it won’t work in Blend</em>”. Make no mistake, we’re twisting and contorting our architectures to satisfy the present state of the tooling. </p>
<p>Worse, we’re encouraging the tailor! </p>
<p>Sometimes I believe he thinks it’s a good thing for us to slouch and droop uncomfortably down the street. He actually thinks it’s a good thing to build View first, to inscribe code in the XAML, to block access to design-time APIs, to resort to Behaviors for simple programming tasks. He can’t believe I need to inject dependencies in the ViewModel … perhaps because that means he’d have to confront his own inadequacies. </p>
<p>I should get over it. Yet my hackles go up when I detect that smug, dismissive tone. </p>
<p>Hey, if you have to say “<em>it won’t Blend</em>” that’s an admission of failure. It means you’re not where you should be. I can deal with that. But stop sounding triumphant … as if what I want to do is stupid because it won’t Blend.</p>
<p>Yes, please make the tooling great for the designer. But the developer is the customer too … never forget that. The tooling should change to suit me … not the other way around.</p>
<p>Signed,</p>
<p>Frustrated-in-CA </p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/wardbell/category/uncategorized/" title="View all posts in Uncategorized" rel="category">Uncategorized</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/wardbell/2010/03/31/of-tailors-and-tooling-rant/#comments" title="Comment on Of Tailors and Tooling (rant)">7 Comments</a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-10 -->

		
						
			<div id="post-9" class="post-9 post type-post status-publish format-standard hentry category-mvvm">
			<h2 class="entry-title"><a href="http://codebetter.com/wardbell/2010/03/20/rob-e-s-mini-mvvm-framework-mix10/" title="Permalink to Rob E’s Mini-MVVM Framework @ MIX10" rel="bookmark">Rob E’s Mini-MVVM Framework @ MIX10</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/wardbell/2010/03/20/rob-e-s-mini-mvvm-framework-mix10/" title="1:20 am" rel="bookmark"><span class="entry-date">March 20, 2010</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/wardbell" title="View all posts by wardbell">wardbell</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>Rob Eisenberg’s MIX 2010 talk, “<a href="http://live.visitmix.com/MIX10/Sessions/EX15" target="_blank">Build Your Own MVVM Framework</a>” was terrific. If you feel modestly comfortable with MVVM, run over and get the video and the code.</p>
<p>Rob may be best known for his <a href="http://caliburn.codeplex.com/" target="_blank">Caliburn</a> WPF/Silverlight Presentation Development Framework. That’s a hefty body of work and if the word “framework” sends an unpleasant shiver down your spine … <em>relax yourself</em>.</p>
<p>The “framework” demonstrated at MIX is roughly 500 lines (says Rob … I haven’t checked yet &lt;grin/&gt;). It’s based on Caliburn but stripped to essentials that Rob covered in an easy-to-follow, leisurely, one hour code-walk.</p>
<p>Highlights:</p>
<ul>
<li>Simple MVVM
<ul>
<li>&quot;VM first&quot; in the sense that VM is in the driver&#8217;s seat. </li>
<li>No impediment to &quot;View first&quot; in the sense of view-design drives VM-design. </li>
</ul>
</li>
<li>Simple naming conventions eliminate tedious code and XAML </li>
<li>Configuration at-the-ready when conventions fail </li>
<li>No code-behind … and didn’t miss it </li>
<li>No behaviors … and didn’t miss them (not that they’d be bad) </li>
<li>No XAML data binding; debuggable bindings created at runtime </li>
<li>No drag-and-drop binding … and didn’t miss it </li>
<li>No ICommand implementations and no event handlers </li>
<li>No files over 150 lines (as I remember) </li>
<li>Cool co-routines for programming a sequence of sync and async tasks; no call backs in the ViewModel </li>
<li>Screen Conductor pattern in play </li>
</ul>
<p>All that in one hour.</p>
<p>The “co-routine” trick alone is worth your time. You almost get F# “bang” syntax in C#.</p>
<p>It could get more complicated in your app … and you’d have Caliburn. But it might not&#160; … and you’d be living large with dead-simple, DRY code.</p>
<p>One of the best sessions ever.</p>
<p>If only we could teach Rob to emote. The guy is passionate on the subject but you might miss it behind that mono-tone voice of his. A <a href="http://movies.msn.com/celebrities/celebrity/jim-carrey/" target="_blank">Jim Carrey</a> he is not. You want entertainment? Look elsewhere. You want substance … tune in.</p>
<p>He got a big ovation, by-the-by, so it ain’t just me who liked it.</p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/wardbell/category/mvvm/" title="View all posts in MVVM" rel="category">MVVM</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/wardbell/2010/03/20/rob-e-s-mini-mvvm-framework-mix10/#comments" title="Comment on Rob E’s Mini-MVVM Framework @ MIX10">2 Comments</a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-9 -->

		
						
			<div id="post-8" class="post-8 post type-post status-publish format-standard hentry category-mvvm">
			<h2 class="entry-title"><a href="http://codebetter.com/wardbell/2010/03/19/mvvm-josh-smith-s-way/" title="Permalink to MVVM, Josh Smith’s Way" rel="bookmark">MVVM, Josh Smith’s Way</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/wardbell/2010/03/19/mvvm-josh-smith-s-way/" title="7:24 pm" rel="bookmark"><span class="entry-date">March 19, 2010</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/wardbell" title="View all posts by wardbell">wardbell</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>I&rsquo;ve long admired <a target="_blank" href="http://joshsmithonwpf.wordpress.com/">Josh Smith</a>&rsquo;s work. He&rsquo;s one of the best explainers on the web and he &ndash; together with Karl Shifflett and Andrew Smith &#8211; gave us <a target="_blank" href="http://joshsmithonwpf.wordpress.com/mole/">Mole</a>, the superb WPF Visual Studio debugger visualizer.</p>
<p>I heard recently that he&rsquo;d published an e-book on Model-View-ViewModel (MVVM). I met him for the first time at the Microsoft MVP Summit last week and he graciously handed me a printed copy. I devoured it on the plane home and spent the next day playing with the code and preparing this review. </p>
<p>It&rsquo;s called &ldquo;<strong>Advanced MVVM</strong>&rdquo; and you can buy a <a target="_blank" href="http://www.lulu.com/content/paperback-book/advanced-mvvm-(hard-copy)/8353355">printed copy</a> for $20 or get it for $15 <a target="_blank" href="http://www.amazon.com/Advanced-MVVM-ebook/dp/B0038KX9FW">on the Kindle</a>. The companion code is freely available at <a href="http://AdvancedMvvm.com">AdvancedMvvm.com</a> .</p>
<p><strong>$15 bucks for a 52 page &ldquo;book&rdquo;?</strong> It&rsquo;s more of an extended essay to be honest &hellip; an essay with code. After spending some pleasurable hours with both book and code I thought &ldquo;<em>where do you get that kind of entertainment / self-reflection for $15?</em>&rdquo; I have a surfeit of 600 page sleepers lounging on my bookshelf at home; paid more then $50 for each and hardly cracked them. Should we pay by the pound? So I&rsquo;m over it. I don&rsquo;t mind paying for the hours Josh poured in and the fun I got out. Set your expectations appropriately and you&rsquo;ll feel fine.</p>
<p>&#8212;- 19 March 2010 Note &#8212;</p>
<p>Ok, it&rsquo;s been a month or so since I wrote this. Life happens while you&rsquo;re making plans. I intended to be among the first to comment on it. I&rsquo;m late to that party (although I have deliberately NOT looked at what others may have said) so I&rsquo;m not sure if it&rsquo;s still timely. I also shared it with Josh last week to see if I had missed something and get his feedback, particularly in light of my critical remarks.</p>
<p>He encouraged me to publish it even at this late date. I hope he&rsquo;ll repost here some of his responses to the points I raised.</p>
<p>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-</p>
<p>MVVM has spooked a lot of developers. There&rsquo;s more than a whiff of <a target="_blank" href="http://www.joelonsoftware.com/articles/fog0000000018.html">astronaut architecture</a> about it. There have to be at least 20 MVVM frameworks and no end of contentious arguments to confound and distress you. No wonder so many are put off.</p>
<h3>MVVM in a Nutshell</h3>
<p>In fact MVVM is fundamentally a simple idea. It starts with the realization that your application is an intractable mess in part because you dumped all of your UI logic into the code-behind &hellip; with the help of Microsoft tools. You discover the wisdom of pulling much of that logic out into a companion class (and some helpers) leaving the view class to concentrate on looking pretty and capturing user gestures. The view and its companion must talk; you can structure their conversation according to a variety of familiar patterns. Model-View-ViewModel is one such pattern.</p>
<p>The predominance of automated binding is the hallmark of MVVM. You bind a View&rsquo;s textbox to a string-providing property of the ViewModel so that a user&rsquo;s changes in the textbox flow to the property and so that programmatic changes to the ViewModel property flow back to the textbox. You bind View events (e.g., button click) to event handlers in the ViewModel enabling user gestures to be conveyed to the ViewModel.</p>
<p>You could write your own bindings by hand, pushing and pulling data and events with custom code. That&rsquo;s a lot of work. The XAML-based client technologies (WPF and Silverlight) provide a binding framework that requires little to no custom coding. In most cases you can &ldquo;connect the dots&rdquo; declaratively and it just works.</p>
<p>Now the View concentrates on appearance and the ViewModel feeds the view. This separation is both clarifying and liberating. You can start looking at that ViewModel to figure out what it should do and how it should do it without also worrying about the visuals. The subsequent examination of ViewModel&rsquo;s more limited responsibilities sets you on a more sustainable course. At least this has been my experience &hellip; and that of the hundreds (thousands?) of other developers who&rsquo;ve adopted this pattern.</p>
<p>Now you&rsquo;ll note that I said it &ldquo;sets you on course&rdquo;; I did not say it delivers you to the promised land. There are details to work out. If the View looks to the ViewModel for data, where does the ViewModel get that data? Are we talking about data values alone or the business rules that surround that data, rules about data validity, integrity, security, and persistence?</p>
<p>Many of us draw a circle around these concerns and call that circle &ldquo;the Model&rdquo;, the third element in the MVVM triad. Our guiding intuition is this: &ldquo;the persistent data are definitely in the model and if the rules about data are true for this and every possible UI, the rules belong in the model as well.&rdquo;</p>
<p>If the last name is required, it is required everywhere; that&rsquo;s a model rule. If gold customers can select from several thank-you gifts, that sounds like UI logic to me &hellip; and belongs in the ViewModel. The specifics have to be worked out.</p>
<h3>Back To Josh</h3>
<p>At this point the discussion risks slipping into theory and theater. We could run to the white board, scribble madly, and count angels on pins without writing a line of code. I love doing that.</p>
<p>Josh has taken another direction which is likely to be both more popular and more effective. He briefly presents his take on MVVM in clear, accessible prose &hellip; and then makes it tangible with an extended exploration of a meaty sample application. I&rsquo;ve read plenty of pattern papers; I don&rsquo;t remember any that were so thorough &hellip; and entertaining &hellip; in their examples. </p>
<p>For style and substance this is a remarkable achievement. I truly hope that Josh&rsquo;s book is widely read because I think it has a better chance of helping WPF and Silverlight developers feel comfortable about MVVM than anything else I&rsquo;ve seen. </p>
<p>I&rsquo;m a little worried that some will fear the word &ldquo;Advanced&rdquo; in the title. The term &ldquo;MVVM&rdquo; is forbidding enough and many folks are still looking for the introduction. I think this book is the introduction they really need. </p>
<p>In what sense is it &ldquo;advanced&rdquo;? It&rsquo;s far from the last word on the subject. It won&rsquo;t settle any arguments (least of all mine). But it does rise above the introductory level in two important respects. </p>
<p>First, it considers the implications of multiple, cooperating MVVM instances. Most MVVM articles present a single MVVM-triad: a single View and its companion ViewModel and Model. </p>
<p>No application needs a single MVVM triad. If you have a one-screen application, don&rsquo;t use MVVM; it&rsquo;s overkill. MVVM is for multi-screen applications consisting of multiple MVVM triads which spring to life somehow and somehow interoperate.</p>
<p>Second, as I noted earlier, Josh doesn&rsquo;t just talk about the pattern. Most of the pages describe the accompanying game, <strong>BubbleBurst</strong>, which is implemented in MVVM style. Instead of paeans to principles and their wondrous benefits, you see MVVM in action, warts and all. </p>
<p>BubbleBurst is &ldquo;advanced&rdquo; enough to both introduce MVVM and reveal important implementation challenges of multi-MVVM applications. Yet it&rsquo;s simple enough to be easily understood in the pages of a book or in a few hours spent trolling the code. It&rsquo;s also fun to play.</p>
<h3>Proceed with Caution</h3>
<p>I&rsquo;m about to begin my critical remarks. Before I do, I want to reemphasize my enthusiasm for what Josh has accomplished. This book is a wonderful place to begin your MVVM journey and I found it to be an enjoyable and insightful read. So, hell-yes, I&rsquo;m recommending it.</p>
<p>On the other hand, it would be a shame if developers stopped their education here. Important elements of the story are missing and many recommendations are seriously misguided in my view. Readers should take Josh seriously but, once they are comfortable with the pattern, they should become aware of starkly contrasting perspectives as well.</p>
<h3>Critical Omissions</h3>
<p>Four vital topics are neither covered nor illustrated in the <a target="_blank" href="http://bubbleburst.codeplex.com/">code</a>:</p>
<ul>
<li>Testing </li>
<li>Model (the first &lsquo;M&rsquo; in MVVM) </li>
<li>Dependency Injection </li>
<li>Event Aggregation </li>
</ul>
<h4>Testing</h4>
<p>Josh asks &ldquo;<em>What is the point of having ViewModels?</em>&rdquo; First among his reasons: &ldquo;<em>the ability to easily write unit and integration tests for the functionality of the user interface without having to get into the messy world of writing tests for live UIs.</em>&rdquo;</p>
<p>That&rsquo;s the last we hear of testing. There is not a single test in the code base. If testing is as important as he says, I&rsquo;d expect a thorough treatment starting with building a test regimen and showing, by example, how to write good tests. Instead, we get lip service.</p>
<p>I don&rsquo;t think testability is the only value of MVVM. I couldn&rsquo;t recommend it for this reason alone. MVVM is a significant architectural investment that introduces complexity. I wouldn&rsquo;t incur that complexity cost merely to make my UI testable. I&rsquo;d look for a less onerous route. Fortunately, I think it has other benefits such as clean separation of concerns, improved readability, and easier debugging (try break-pointing XAML!).</p>
<p>But testability is both a motivation for and a by-product of MVVM style and it should have been covered thoroughly in an &ldquo;advanced&rdquo; treatise on MVVM.</p>
<p>Moreover, the design would have benefitted greatly from attempts to test it. Many lines of view code-behind are both untestable and harder to follow than they should be. I see early signs of the spaghetti code that afflicts more complex and mature applications &hellip; a drum I&rsquo;ll beat furiously later in this review.</p>
<p>At almost 300 lines, the BubbleMatrixViewModel begs to be tested both for quality and to reveal the expectations latent in its 20+ public and internal members.</p>
<h4>The Missing Model</h4>
<p>The pattern is called <strong><em>Model</em></strong>-View-ViewModel. Josh&rsquo;s Model is nowhere to be found. Model and ViewModel are combined and it&rsquo;s not clear to me how one would disambiguate them.</p>
<p>The absence of Model isn&rsquo;t blatantly obvious in a simple game like BubbleBurst. The game doesn&rsquo;t to retrieve or save objects to a persistent store. We aren&rsquo;t expecting much in the way of business model logic either; there&rsquo;s nothing of interest to validate or secure. So the lack of a model is not a deep fault of this particular application. Indeed, it&rsquo;s a convenient way to concentrate our attention on the central issues for most students of MVVM:</p>
<ul>
<li>What code belongs in View and what code in ViewModel? </li>
<li>How do View and ViewModel interact? </li>
<li>How do you instantiate Views and ViewModels? </li>
</ul>
<p>Nonetheless, we can&rsquo;t pretend to provide a comprehensive guide to MVVP without talking about the Model and how it interacts with ViewModel and (to a lesser extent) View. A business application will demand a clear delineation of responsibilities and equally clear communication paths.</p>
<p>I&rsquo;m not letting BubbleBurst off the hook either. I felt on several occasions that some ViewModels were heavier and more complicated than they should be because an inchoate game model was not independently defined.</p>
<h4>Dependency Injection</h4>
<p>I appreciate that Dependency Injection frightens many developers. You can discover MVVM without learning about Dependency Injection. Josh can kind of get away without it as long as he doesn&rsquo;t test his ViewModels and doesn&rsquo;t have to think about the services required to manage a persistent model.</p>
<p>But I feel you can&rsquo;t call this &ldquo;Advanced MVVM&rdquo; &hellip; or even &ldquo;Intermediate MVVM&rdquo; &hellip; without introducing DI at some point. In Josh&rsquo;s application, every View and every ViewModel class is known to and instantiated by some other View or ViewModel class. That won&rsquo;t fly in real-world applications which have Views and ViewModels that are ignorant of each other.</p>
<p>The constructor of the BubbleMatrixViewModel instantiates three concrete bubble components: BubblesTaskManager, BubbleFactory, and BubbleGroup (twice) before making heavy use of them.&nbsp; That&rsquo;s a lot of dependencies that would make this ViewModel brittle and especially difficult to test.</p>
<p>Taking hard dependencies means Josh can freely assume that ViewModels will always have parameterless constructors and can always be instantiated in XAML, as he often does here. Someone new to MVVM might think this is the norm. It is not.</p>
<p>Josh himself alludes to DI as one of the avenues opened by the MVVM pattern: &ldquo;<em>[MVVM] means that you can use frameworks like MEF to dynamically compose your ViewModels, to easily support plug-in architectures &hellip;&rdquo;.</em> That&rsquo;s the last we hear of MEF or dynamic VM composition.</p>
<p>Again, I think we can ignore DI in an introduction to MVVM; we cannot ignore it in an advanced lesson on MVVM.</p>
<h4>Event Aggregation: communicating with the unknown</h4>
<p>All of Josh&rsquo;s MVVM triads are statically determined. Their relationships to each other are fixed and well known.</p>
<p>I was surprised to see a ViewModel for one view hold a reference to a ViewModel of a subordinate view. That&rsquo;s not how I do it; my general rule is that MVVM triads do not hold references to each other. I concede that the rule makes it difficult to organize cross-triad communication. Josh&rsquo;s approach is simple and elegant &hellip; when available.</p>
<p>In real-world business applications, the MVVM triads often can&rsquo;t know about each other. They are often defined in separate modules without mutual references. Views appear and disappear dynamically. Direct communication is frequently impossible.</p>
<p>That&rsquo;s why so many so-called MVVM frameworks include some kind of messaging or <a target="_blank" href="http://www.martinfowler.com/eaaDev/EventAggregator.html">Event Aggregation</a> infrastructure. You don&rsquo;t need them to understand MVVM triads in isolation. But you never see an application with a single MVVM triad and you rarely find an MVVM application with statically determined, session-permanent views. No &ldquo;advanced&rdquo; treatment of MVVM can neglect Event Aggregation.</p>
<h3>View First or ViewModel First?</h3>
<p>Here&rsquo;s an incendiary topic Josh leaves untouched.</p>
<p>I see two ways to ask this question:</p>
<ul>
<li>Do I <strong><em>design</em></strong> the View first or the ViewModel first? </li>
<li>Do I <strong><em>instantiate</em></strong> the View first or the ViewModel first (or does something else instantiate and wed them)? </li>
</ul>
<p>The answer to both questions need not be the same. For example, you could decide to <strong><em>design</em></strong> the ViewModel first and let the View <strong><em>instantiate</em></strong> that VM at runtime. This is plausibly the approach advocated in BubbleBurst although Josh never talks about it.</p>
<p>Again, it&rsquo;s important that readers new to MVVM learn that Josh&rsquo;s way is not the only way.</p>
<h4>View and ViewModel Design</h4>
<p>In my experience there is a &ldquo;dialog&rdquo; between View and ViewModel design. The VM exists to serve a view even as it strives for independence from any particular concrete view. A VM is useless if&nbsp; there is no view that will work with it; clearly the VM developer must heed the imprecations of the View developer.</p>
<p>On the other hand, in business applications the application&rsquo;s imperatives &ndash; what the view must do to satisfy business requirements &ndash; are the province of the programmer and are best articulated through the capabilities of the ViewModel. </p>
<p>Therein lies the necessary tension between View and ViewModel design. As a developer my allegiance is with the ViewModel (&ldquo;the application should do something worthwhile&rdquo;) but it would be silly to defend that allegiance at the expense of the View (&ldquo;a good UX is essential to making an application easy to learn and to use&rdquo;).</p>
<p>I&rsquo;d have liked to see this tension at least acknowledged and perhaps explored.</p>
<h4>Who begets Whom?</h4>
<p>Runtime construction is a question apart from the matter of who drives the design. WPF and Silverlight tooling push you toward &ldquo;View First&rdquo; construction in which the View instantiates the ViewModel. You&rsquo;ll often see the View&rsquo;s DataContext set by a ViewModel instantiated in the XAML as shown here:</p>
<pre>&nbsp; &lt;UserControl.DataContext&gt;&nbsp;&nbsp;&nbsp;&nbsp; &lt;viewModel:<strong>BubbleBurstViewModel</strong> /&gt;&nbsp; &lt;/UserControl.DataContext&gt;</pre>
<p>Contrast this with the ViewModel first, code-based approach (not seen in BubbleBurst) in which the ViewModel is assigned to the View&rsquo;s DataContext as follows:</p>
<pre> view.DataContext = viewModel;</pre>
<p>The View First approach assumes that the ViewModel can be created via a default, parameterless constructor. That&rsquo;s fine for BubbleBurst but wholly unrealistic in business applications whose ViewModels have dependencies (e.g., on the domain model).</p>
<p>Neither WPF nor Silverlight XAML support the dependency injection mechanisms that many of us prefer. I wish Josh had talked about this and perhaps discussed the interesting attempts to use MEF dependency injection (via properties rather than constructor arguments)</p>
<p>I&rsquo;m not trying to settle these questions. I am saying these questions could have been called out in an &ldquo;advanced&rdquo; book on MVVM patterns.</p>
<h3>What Belongs In Code-Behind?</h3>
<p>Do we allow or prohibit code-behind? That&rsquo;s a fist-fight topic. Josh looks for a Goldilocks solution, suggesting the amount of code-behind is just right if confined to &ldquo;logic scoped to the view&rdquo;.</p>
<p>Such guidance is far too loose in my opinion. It&rsquo;s not effective guidance at all.</p>
<p>We choose presentation separation patterns in part because we want to minimize testing of the view. We should test any custom logic we write &ndash; no matter how it is scoped. The poverty of our testing tools means that, in practice, we will not test the code in the view. Therefore, any code in the code-behind is suspect.</p>
<p>I am open to some code in the code-behind; the &ldquo;InitializeComponent&rdquo; method is inescapable. I&rsquo;ll accept a minimum of &ldquo;switch board&rdquo; code in the code behind; direct wiring to a ViewModel member is ok in small doses.</p>
<p>I draw the line at decision logic. I smell a rat when I see a conditional statement of any kind. That&rsquo;s where bugs breed. Conditional logic is code we should be testing.</p>
<p>I much prefer this rule: &ldquo;<strong>No conditional logic in the code-behind</strong>&rdquo;. </p>
<p>That&rsquo;s unambiguous. We don&rsquo;t have to wonder what &ldquo;<em>scope of the view</em>&rdquo; means. If there&rsquo;s an &ldquo;if&rdquo; or a &ldquo;switch&rdquo; statement, something is wrong. You can detect a violation with automation or visual inspection. It&rsquo;s a rule that&rsquo;s easy to follow and pretty easy to abide by &hellip; when you know how.</p>
<p>What happens when you don&rsquo;t follow this rule? You&rsquo;re lured into the kind of dodgy code that &hellip; well we see in the innocent seeming BubbleMatrixView.xaml.cs.</p>
<p>In fact, far from being &ldquo;best practices&rdquo;, I&rsquo;d say that the View code in BubbleBurst represents some of the worst practices.</p>
<p>Look at the HandleMatrixDimensionsAvailable method. This event handler is wired to a UI element in the BubbleBurstView. Unfortunately, the UI element happens to be in a different view, the BubbleMatrixView! One view&rsquo;s code-behind is wired to members of another view; that&rsquo;s the road to perdition. That would never pass my review.</p>
<p>I wanted to clean it up immediately. I tried to find the intention behind this practice. Usually I look to the name of a method to discover its purpose. Unfortunately the handler is named for the moment when it is called (&ldquo;Matrix dimensions available&rdquo;) rather than for what it does. That&rsquo;s conventional naming for event handlers but not terribly informative. Unless a handler is brain-dead-simple, I have it delegate immediately to methods with meaningful names. The handler tells me when something happens; the inner method tells me what will be done.</p>
<p>Had Josh adopted my suggestion, he&rsquo;d have realized that his handler has multiple responsibilities:</p>
<ul>
<li>wires the outer window&rsquo;s keydown event </li>
<li>picks up the dimensions of the related view&rsquo;s grid </li>
<li>starts the game </li>
</ul>
<p>That&rsquo;s too much work for code-behind in my book.</p>
<p>When we strive to apply the &ldquo;<em>no conditional logic in the code-behind</em>&rdquo; rule, we discover other design problems.</p>
<p>It appears that Undo logic is distributed between two ViewModels. One of them, the BubbleBurstViewModel, determines if undo is possible while the second, BubbleMatrixViewModel performs the undo. Probe further and we find that even the BubbleBurstViewModel test for undo-ability is delegated back to the BubbleMatrixViewModel. The ping-ponging among Views and ViewModels is confusing; it doesn&rsquo;t smell right.</p>
<p>All the signs suggest the real action is in BubbleMatrixView and its ViewModel.</p>
<p>BubbleMatrixView.xaml is short and sweet.The code-behind in BubbleMatrixView.xaml.cs is another story. Five Region tags sound the alarm. You shouldn&rsquo;t need region tags in code-behind. Here they barely disguise the complexity of 145 lines of code-behind. That can&rsquo;t be right.</p>
<h3>MicroControllers: BubblesTaskPresenter Example</h3>
<p>I was able to refactor the 53 lines dedicated to animating bubble tasks. Most of them went to a BubblesTaskPresenter class, a component Jeremy Miller calls the &ldquo;<a target="_blank" href="/blogs/jeremy.miller/archive/2007/10/21/build-your-own-cab-15-microcontrollers.aspx">MicroController</a>&rdquo;.</p>
<p>Every MVVM developer should become familiar with the &ldquo;MicroController&rdquo; approach.</p>
<p>A &ldquo;MicroController&rdquo; performs a narrow UI task on behalf of a view. We usually write one to encapsulate UI logic that is reused across multiple views. That&rsquo;s not the case here; the application is too small.</p>
<p>We also write MicroControllers to encapsulate UI-specific functionality in a UI-agnostic wrapper. They make it easy for non-UI components, such as ViewModels, to invoke the UI-specific behavior we find in Views. That&rsquo;s what we need here.</p>
<p>I noticed that the ViewModel holds a TaskManager which raises a PendingTasksAvailable event when there are bubble display tasks. This sets off a sequence of calls between View and ViewModel which collectively &ldquo;process tasks&rdquo; queued up by the ViewModel.</p>
<p>Josh&rsquo;s original code forwarded the event to the View&rsquo;s code-behind. That code-behind then extracted the VM&rsquo;s TaskManager and called into it. 53 lines of code-behind are dedicated to this entire process.</p>
<p>After my revision, the view merely provides the ViewModel with a configured MicroController, here called a &ldquo;BubblesTaskPresenter&rdquo;:</p>
<pre> _bubbleMatrix.BubblesTaskPresenter = new BubblesTaskPresenter(_bubbleCanvas);</pre>
<p>This is what switchboard code should look like. I&rsquo;d like to get rid of the instantiation but at least there is a bare minimum of logic and no conditionals.</p>
<p>The ViewModel receives the concrete presenter in the guise of a UI-agnostic interface, IBubblesTaskPresenter and wires itself to the presenter&rsquo;s events.</p>
<pre>&nbsp;&nbsp;&nbsp; public IBubblesTaskPresenter BubblesTaskPresenter {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get { return _bubblesTaskPresenter;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _bubblesTaskPresenter = value;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _bubblesTaskPresenter.Completed += delegate { ProcessTasks(); };&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TaskManager.PendingTasksAvailable += delegate { ProcessTasks(); };&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp; }</pre>
<pre>&nbsp;&nbsp;&nbsp; private void ProcessTasks() {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var task = TaskManager.GetPendingTask();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BubblesTaskPresenter.PresentTask(task);&nbsp;&nbsp;&nbsp; }</pre>
<p>IBubblesTaskPresenter uses simple .NET types and looks like this:</p>
<pre>&nbsp; /// &lt;summary&gt;   /// Interface for a presenter of &lt;see cref="BubblesTask"/&gt;  /// &lt;/summary&gt;&nbsp;&nbsp;   public interface IBubblesTaskPresenter {&nbsp;&nbsp;&nbsp;&nbsp; void PresentTask(BubblesTask task);&nbsp;&nbsp;&nbsp;&nbsp; event EventHandler Completed; }</pre>
<p>Where did the 53 lines of code-behind go? Into the BubblesTaskPresenter.</p>
<p>What has been gained? Did I just hide the pea under another untestable cup called a &ldquo;presenter&rdquo;? Is this merely an academic exercise?</p>
<p>I don&rsquo;t think so. True, the presenter is dependent upon WPF and upon BubbleCanvas in particular. But it could be tested with a faked canvas and a faked factory. Testing aside, it&rsquo;s small and focused; it&rsquo;s easy to see what it does and how it works. It won&rsquo;t get lost amidst the other motions of the BubbleMatrixView. We might someday use it in another view that presented BubblesTasks.</p>
<p>The BubbleMatrixViewModel has grown a few lines but remains readable and testable; its imported IBubblesTaskPresenter is easy to fake.</p>
<p>The ViewModel no longer exposes the TaskManager. That&rsquo;s a good thing because the TaskManager is pretty complex piece of machinery with a rich API. We don&rsquo;t want the View or BubblesTaskPresenter to know about it.</p>
<p>And the View is 53 lines lighter, reducing the anxiety we might justifiably feel if we handed it over to a non-programming designer for styling.</p>
<p><strong>Homework Assignment</strong>: if you&rsquo;re playing along and are looking toward your own application design, you might want to linger over the BubblesTaskPresenter. It is specific to bubbles right now &hellip; which is appropriate in the absence of forces that would drive us to generalization. </p>
<p>But you can encapsulate storyboard animations in much this way to both determine state changes within the ViewModel and externalize the animations in &ldquo;View-space&rdquo; where they belong. Josh is spot-on when he insists on this separation. The MicroController &ldquo;presenter&rdquo; approach is one way to achieve that separation without polluting the code-behind.</p>
<p>Aside: my first presenter was more abstract and general purpose. My generalization was premature. Generalization made the code more complex than it needed to be in this application. I un-factored it to the current version that knows about BubbleCanvas and BubblesTaskStoryboardFactory.</p>
<h3>Views Shouldn&rsquo;t Talk To Views</h3>
<p>After clearing out the 53 lines, I was able to focus on what&rsquo;s left.</p>
<p>I was deeply troubled by the properties of BubbleMatrixView that are exposed to and consumed by the BubbleBurstView code-behind. That can&rsquo;t be right. Views shouldn&rsquo;t need custom properties. </p>
<p>If you have to expose a custom view member, you should do so through a view interface. We don&rsquo;t want any code &ndash; View or ViewModel &ndash; depending upon a concrete view class. That&rsquo;s asking for trouble and flies in the face of the testability which justifies MVVM.</p>
<p>It&rsquo;s also completely unnecessary in this application. As noted earlier the event loop from inner BubbleMatrixView to outer BubbleBurstView leads back around to BubbleMatrixView&rsquo;s ViewModel. We can cut all that nonsense out and simply update the BubbleMatrixViewModel directly in the code-behind &hellip; without any conditional logic.</p>
<p>I refactored as follows:</p>
<ul>
<li>Removed 30 lines from BubbleBurstView code-behind </li>
<li>Added &ldquo;StartTheGame&rdquo; to BubbleMatrixViewModel; it combines the functions of setting the dimensions (now private) and starting a new game. </li>
<li>Removed 61 lines from BubbleMatrixView code-behind which now calls StartTheGame when the canvas is loaded. Region tags are gone. </li>
</ul>
<p>The BubbleMatrixView code-behind is now a trim 30 lines with no conditionals, down from 145 (80% reduction). Of the 30, exactly 5 of them do work.</p>
<p>My cleanup involved eliminating several null checks. They never did anything useful. First, the variables could not be null in practice. Second, even if they were (e.g., someone broke the xaml), the application would not have functioned anyway. I don&rsquo;t think a blank screen is superior to an exception. The null checks were about as helpful as empty catch blocks.</p>
<h3>Tidy-up BubbleBurstView Code-Behind</h3>
<p>BubbleBurstView&rsquo;s code-behind had one remaining &ldquo;if&rdquo; and some other code that I felt didn&rsquo;t belong there.</p>
<p>Key monitoring logic contained an &ldquo;if&rdquo; statement. At first it seemed like key monitoring was a candidate for another MicroController. But there is only one key to handle, the key for Undo. That wasn&rsquo;t worth the overhead of another MicroController component. Instead I decided to enrich the BubbleBurstViewModel with an Undo method whose signature is:</p>
<pre>  public bool TryUndo(bool shouldTry) // returns True if undid</pre>
<p>The code-behind calculates whether the key presses amount to an undo request. The call is:</p>
<pre>  e.Handled |= _bubbleBurst.TryUndo(isUndoKey);</pre>
<p>I don&rsquo;t like the isUndoKey calculation but I&rsquo;ll leave it for another day.</p>
<p>My final bug-a-boo is the LoadBubbleViewResources method which instantiates a ResourceDictionary and plugs it into the application-level resources. </p>
<p>I expected this to be loaded by the App.xaml itself but I suspect Josh wants to simulate the notion that independent assemblies have their own resources. While the &ldquo;Bubble.View&rdquo; assembly is not independent &ndash; the App.xaml has access to it through its host assembly&rsquo;s references &ndash;, I&rsquo;ll play along.</p>
<p>In any case, the view&rsquo;s code-behind shouldn&rsquo;t know the details of ResourceDictionary construction and App.Resources update. Time for a MicroController: &ldquo;BubbleViewResourceLoader&rdquo; which we can invoke from within the code-behind&rsquo;s constructor for now. It still stinks but it stinks less.</p>
<p>The code-behind now stands at 41 lines, down from the original 86; only 9 of them do work.</p>
<h3>Picky, Picky</h3>
<p>I&rsquo;m a restless complainer. I&rsquo;ve got a few more bones to pick having nothing to do with MVVM.</p>
<p>Page numbers! You may have noticed that my citations lacked page numbers. That&rsquo;s because there aren&rsquo;t any in the printed document I&rsquo;m reading.</p>
<p>The abundance of Region tags annoys me. Hey, I use them too, especially in pedagogical code where I want to unveil new ideas didactically in the course of a presentation.</p>
<p>I appreciate that they seem to organize the code into nice buckets: &ldquo;constructors&rdquo;, &ldquo;methods&rdquo;, &ldquo;fields&rdquo;. But lately I&rsquo;ve come to believe that they&rsquo;re more of a code smell.</p>
<p>If the class is short &ndash; as it should be &ndash; they interfere with my ability to read and grasp the class at a glance. If the class is long, they suggest that my class implements too many distinct concerns and I&rsquo;m struggling &ndash; vainly &ndash; to keep them organized. These concerns would be better delegated to supporting classes. I suspect that automated testing would make this defect more obvious.</p>
<p>I&rsquo;m not thrilled with the data triggers. Data triggers are not available to Silverlight programmers probably for good reason. The Visual State Manager is the preferred choice for both WPF and Silverlight.</p>
<p>A particularly egregious data trigger can be found in BubbleBurstView.xaml where the GameOverView is collapsed when the BubbleBurstViewModel&rsquo;s GameOverViewModel is null. Could there be a more obscure way to signal that a modal dialog should be hidden? I suspect a bound IsGameOver property would be both simpler and more obvious.</p>
<h3>Where&rsquo;s The Code?</h3>
<p>Josh&rsquo;s original source is at <a target="_blank" href="http://advancedmvvm.com/">AdvancedMvvm.com</a> . I&rsquo;ve temporarily posted my refactored version <a target="_blank" href="http://www.ideablade.com/WardsBlog/JoshSmithBubbleBurst.ward.v2.zip">on my site</a>. I&rsquo;m not promising it will stay there- this <strong>is Josh&rsquo;s code</strong> and I&rsquo;ll do whatever he wants me to do with it (including burn it) &ndash; but it&rsquo;s there now and I&rsquo;ll let you know if I move it.</p>
<h3>Wrap Up</h3>
<p>I have high hopes for the conversation Josh has started with this book.</p>
<p>I see it as one place to begin your study of MVVM rather than as the definitive work on the subject. Some of the practices I find dubious and there are serious omissions. </p>
<p>But I gave it this much attention because it deserves it. It&rsquo;s a fine piece of writing, a carefully considered example, and a push in the right direction. Josh speaks to a broad audience with an authentic voice they understand and respect. He has my respect as well.</p>
<p>It&rsquo;s well worth the $15 bucks <a target="_blank" href="http://www.amazon.com/Advanced-MVVM-ebook/dp/B0038KX9FW">on the Kindle</a>.</p>
<p>Enjoy!</p>
<p>p.s.: Cross-posted to my other blog, &#8220;<a href="http://neverindoubtnet.blogspot.com/2010/03/mvvm-josh-smiths-way.html">Never In Doubt</a>&#8220;</p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/wardbell/category/mvvm/" title="View all posts in MVVM" rel="category">MVVM</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/wardbell/2010/03/19/mvvm-josh-smith-s-way/#comments" title="Comment on MVVM, Josh Smith’s Way">8 Comments</a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-8 -->

		
						
			<div id="post-6" class="post-6 post type-post status-publish format-standard hentry category-uncategorized">
			<h2 class="entry-title"><a href="http://codebetter.com/wardbell/2010/01/01/an-ioc-agnostic-prism-bootstrapper/" title="Permalink to An IoC-Agnostic Prism Bootstrapper" rel="bookmark">An IoC-Agnostic Prism Bootstrapper</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/wardbell/2010/01/01/an-ioc-agnostic-prism-bootstrapper/" title="4:54 am" rel="bookmark"><span class="entry-date">January 1, 2010</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/wardbell" title="View all posts by wardbell">wardbell</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p><a href="http://www.codeplex.com/prism">Prism</a> from Microsoft Patterns &amp; Practices leans on an <a href="http://en.wikipedia.org/wiki/Inversion_of_control">Inversion of Control (IoC)</a> container. While nominally indifferent to your choice of container, you have to work a bit to extricate yourself from its default choice which is <a href="http://www.codeplex.com/unity">Microsoft Unity</a>. More so with some containers than others.</p>
<p>The sweat and tears flow in the “Bootstrapper” class with which you launch your application. Most Prism samples feature a Bootstrapper that inherits from “UnityBootstrapper”. “UnityBootstrapper” busies itself with registering and configuring a dozen or so Prism components in a manner characteristic of Unity and it unapologetically takes a hard dependence on Unity itself. You are welcome to write your own Bootstrapper base class from scratch; of course this entails reading and understanding what “UnityBootstrapper” does so you can reassure yourself that your replacement achieves the same effects. Who has time for that?</p>
<p>Almost a year ago I found myself writing a single application with three different client technologies, each dependent upon its own container. The three diverged in minor details – each was a different incarnation of a Container + ObjectBuilder – but the differences were sufficiently great that I felt compelled to unleash the Prism base bootstrapper class from its Unity chains.</p>
<p>Preoccupied with more important business, I took the most expeditious route. I salvaged as much of Prism’s UnityBootstrapper as I could while replacing its direct dependency on Unity library references. </p>
<p>Prism initialization is not something I want to own. When P&amp;P updates its UnityBootstrapper, I want a quick, no-thought pathway to update my IoC-agnostic version.</p>
<p>The result was Cal.Bootstrapper (“CAL” is short for “Composite Application Library”, Prism’s official name) and some supporting types. Cal.Bootstrapper looks like a cleaned-up UnityBootstrapper. It goes through the same motions of registering types and configuring instances albeit with reference to a denuded IoC, shorn of all but the most minimal functionality. This, dear reader, will be my gift to you.</p>
<p>Recently, a few folks have wondered about replacing Unity with a completely different IoC container. The one I hear most often is <a href="http://structuremap.sourceforge.net/Default.htm" target="_blank">StructureMap</a>. Its author, <a href="http://codebetter.com/blogs/jeremy.miller/" target="_blank">Jeremy Miller</a>, has several times entertained the notion of replacing “UnityBootstrapper” with something that reflects glory on StructureMap. Apparently he has better things to do. I guess I’ll tackle it.</p>
<h3>The Goods</h3>
<p>I’ve bundled everything described in this post into a 2 meg zip, <a href="http://www.ideablade.com/WardsBlog/PrismRI-Ioc.zip" target="_blank">PrismRI-Ioc.zip</a>, downloadable from my company website. Do with it as you will.</p>
<p><strong>Please note: I have no intention of maintaining this; don’t even ask.</strong></p>
<h3>No, This is Not the Right Way</h3>
<p>My knowledge of StructureMap is deeply impoverished but, from the little I do know, I’m certain that the “proper” course is to abandon “UnityBootstrapper” altogether. But there’s a reason Jeremy hasn’t tackled this and no one seems to have done so for other IoC products either.</p>
<p>Nicholas Blumhardt, author of Autofac, took a crack at integrating Prism with his IoC back in August, 2009. He wanted to do it “the right way,” completely rethinking how a Prism app is bootstrapped and how application modules are written. He describes it <a href="http://code.google.com/p/autofac/wiki/PrismIntegration" target="_blank">here</a> as a “work-in-progress”. I guess it took a little more work than he thought it would and he must have found something better to do because it doesn’t look like he finished.</p>
<p>I hoped to avoid this “road to good intentions” by doing it the “the easy way” which may be the “wrong way” but it works … which beats something that doesn’t.</p>
<p>I decided to change as little of the Unity-oriented Prism app approach as I could. I want to get something done. I want you to be able to convert your running Prism app with minimal effort.</p>
<p>Accordingly, my “Cal.Bootstrapper” mimics the “UnityBootstrapper” and it wallows in the style and ceremony that other IoC products despise.</p>
<p>Is it all that bad? Why am I changing my IoC container anyway? I ought to have a clear idea about what I want from an alternative to Unity. I’m wasting my time if I’m only replacing the UnityBootstrapper with something “better”. Frankly, I don’t care how Prism configures its minimal requirements. If I want StructureMap (or AutoFaq, Castle Windsor, Ninject, etc), it is because I prefer that IoC for registering and configuring <strong><em>my own application components</em></strong>. I may replace the Prism configuration eventually but right now that is neither my motivation nor my first step.</p>
<p>Therefore, although my Cal.Bootstrapper is ugly as sin, it will serve me for the nonce as I hope it serves you and I shall proceed to describe it without further apology. I will let it configure Prism the ugly way using my IoC container in place of Unity after which I am free in my own code to drive my IoC container as it was meant to be driven.</p>
<h3>Battle Plan</h3>
<p>A Prism application has a Bootstrapper class to configure the container, create and configure the main UI view called the “shell”, acquire application modules, and launch the application.</p>
<p>You are expected to write a custom Bootstrapper that inherits from a base Bootstrapper class provided by Prism (the aforementioned UnityBootstrapper). This base class handles the above inventory of start-up tasks. Your derived Bootstrapper is supposed to extend the base class by overriding certain abstract and virtual methods.</p>
<p>In other words, the bootstrapper is launch karaoke. You add your voice at predefined moments. It’s great if the music suits you. If you’re singing off key, you’re should stop faking it and write your own song.</p>
<p>Tempted as I was, I chose not to quarrel with this approach. In fact, I took a deep breath and then embraced it … for the reasons discussed above. </p>
<p>I decided to replace the UnityBoostrapper with an alternative base class (Cal.Bootstrapper) that does not know about Unity.</p>
<p>Your derived Bootstrapper will provide an IoC container to this base class, wrapped in a vendor-neutral “ContainerAdapter, and delivered to the base class by overriding its abstract “CreateContainerAdapter” method.</p>
<p>I have a few additional goals:</p>
<ul>
<li>“Improve” the UnityBootstrapper so I can figure out what it does. </li>
<li>Make it easy to update my base class when (if) Microsoft updates the UnityBootstrapper. </li>
<li>Minimize the effort to get my existing app bootstrapper deriving fro the IoC-agnostic base class. </li>
<li>Minimize the changes necessary to convert my existing Unity-based Prism app. </li>
<li>“Prove it” with an app Prism-aficionados know: the Prism Reference Implementation. </li>
</ul>
<p>The original UnityBootstrapper is code only a mother could love. Long methods; much repetition; mysterious names. I can’t replace it until I understand what it does. My first step is to refactor it for readability. This is somewhat a matter of taste but I hope you’ll agree that the my revision, called “RefinedUnityBootstrapper”, is an improvement.</p>
<p>I mustn’t get carried away if I am to satisfy my second subsidiary goal. Too many improvements would hinder re-synchronization with Microsoft’s changes.</p>
<p>I want to prove that my approach works on an “application” that anyone can examine and that would be familiar to Prism developers. The Prism RI is the obvious candidate; that’s what I tackled.</p>
<p>I haven’t looked at the RI in a long time. The version on my disk dates from February 2009. That’s pre-Silverlight 3 and, although I had patched it for SL 3, it’s still old and funky. The UI doesn’t work the way it should: stock positions don’t change when you buy and sell, the “Watch List” feature is broken, the Silverlight version throws a recoverable exception when you sell more stock than you own.</p>
<p>But I didn’t have time to freshen it up, it was good enough for my purposes, and it’s all I’m going to give you.</p>
<h3>Swappable Versions</h3>
<p>This is a tutorial. I want you to be able to switch among different container implementations without changing the body of the application. I don’t have the time or the interest to do anything fancy.&#160; In the “real” world, I’d make the change and discard the original. </p>
<p>The version of the RI you run depends entirely upon the executing version of Prism RI Bootstrapper class. The class is divided into two partial class files. One of them is constant. The other holds just the code that varies from container to container. The file with variations is called StockTraderRIBootstrapper.Ioc.Desktop or StockTraderRIBootstrapper.Ioc.Silverlight.</p>
<p>The variations are governed by compiler directives at the top. You uncomment ONE of them, recompile, and let ‘er rip. The example below shows the bootstrapper readied for StructureMap.</p>
<p>//***************************************************************************    <br />// *** PICK YOUR BOOTSTRAPPER AND IOC CONTAINER WITH _ONE_ OF THESE DEFINES </p>
<p>//#define ORIGINAL_UNITYBOOTSTRAPPER    <br />//#define REFINED_UNITYBOOTSTRAPPER     <br />//#define UNITY_CONTAINER_ADAPTER     <br />#define STRUCTUREMAP_CONTAINER_ADAPTER     <br />//#define AUTOFAC_CONTAINER_ADAPTER </p>
<p>//***************************************************************************</p>
<p>Each variation takes only a few lines. I set the title text so you can see which version is running on screen (the original three letter “CFI” company name changes to one of “OUB”, “RUB”, “UCA”, “SMA”, or “ACA” to match your selection). For the Ioc-agnostic variations, there is an override of the method that creates the selected Ioc ContainerAdapter. The two versions pinned to the UnityBootstrapper (remember that I “refined” the UnityBootstrapper first simply to understand it better) have a shim method instead.</p>
<p><em>Incredibly stupid, I know. I’d never ship anything like this. I live with it because it’s a throw away demo and doesn’t merit the effort or complexity of proper decoupling. Or at least it doesn’t merit that attention yet.</em></p>
<p>The rest of the Prism RI stays constant. It took some work to keep it that way. Not a lot, fortunately; the Patterns and Practices people did a pretty good job of keeping the RI Ioc-neutral.</p>
<p>I won’t bore you with the details of my journey to this blissful place. They are chronicled in “PrismRIChanges.txt”, located in the PrismRI folder next to the Visual Studio Solution file, “StockTraderRI-IoC.sln”. The gist of it is</p>
<ul>
<li>Add the Ioc assemblies in a common directory structure </li>
<li>Add the PrismBootstrapper solution with its Ioc-agnostic Cal.Bootstrapper and the Ioc-specific ContainerAdapters. </li>
<li>Revise the start-up project, StockTraderRI, to access the above </li>
<li>Replace references to “IUnityContainer” with “IContainerAdapter” </li>
<li>Remove module references to Unity. </li>
</ul>
<p>You’ll do pretty much the same if you convert your existing Prism application to another Ioc container.</p>
<h3>ContainerAdapters</h3>
<p>The fun is in the ContainerAdapters which implement the following interface:</p>
<p>namespace Cal.Bootstrapper {    <br />&#160; public interface IContainerAdapter { </p>
<p>&#160;&#160;&#160; IContainerAdapter RegisterInstance&lt;T&gt;(T instance);    </p>
<p>&#160;&#160;&#160; IContainerAdapter RegisterType&lt;TFrom, TTo&gt;(     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ContainerRegistrationScope scope) where TTo : TFrom;     </p>
<p>&#160;&#160;&#160; IContainerAdapter RegisterType(     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Type fromType, Type toType, ContainerRegistrationScope scope);     </p>
<p>&#160;&#160;&#160; IContainerAdapter RegisterTypeIfMissing&lt;TFrom, TTo&gt;(     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ContainerRegistrationScope scope) where TTo : TFrom;     </p>
<p>&#160;&#160;&#160; IContainerAdapter RegisterTypeIfMissing(     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Type fromType, Type toType, ContainerRegistrationScope scope);     </p>
<p>&#160;&#160;&#160; T Resolve&lt;T&gt;() where T : class;     </p>
<p>&#160;&#160;&#160; object Resolve(Type type);     </p>
<p>&#160;&#160;&#160; T TryResolve&lt;T&gt;() where T : class ;     </p>
<p>&#160;&#160;&#160; object TryResolve(Type type);     <br />&#160; } </p>
<p>&#160; public enum ContainerRegistrationScope {    <br />&#160;&#160;&#160; Singleton,     <br />&#160;&#160;&#160; Instance,     <br />&#160; }     <br />}</p>
<p>Not so bad if you know your container. Clearly IContainerAdapter must be so dumb that any IoC Container vendor can support it. It needs to be just smart enough for the base Bootstrapper class to configure Prism. Fortunately, this challenge is easily met.</p>
<p>The code tends to be boilerplate. Autofac took a little more work (see below) but still weighs in at only 180 lines.</p>
<p>You also have to write an adaptor that implements Microsoft.Practices.ServiceLocation.IServiceLocator; virtually everyone has done this already.</p>
<h3>IoC Containers Demo’d</h3>
<p>I’ve tried this approach with three IoC Containers: <a href="http://msdn.microsoft.com/en-us/library/dd203101.aspx" target="_blank">Unity</a> (Unity v.1.2.0.0, ObjectBuilder2 v.2.2.2.0), <a href="http://sourceforge.net/projects/structuremap/files/" target="_blank">StructureMap</a> (v.2.5.4.0), and <a href="http://code.google.com/p/autofac/downloads/list" target="_blank">Autofac</a> (Desktop: v.1.4.5.676, Silverlight: 1.4.4.572).</p>
<p>You should know that I am not an expert in any of these containers. In fact, I just winged it, especially with StructureMap and Autofaq about which I know squat. I figured I could download them, skim whatever documentation they offered, and get something to work adequately for Shmoes like me.</p>
<p>It’s not quite that easy and I have low confidence in my use of these containers. Their authors are invited to lend a hand improving matters … after they’re done laughing.</p>
<p>I wanted to show at least one non-Unity container for both desktop and Silverlight applications. StructureMap doesn’t have a Silverlight version yet (come on, Jeremy). I tried Autofac because it does have a Silverlight version. </p>
<p>I’m glad I did. The StructureMap implementation was a breeze. Autofac was much harder. I’m not trashing Autofac. It just happened to be harder for me, partly due to my ignorance and mostly because of the position Autofac takes on resolving unregistered types.</p>
<h3>Major Container “Gotcha”</h3>
<p>Container differences matter! One pervasive Prism practice in particular relies on a Unity default behavior that other containers do not observe. It’s serious enough to influence your choice of containers or make your conversion substantially more difficult.</p>
<p>Prism instantiates a lot of its own components with unregistered public concrete classes. For example, somewhere in the bowels of RegionManager initialization, it resolves “DelayedRegionCreationBehavior”. This class is never registered with the container.</p>
<p>Unity is ok with this. When asked to resolve an unregistered public concrete type, it treats the type as if it had been registered and scoped as an instance (i.e., you get a fresh instance each time). Both TryResolve and Resolve behave this same way.</p>
<p>Prism components count on this default Unity container behavior. What if you change containers?</p>
<p>StructureMap has the same default behavior when resolving an unregistered public concrete type. However, it’s TryResolve equivalent, “TryGetInstance”, return null. As I write, I have not detected a consequence of this difference; but I know it’s waiting in the grass somewhere.</p>
<p>You could argue all day about whether a container should return null or return an instance the way Unity does. You could argue whether it should default to Singleton or Instance scope. </p>
<p>Autofac punts. If you attempt to Resolve an unregistered type, it throws an Autofac.ComponentNotRegisteredException with a clear message. “TryResolve” returns null, which is the sensible thing to do.</p>
<p><em>Aside: the three ContainerAdapter files in my sample implement a “ContainerPlay” class that reveals these differences.</em></p>
<p>I can’t quarrel with Autofac’s choice but I sure paid the price for purity. I had to hunt down all resolutions of concrete types and manually register them during AutofacContainerAdapter initialization. Unfortunately even that is insufficient. Many class constructors take parameters defined by concrete types. The container will attempt to resolve these and will throw at runtime. There aren’t integration tests to detect these automatically so I have to wander through the app under the debugger. I still haven’t got it to work.</p>
<p>It was easier to get the Prism RI working with StructureMap. I have assumed that the only critical difference is with explicit “TryResolve” calls. I haven’t encountered any optional constructor parameters so I expect StructureMap and Unity to resolve these in the same way.</p>
<p>I searched the Prism and RI source code for “TryResolve” calls involving concrete type. There weren’t many of them. I only found one of potential consequence. The base bootstrapper calls “TryResolve&lt;RegionAdapterMappings&gt;”. Fortunately, it also registers RegionAdapterMappings explicitly so resolution is always successful. Perhaps I was luck. Remember to be careful how you use TryResolve in your application.</p>
<p>The net of it is that containers differ. Prism should not have relied on a Unity-specific type resolution feature. If you have done so in your Unity-based application (as I have), you too are vulnerable.</p>
<h3>Where Did The Tests Go?</h3>
<p>I removed the test projects from the Prism RI and the Composite Application Library projects that go with it. Why did I do that? laziness?</p>
<p>I really thought this simple task would take maybe a long day at most. Stripping the tests away from the start was supposed to help me stay in the time box. It was going to be non-trivial to setup Prism’s test environment, convert the tests, and repackage for distribution to you. I didn’t think I could afford it.</p>
<p>The point of the exercise was to demonstrate how to liberate your application to use an alternative container. I wasn’t trying to deliver a product and there is limited value in tests for a version of the Prism RI that is (a) obsolete and (b) irrelevant to your application.</p>
<p>Unfortunately, this “simple” task kept expanding in scope; it took four long days. Geez like that never happens.</p>
<p>Now that I’m “done” I wish I had those tests back, the UnityBootstrapperFixture in particular. Debugger testing is painful as we all know. Had I committed to automated tests, I would have written something better than the idiotic compiler-directive-based approach to swapping containers. Sure it would have cost me something – a day? – to get it right, a day I didn’t want to spend. But if someone wants to take this further, the tests would accelerate his progress greatly and imbued his efforts with confidence. Mea culpa.</p>
<p>I wonder if some kind soul will restore them?</p>
<p>Happy New Year, everyone!</p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/wardbell/category/uncategorized/" title="View all posts in Uncategorized" rel="category">Uncategorized</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/wardbell/2010/01/01/an-ioc-agnostic-prism-bootstrapper/#comments" title="Comment on An IoC-Agnostic Prism Bootstrapper">7 Comments</a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-6 -->

		
						
			<div id="post-5" class="post-5 post type-post status-publish format-standard hentry category-uncategorized">
			<h2 class="entry-title"><a href="http://codebetter.com/wardbell/2009/12/06/a-programmer-s-progress/" title="Permalink to A Programmer Pilgrim’s Progress" rel="bookmark">A Programmer Pilgrim’s Progress</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/wardbell/2009/12/06/a-programmer-s-progress/" title="8:00 pm" rel="bookmark"><span class="entry-date">December 6, 2009</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/wardbell" title="View all posts by wardbell">wardbell</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>New Jersey, 1962? Vague memories of an entire barn filled with racks of wires and relays like a giant pipe organ. It’s a surplus electronic telephone switch, a predecessor of the Bell System’s 1ESS. A small team of enthusiasts has high hopes for its restoration.&#160; Impressed and baffled, it’s the first computer I’ve seen. I’ll not see another for eight more years.</p>
<p>I am Ward Bell, V.P. of Technology at <a href="http://www.ideablade.com/">IdeaBlade</a>, makers of DevForce. DevForce is a product for building multi-tier, data-driven business applications in .NET. It’s kind of like Microsoft’s WCF RIA Services … only we’ve been in production since 2002 with all that implies about focus, experience, maturity, support, features and architecture. We used to have our own ORM, one of the first in .NET. We abandoned that component when Entity Framework was announced; why resist its EF’s inevitable market victory when there is so much need to ease the pain of building distributed applications? </p>
<p>Distributed CRUD apps to be sure. But then most business applications are essentially CRUD + Behavior, aren’t they? A tiny fraction of developers both understand and need message-oriented architectures. The RIA Services perspective – I think of “RIA Services” as a category rather than a Microsoft product – that perspective will dominate Silverlight application development for the next decade at least. Thus spake Zarathustra.</p>
<p>What am I doing on CodeBetter? I’m certainly not here to talk about my product; I’ve got my own blog for that.</p>
<p>I am here because CodeBetter speaks to the software craftsman, the person who is curious about the practice of software development. We want to know “why” as much as “how”. We want to know when to do something and when not to do it. We see programming as a social phenomenon engaging a variety of actors, not as a stunt performed by heroic individuals in isolation. Our craft has a history. What we applaud or disparage today is provisional and contextual. There are no fixed marks – no permanent truths.</p>
<p>Sure, we have convictions and strong opinions rooted in practical experience. But we’re not wizards who’ve mastered a book of spells; we’re seekers, feeling our way forward, exploring better ways to develop software, mindful that the measure of “better” is a function in part of rapidly changing human and technical conditions. </p>
<p>When I read a CodeBetter post, I’m always impressed by the author’s enthusiasm and expertise – yes – but also the passion to communicate and educate. It’s a noble community and I’m honored to have been invited to join.</p>
<p>I come late to my love of the craft. So many of my itinerate years were spent programming unconsciously, showing up for the job, all wit and no wisdom. I’m kind of nostalgic for my old “Mort” self in much the way we can be nostalgic for our teenage selves.</p>
<p>Journeyman programmers are not “those people”; they’re “my people”. I’m freshly reminded of them every time I visit customers. Not all of them are unreachable; most merely slumber. Perhaps we can awaken a few. For the others, we can provide tools, rules, and infrastructure so they can program beyond their competence.</p>
<p>I figure as I write in this space, you’re bound to wonder “who <em><strong>is</strong></em> this guy?” Herewith, a little autobiography.</p>
<h3>Lesson #1: Generosity</h3>
<p>Poker was my first program, written in <a href="http://en.wikipedia.org/wiki/APL_(programming_language)">APL</a> on an IBM Selectric terminal wired to a System/360 in Poughkeepsie, NY.&#160; In 1966, Tom Watson named Steve Dunwell an IBM Fellow. Dunwell had been the inspiration and driving force behind the “Stretch” supercomputer, perhaps the world’s first supercomputer, delivered three years before Cray’s CDC 6600. His rise, fall, and resurrection is <a href="http://www.dvorak.org/blog/whatever-happened-to-the-ibm-stretch-computer/">a great story</a>.</p>
<p>As an IBM Fellow, Dunwell had some money and latitude to pursue projects that interested him. Teaching kids about computing was one of those projects. He put typewriter terminals in several high schools, one of them mine. It took passion and selfless dedication to put million dollar machines in the hands of clueless kids. I repaid his generosity with 5 card stud. I think the best it could do was deal cards. That was enough computing for me. Sorry, Steve.</p>
<p>I couldn’t afford college right away. I needed a job. I had no skills, no prospects, and no interests beyond the pursuit of girls and good times.</p>
<p>The fortuitous conjunction of my poker program and my fascination with the Albigensian Crusade lead to a bolt from the blue. The wife of my medieval history teacher worked for Dunwell. She called a Dr. Bill Hagamen, a neuro-anatomist at Cornell Medical School in New York City. He too was a beneficiary of Dunwell’s educational computing vision and he owed her a favor. “Call this kid and see if you can use him.”</p>
<p>I stumbled through the interview … a complete disaster. I couldn’t remember a thing about my poker program or APL. He almost hung up but I begged to see him and try again. I have no idea why I begged him or why he accepted. But a few days later, after cramming “A Programming Language” by Ken Iverson, I was sitting at his kitchen table in Long Island trying to convince him I knew enough APL to be useful.</p>
<p>I didn’t fool him at all but there must have been something he liked about a&#160; nineteen year old, long-haired, hippie kid who would try that stunt. More likely he needed to payoff the favor and he didn’t have any money for programmers anyway. Over the next few years he’d hire a taxi cab driver, a Ph.D in Slavic languages, a street musician, … just about anyone who’d work for dirt and flashed a little intelligence.</p>
<p>Dr. Hagamen was cheap by necessity, not by nature. When I met him he was still funding his work with grants. Grant money is uncertain; even when awarded, you can’t be sure when it will arrive. “Write the grant proposal for work you’ve already done; the money funds the research results that are the basis for the next grant”. </p>
<p>Live this way and you learn to spend carefully and scrounge for everything. He lived alone, subsisting on cigarettes and McDonalds as far as I can tell.</p>
<p>His neurological research depended on cats. Unlike the human brain, the cat brain hardly varies from subject to subject; it’s a stable specimen for anatomical research which, at the time, consisted of surgically poking at interesting structures to see what happened. The top floor was a vast mob of cats in cages, blinded and lamed in the course of his work. Cruel as this sounds he was not a cruel man; they purred and rubbed themselves against him with no sign of pain. He had gathered each one himself, walking the alleys of New York by night with his cloth cat collection bags: “press down on the neck just above the shoulders and they’ll push back with their fore legs, immobilized” he advised; “Then whip them in one stroke into the bag.” That’s scrounging.</p>
<p>We were just cats of a different color, scrounged from the streets of New York. We too purred every time we saw him. He loved each of us as individuals, listened to our stories, shared his own, laughed freely between long drags on endless cigarettes. If the toe of my shoe pointed slightly out he’d note that I’d sprained my ankle slightly … as indeed I had, playing basketball the night before. He became a second father to me. We had long conversations about everything.</p>
<p>He taught gross anatomy. The door to our computer lab opened into an adjacent dissection room where Dr. Hagamen showed students the body’s neural pathways. We met there often to discuss some forthcoming feature while he prepared for tomorrow’s lecture. I can still see him, bare hands deep in a cadaver’s chest, absent mindedly tying little white flags around nerve bundles while we talked. I never got used to that, pretending not to stare at the hollow shell of a human being, tanned leathery brown from its bath in formaldehyde. We stood amidst rows of them in various states of disrepair, limbs wrenched into impossible positions, parts meticulously tagged for display. Didn’t bother him at all. </p>
<p>Usually we talked about the work. Dr. Hagamen (he was always “Dr. Hagamen”, never “Bill”) had tired of neuroanatomy. Natural language processing was his passion now and for the rest of his life. We were writing a system for Computer Aided Instruction (CAI) to supplement the lectures in a medical student’s training. The program typed out questions, say, about the muscles of the eye. The student answered in full English sentences. The program determined what he’d said and chose what to ask next based on its “interpretation” of the student’s answer: if deemed correct, on to the next question; if it was a common error, on to a revealing query series; if flat wrong or unintelligible, ask for clarification. No multiple choice, no cheerful “right” or excoriating “wrong” answers. If you knew the muscles, you were through in minutes; if you didn’t, the program could lead you for more than an hour through a maze of enlightening statements and follow up questions.</p>
<p>Our teaching model was Rogerian psychotherapy. Dr. Hagamen had translated Joe Weizenbaum’s <a href="http://i5.nyu.edu/~mm64/x52.9265/january1966.html">ELIZA</a> (1966) into APL. That was the inspiration for our achievements in simulating “normal conversation”; we applied some minimal grammatical analysis, extracted key words matched to a constrained subject-matter context, and leaped to conclusions about what you had probably said. It worked surprisingly well and I think is still the foundation of most CAI to this day.</p>
<p>We knew this wasn’t how language actually works in humans … no more than airplanes simulate how birds fly. The facade of human conversation collapsed quickly as the vocabulary grew, the context expanded, or the sentences became paragraphs. We wanted to apply more intelligence and fewer statistics. We read Chomsky, hoping to find the deep structures of language and enshrine their algorithms in APL.</p>
<p>We didn’t get far. The search, however, was intoxicating, especially for a kid fresh out of high school. It seemed to me I was doing something important; we were pushing against the frontiers of knowledge and I was part of it.</p>
<p>He made us part of it. He put our names on the papers he published. Each of us had a moment or two in the sun. There I am, listed as a co-author of “ATS in Exposition”, Computers in Biology &amp; Medicine, volume 3, 1973; got my first academic citation before I’d even entered college. I hadn’t written a word of it.&#160; I guess I had contributed in some small way just by being on the team. He wanted to share the credit with all of us.</p>
<p>Looking back I understand now a little better about what “team” means. We were more than a group. We knew about each other’s lives – family, friends, pleasures, peeves. We played together as much as we worked together. We may not have been great at what we did, but we were full of common purpose and proud of what we did. We shared our code as we would share a beer, hiding nothing. </p>
<p>And were we ever close to our customer. So close we couldn’t have thought of it that way. Dr. Hagamen was happy to be the worst coder among us (smart of him to let us think so) but he was our leader, our friend, and we tried never to let him down.</p>
<p>I am convinced that commitment to purpose and fellowship trumps anything to be gained from smart people, “best practices”, great architecture. Get to know your team intimately and authentically. Disappointments are inevitable but your colleagues will fight like cornered rats to avoid them. Share the credit, absorb the blame and your prospects for success improve beyond measure.</p>
<p>The cigarettes and quarter-pounders finally caught up with him. He died from cancer in 2007 at 82. I’d long since gone west and fallen out of touch. The others hadn’t. </p>
<p>The news found me across the decades and broke my heart. I grieve for him now. In thirty years, who on any of my teams since will grieve for me? It’s a question I ask myself now and it goes straight to producing productive teams. Generosity of spirit, inspired loyalty, a learning organization … whatever my failings as a developer, this I can build.</p>
<h3>Lessons #2: Productivity</h3>
<p>Dr. Hagamen didn’t have to worry about hiring a complete loser. The APL language itself weeds them out. Your program either worked or it didn’t and there was no waiting around for days full of excuses. A few lines told everything about you and your potential.</p>
<p>You simply can’t fake it in APL. Every expression is a parade of equal parts alphabetic and hieroglyphic characters evaluated from right to left. <a href="http://en.wikipedia.org/wiki/Conway%27s_Game_of_Life">Conway’s Game of Life</a> can be written in a single, impenetrable line. You want to do away with ceremony? You want zero noise? You want the maximum bang for your keystroke buck? APL is your language.&#160; Ruby? Boo? They’re chatterboxes. In APL you can pack a ton of functionality into 32k of main memory, the extent of our universe in those days.</p>
<p>Unfortunately, APL deserved its reputation as a “write-only” language; the annual contest for one-liners of maximum obscurity was a highlight of every ACM APL conference.</p>
<p>But it was (and remains) a serious language, a forerunner of the functional programming languages becoming popular now. Skim Ken Iverson’s own Turing Award Lecture, “<a href="http://awards.acm.org/images/awards/140/articles/9147499.pdf">Notation as a Tool of Thought</a>” and discover your unworthiness. This is genius almost unknown today.</p>
<p>APL is interpreted which, combined with its unequaled power and economy of expression, enabled productivity such as had never been seen … and would not be seen until this century. While everyone else was presenting their boxes of 80-column cards to the guardians of the raised floor, hoping to squeeze in one or two runs per day, we were merrily tapping away at our terminals, cranking out several new applications a week.</p>
<p>I learned the power of iterative development writing APL. No interminable design documents for us. You had an idea; you wrote it and shipped it. It was cowboy programming but who knew? Who cared? Everyone’s programs were rife with bugs in those days. We could find ours, fix, and release again in minutes while the Fortran guy was still waiting for the band printer to burn through a box of paper with his core dump.</p>
<p>APL swept through the IT shops of New York financial houses. Morgan Stanley, Merrill Lynch, American Express … I would one day write APL for all of them. They still use APL! APL’s mathematical heritage had nothing to do with it. I suck at math. Fortunately I never needed more than high school algebra. I wrote applications to find things, watch things, and count things; I was solving the same kinds of business problems we work on today. APL dominated because it was incredibly productive. </p>
<p>On the street they hated to wait. Time-to-market was everything. The half-life of an application was a year or two. Maintainability was an after-thought; overpay the developers to stick around and everything would be fine. You only needed one or two … compared to the army of drones it took to write it in any other language … assuming they could get it done before you lost interest. Had there been such a thing as well-tested code, the cost to produce it would never have overtaken the benefit of moving pell-mell. Quality was a distant second to Functionality … and rightly so.</p>
<p>In time I learned to value the stability and maintainability of well architected, readable, code written in compiled, statically-typed languages. Today’s IDEs and fast compilers have narrowed the productivity gap. It’s no longer a straight-up trade between productivity and maintainability. I wouldn’t write in APL now even if I remembered how.</p>
<p>I remain receptive to the “git ’er done” message. It’s pointless delivering a properly architected and tested product later than it’s needed. The budget will be gone. The opportunity will be gone. Technology debt is a great thing when there is big return for short term debt. This I learned during my first twenty years of programming.</p>
<p>Our present challenge is to marry speed and sound practices.&#160; That was impossible when I started; I believe it is possible now. We have to keep our eyes on both … and I intend to do that in my posts here on CodeBetter.</p>
<h3>Lesson #3: Suspect all arguments about Performance</h3>
<p>The quest for maximum performance in minimal space ruled our days. We were programming in a phone booth: 32k memory, 30 characters-per-second networks, tape drives. One of us, David Linden, discovered that the integer ‘1’ occupied 4 bytes in memory while the variable name “ONE” took only three; he could shave hundreds of bytes from the program simply by substituting ONE for ‘1’ and “TWO” for ‘2’. We promptly converted all of our programs to spare those precious bytes. We might have patented the process had there been lawyers around to guard our “intellectual property”.</p>
<p>We thought about algorithms, not methodology.&#160; Dijkstra was unknown to us; we didn’t know that GOTOs were bad style We knew that performance stunk for any kind of branching at all so we avoided it where possible, favoring the APL equivalents of map and reduce. We had no notion of “style”. We had “idioms”, the best known being “((V ι V) = ιρV)/V”, which removes duplicates in the vector, V. “V” itself was a popular enough name – second to ‘X’ perhaps – and we’d use it everywhere. Any function or variable name over four characters attracted the gravest suspicion; it took too much space and cost more to fetch.</p>
<p>Thank goodness we don’t have to write this way any more. At PDC I heard a speaker say “our hardware is 50,000 times faster but our programs are only 5,000 times faster.”&#160; As if that were a bad thing. It’s not bad at all. I used to argue with people who insisted you should program only in assembler because higher level languages – Fortran, PL/I, APL – could never perform as well as properly written assembly code. No one makes that particular case anymore. It’s obvious now that we’d never get much done that way even if it were true. It also happened to be false much of the time for even a modest body of code; then as now, compilers regularly beat good assembly coders.</p>
<p>We prioritized performance because we had to; the program died or ran out of memory without those tricks. You’ll note that David measured the optimization before we employed it.</p>
<p>It galls me to hear someone argue for “better performance” before anyone knows if it will matter. Almost as bad is the phony speed derby down a short track when we know we’ll be running a marathon. Consider the smarty pants who proves that a Data Reader executes a simple query many times faster than an ORM. No kidding. Of course the application won’t run that query more than a few times all day and when it runs, no one notices the difference between 300ms and 30ms. Meanwhile, we discover that network latency is the dominate factor. Reducing trips to the server, each payload packed with a rich object graph, yields a vastly more responsive experience than the Data Reader Guy can dream of. Not to mention that Mr. Data Reader will waste months chasing bugs at the expense of building business value.</p>
<p>You want to be sensible. Synchronously loading a 100,000 records before you show the first screen may work on the LAN but it will never fly over the internet. Reason and experience can spare you much heart ache. A little scratching on the back of the envelope can clarify issues and identify threats. Otherwise, we’re far better off writing clear, clean code … benchmarking … and tuning the hot spots as we find them.</p>
<p>“Duh” you say? I’ll keep talking about this until my customers stop arguing about performance prematurely or ignoring it altogether.</p>
<h3>Lesson #4: Read Code … Lots of it</h3>
<p>We were all self-taught back then. In our little lab on East 68th street, we learned by reading each other’s code. Maybe we worked in a vacuum but no one I knew thought about software methodology. The first “Software Engineering” conference was held in 1968. David Parnas coined the terms “modularity” and “information hiding” in 1972. We didn’t know about any of this. We had few books and publications to consult: a couple APL reference books, the Transactions of the ACM, the IBM Systems Journal, and Knuth. </p>
<p>An eye-opener for me was Fred Brooks “Mythical Man Month” (1975), a landmark then and forever relevant. Brooks described it as &quot;<em>my belated answer to Tom Watson&#8217;s probing question as to why programming is hard to manage</em>.&quot; Its many lessons are blithely ignored to this day. Try explaining to your twenty-something manager that “<em>adding manpower to a late software project makes it later.</em>” </p>
<p>Brooks woke me to the idea that programming is a social phenomenon to be studied and reasoned about. Then I went back to sleep for another seven years.</p>
<p>We read code. Not books about code. Not magazine articles with code samples. Production code. Code written by colleagues and later by customers. “Good” code and “bad” code.</p>
<p>A lot of what we thought was “good” code we’d now regard as “bad” code. The converse is not true: what was bad then is worse today. And there was truly awful code out there. I ought to know; I wrote plenty of it.</p>
<p>I wish we had had the books, articles, blogs, manifestos, and conferences readily available to any developer today. I would have learned faster and avoided mistakes that seem obvious to me now. I won’t fetishize a prolonged experience in ignorance.</p>
<p>On the other hand, I don’t believe you can read your way to competence. You have to write a lot of code before you get decent at it. You have to read even more code before your writing gets good. In this respect it is like any profession. We learn by doing and we improve by watching others do it. </p>
<p>Don’t get stuck reading just one person’s code. Don’t get stuck in one school of design either. Look around. Try another language. See how different applications, different developers, and different customers create conditions and constraints that shake your assumptions. As Han Shan says “There is no path that goes all the way”.</p>
<p>No one path for me. </p>
<h3>… Next Installment?</h3>
<p>So much for a brief intro. Suddenly I’ve got a memoir going.</p>
<p>If my introductory post generates favorable interest, I’ll keep going. If it generates outrage and alarm, I’ll stop!</p>
<p>A “next installment” could cover:</p>
<ul>
<li>The Reluctant Programmer – how I discovered I was a programmer while striving to be something else. </li>
<li>The Itinerant Programmer – life as a job-hopping consultant and what I learned about making a quick impression and grasping the customer’s business, “Show me the data and I’ll tell you what your application does”. Hubris and infrastructure.</li>
<li>The Corporate Programmer – “10 years before the mast” Or “settling in at GE”, How long does an application last? Cobol follies.</li>
<li>Never hire a friend – Oops </li>
<li>Hiring a programmer – Ravishing beauty versus pain-in-the-butt </li>
<li>Life on the other side: becoming a customer of IT </li>
<li>“If it makes no business sense …” &#8211; my Dot Bomb moment </li>
<li>Starting a product company </li>
<li>Re-starting a product company </li>
</ul>
<p>Until we meet again …</p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/wardbell/category/uncategorized/" title="View all posts in Uncategorized" rel="category">Uncategorized</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/wardbell/2009/12/06/a-programmer-s-progress/#comments" title="Comment on A Programmer Pilgrim’s Progress">16 Comments</a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-5 -->

		
			
	<div id="nav-below" class="navigation">
		<div class="nav-next"><a href="?page=1" > Next Page &raquo;</a></div>
		
	</div><!-- #nav-below -->
			</div><!-- #main -->
			<div id="sidebar" class="grid_4">
						<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
					<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-new-features?utm_source=cb&utm_medium=button&utm_term=4328&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="125" height="125" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/ANTSPP5_125x125_M1.gif"></a>
					<embed width="125" height="125" flashvars="clickTARGET=_blank&amp;clickTAG=http%3A%2F%2Fd1.openx.org%2Fck.php%3Foaparams%3D2__bannerid%3D62753__zoneid%3D29419__cb%3Da0471ce5e8__r_id%3Dd42118811971f057012db20aa261c5c1__r_ts%3Dldef6x__oadest%3Dhttp%253A%252F%252Fwww.jetbrains.com%252Fresharper%252F%253Frs4cb125" allowscriptaccess="always" quality="high" name="Advertisement" id="Advertisement" style="" src="http://s3.amazonaws.com/CodeBetter/Creative/tc_125x125_simple2.swf" type="application/x-shockwave-flash">
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				<script type="text/javascript" src="http://engine.theloungenet.com/z/15/adzerk1_2_5"></script>
				<div id="adzerk1"></div>
				
				<ul class="xoxo">		
									</ul>	
				
				<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-csharp?utm_source=cb&utm_medium=rectangle&utm_term=4327&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="300" height="250" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/APP6_Launch_C%23_Jun10_300x250_M1.gif?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1458095516&amp;Signature=BIBDilUaLnZe1uKfVKyyTBxr%2BvE%3D"></a>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #content -->
	
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/" title="Search Results">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="/blogs/products/pages/64386.aspx">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="/blogs/products/pages/64615.aspx">Telerik</a></li>
<li><a href="/blogs/products/pages/142174.aspx">JetBrains - ReSharper</a></li>
<li><a href="/blogs/products/pages/Beyond-Compare.aspx">Beyond Compare</a></li>
<li><a href="/blogs/products/pages/.NET-Memory-Profiler.aspx">.NET Memory Profiler</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a> &lt;-- NEW Friend!</li>

	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '11<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = false; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.500 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-01-27 08:45:07 -->
<!-- super cache -->