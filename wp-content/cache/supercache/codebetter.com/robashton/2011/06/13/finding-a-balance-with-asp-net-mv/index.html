<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Finding a balance with ASP.NET MVC | Rob Ashton</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/robashton/xmlrpc.php" />
	<link rel='stylesheet' id='mainstyle-css'  href='http://codebetter.com/robashton/wp-content/themes/codebetter/style.css?ver=3.4.2' type='text/css' media='all' />
<link rel='stylesheet' id='jquerystyle-css'  href='http://codebetter.com/robashton/wp-content/themes/codebetter/jquery-ui-1.8.1.custom.css?ver=3.4.2' type='text/css' media='all' />
<link rel='stylesheet' id='wp_greet_box_style-css'  href='http://codebetter.com/robashton/wp-content/plugins/wp-greet-box/css/style.css?ver=3.4.2' type='text/css' media='all' />
<script type='text/javascript' src='http://codebetter.com/robashton/wp-includes/js/jquery/jquery.js?ver=1.7.2'></script>
<script type='text/javascript' src='http://codebetter.com/robashton/wp-includes/js/comment-reply.js?ver=3.4.2'></script>
<script type='text/javascript' src='http://codebetter.com/robashton/wp-content/plugins/wp-greet-box/js/functions.js?ver=3.4.2'></script>
<script type='text/javascript' src='http://codebetter.com/robashton/wp-content/plugins/wp-greet-box/js/js-mode.js?ver=3.4.2'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/robashton/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://codebetter.com/robashton/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Hello' href='http://codebetter.com/robashton/2011/04/13/hello/' />
<link rel='next' title='Keeping JS Sane' href='http://codebetter.com/robashton/2012/09/03/keeping-js-sane/' />
<meta name="generator" content="WordPress 3.4.2" />
<link rel='shortlink' href='http://codebetter.com/robashton/?p=19' />

<!-- All in One SEO Pack 1.6.15.2 by Michael Torbert of Semper Fi Web Design[83,137] -->
<link rel="canonical" href="http://codebetter.com/robashton/2011/06/13/finding-a-balance-with-asp-net-mv/" />
<!-- /all in one seo pack -->
<link rel="stylesheet" href="http://codebetter.com/robashton/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=5.2.9" type="text/css" media="screen" /><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3" />
	
	<script type='text/javascript' src='http://d1.openx.org/spcjs.php?id=7744&amp;target=_blank'></script>
	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>
<!-- BuySellAds Ad Code -->
<script type="text/javascript">
(function(){
  var bsa = document.createElement('script');
     bsa.type = 'text/javascript';
     bsa.async = true;
     bsa.src = 'http://s3.buysellads.com/ac/bsa.js';
  (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);
})();
</script>
<!-- End BuySellAds Ad Code -->
</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">
			<!-- BuySellAds Zone Code -->
<div id="bsap_1276080" class="bsarocks bsap_4fe632babdccc2b4b049e4f08cc3c549"></div>
<!-- End BuySellAds Zone Code --></div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-19" class="post-19 post type-post status-publish format-standard hentry category-asp-net category-mvc">
					<h1 class="entry-title">Finding a balance with ASP.NET MVC</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/robashton/author/rashton/" title="View all posts by Rob Ashton">Rob Ashton</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/robashton/2011/06/13/finding-a-balance-with-asp-net-mv/" title="4:48 pm" rel="bookmark"><span class="entry-date">June 13, 2011</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/robashton/feed/rss/"  rel="nofollow"><img src="http://codebetter.com/robashton/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/robashton/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><p>The other day I did a talk at DDD South West, cheekily entitled &#8220;ASP.NET MVC, coping with mediocrity&#8221;,  pitched on the agenda as being fairly heavily negative about ASP.NET MVC, but in reality summarising that it&#8217;s okay so long as you understand its limitations and that you don&#8217;t spend all of your time being angry and fighting it.</p>
<p>I&#8217;ve been asked to structure  some of the information into a blog post so here is my attempt at that. <em>Note: This is old ground for a lot of people, and is pitched at those asking the questions after my session.</em></p>
<p><strong>Choosing ASP.NET MVC</strong></p>
<p>There are several reasons we end up going with ASP.NET MVC, the loudest three seem to be that &#8220;<em>it&#8217;s easy to get training on it</em>&#8220;, &#8221;<em>we can easily hire people who know it</em>&#8220;, and &#8220;<em>it&#8217;s from Microsoft and we&#8217;re a Microsoft Shop</em>&#8220;. Two of these are valid and the other seems valid when you&#8217;re a manager on the outside, looking in on the other two.</p>
<p>Assuming that ASP.NET MVC is what you or somebody else has chosen, you&#8217;ve subscribed yourself to doing things the way it thinks, and whether not you regard it to think like the class dunce, this still remains true.</p>
<p>From what I see, there are four main problems that people have with Microsoft&#8217;s ASP.NET MVC Framework, in no particular order these seem to be, &#8220;<em>Microsoft</em>&#8220;, &#8220;<em>ASP.NET&#8221;</em>, &#8220;<em>MVC</em>&#8221; and &#8220;<em>Framework</em>&#8220;, some of these more so than others.</p>
<p>The following writings come from the perspective of somebody wanting to perform a half-decent level of testing within an application, but without going overboard on layers or enterprise &#8220;magic&#8221;.</p>
<p><strong>ASP.NET</strong></p>
<p>Microsoft gets a lot of flack for this stack, and rightfully so, it is for the most part a massive klooge fest of train-wrecks and bizarre decisions that make it possible to completely blow your own foot off if you&#8217;re not careful to guard against it.</p>
<p>Keeping ASP.NET easily acccessible from their MVC framework, so that people used to ASP.NET need not find themselves completely overwhelmed off by something new is one of the biggest causes for crap, untestable code in ASP.NET MVC applications.<br />
However, this is easily managed by treating ASP.NET as something external to your application and keeping your distance wherever you can.</p>
<p>Consider the following example of ASP.NET MVC code:</p>
<pre class="brush: csharp; title: ; notranslate" title="">
        [HttpPost]
        public ActionResult DoSomethingCool()
        {
            if (Session[&quot;water&quot;] == &quot;boiling&quot;)
            {
                Server.TransferRequest(&quot;~/408.aspx&quot;);
            }
            return View();
        }
</pre>
<p>Clearly I can&#8217;t test this, as I&#8217;m directly accessing the base controller which &#8220;conveniently&#8221; gives me access to all the gubbins that ASP.NET ships with.</p>
<p>Yes, the team have stuck all the sealed classes behind a set of &#8216;wrappers&#8217; which are virtual and override-able, giving us the ability to &#8216;mock&#8217; them, but this isn&#8217;t the answer, as not only are they a massive dependency to take on &#8211; they also have really high surface areas and actually constructing the objects to populate the &#8216;ControllerContext&#8217; with is a huge pain in testing.</p>
<pre class="brush: csharp; title: ; notranslate" title="">

        [Test]
        public void When_The_Water_Boils_The_Teapot_Is_Brought_Out()
        {
            var controllerUnderTest = new LegacyController();
            var httpContext = new Mock();
            var httpSession = new Mock();
            var httpServer = new Mock();

            httpSession.SetupGet(x =&gt; x[&quot;water&quot;]).Returns(&quot;boiling&quot;);
            httpContext.SetupGet(x =&gt; x.Session).Returns(httpSession.Object);
            httpContext.SetupGet(x =&gt; x.Server).Returns(httpServer.Object);

            controllerUnderTest.ControllerContext = new ControllerContext(
                httpContext.Object,
                new RouteData(),
                controllerUnderTest);

            controllerUnderTest.DoSomethingCool();

            httpServer.Verify(x =&gt; x.TransferRequest(&quot;~/418.aspx&quot;), Times.Once());

        }
</pre>
<p>Of course, there are tools that can help you minimise this pain, but in that case you&#8217;re fixing the wrong problem. Another oft-seen solution to this is often either creating interfaces that map onto HttpServer/etc and passing them into the controller, or just sticking HttpContextBase into the container itself &#8211; this makes things more testable but still doesn&#8217;t lead to especially good tests or readable code.</p>
<pre class="brush: csharp; title: ; notranslate" title="">

        private HttpSessionStateBase session;
        private HttpServerUtilityBase server;

        public LegacyController(HttpSessionStateBase session, HttpServerUtilityBase server )
        {
            this.session = session;
            this.server = server;
        }

        [HttpPost]
        public ActionResult DoSomethingCooler()
        {
            if (this.session[&quot;water&quot;] == &quot;boiling&quot;)
            {
                server.TransferRequest(&quot;~/408.aspx&quot;);
            }
            return View();
        }

</pre>
<p>And the test</p>
<pre class="brush: csharp; title: ; notranslate" title="">

        [Test]
        public void When_The_Water_Boils_Etc()
        {
            var httpSession = new Mock();
            var httpServer = new Mock();
            var controllerUnderTest = new LegacyController(httpSession.Object, httpServer.Object);

            httpSession.SetupGet(x =&gt; x[&quot;water&quot;]).Returns(&quot;boiling&quot;);

            controllerUnderTest.DoSomethingCooler();

            httpServer.Verify(x =&gt; x.TransferRequest(&quot;~/408.aspx&quot;), Times.Once());

        }

</pre>
<p>The problem is, that if you bootstrap these in, you&#8217;re still not thinking about the meaning of the actual code you&#8217;re writing. If you&#8217;re doing some form of TDD you&#8217;ll have written your controller and discovered a role that needs fulfilling by an external object of some sort, and in this case the role isn&#8217;t being surfaced because we&#8217;re passing in an object with no meaning in our system.</p>
<p>The test is also quite brittle because it&#8217;s caring a bit too much about the &#8216;how&#8217; rather than the &#8216;what&#8217;, let&#8217;s see what I mean by this by refactoring this code slightly.<br />
First off, when writing the test, We establish that we need something that boils water, this is a role that we can create an interface for that looks something like this:</p>
<pre class="brush: csharp; title: ; notranslate" title="">
public interface IBoilWater
{
	bool WaterIsBoiling();
}
</pre>
<p>And when it comes to implementing this, we might then create a Kettle:</p>
<pre class="brush: csharp; title: ; notranslate" title="">
// Let's not get into the debate over whether this should simply be IBoilable and Water, this is a silly example
public class Kettle : IBoilWater
{
	bool WaterIsBoiling() {
		return this.waterTemperature &gt;= 100;
	}
}
</pre>
<p>This could take in my HttpSessionBase directly in the constructor and return that value directly, that would make my Kettle a Facade onto the external system, or we could also move to have an IContainSessionState which gets passed into this if we so choose. If &#8220;Kettle&#8221; has a lot of business logic then that&#8217;s probably what will happen.</p>
<p>The biggest change here is that semantically our code makes bit more sense.</p>
<p>How about that server re-direct? Well actually, we&#8217;re not using the ASP.NET MVC framework the way it was intended if we&#8217;re calling into something directly to make that happen. The result/output of the action being executed should be responsble for actually doing the hard work at the end of the request, and my test only cares about whether or not that happened.</p>
<p>We have ActionResult for a reason, and whether we argue about this being a good thing or not, we should use the framework the way it was intended and return something like:</p>
<pre class="brush: csharp; title: ; notranslate" title="">
public TeapotResult : ActionResult
{
        public override void ExecuteResult(ControllerContext context)
        {
		HttpContext.Current.Server.TransferRequest(&quot;~/408.aspx&quot;);
        }
}
</pre>
<p>This isn&#8217;t testable in isolation but can be considered as a thin facade around the cruft that is ASP.NET.  I&#8217;ll talk more about the failings of this when I cover custom pipelines later in this blog entry.</p>
<p>Putting this together, we end up with:</p>
<pre class="brush: csharp; title: ; notranslate" title="">

        public ActionResult DoCoolStuff()
        {
            if(waterBoiler.IsWaterBoiling())
            {
                return new TeapotResult();
            }
            return View();
        }
</pre>
<p>With the test</p>
<pre class="brush: csharp; title: ; notranslate" title="">
        [Test]
        public void When_The_Water_Boils_Etc_Etc()
        {
            var kettle = new FakeKettle.CreateBoilingKettle();
            var controller  = new LegacyController(kettle);

            var result = controller.DoCoolStuff();

            Assert.That(result, Is.InstanceOf());
        }
</pre>
<p>Not only does the code make sense to anybody reading (it&#8217;s very explicit), the test doesn&#8217;t care &#8216;how&#8217; the teapot result works, it just cares that a teapot result is gained (the what).<br />
The lesson we&#8217;ve learned here, is that the legacy ASP.NET can be hidden away if you need to use it, and that doesn&#8217;t just mean creating interfaces that map one-to-one onto ASP.NET.</p>
<p><strong>Controller Bloat</strong></p>
<p>The typical piece of demo code looks something like this:</p>
<pre class="brush: csharp; title: ; notranslate" title="">
        public ActionResult Index(string id)
        {
            using(var context = new DataContext())
            {
                var product = context.Load(id);
                return View(product);
            }
        }

        [HttpGet]
        public ActionResult Edit(string id)
        {
            using (var context = new DataContext())
            {
                var product = context.Load(id);
                return View(product);
            }
        }

        [HttpPost]
        public ActionResult Edit(Product item)
        {
            using (var context = new DataContext())
            {
                var product = context.Load(item.Id);
                this.UpdateModel(product);
                context.Save();
            }
            return View();
        }
</pre>
<p>Which is great, except we&#8217;re not in this case worrying about security, validation, business logic, and anything else that might creep into the development pipeline over time. Sometimes this might actually be the case, in which case you&#8217;re just building a simple CRUD app, and testability isn&#8217;t likely to be a valid concern because you&#8217;re not likely to have a high maintenance burden on this code.</p>
<p>However, in the case where business logic does end up happening, and validation tends to end up requiring a bit more than a pile of attributes can provide, not to mention everything else that can happen this is going to cause us issues.<br />
We also have the problem in the above code that we&#8217;re going to have a load of hidden Select N+1 problems as a consequence of sending our model (complete with proxies) to the view for data-display.</p>
<p>We do very quickly decide that binding directly to a set of POCOs provided by our ORM is a bad idea (thankfully), and think of M as something conceptual behind the controller. The rest of our code often doesn&#8217;t change much however, for example:</p>
<pre class="brush: csharp; title: ; notranslate" title="">
    public class ProductsController : Controller
    {
        private readonly IContainProducts productRepository;
        private readonly ISearchForProducts productsIndex;
        private readonly IContainCustomers customerRepository;
        private readonly IShipProducts productShipper;
        private readonly ICoordinateSales salesCatalog;

        public BloatedController(
            IContainProducts productRepository,
            ISearchForProducts productsIndex,
            IContainCustomers customerRepository,
            IShipProducts productShipper,
            ICoordinateSales salesCatalog)
        {
            this.productRepository = productRepository;
            this.salesCatalog = salesCatalog;
            this.productShipper = productShipper;
            this.customerRepository = customerRepository;
            this.productsIndex = productsIndex;
        }

        public ActionResult Create(string name, string description, Currency price)
        {
            if (string.IsNullOrEmpty(name))
            {
                this.ModelState.AddModelError(&quot;name&quot;, &quot;Name cannot be empty&quot;);
            }
            if (string.IsNullOrEmpty(description))
            {
                this.ModelState.AddModelError(&quot;description&quot;, &quot;Description cannot be empty&quot;);
            }
            if (price != null)
            {
                this.ModelState.AddModelError(&quot;price&quot;, &quot;Price cannot be empty&quot;);
            }

            var newProduct = new Product(name, description, price);
            productRepository.Add(newProduct);

            return View();
        }

        public ActionResult SingleItem(string id)
        {
            if (string.IsNullOrEmpty(id))
            {
                return RedirectToAction(&quot;Search&quot;);
            }

            var productView = productsIndex
                .Query()
                .Where(x =&gt; x.Id == id)
                .As()
                .First();

            return View(productView);
        }

        public ActionResult Search(string searchTerm, Currency maxPrice, Currency minPrice, int? limit)
        {
            var query = productsIndex.Query();

            if (!string.IsNullOrEmpty(searchTerm))
            {
                query.Where(x =&gt;
                                    x.Description.Contains(searchTerm) ||
                                    x.Title.Contains(searchTerm));
            }
            if (maxPrice != null)
            {
                query.Where(x =&gt; x.Price.LessThan(maxPrice));
            }
            if (minPrice != null)
            {
                query.Where(x =&gt; x.Price.GreaterThan(minPrice));
            }

            var results = query
                .As()
                .Limit(limit ?? 100)
                .ToArray();

            return View(results);
        }

        public ActionResult WhatsNew()
        {
            var results = productsIndex.Query()
                .Where(x =&gt; x.DateAdded &lt; DateTime.Now.Subtract(TimeSpan.FromDays(2)))
                .As()
                .ToArray();

            return View(results);
        }

        [Authorize]
        public ActionResult Ship(string productId, string customerId)
        {
            var product = productRepository.Get(productId);
            var customer = customerRepository.Get(customerId);

            if(product == null)
            {
                this.ModelState.AddModelError(&quot;productId&quot;, &quot;Product must exist&quot;);
            }

            if (customer == null)
            {
                this.ModelState.AddModelError(&quot;customerId&quot;, &quot;Customer must exist&quot;);
            }

            if(this.ModelState.IsValid)
            {
                productShipper.ShipProductToCustomer(product, customer);
            }
            return View();
        }

        [Authorize(Roles=&quot;Admin&quot;)]
        public ActionResult CreateSeasonalOffer(string productId, int percentageOff, TimeSpan duration)
        {
            var product = productRepository.Get(productId);

            if (product == null)
            {
                this.ModelState.AddModelError(&quot;productId&quot;, &quot;Product must exist&quot;);
            }

            if (percentageOff &gt; 0)
            {
                this.ModelState.AddModelError(&quot;percentageOff&quot;, &quot;Percentage must be non-zero and positive&quot;);
            }

            if (this.ModelState.IsValid)
            {
                salesCatalog.CreateSeasonalOffer(product, percentageOff, duration);
            }
            return View();
        }
    }

</pre>
<p>This isn&#8217;t actually the worst example I could come up with, being only a couple of hundred lines long, but scale it up across an entire code base with some of the more real business logic and workflow concerns in a more full-on application and we&#8217;re going to be feeling the pain pretty fast.<br />
The default conventions of the controller name dictating the route is what gets us here typically, a desire to keep all the above actions under the /Products route has given us a controller with too many actions and thus too many dependencies.</p>
<p>The controller actions themselves being packed with logic is a problem we have caused for ourselves, but the way that ASP.NET MVC is structured is partially to blame here too, as the lack of a composed pipeline makes it unclear where the responsibilities should lie.</p>
<p>Automated testing of the above would be be fraught with danger and brittleness because of the multitude of concerns and dependencies and logic paths.</p>
<p>The example &#8220;bad code&#8221; does come with some benefits however &#8211; in that it is very explicit and cohesive, there is no hidden magic happening, so any novice developer can go to a controller action and start fixing bugs and adding new ones.</p>
<p>I believe that this explicitness is often overlooked when looking at alternative ways of structuring our applications, and while a lot of us might decry those who look at the pipeline models of Fubu/OpenRasta and accuse all those interfaces/generics and convention-driven magic of being &#8220;complicated&#8221;, a lot of developers aren&#8217;t living in that world and sometimes we should be understanding of that.</p>
<p>Now onto how we improve the above code, as well as another example or two of problems we might encounter, with the goal of making it not only more testable, but keeping the explicitness that we have and we already acknowledge as good.</p>
<p>A mantra oft-repeated by the Good Practises crowd (and rightfully so) is that controllers should have very little logic in them, that they should be coordinating and coordinating only. Taking this to its all too common extremes we can end up with an Enterprise Controller that looks something like this:</p>
<pre class="brush: csharp; title: ; notranslate" title="">
    public class ProductsController : EnterpriseController
    {
        private readonly IProductsService productsService;

        public ProductsController(IProductsService productsService)
        {
            this.productsService = productsService;
        }

        [HttpGet]
        public ActionResult Index(string id)
        {
            var product = this.productsService.GetProduct(id);
            return View(product);
        }

        [HttpGet]
        public ActionResult Edit(string id)
        {
            var product = this.productsService.GetProduct(id);
            return View(product);
        }

        [HttpPost]
        public ActionResult Edit(Product item)
        {
            this.productsService.UpdateProduct(item.Id,item.Name, item.Price);
            return View();
        }
    }

</pre>
<p>Or similar, which doesn&#8217;t really solve the problem (I&#8217;d hazard a guess that the code behind those service calls looks almost identical to that found in the original controller). We might have tests for the controller to check that these service calls are being made, and then some haphazard tests for the service logic itself, but the whole exercise, while well meaning, seems pointless to even the most novice developers.</p>
<p>I&#8217;m not saying that this is an entirely invalid approach, but that in most applications, introducing a forced layer between the framework and our code doesn&#8217;t add a lot of value.<br />
Let&#8217;s go back to that first method and see what we can do to make it easier on the eyes and easier on the tests.</p>
<pre class="brush: csharp; title: ; notranslate" title="">
        public ActionResult Create(string name, string description, Currency price)
        {
            if (string.IsNullOrEmpty(name))
            {
                this.ModelState.AddModelError(&quot;name&quot;, &quot;Name cannot be empty&quot;);
            }
            if (string.IsNullOrEmpty(description))
            {
                this.ModelState.AddModelError(&quot;description&quot;, &quot;Description cannot be empty&quot;);
            }
            if (price != null)
            {
                this.ModelState.AddModelError(&quot;price&quot;, &quot;Price cannot be empty&quot;);
            }

            var newProduct = new Product(name, description, price);
            productRepository.Add(newProduct);

            return View();
        }
</pre>
<p>The first thing that stands out is the inline validation, the reason for which is clear &#8211; that we have our parameters being passed in individually (Perhaps because we decided not to bind to our model directly because that causes so many probems). We&#8217;ll use the validation here to represent anything else that might also creep in to our controllers, it is not that unique a concern.</p>
<p>So many of our problems can be solved in any pipeline by adopting a uniform shape across that pipeline, one-model-in, one-model-out is something that the Fubu guys have adopted but there is no reason we can&#8217;t do the same in ASP.NET MVC.</p>
<p>Let&#8217;s take our Create method, change the method signature so that it takes in a model,and push some of our controller logic into that model.</p>
<pre class="brush: csharp; title: ; notranslate" title="">
        public ActionResult Create(CreateProductCommand command)
        {
            if(command.ValidateInto(this.ModelState))
            {
                var newProduct = command.CreateProduct();
                productRepository.Add(newProduct);
            }
            return View();
        }
</pre>
<p>We can end up easily with something that looks like this &#8211; which has all the explicitness of the original example, but has achieved our goal. No, it&#8217;s not &#8220;technically perfect in every way&#8221;, but it has the advantage that the validation can be tested outside the controller, as can product creation, but that doesn&#8217;t stop us testing the lot in a more &#8216;outside&#8217; feature-level approach &#8211; especially if the logic in those components is all very simple.</p>
<p>Let&#8217;s take another one and have a look at fixing that so it&#8217;s a bit more terse and fits in with this approach:</p>
<pre class="brush: csharp; title: ; notranslate" title="">
        public ActionResult Search(string searchTerm, Currency maxPrice, Currency minPrice, int? limit)
        {
            var query = productsIndex.Query();

            if (!string.IsNullOrEmpty(searchTerm))
            {
                query.Where(x =&gt;
                                    x.Description.Contains(searchTerm) ||
                                    x.Title.Contains(searchTerm));
            }
            if (maxPrice != null)
            {
                query.Where(x =&gt; x.Price.LessThan(maxPrice));
            }
            if (minPrice != null)
            {
                query.Where(x =&gt; x.Price.GreaterThan(minPrice));
            }

            var results = query
                .As()
                .Limit(limit ?? 100)
                .ToArray();

            return View(results);
        }
</pre>
<p>First off, read operations can fit into our one-model-in, one-model-out approach too, our main bulk of work here appears to be the population of the query object from the set of input parameters.</p>
<p>We can push that into our query model, and we don&#8217;t need to do any further abstraction because it already makes our controller action nice and thin.</p>
<pre class="brush: csharp; title: ; notranslate" title="">
        public ActionResult Search(SearchProductsQuery query)
        {
            var searchView = query.From(productsIndex);
            return View(searchView);
        }
</pre>
<p>In this, our query model knows how to populate the query object and return the data from that query object - perhaps we might end up discovering that it best be that it only populates the query object and our controller take care of modifying the query a bit more (A micro-pipeline if you will), but in this instance we&#8217;ve again maintained our explicitness and kept it readable.</p>
<p>Let&#8217;s take a look at one more before moving onto the next topic:</p>
<pre class="brush: csharp; title: ; notranslate" title="">
        public ActionResult SingleItem(string id)
        {
            if (string.IsNullOrEmpty(id))
            {
                return RedirectToAction(&quot;Search&quot;);
            }

            var productView = productsIndex
                .Query()
                .Where(x =&gt; x.Id == id)
                .As()
                .First();

            return View(productView);
        }
</pre>
<p>We only querying for a single property, why put it into a model? Well for one thing, it&#8217;ll potentially make our tests less brittle, as an addition to our query means changing only the model and the builders and leaving most of the tests themselves alone.</p>
<p>It will also allow us to put the logic in an appropriate place for performing the query and validation.</p>
<pre class="brush: csharp; title: ; notranslate" title="">
        public ActionResult SingleItem(SingleItemQuery query)
        {
            if (!query.MakesSense()) {
                return RedirectToAction(&quot;Search&quot;);
            }
            var productView = query.From(productsIndex);
            return View(productView);
        }
</pre>
<p>I think perhaps if we found ourselves doing this a lot, rather than the <em>RedirectToAction(&#8220;Search&#8221;)</em>, we might choose instead to have a<em> return new RedirectToMainSearchPage() </em>action, but in this case we decided this isn&#8217;t<br />
too harmful and nobody is going to get too hurt by leaving it in here.</p>
<p>I think we get the gist of all this now, and speaking of gists, the gist for this iteration of refactoring the controller can be found <a href="https://gist.github.com/1023120">here</a>:</p>
<p><strong>Constructor bloat</strong></p>
<p>We are still left with the problem of the constructor bloat though, that hasn&#8217;t changed. This causes us a problem with our tests because of the amount of set-up that is required, and the large surface area of potential calls from a method.</p>
<p>We already covered one possible solution to that (pushing all the logic to an IProductsService) and why we probably wouldn&#8217;t want to do that just to solve this problem.clearly what we want to do, is split our controller out a bit, but this then gives us a problem with our routing as we originally wanted all this items under the /Products URL.</p>
<p>Question that &#8211; why do we want all the items under the Products URL? Products is not a responsibility, it&#8217;s a type in our system so you&#8217;ll have a hard time trying to craft a controller around that.</p>
<p>Consider instead, ProductShipmentController, ProductSearchController, ProductUpdateController and so on and so forth. There is no harm having multiple actions on these as they&#8217;ll likely have similar dependencies and wants.</p>
<p>Going even further, we can even discuss the possibility of just having single action controllers, ASP.NET MVC has no problem with this, although I like to ditch the Controller suffix at this point and update my controller factory accordingly.</p>
<p>Consider:</p>
<pre class="brush: csharp; title: ; notranslate" title="">
    public class CreateProductCommandHandler : Controller
    {
        private readonly IContainProducts productRepository;

        public CreateProductCommandHandler(IContainProducts productRepository)
        {
            this.productRepository = productRepository;
        }

        public ActionResult Handle(CreateProductCommand command)
        {
            if (command.ValidateInto(this.ModelState))
            {
                var newProduct = command.CreateProduct();
                productRepository.Add(newProduct);
            }
            return View();
        }
    }
</pre>
<p>or</p>
<pre class="brush: csharp; title: ; notranslate" title="">
    public class SearchProductsQueryHandler : Controller
    {
        private readonly ISearchForProducts productsIndex;

        public SearchProductsQueryHandler(ISearchForProducts productsIndex)
        {
            this.productsIndex = productsIndex;
        }

        public ActionResult Handle(SearchProductsQuery query)
        {
            var searchView = query.From(productsIndex);
            return View(searchView);
        }
    }
</pre>
<p>Easy to test, easy on the eyes, and still has the explicitness of the original code. If you&#8217;re not comfortable with going this far, then don&#8217;t &#8211; I&#8217;m not advocating this as &#8216;best practise&#8217; &#8211; and you&#8217;ll get almost as far if you simply think about the responsibility boundaries as first suggested.</p>
<p><strong>Default conventions + file organisation</strong></p>
<p>By doing this however, we&#8217;ve unintentially created more problems for ourselves in trying to make our code more readable &#8211; chiefly this is that we&#8217;ve now got a lot of files and if we keep the default ASP.NET MVC project structure of grouping objects by their &#8216;type&#8217; rather than by their &#8216;responsibility&#8217;, it&#8217;s going to be hard to find related files for development.<br />
Areas are one way to solve this, although all that achieves by itself is that we have a lot more directories which still have the same structure of grouping objects by &#8216;type&#8217;.</p>
<p>Consider instead, the possibility of grouping features together (this will of course mean amending the view engine and the controller factory &#8211;  although this is very little bother in practise)</p>
<p><a href="http://codebetter.com/robashton/files/2011/06/features.png"><img class="alignnone size-medium wp-image-28" src="http://codebetter.com/robashton/files/2011/06/features-212x300.png" alt="" width="212" height="300" /></a></p>
<p>Doing this might make you think again about not creating single-action controllers as suddenly the project becomes a lot easier to navigate, even to those new to the project.</p>
<p><strong>The limitations of a fixed request pipeline</strong></p>
<p>Touched on briefly a few times so far, is that we&#8217;re making compromises to deal with the limitations of the fixed request pipeline present in ASP.NET MVC.<br />
Well, as discussed by Jeremy in <a href="http://codebetter.com/jeremymiller/2011/01/09/fubumvcs-internal-runtime-the-russian-doll-model-and-how-it-compares-to-asp-net-mvc-and-openrasta/">this post</a>, frameworks like Fubu or OpenRasta work along the basis of there being some sort of request, and a series of actions that happen along that request. Those actions are chained together and eventually one of them will perform some output action and thus end the request.</p>
<p>This looks something like this:</p>
<pre class="brush: csharp; title: ; notranslate" title="">
    public interface IPipelineElement
    {
        void Handle(IRequest request);
    }

    public interface IRequest
    {
        void SetData(T input);
        T GetData();
    }

</pre>
<p>Where we might have:</p>
<pre class="brush: csharp; title: ; notranslate" title="">
ModelBinder : IPipelineElement {}
JsonOutput : IPipelineElement {}
CommandHandler : IPipelineElement {}
Validation : IPipelineElement {}
RequestLogger : IPipelineElement {}
</pre>
<p>And these can be strung together in whatever order the bootstrapper determines, each putting items in and out of the request and each being testable in isolation (Given these inputs to the request, I expect these outputs when this pipeline element is executed.)</p>
<p>ASP.NET MVC does not work like this, instead you have a <em>Controller </em>which is where your coordination occurs, you have an <em>ActionResult </em>which is where your output occurs, and you have <em>Filters </em>which is where code that should be executed before all that goes.</p>
<p>With ASP.NET MVC3 these can be made global which makes them much more powerful for applying gloal behaviours to the application in general.<br />
The problem with the filters is that they are not equipped for working in the same manner as a flexible pipeline, you can put perhaps some ORM management in them (Transactions), Binding, and perhaps some Validation &#8211; but these filters won&#8217;t typically be interacting with one another (whereas with the pipeline system, they&#8217;re chained together in an explicitly defined order).</p>
<p>The point is, this is how it works, and fighting it is futile &#8211; trying to write an application on top of ASP.NET MVC in a generic pipeline pattern just leads to pain and confusion.</p>
<p>In the above examples, rather than try to do this, I&#8217;ve used ActionResults for my output and tested that I received them, binding takes place in the filters, as do probably common things like disable session, error handling, transaction management, but all the calls *into* my business logic goes into the controller.</p>
<p>It&#8217;s explicit and it&#8217;s simple and it&#8217;s good enough for 90% of us.</p>
<p>Yes, you can split it out and set the controller to just fire off commands to your domain, that&#8217;s cool too - if you need it, the rest of this article still applies in this case except the nomenclature of the models and controllers will change.</p>
<p><strong>Summary</strong></p>
<p><strong> </strong>What do you consider to be your goals to be when writing code? Testability? Maintainability? Readability?  Code beauty? A Happy customer?</p>
<p>Obviously none of these are not mutually exclusive, but often we find as developers we&#8217;re either sacrificing our code quality to keep the customer happy or telling the customer we&#8217;re sorry we can&#8217;t deliver on time because we &#8220;have some refactoring to do&#8221;.</p>
<p>Whatever the reality it is obvious that as developers we&#8217;re spending a lot of time fighting either ourselves or our technology stacks to get our jobs done effectively.</p>
<p>I open with this question because most of the people who dislike ASP.NET MVC are having a go at it because it doesn&#8217;t allow them to work in a certain way &#8211; it gets in their way of meeting the above goals in the manner to which they desire.</p>
<p>When you choose a framework, you are subscribing yourself to some of the philosophies of the developer(s) who designed that framework, I am becoming more and more convinced of this over time &#8211; and while frameworks exist that are &#8220;highly customisable&#8221; that doesn&#8217;t make this fact doesn&#8217;t go away &#8211; and indeed because they generally have a higher barrier to entry than their more &#8220;on rails&#8221; counter-parts there are some genuinely good reasons for avoiding them.</p>
<p>It is this that distinguishes, a framework from a library, and in my delvings into technology stacks on top of systems like node.js most of my development has been done by pulling libraries together, then writing code to do things &#8220;the way the application features demand&#8221;.</p>
<p>In other words, frameworks are typically opinionated, and in my opinion, in order to be a good framework, those opinions need to be present, and they need to be loud and clear, and the application being hosted in that framework need to agree wth those opinions.</p>
<p>I think one of the problems with ASP.NET MVC is that there very few *strong* opinions surfacing in it, other than &#8220;it must be easy to demo at TechEd&#8221; and &#8220;it must be easy to get started with&#8221; &#8211; contrasted with say, the focus in FubuMVC on testability, conventions and SOLID, DRY principles &#8211; and the focus in Rails in being able to deliver 90% of what the customer wants with ease.</p>
<p>If you are going to use ASP.NET MVC, then don&#8217;t try to write code in a manner to which it is not capable of doing, keep things explicit, keep things simple, and keep pushing your code inwards to places where it isn&#8217;t directly touching the framework.</p>
<p>You&#8217;ll find yourself happier as a consequence, because you&#8217;re not spending<br />
all of your time trying to fight the framework. Where ASP.NET MVC provides very clear extensibility, don&#8217;t be afraid of using it to re-shape your application to keep things tidy.</p>
<p>There are good stacks available on top of .NET itself, from minimalist frameworks like NancyFX + Simple.Data etc all the way to full on opinionated beasts like Fubu, ASP.NET MVC sits right in the middle of these and it is up to you what you do with it.</p>
<p>If you find yourself fighting the framework, then either switch to something that works the way you want it to work, or make compromises &#8211; it&#8217;s simple, application development is only ever as painful as you make it.</p>
											</div><!-- .entry-content -->

					<div id="entry-author-info">
						<div id="author-avatar">
							<img alt='' src='http://1.gravatar.com/avatar/b6a6693f03003f7ab0f9b0882e9c2dde?s=60&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G' class='avatar avatar-60 photo' height='60' width='60' />						</div><!-- #author-avatar 	-->
						<div id="author-description">
							<h2>About Rob Ashton</h2>
							I'm @robashton, a freelance software consultant from the UK and currently based in Belgium, I write Javascript and C# for a living and spend my spare time learning and sharing those things that I have learned.							<div id="author-link">
								<a href="http://codebetter.com/robashton/author/rashton/" title="View all posts by Rob Ashton">View all posts by Rob Ashton &rarr;</a>
							</div><!-- #author-link	-->
						</div><!-- #author-description	-->
					</div><!-- .entry-author-info -->

					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/robashton/category/asp-net/" title="View all posts in asp.net" rel="category tag">asp.net</a>, <a href="http://codebetter.com/robashton/category/mvc/" title="View all posts in mvc" rel="category tag">mvc</a>. Bookmark the <a href="http://codebetter.com/robashton/2011/06/13/finding-a-balance-with-asp-net-mv/" title="Permalink to Finding a balance with ASP.NET MVC" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/robashton/2011/06/13/finding-a-balance-with-asp-net-mv/feed/" title="Comments RSS to Finding a balance with ASP.NET MVC" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-19 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/robashton/2011/04/13/hello/" rel="prev"><span class="meta-nav">&larr;</span> Hello</a></div>
					<div class="nav-next"><a href="http://codebetter.com/robashton/2012/09/03/keeping-js-sane/" rel="next">Keeping JS Sane <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
                    <div id="dsq-content">


            <ul id="dsq-comments">
                    <li class="comment even thread-even depth-1" id="dsq-comment-65">
        <div id="dsq-comment-header-65" class="dsq-comment-header">
            <cite id="dsq-cite-65">
                <span id="dsq-author-user-65">Mvcvm</span>
            </cite>
        </div>
        <div id="dsq-comment-body-65" class="dsq-comment-body">
            <div id="dsq-comment-message-65" class="dsq-comment-message"><p>Quote&#8221;why do we want all the items under the Products URL?&#8221;</p>
<p>Precisely:<br />
/Products/Shipment<br />
/Products/Create<br />
/Products/Update<br />
will route to different controllers. This one is not on MVC.</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-63">
        <div id="dsq-comment-header-63" class="dsq-comment-header">
            <cite id="dsq-cite-63">
http://www.facebook.com/andrei.rinea                <span id="dsq-author-user-63">Andrei Rinea</span>
            </cite>
        </div>
        <div id="dsq-comment-body-63" class="dsq-comment-body">
            <div id="dsq-comment-message-63" class="dsq-comment-message"><p>&#8220;You can write FORTRAN in any language&#8221;</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-62">
        <div id="dsq-comment-header-62" class="dsq-comment-header">
            <cite id="dsq-cite-62">
                <span id="dsq-author-user-62">Anonymous</span>
            </cite>
        </div>
        <div id="dsq-comment-body-62" class="dsq-comment-body">
            <div id="dsq-comment-message-62" class="dsq-comment-message"><p>And yes &#8211; although I&#8217;ve always tended towards making a formal separation between my reads and my writes, using some CQRSy language means people know what I&#8217;m on about <img src='http://codebetter.com/robashton/wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' /> </p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-61">
        <div id="dsq-comment-header-61" class="dsq-comment-header">
            <cite id="dsq-cite-61">
                <span id="dsq-author-user-61">Anonymous</span>
            </cite>
        </div>
        <div id="dsq-comment-body-61" class="dsq-comment-body">
            <div id="dsq-comment-message-61" class="dsq-comment-message"><p>I&#8217;m afraid not, I&#8217;d like to do it again sometime to a more receptive audience though, think I could probably structure it better too now.</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-60">
        <div id="dsq-comment-header-60" class="dsq-comment-header">
            <cite id="dsq-cite-60">
                <span id="dsq-author-user-60">Anonymous</span>
            </cite>
        </div>
        <div id="dsq-comment-body-60" class="dsq-comment-body">
            <div id="dsq-comment-message-60" class="dsq-comment-message"><p>What gives you that impression? I&#8217;m *almost* encouraging its use in this blog post.</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-59">
        <div id="dsq-comment-header-59" class="dsq-comment-header">
            <cite id="dsq-cite-59">
                <span id="dsq-author-user-59">Johan Nilsson</span>
            </cite>
        </div>
        <div id="dsq-comment-body-59" class="dsq-comment-body">
            <div id="dsq-comment-message-59" class="dsq-comment-message"><p>As always extremely informative! Love your articles and looking forward to the next one.<br />
Feels like this one was a bit CQRS influenced : ) There wouldn&#8217;t perhaps exist a video of your talk? Would love to hear the whole thing.</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-58">
        <div id="dsq-comment-header-58" class="dsq-comment-header">
            <cite id="dsq-cite-58">
                <span id="dsq-author-user-58">Anonymous</span>
            </cite>
        </div>
        <div id="dsq-comment-body-58" class="dsq-comment-body">
            <div id="dsq-comment-message-58" class="dsq-comment-message"><p>It Seems that you wanna to kill ASP.NET MVC.</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-56">
        <div id="dsq-comment-header-56" class="dsq-comment-header">
            <cite id="dsq-cite-56">
                <span id="dsq-author-user-56">Simon</span>
            </cite>
        </div>
        <div id="dsq-comment-body-56" class="dsq-comment-body">
            <div id="dsq-comment-message-56" class="dsq-comment-message"><p>&#8220;MVC actually not being that bad so long as you thought about your code.&#8221;</p>
<p>Thinking about your code?  Why?  google.com, CTRL+C, CTRL+V <img src='http://codebetter.com/robashton/wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' /> </p>
<p>Don&#8217;t understand why they take it personally.  YOU ARE NOT YOUR CODE.  It&#8217;s good if someone tells you it&#8217;s s**t&#8230; as long as they explain why and offer an alternative, which I think you did.</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-55">
        <div id="dsq-comment-header-55" class="dsq-comment-header">
            <cite id="dsq-cite-55">
                <span id="dsq-author-user-55">Anonymous</span>
            </cite>
        </div>
        <div id="dsq-comment-body-55" class="dsq-comment-body">
            <div id="dsq-comment-message-55" class="dsq-comment-message"><p>That was exactly the intent, it was a rant, but leaning towards ASP.NET MVC actually not being that bad so long as you thought about your code.</p>
<p> On reflection, I think the people who got annoyed took my jibing personally &#8211; (maybe they did all the things I said were bad things to do <img src='http://codebetter.com/robashton/wp-includes/images/smilies/icon_wink.gif' alt=';-)' class='wp-smiley' /> ).</p>
<p>Thanks for your kind words!</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-54">
        <div id="dsq-comment-header-54" class="dsq-comment-header">
            <cite id="dsq-cite-54">
                <span id="dsq-author-user-54">Anonymous</span>
            </cite>
        </div>
        <div id="dsq-comment-body-54" class="dsq-comment-body">
            <div id="dsq-comment-message-54" class="dsq-comment-message"><p>Crumbs, a regression!</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-53">
        <div id="dsq-comment-header-53" class="dsq-comment-header">
            <cite id="dsq-cite-53">
                <span id="dsq-author-user-53">Anonymous</span>
            </cite>
        </div>
        <div id="dsq-comment-body-53" class="dsq-comment-body">
            <div id="dsq-comment-message-53" class="dsq-comment-message"><p>In your examples, shouldn&#8217;t you be transferring to ~/418.aspx?<br />
 <img src='http://codebetter.com/robashton/wp-includes/images/smilies/icon_wink.gif' alt=';-)' class='wp-smiley' /> </p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-52">
        <div id="dsq-comment-header-52" class="dsq-comment-header">
            <cite id="dsq-cite-52">
                <span id="dsq-author-user-52">Anon</span>
            </cite>
        </div>
        <div id="dsq-comment-body-52" class="dsq-comment-body">
            <div id="dsq-comment-message-52" class="dsq-comment-message"><p>That will be great &#8211; looking forward to it!</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-51">
        <div id="dsq-comment-header-51" class="dsq-comment-header">
            <cite id="dsq-cite-51">
                <span id="dsq-author-user-51">Anonymous</span>
            </cite>
        </div>
        <div id="dsq-comment-body-51" class="dsq-comment-body">
            <div id="dsq-comment-message-51" class="dsq-comment-message"><p>Yeah, that makes a lot of sense actually, thanks!!</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-50">
        <div id="dsq-comment-header-50" class="dsq-comment-header">
            <cite id="dsq-cite-50">
                <span id="dsq-author-user-50">Simon</span>
            </cite>
        </div>
        <div id="dsq-comment-body-50" class="dsq-comment-body">
            <div id="dsq-comment-message-50" class="dsq-comment-message"><p>Hey Rob,</p>
<p>I was at your talk on Saturday and &#8211; unlike most of the people on &#8216;heckle&#8217; &#8211; thought it was brilliant!  I enjoy a good rant so liked your style!  And in the end it was quite positive about MVC really.  Think some people didn&#8217;t get your point (or they did and I&#8217;m wrong).</p>
<p>It made me laugh and I learnt a few ideas to take away so perfect session for me.</p>
<p>Thanks for giving up your time.</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-49">
        <div id="dsq-comment-header-49" class="dsq-comment-header">
            <cite id="dsq-cite-49">
                <span id="dsq-author-user-49">Anonymous</span>
            </cite>
        </div>
        <div id="dsq-comment-body-49" class="dsq-comment-body">
            <div id="dsq-comment-message-49" class="dsq-comment-message"><p>(Again, speaking from the perspective of a typical .NET shop and not an awesome one stocked with awesome people who have no problems with unfamiliar structures)</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-48">
        <div id="dsq-comment-header-48" class="dsq-comment-header">
            <cite id="dsq-cite-48">
                <span id="dsq-author-user-48">Anonymous</span>
            </cite>
        </div>
        <div id="dsq-comment-body-48" class="dsq-comment-body">
            <div id="dsq-comment-message-48" class="dsq-comment-message"><p>As soon as you start building a framework on a framework, as soon as you reach the point where you think an upgrade from MVC3 to MVC4 might be difficult, as soon as you think you&#8217;re being clever by bending the framework to your will?</p>
<p>In the above case, it&#8217;s meant as a bridge while moving an application to Fubu, it&#8217;s a Good Thing(tm)  - but going forwards if that wasn&#8217;t the plan it would likely be a maintenance burden &#8211; especially as folk left the team and new ones came in.</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-47">
        <div id="dsq-comment-header-47" class="dsq-comment-header">
            <cite id="dsq-cite-47">
                <span id="dsq-author-user-47">Anonymous</span>
            </cite>
        </div>
        <div id="dsq-comment-body-47" class="dsq-comment-body">
            <div id="dsq-comment-message-47" class="dsq-comment-message"><p>No, I am thinking about putting one together on top of RavenDB though</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-46">
        <div id="dsq-comment-header-46" class="dsq-comment-header">
            <cite id="dsq-cite-46">
                <span id="dsq-author-user-46">Anonymous</span>
            </cite>
        </div>
        <div id="dsq-comment-body-46" class="dsq-comment-body">
            <div id="dsq-comment-message-46" class="dsq-comment-message"><p>Hey Rob,<br />
Why do you consider such a solution as &#8216;fighting&#8217;? Honestly curious to know&#8230; Do you believe this could cause more problems than benefit? In what way? Would truly appreciate an answer <img src='http://codebetter.com/robashton/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> </p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-45">
        <div id="dsq-comment-header-45" class="dsq-comment-header">
            <cite id="dsq-cite-45">
http://twitter.com/MikaelKoskinen                <span id="dsq-author-user-45">Mikael Koskinen</span>
            </cite>
        </div>
        <div id="dsq-comment-body-45" class="dsq-comment-body">
            <div id="dsq-comment-message-45" class="dsq-comment-message"><p>Thanks, this was a great post! </p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-44">
        <div id="dsq-comment-header-44" class="dsq-comment-header">
            <cite id="dsq-cite-44">
                <span id="dsq-author-user-44">Dotnetcoder</span>
            </cite>
        </div>
        <div id="dsq-comment-body-44" class="dsq-comment-body">
            <div id="dsq-comment-message-44" class="dsq-comment-message"><p>Do you have any recommendation for a sample MVC app for download that followed the architecture specified in your article. </p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-43">
        <div id="dsq-comment-header-43" class="dsq-comment-header">
            <cite id="dsq-cite-43">
http://twitter.com/akshay123                <span id="dsq-author-user-43">akshay123</span>
            </cite>
        </div>
        <div id="dsq-comment-body-43" class="dsq-comment-body">
            <div id="dsq-comment-message-43" class="dsq-comment-message"><p>Rob &#8211; I think this was truely an awesome article. Opened my eyes.<br />
I like to think that w/ MVC next release we would see simpler async controllers with &#8220;await&#8221;.</p>
<p>If you truly want to create a pipeline approach then why not use PRG Pattern &#8211;<br />
<a href="http://weblogs.asp.net/rashid/archive/2009/04/01/asp-net-mvc-best-practices-part-1.aspx" rel="nofollow">http://weblogs.asp.net/rashid/archive/2009/04/01/asp-net-mvc-best-practices-part-1.aspx</a> </p>
<p>Rob, I m loving your articles, this and ones of RavenDb &#8211; thank you. </p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-42">
        <div id="dsq-comment-header-42" class="dsq-comment-header">
            <cite id="dsq-cite-42">
                <span id="dsq-author-user-42">Anonymous</span>
            </cite>
        </div>
        <div id="dsq-comment-body-42" class="dsq-comment-body">
            <div id="dsq-comment-message-42" class="dsq-comment-message"><p>Yeah, I fell asleep in my car after telling everybody they were idiots, sorry if you were one of them or you missed the second talk where I planned on doing it again <img src='http://codebetter.com/robashton/wp-includes/images/smilies/icon_wink.gif' alt=';-)' class='wp-smiley' /> </p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-41">
        <div id="dsq-comment-header-41" class="dsq-comment-header">
            <cite id="dsq-cite-41">
                <span id="dsq-author-user-41">DDD SW Attendee</span>
            </cite>
        </div>
        <div id="dsq-comment-body-41" class="dsq-comment-body">
            <div id="dsq-comment-message-41" class="dsq-comment-message"><p>You done the dirty on DDD SW <img src='http://codebetter.com/robashton/wp-includes/images/smilies/icon_sad.gif' alt=':-(' class='wp-smiley' />  Boooo!</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-40">
        <div id="dsq-comment-header-40" class="dsq-comment-header">
            <cite id="dsq-cite-40">
                <span id="dsq-author-user-40">Mylyne</span>
            </cite>
        </div>
        <div id="dsq-comment-body-40" class="dsq-comment-body">
            <div id="dsq-comment-message-40" class="dsq-comment-message"><p>Agreed &#8211; why should we have to re-invent the wheel if people like Rob have come up with patterns that have been discovered after using MVC for a long time? Thanks Rob for sharing your thoughts.</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-39">
        <div id="dsq-comment-header-39" class="dsq-comment-header">
            <cite id="dsq-cite-39">
                <span id="dsq-author-user-39">Anon</span>
            </cite>
        </div>
        <div id="dsq-comment-body-39" class="dsq-comment-body">
            <div id="dsq-comment-message-39" class="dsq-comment-message"><p>Great article Rob. I am new to MVC (but have been working with WebForms for many years) and have often wondered the proper way to build enterprise scale MVC &#8211; the Hello World demos on the web just aren&#8217;t suffice &#8211; I really need articles like this to show me how it should be done in the real world. Great work!</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-38">
        <div id="dsq-comment-header-38" class="dsq-comment-header">
            <cite id="dsq-cite-38">
http://twitter.com/klabranche                <span id="dsq-author-user-38">Kevin LaBranche</span>
            </cite>
        </div>
        <div id="dsq-comment-body-38" class="dsq-comment-body">
            <div id="dsq-comment-message-38" class="dsq-comment-message"><p>Something to chew on that&#8217;s for sure!  Thanks Rob.</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-37">
        <div id="dsq-comment-header-37" class="dsq-comment-header">
            <cite id="dsq-cite-37">
                <span id="dsq-author-user-37">Anonymous</span>
            </cite>
        </div>
        <div id="dsq-comment-body-37" class="dsq-comment-body">
            <div id="dsq-comment-message-37" class="dsq-comment-message"><p>Yeah, I actually saw that in the mailing list &#8211; but that comes under the category of fighting for me <img src='http://codebetter.com/robashton/wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' /> </p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-36">
        <div id="dsq-comment-header-36" class="dsq-comment-header">
            <cite id="dsq-cite-36">
http://murrayon.net/                <span id="dsq-author-user-36">Mike Murray</span>
            </cite>
        </div>
        <div id="dsq-comment-body-36" class="dsq-comment-body">
            <div id="dsq-comment-message-36" class="dsq-comment-message"><p>I realize this isn&#8217;t exactly the point of your post, but a coworker of mine developed a way to have the flexible pipelines that are FubuMVC behavior chains in an ASP.NET MVC codebase. We used it for a while in production before switching to full-on FubuMVC.</p>
<p><a href="http://paceyourself.net/2011/06/11/mvctofubu---transition-your-website-from-aspnet-mvc-to-fubumvc-part-1/" rel="nofollow">http://paceyourself.net/2011/06/11/mvctofubu&#8212;transition-your-website-from-aspnet-mvc-to-fubumvc-part-1/</a></p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-35">
        <div id="dsq-comment-header-35" class="dsq-comment-header">
            <cite id="dsq-cite-35">
http://sm-art.biz                <span id="dsq-author-user-35">Artëm Smirnov</span>
            </cite>
        </div>
        <div id="dsq-comment-body-35" class="dsq-comment-body">
            <div id="dsq-comment-message-35" class="dsq-comment-message"><p>&#8220;most of my development has been done by pulling libraries together, then<br />
 writing code to do things “the way the application features demand”.&#8221; </p>
<p>This is why I think three times before approaching a new framework. </p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-34">
        <div id="dsq-comment-header-34" class="dsq-comment-header">
            <cite id="dsq-cite-34">
http://sm-art.biz                <span id="dsq-author-user-34">Artëm Smirnov</span>
            </cite>
        </div>
        <div id="dsq-comment-body-34" class="dsq-comment-body">
            <div id="dsq-comment-message-34" class="dsq-comment-message"><p>&#8220;most of my development has been done by pulling libraries together, then<br />
 writing code to do things “the way the application features demand”.&#8221; </p>
<p>This is why I think three times before approaching a new framework. </p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-33">
        <div id="dsq-comment-header-33" class="dsq-comment-header">
            <cite id="dsq-cite-33">
http://mattiovalentino.com/                <span id="dsq-author-user-33">Mattio</span>
            </cite>
        </div>
        <div id="dsq-comment-body-33" class="dsq-comment-body">
            <div id="dsq-comment-message-33" class="dsq-comment-message"><p>The refactoring steps you go through are really interesting. I&#8217;d love to see more posts on how to get out of situations where the code has become bloated.</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-32">
        <div id="dsq-comment-header-32" class="dsq-comment-header">
            <cite id="dsq-cite-32">
                <span id="dsq-author-user-32">Anonymous</span>
            </cite>
        </div>
        <div id="dsq-comment-body-32" class="dsq-comment-body">
            <div id="dsq-comment-message-32" class="dsq-comment-message"><p>Wow, great post!</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-31">
        <div id="dsq-comment-header-31" class="dsq-comment-header">
            <cite id="dsq-cite-31">
                <span id="dsq-author-user-31">Battaile</span>
            </cite>
        </div>
        <div id="dsq-comment-body-31" class="dsq-comment-body">
            <div id="dsq-comment-message-31" class="dsq-comment-message"><p>Except that he didn&#8217;t say that unit tests were the only way to test things, nice strawman though.</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-30">
        <div id="dsq-comment-header-30" class="dsq-comment-header">
            <cite id="dsq-cite-30">
                <span id="dsq-author-user-30">Anonymous</span>
            </cite>
        </div>
        <div id="dsq-comment-body-30" class="dsq-comment-body">
            <div id="dsq-comment-message-30" class="dsq-comment-message"><p>Basically, I&#8217;m saying that you can build good apps on top of ASP.NET MVC so long as you follow a few basic principles and don&#8217;t spend all your time framework building around it.</p>
<p>It depends on what your goals are, if you want something that&#8217;s completely built out of testable components, then you want to hit up Fubu (which is now available on NuGet last I checked) &#8211; if you want to just put something together and you&#8217;re willing to make a few compromises, ASP.NET MVC is fine too.</p>
<p>I wouldn&#8217;t go building something from the ground up in .NET, because for the most part the facilities for this don&#8217;t exist in an easily usable manner (emphasis on frameworks in the .NET space)</p>
<p>Manos is probably your best bet for doing something like that if you want to try, or if you want to go all minimalist, hit up NancyFX.</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-29">
        <div id="dsq-comment-header-29" class="dsq-comment-header">
            <cite id="dsq-cite-29">
http://harriyott.com                <span id="dsq-author-user-29">Simon Harriyott</span>
            </cite>
        </div>
        <div id="dsq-comment-body-29" class="dsq-comment-body">
            <div id="dsq-comment-message-29" class="dsq-comment-message"><p>Interesting. I tend to use a framework and initially do what it takes to get it to work. Once I&#8217;ve got that far, I then go on to the application(s) itself, and never really get back into learning the framework properly. Thanks for writing this &#8211; it&#8217;s prompted me to rethink how I work with ASP.NET MVC.</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-28">
        <div id="dsq-comment-header-28" class="dsq-comment-header">
            <cite id="dsq-cite-28">
                <span id="dsq-author-user-28">Anonymous</span>
            </cite>
        </div>
        <div id="dsq-comment-body-28" class="dsq-comment-body">
            <div id="dsq-comment-message-28" class="dsq-comment-message"><p>Don&#8217;t feed the trolls <img src='http://codebetter.com/robashton/wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' />  (Unless I genuinely have missed something, in which case I&#8217;d be glad to hear what that is)</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-27">
        <div id="dsq-comment-header-27" class="dsq-comment-header">
            <cite id="dsq-cite-27">
                <span id="dsq-author-user-27">Anonymous</span>
            </cite>
        </div>
        <div id="dsq-comment-body-27" class="dsq-comment-body">
            <div id="dsq-comment-message-27" class="dsq-comment-message"><p>Yeah &#8211; whatever code decided it needed such a role (Actually, I&#8217;d hesitate to call a property bag against session state a role) would receive this handily via its constructor.</p>
<p>The advantage is that you can use nice names for everything, your code will read nicer (you can also hide any faffy stuff behind the interface), and your tests will be cleaner and more expressive.</p>
<p>(Also, it hides the  magic strings which is why most people do such things)</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-26">
        <div id="dsq-comment-header-26" class="dsq-comment-header">
            <cite id="dsq-cite-26">
                <span id="dsq-author-user-26">Anonymous</span>
            </cite>
        </div>
        <div id="dsq-comment-body-26" class="dsq-comment-body">
            <div id="dsq-comment-message-26" class="dsq-comment-message"><p>Yeah, sorry about that &#8211; I doubt it was any failing on your part, I managed to piss off a fair few people with this one <img src='http://codebetter.com/robashton/wp-includes/images/smilies/icon_wink.gif' alt=';-)' class='wp-smiley' /> </p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-25">
        <div id="dsq-comment-header-25" class="dsq-comment-header">
            <cite id="dsq-cite-25">
                <span id="dsq-author-user-25">Anonymous</span>
            </cite>
        </div>
        <div id="dsq-comment-body-25" class="dsq-comment-body">
            <div id="dsq-comment-message-25" class="dsq-comment-message"><p>Yes indeed, obviously you can take my philosophy, dump it by the wayside and apply whatever your own thinking is &#8211; everybody works in their own way.</p>
<p>Thanks for the kind words <img src='http://codebetter.com/robashton/wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' /> </p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-24">
        <div id="dsq-comment-header-24" class="dsq-comment-header">
            <cite id="dsq-cite-24">
http://twitter.com/NathanGloyn                <span id="dsq-author-user-24">Nathan Gloyn</span>
            </cite>
        </div>
        <div id="dsq-comment-body-24" class="dsq-comment-body">
            <div id="dsq-comment-message-24" class="dsq-comment-message"><p>No you&#8217;ve answered the right question <img src='http://codebetter.com/robashton/wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' />  was a continuation of our brief twitter conversation on Sat.</p>
<p>So to just check I presume you&#8217;d inject the IStoreUserInfo into the controller (or controllers) that needed it?</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-23">
        <div id="dsq-comment-header-23" class="dsq-comment-header">
            <cite id="dsq-cite-23">
                <span id="dsq-author-user-23">Anonymous</span>
            </cite>
        </div>
        <div id="dsq-comment-body-23" class="dsq-comment-body">
            <div id="dsq-comment-message-23" class="dsq-comment-message"><p>I&#8217;d probably not do an IStoreSessionState, because you&#8217;re still only exposing a key value interface, and that hasn&#8217;t got any meaning &#8211; consider instead however, providing an interface that maps onto the actual need you have, which directly uses session itself.</p>
<p>For example, for whatever reason I want to store some user info in the session (on a side note, I&#8217;d probably use cache for this), I might have an interface which looks like</p>
<p>IStoreUserInfo</p>
<p>And against this, methods/properties to get strongly typed data from the session. (Or even better, to perform the actions based on this state and not bother exposing the state directly at all &#8211; but this is perhaps going too far in most single-shot cases)</p>
<p>Is this what you were looking for or have I answered the wrong question? I have a habit of doing that.</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-20">
        <div id="dsq-comment-header-20" class="dsq-comment-header">
            <cite id="dsq-cite-20">
http://twitter.com/RobAshton                <span id="dsq-author-user-20">Rob Ashton</span>
            </cite>
        </div>
        <div id="dsq-comment-body-20" class="dsq-comment-body">
            <div id="dsq-comment-message-20" class="dsq-comment-message"><p>While you do raise a valid point (and in a lot of applications this really IS all that is needed),  my only concern with relying on this kind of testing is that you&#8217;re going to lack the instant feedback that a series of fast running tests would give you.</p>
<p>We also have other benefits in writing code that actually captures meaning other than testing, I think I&#8217;d find that most of my controller actions aren&#8217;t worth testing because they&#8217;re so thin but I&#8217;d still write the code this way because it&#8217;s so easy to understand.</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-19">
        <div id="dsq-comment-header-19" class="dsq-comment-header">
            <cite id="dsq-cite-19">
http://twitter.com/NathanGloyn                <span id="dsq-author-user-19">Nathan Gloyn</span>
            </cite>
        </div>
        <div id="dsq-comment-body-19" class="dsq-comment-body">
            <div id="dsq-comment-message-19" class="dsq-comment-message"><p>Rob, in some of the earlier bad code you showed the use of session and then swapped that out with a kettle.</p>
<p>My question is when you do need to store something in session how would you go about it?</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-17">
        <div id="dsq-comment-header-17" class="dsq-comment-header">
            <cite id="dsq-cite-17">
http://ramakantyadav.com                <span id="dsq-author-user-17">Ramakant</span>
            </cite>
        </div>
        <div id="dsq-comment-body-17" class="dsq-comment-body">
            <div id="dsq-comment-message-17" class="dsq-comment-message"><p>Good post on how not to do things. Very useful.</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-16">
        <div id="dsq-comment-header-16" class="dsq-comment-header">
            <cite id="dsq-cite-16">
                <span id="dsq-author-user-16">Rodrigo Dumont</span>
            </cite>
        </div>
        <div id="dsq-comment-body-16" class="dsq-comment-body">
            <div id="dsq-comment-message-16" class="dsq-comment-message"><p>Very interesting post, Rob! I think that many of your arguments are a little too relative to your philosophy and point of view, but hey, the thing about points of view is that everybody has one, right?</p>
<p>What I actually liked the most was the part about making the framework work FOR you, and choosing how you can get the most out of a tool set. Very well written, and breaks a lot of the psychological chains that usually impel us to write MIX or TechEd keynote-style code.</p>
<p>Kudos!</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-15">
        <div id="dsq-comment-header-15" class="dsq-comment-header">
            <cite id="dsq-cite-15">
                <span id="dsq-author-user-15">Jesse Williamson</span>
            </cite>
        </div>
        <div id="dsq-comment-body-15" class="dsq-comment-body">
            <div id="dsq-comment-message-15" class="dsq-comment-message"><p> What about this post indicates a lack of understanding?</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-13">
        <div id="dsq-comment-header-13" class="dsq-comment-header">
            <cite id="dsq-cite-13">
http://twitter.com/zvolkov                <span id="dsq-author-user-13">Andrei Volkov</span>
            </cite>
        </div>
        <div id="dsq-comment-body-13" class="dsq-comment-body">
            <div id="dsq-comment-message-13" class="dsq-comment-message"><p>Wow you must be the sanest person in the whole .NET world. Thanks to you I might actually checkout Fubu. Although I&#8217;m learning Rails big time now (after being a Microsoft bitch for like 15 years) so by the end of the week Fubu might not be as relevant <img src='http://codebetter.com/robashton/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> </p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-12">
        <div id="dsq-comment-header-12" class="dsq-comment-header">
            <cite id="dsq-cite-12">
http://profiles.google.com/naikrovek                <span id="dsq-author-user-12">jeremiah johnson</span>
            </cite>
        </div>
        <div id="dsq-comment-body-12" class="dsq-comment-body">
            <div id="dsq-comment-message-12" class="dsq-comment-message"><p>The thing is, I don&#8217;t have an understanding of MVC framework yet, either, and I don&#8217;t have anyone to fall on if I have questions.  Unfortunately I have only myself to rely on here, and I want to make sure I head down the right path.</p>
<p>I haven&#8217;t written it off, I&#8217;m just trying to understand the pros and cons a bit better.  </p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-11">
        <div id="dsq-comment-header-11" class="dsq-comment-header">
            <cite id="dsq-cite-11">
                <span id="dsq-author-user-11">Jake</span>
            </cite>
        </div>
        <div id="dsq-comment-body-11" class="dsq-comment-body">
            <div id="dsq-comment-message-11" class="dsq-comment-message"><p>The person writing this post clearly doesn&#8217;t have a true in-depth understanding of the MVC framework.  Don&#8217;t write it off just because one person couldn&#8217;t wrap his hear around it or learn best practices commonly associated with the framework.</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-10">
        <div id="dsq-comment-header-10" class="dsq-comment-header">
            <cite id="dsq-cite-10">
                <span id="dsq-author-user-10">fschwiet</span>
            </cite>
        </div>
        <div id="dsq-comment-body-10" class="dsq-comment-body">
            <div id="dsq-comment-message-10" class="dsq-comment-message"><p>&#8220;Clearly I can’t test this, as I’m directly accessing the base controller which “conveniently” gives me access to all the gubbins that ASP.NET ships with.&#8221;</p>
<p>That code may be awkward to unit test, but its fairly simple to write an integration test that makes an HTTP request and checks that the result is a redirect.  I guess with the rise of MVC and &#8220;testability&#8221; we&#8217;ve also got the mindset that unit tests are the only way to test things (they aren&#8217;t, and if you&#8217;re only writing unit tests I&#8217;d say you&#8217;re doing it wrong).</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-9">
        <div id="dsq-comment-header-9" class="dsq-comment-header">
            <cite id="dsq-cite-9">
http://twitter.com/302Redirect                <span id="dsq-author-user-9">Reza Mahmood</span>
            </cite>
        </div>
        <div id="dsq-comment-body-9" class="dsq-comment-body">
            <div id="dsq-comment-message-9" class="dsq-comment-message"><p>Great post &#8211; thanks for clearing all those points up into a nice cohesive blog post.  As one of the people in your DDDSW audience I sometimes felt lost as to what exactly your point was sometimes &#8211; a combination of my lack of comprehension and your lack of sleep!</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-8">
        <div id="dsq-comment-header-8" class="dsq-comment-header">
            <cite id="dsq-cite-8">
http://sbohlen.myopenid.com/                <span id="dsq-author-user-8">Steve Bohlen</span>
            </cite>
        </div>
        <div id="dsq-comment-body-8" class="dsq-comment-body">
            <div id="dsq-comment-message-8" class="dsq-comment-message"><p>Rob:</p>
<p>First, excellent post with some great examples.  Sorry I wasn&#8217;t able to catch the delivery of the talk but this blog post does a great job of wrapping it all up &#8212; thanks for taking the time to &#8216;convert&#8217; it to a blog post for those that couldn&#8217;t attend the talk.</p>
<p>Its interesting to me that you have settled on the conclusion of &#8216;work with your framework rather than against it&#8217; as that&#8217;s sort of the same conclusion I was using to defend a choice of MVC over WebForms (among other things) in this post over a year ago <a href="http://unhandled-exceptions.com/blog/index.php/2010/03/23/how-do-you-think-about-the-problem/" rel="nofollow">http://unhandled-exceptions.com/blog/index.php/2010/03/23/how-do-you-think-about-the-problem/</a></p>
<p>After all this time in between then and now that I have spent working with ASP.NET MVC, I&#8217;ve come to the further conclusion that while ASP.NET MVC is indeed closer to my &#8216;world view&#8217; than WebForms ever was, there&#8217;s still a very noticeable gap between it and my more ideal view of how to develop web applications.</p>
<p>You&#8217;ve done a stellar job of highlighting some of those exact pain-points that have begin to nag at me with ever-increasing volume and push me ever-closer to something like FUBU MVC for other than just experimentation on my part.</p>
<p>Great post &#8211;!</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-7">
        <div id="dsq-comment-header-7" class="dsq-comment-header">
            <cite id="dsq-cite-7">
http://profiles.google.com/naikrovek                <span id="dsq-author-user-7">jeremiah johnson</span>
            </cite>
        </div>
        <div id="dsq-comment-body-7" class="dsq-comment-body">
            <div id="dsq-comment-message-7" class="dsq-comment-message"><p>I&#8217;m about to start a new ASP.NET project here in about an hour, it was going to be using MVC3, my first, but now I don&#8217;t know&#8230; I understand the MVC architecture, I used it a lot in my JEE development career, but now you&#8217;ve got me thinking that the best way for me to proceed on ASP.NET is to basically roll my own app rather than use any framework at all.</p>
<p>I&#8217;m at this weird point where I have LOTS of JEE experience, but it&#8217;s been 3 years since I&#8217;ve really used any of those skills.  Also, I want to use ASP.NET a few times before I pass judgement on it.  I&#8217;m at this weird point where both options are equally attractive, and I&#8217;m not sure where to go.</p>
<p>Would you agree that starting without a web architecture framework at all is a valid way to go?  </p>
<p>Stupid question, possibly, but I wanted to ask.</p>
<p>Thanks.</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="dsq-comment-6">
        <div id="dsq-comment-header-6" class="dsq-comment-header">
            <cite id="dsq-cite-6">
http://twitter.com/mr_adubb_atl                <span id="dsq-author-user-6">A-Dubb Wimberly</span>
            </cite>
        </div>
        <div id="dsq-comment-body-6" class="dsq-comment-body">
            <div id="dsq-comment-message-6" class="dsq-comment-message"><p>Aah. I spoke to soon. Right on pal. Good post.</p>
</div>
        </div>
    </li>

    </li>
    <li class="comment even thread-even depth-1" id="dsq-comment-5">
        <div id="dsq-comment-header-5" class="dsq-comment-header">
            <cite id="dsq-cite-5">
http://twitter.com/mr_adubb_atl                <span id="dsq-author-user-5">A-Dubb Wimberly</span>
            </cite>
        </div>
        <div id="dsq-comment-body-5" class="dsq-comment-body">
            <div id="dsq-comment-message-5" class="dsq-comment-message"><p>Why wouldn&#8217;t you use a RedirectToActionResult instead of making your own Teapot&#8230; stuff?</p>
</div>
        </div>
    </li>

    </li>
            </ul>


        </div>

    </div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://codebetter.com/robashton/2011/06/13/finding-a-balance-with-asp-net-mv/';
    var disqus_identifier = '19 http://codebetter.com/robashton/?p=19';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'robashtoncodebetter';
    var disqus_title = "Finding a balance with ASP.NET MVC";
        var disqus_config = function () {
        var config = this; // Access to the config object

        /*
           All currently supported events:
            * preData — fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            var script = document.createElement('script');
            script.async = true;
            script.src = '?cf_action=sync_comments&post_id=19';

            var firstScript = document.getElementsByTagName( "script" )[0];
            firstScript.parentNode.insertBefore(script, firstScript);
        });
                    };
    var facebookXdReceiverPath = 'http://codebetter.com/robashton/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
        ],
        'trackback_url': "http:\/\/codebetter.com\/robashton\/2011\/06\/13\/finding-a-balance-with-asp-net-mv\/trackback\/"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
        dsq.src = 'http' + '://' + disqus_shortname + '.' + 'disqus.com' + '/embed.js?pname=wordpress&pver=2.73';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29416);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=2782afb'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29416&amp;n=2782afb' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29417);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=e94cea6'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29417&amp;n=e94cea6' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29418);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=9ba3022'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29418&amp;n=9ba3022' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29419);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=f467b52'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29419&amp;n=f467b52' /></a></noscript>
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(220407);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=68b8307'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=220407&amp;n=68b8307' /></a></noscript>				
				
				<ul class="xoxo">		
									</ul>	
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29421);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=3f8e353'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29421&amp;n=3f8e353' /></a></noscript>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="http://red-gate.com/">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="http://telerik.com">Telerik .NET Tools</a></li>
<li><a href="http://jetbrains.com/resharper/">JetBrains - ReSharper</a></li>
<li><a href="http://scootersoftware.com">Beyond Compare</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a></li>
<li><a href="http://umbraco.com" target="_blank">Umbraco</a></li>
<li><a href="http://nservicebus.com" target="_blank">NServiceBus</a></li>
<li><a href="http://ravendb.net" target="_blank">RavenDb</a></li>
<li><a href="http://www.websequencediagrams.com/" target="_blank">Web Sequence Diagrams</a></li>
	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '12<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPython.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = true; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>

<script type='text/javascript'>//<![CDATA[
    if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.4.2.min.js' type='text/javascript' %3E%3C/script%3E"));
    }//]]></script>
<script type='text/javascript' language='Javascript' src='http://s1.lqcdn.com/m.min.js?dt=2.3.110202.1'></script>
<script type='text/javascript' language='Javascript'> if(jQuery.LqmAds)jQuery.LqmAds();</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.476 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2012-11-26 14:34:55 -->

<!-- super cache -->