<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Lessons learned from a real-world focus on performance | Patrick Smacchia</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/patricksmacchia/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css?v=3912785705" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js?ver=3.4.2'></script>
<script type='text/javascript' src='http://dtym7iokkjlif.cloudfront.net/dough/1.0/recipe.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/patricksmacchia/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Composing Code Metrics Values' href='http://codebetter.com/patricksmacchia/2008/11/25/composing-code-metrics-values/' />
<link rel='next' title='Solid State Drive: Enhance developers&#8217; productivity' href='http://codebetter.com/patricksmacchia/2008/12/04/solid-state-drive-enhance-developers-productivity/' />
<meta name="generator" content="WordPress 3.4.2" />
<link rel='shortlink' href='http://codebetter.com/patricksmacchia/?p=86' />

<!-- All in One SEO Pack 1.6.13.2 by Michael Torbert of Semper Fi Web Design[83,163] -->
<link rel="canonical" href="http://codebetter.com/patricksmacchia/2008/12/01/lessons-learned-from-a-real-world-focus-on-performance/" />
<!-- /all in one seo pack -->
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.3.3" type="text/css" media="screen" />

<!-- Start Shareaholic OgTags -->

	<meta property='og:image' content='http://s3.amazonaws.com:80/CodeBetter/CommunityServer.Blogs.Components.WeblogFiles/patricksmacchia/OptimizationDec2008/ndepend-optimization-graph.png?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1919992098&amp;Signature=XFluknatiNW%2fBtlxk4EqI5oFfhw%3d' />

<!-- End Shareaholic OgTags -->

<meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/dc168cf39155d7b5d39f696ca94d5980.js?v=5302176208">/*Is Cache!*/</script>
                	
	<script type='text/javascript' src='http://d1.openx.org/spcjs.php?id=7744&amp;target=_blank'></script>
	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>
<!-- BuySellAds Ad Code -->
<script type="text/javascript">
(function(){
  var bsa = document.createElement('script');
     bsa.type = 'text/javascript';
     bsa.async = true;
     bsa.src = 'http://s3.buysellads.com/ac/bsa.js';
  (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);
})();
</script>
<!-- End BuySellAds Ad Code -->
</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">
			<!-- BuySellAds Zone Code -->
<div id="bsap_1276080" class="bsarocks bsap_4fe632babdccc2b4b049e4f08cc3c549"></div>
<!-- End BuySellAds Zone Code --></div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-86" class="post-86 post type-post status-publish format-standard hentry category-uncategorized">
					<h1 class="entry-title">Lessons learned from a real-world focus on performance</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/patricksmacchia/author/patricksmacchia/" title="View all posts by Patrick Smacchia">Patrick Smacchia</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/patricksmacchia/2008/12/01/lessons-learned-from-a-real-world-focus-on-performance/" title="9:31 am" rel="bookmark"><span class="entry-date">December 1, 2008</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/patricksmacchia/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/patricksmacchia/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><!-- Start Shareaholic LikeButtonSetTop Automatic --><!-- End Shareaholic LikeButtonSetTop Automatic --><p style="margin: 1pt 0cm">&nbsp;<br />
<br /><span lang="EN-US">I am glad to announce that<br />
we just released a new version of <a href="http://www.NDepend.com" target="_blank">NDepend&nbsp;</a></span><a href="http://www.NDepend.com" target="_blank"><span lang="EN-US"></span></a><span><span lang="EN-US">where the analysis phase<br />
duration has been divided by 4 and the memory consumption has been divided by<br />
2. </span></span></p>
<p style="margin: 1pt 0cm"><span lang="EN-US">&nbsp;</span></p>
<p style="margin: 1pt 0cm"><span lang="EN-US">An interesting question is:<span> </span><i>Does such a massive performance gain means that it was badly coded the first time</i>?<br />
Previous slower versions met several thousands of functional<br />
requirement needed to analyze properly any .NET application. In this<br />
sense, it was nicely coded. But still, there<br />
were room for improvement and my believe is that there is <i>always</i> room for better performance. Even on the current much faster<br />
version we identified several significant optimizations to be done. The downside<br />
is that this will require a lot of work. So the first lesson learned<br />
is that <b>there is always room for better<br />
performance. </b>We can complete this rule with the fact that <b>the amount of work to make a program run<br />
faster grows exponentially with the gain expected</b>.</span></p>
<p style="margin: 1pt 0cm"><span lang="EN-US">&nbsp;</span></p>
<p style="margin: 1pt 0cm"><span lang="EN-US">We quantified each<br />
performance gain source and we obtained this chart. As said we have a 75% gain obtained<br />
thanks to algorithm optimization, micro-optimization and parallelization. The<br />
current analysis duration (25% of the original analysis duration) can be split between 17% of the time spent in our<br />
code, and 8% of the time spent in tier code. In our case, tier code is <a href="/blogs/patricksmacchia/archive/2008/03/18/mono-cecil-vs-system-reflection.aspx" target="_blank">the code of<br />
Mono.Cecil</a>,<br />
used to build some object models of the assemblies analyzed.</span></p>
<p style="margin: 1pt 0cm"><span lang="EN-US">&nbsp;</span></p>
<p style="margin: 1pt 0cm"><span lang="EN-US">&nbsp;</span></p>
<p style="margin: 1pt 0cm"><span lang="EN-US"><img src="http://s3.amazonaws.com:80/CodeBetter/CommunityServer.Blogs.Components.WeblogFiles/patricksmacchia/OptimizationDec2008/ndepend-optimization-graph.png?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1919992098&amp;Signature=XFluknatiNW%2fBtlxk4EqI5oFfhw%3d" />&nbsp;</span></p>
<p style="margin: 1pt 0cm"><span lang="EN-US">&nbsp;</span></p>
<p style="margin: 1pt 0cm"><span lang="EN-US">The bulk of performance<br />
was obtained with algorithm improvement and this is not a surprise. IMHO the<br />
surprise comes from the relatively small gain obtained from parallelization. Indeed,<br />
we did some massive refactoring to parallelized the analysis with the <a href="http://ayende.com/Blog/archive/2008/11/21/parallel-monologues.aspx" target="_blank"><i>parallel monologue</i></a></span><a href="http://ayende.com/Blog/archive/2008/11/21/parallel-monologues.aspx" target="_blank"><span lang="EN-US"></span></a><span> <span lang="EN-US">idea in mind. Now each<br />
assembly is analyzed as a task that doesn&rsquo;t have <i>any</i> synchronization need with <i>any</i><br />
other task. In other words each task uses its own states that are not visible<br />
from the other tasks. Unfortunately this requirement is not enough to ensure<br />
proper scaling on the number of processor. While we get the 15% gain from<br />
between 1 and 2 processors, the gain is almost zero between 2 and 4 processors.<br />
We identified some<a href="http://msdn.microsoft.com/en-us/magazine/cc872851.aspx" target="_blank"> potential IO contentions and memory issues</a><br />
that will require more attention in the future. This leads to another lesson: <b>Don&rsquo;t expect that scaling on many processors<br />
will be something easy, even if you don&rsquo;t share states and don&rsquo;t use<br />
synchronization.</b></span></span></p>
<p style="margin: 1pt 0cm"><span lang="EN-US">&nbsp;</span></p>
<p style="margin: 1pt 0cm"><span lang="EN-US">When it comes to<br />
enhancing performance there is only one way to do things right: <b>measure</b> and focus your work on the part<br />
of the code that <b>really</b> takes the<br />
bulk of time, not the one that <b>you think</b><br />
takes the bulk of time. I have a quick real-world illustration. Personally I<br />
have always been amazed by <a href="/blogs/patricksmacchia/archive/2007/06/20/benefit-from-the-c-and-vb-net-compilers-perf.aspx" target="_blank">the performance of the C# and VB.NET compilers</a></span><a href="/blogs/patricksmacchia/archive/2007/06/20/benefit-from-the-c-and-vb-net-compilers-perf.aspx"><span lang="EN-US"></span></a><span lang="EN-US">. Imagine, it can compile in a few<br />
seconds thousands of source files that took dozens or even hundreds of man-year<br />
to be written. At analysis time, NDepend needs also to parse sources files but<br />
it does it partially to only obtain <a href="http://www.ndepend.com/Metrics.aspx#NbLinesOfComment" target="_blank">comment</a></span><a href="http://www.ndepend.com/Metrics.aspx#NbLinesOfComment" target="_blank"><span lang="EN-US"></span></a><span lang="EN-US"><a href="http://www.ndepend.com/Metrics.aspx#NbLinesOfComment" target="_blank"> </a>and <a href="http://www.ndepend.com/Metrics.aspx#CC" target="_blank">Cyclomatic Complexity</a>&nbsp;</span><a href="http://www.ndepend.com/Metrics.aspx#CC"><span lang="EN-US"></span></a><span lang="EN-US"> metrics. By measuring file loading time<br />
we had a good surprise: loading source file in memory is much cheaper than<br />
expected. For example, to load the 1728 C# sources files of NDepend it takes<br />
less than 0.2 seconds on the 13 seconds needed for a complete analysis of its own code. Now, knowing<br />
that it is almost free to load the source files in memory I am a bit less<br />
impressed by the performance of the C# and VB.NET compilers. And it leads to an<br />
important lesson: <b>NEVER anticipate the<br />
performance cost, ALWAYS measure it</b>. And the only professional way to<br />
measure is to rely on performance profiler tools. Actually, we use both<br />
<a href="http://www.jetbrains.com/profiler/" target="_blank">dotTrace from JetBrain</a></span><a href="http://www.jetbrains.com/profiler/" target="_blank"><span lang="EN-US"></span></a><span lang="EN-US"> and <a href="http://www.red-gate.com/Products/ants_profiler/index.htm" target="_blank">Red-Gate ANTS Profiler</a></span><a href="http://www.red-gate.com/Products/ants_profiler/index.htm" target="_blank"><span lang="EN-US"></span></a><span lang="EN-US"> and are happy with it.</span></p>
<p style="margin: 1pt 0cm"><span lang="EN-US">&nbsp;</span></p>
<p style="margin: 1pt 0cm"><span lang="EN-US">Something important<br />
concerning the measure of code performance is the percentage of time spent<br />
inside tier code, things like DB or network access. </span><span lang="EN-US">As we explained in the previous chart, in our case study<br />
35% of the analysis time is spent inside the Cecil code. We can infer from this<br />
number that if we want to have an analysis duration divided by 2 in the future,<br />
our code will need to run 4.3 faster! ((100 &ndash; 35) / (50 -35) = 4,3). This<br />
clearly shows the importance of another lesson: <b>assess your limits by measuring the percentage of time spent in tier code</b>.</span></p>
<p style="margin: 1pt 0cm"><span lang="EN-US">&nbsp;</span></p>
<p style="margin: 1pt 0cm"><span lang="EN-US">In the dissection of<br />
performance gain, an interesting point is the 15% gain obtained from<br />
micro-optimization. I mean things like using <a href="/blogs/patricksmacchia/archive/2008/11/19/an-easy-and-efficient-way-to-improve-net-code-performances.aspx" target="_blank">the right kind of loop</a></span><span lang="EN-US">, using <a href="/blogs/patricksmacchia/archive/2008/10/29/collections-and-performances.aspx" target="_blank">the right kind of<br />
collection</a></span><a href="http://codebetter.com/blogs/patricksmacchia/archive/2008/10/29/collections-and-performances.aspx" target="_blank"><span lang="EN-US"></span></a><span lang="EN-US">, preferring to deal with primitive<br />
CLR objects as <i>int </i>and <i>string </i>(POCO idea), choosing carefully between structures and classes, buffering<br />
properties getter results into local variables or even exposing<br />
non-private fields. I could summarized<br />
the lesson learned by the fact that <b>micro-optimizations<br />
are worth it while premature optimizations are the root of evil </b>(as <i>Donald Knuth</i> said a long time ago). The<br />
difference between micro-optimizations and premature optimizations is that the<br />
first ones are driven by measurement while the second ones are driven by<br />
guesses, intuitions and hunches.</span></p>
<p style="margin: 1pt 0cm"><span lang="EN-US"><br /></span></p>
<p style="margin: 1pt 0cm"><span lang="EN-US">Something not quantified<br />
in our performance gain is the fact that memory consumption has been roughly<br />
divided by 2. Less memory doesn&rsquo;t necessarily means less managed objects but in<br />
our particular case we <i>do</i> allocate<br />
less objects. The nice consequence is that less objects means less time spent in the<br />
GC. Less memory also means less virtual memory page fault, which is IMHO the<br />
worst thing when it comes to polish performances of a program.</span></p>
<p style="margin: 1pt 0cm"><span lang="EN-US">&nbsp;</span></p>
<p style="margin: 1pt 0cm"><span lang="EN-US">Finally, we are now experiencing a<br />
great advantage of optimization: automatic tests naturally ran<br />
much faster and it is a good motivation to run them more often!</span></p>
<p style="margin: 1pt 0cm"><span lang="EN-US">&nbsp;</span></p>
<p style="margin: 1pt 0cm">&nbsp;</p>
<p style="margin: 1pt 0cm">&nbsp;</p>
<p style="margin: 1pt 0cm"><span lang="EN-US">I end up with an </span><span lang="EN-US">illustration of the tenet <b>there is always room<br />
for better performance</b>: the Amiga demo scene in which I<br />
participated in the early nineties</span><a href="/blogs/patricksmacchia/archive/2008/10/04/geek-nostalgia.aspx"><span lang="EN-US"></span></a><span lang="EN-US">. Every demos ran on a <a href="http://en.wikipedia.org/wiki/Original_Amiga_chipset" target="_blank">constant<br />
hardware</a></span><a href="http://en.wikipedia.org/wiki/Original_Amiga_chipset" target="_blank"><span lang="EN-US"></span></a><span lang="EN-US">.<br />
It was the perfect incentive for<br />
demo developers to produce code more and more optimized. During several<br />
years, every months<br />
some record were beaten, like the number of 3D polygons, the number of<br />
sprites<br />
or the number of dots displayed simultaneously at the rate of 50 frames<br />
per<br />
seconds. As far as I can estimate, the performance factor obtained in a<br />
few years was something around x50! Imagine what<br />
it means, running in one second a computation that took initially a<br />
minute. And as far as I know this massive gain was the result of both<br />
better algorithms (with many pre-computations and delegations to<br />
sub-chip) and micro-optimizations at assembly language level (better<br />
use of the chip registers, better use of the set of instructions&#8230;). </span></p>
<p style="margin: 1pt 0cm"><span lang="EN-US">&nbsp;</span></p>
<p>&nbsp;</p>
<div class="shr-publisher-86"></div><!-- Start Shareaholic LikeButtonSetBottom Automatic --><!-- End Shareaholic LikeButtonSetBottom Automatic -->											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/patricksmacchia/category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>. Bookmark the <a href="http://codebetter.com/patricksmacchia/2008/12/01/lessons-learned-from-a-real-world-focus-on-performance/" title="Permalink to Lessons learned from a real-world focus on performance" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/patricksmacchia/2008/12/01/lessons-learned-from-a-real-world-focus-on-performance/feed/" title="Comments RSS to Lessons learned from a real-world focus on performance" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-86 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/patricksmacchia/2008/11/25/composing-code-metrics-values/" rel="prev"><span class="meta-nav">&larr;</span> Composing Code Metrics Values</a></div>
					<div class="nav-next"><a href="http://codebetter.com/patricksmacchia/2008/12/04/solid-state-drive-enhance-developers-productivity/" rel="next">Solid State Drive: Enhance developers&#8217; productivity <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
                    <div id="dsq-content">
            <ul id="dsq-comments">
                    <li id="dsq-comment-488">
                    <div id="dsq-comment-header-488" class="dsq-comment-header">
                        <cite id="dsq-cite-488">
    http://jon@jon.com                            <span id="dsq-author-user-488">jon</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-488" class="dsq-comment-body">
                        <div id="dsq-comment-message-488" class="dsq-comment-message"><p>you forgot<br />
Migrate to C++ gain 99%</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-489">
                    <div id="dsq-comment-header-489" class="dsq-comment-header">
                        <cite id="dsq-cite-489">
    http://www.NDepend.com                            <span id="dsq-author-user-489">Patrick Smacchia</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-489" class="dsq-comment-body">
                        <div id="dsq-comment-message-489" class="dsq-comment-message"><p>I am not sure it is that easy Jon, I used to do &#8220;a lot&#8221; of C++ before .NET.</p>
<p>For sure you can get a non-neglectable gain in performance with C++ but for sure also you&#8217;ll need much much more time to achieve the same set of features.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-490">
                    <div id="dsq-comment-header-490" class="dsq-comment-header">
                        <cite id="dsq-cite-490">
                                <span id="dsq-author-user-490">Sebastien Pouliot</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-490" class="dsq-comment-body">
                        <div id="dsq-comment-message-490" class="dsq-comment-message"><p>Many lessons you learned young padawan, but still much to learn*.</p>
<p><quote>asses your limits by measuring the percentage of time spent in tier code.</quote></p>
<p>Measuring tier code is *not* measuring your limits (but it can be measuring your old decisions <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_wink.gif' alt=';-)' class='wp-smiley' /> . This is even less true when you lucky enough to depend on open-source tier code. You made a good decision in choosing Cecil (not that there were a lot of alternatives <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_wink.gif' alt=';-)' class='wp-smiley' />  and you can/should capitalize on it.</p>
<p>Take this lesson from someone who depends very much on Cecil performance *and* invested a bit time into making it faster and less memory hungry: You too can make Cecil better, get the advantages inside your software and contribute to the community around Cecil. If you have reached 35% of your time inside Cecil then it does look like a prime candidate to make NDepend better, performance wise.</p>
<p>BTW since last week Cecil gained new Has{x} properties that can help you reduce your memory usage quite a bit (since NDepend probably touch every properties and creates empty collection everywhere possible).</p>
<p>* or as Yoda used to say &#8220;use the source Luke&#8221;!</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-491">
                    <div id="dsq-comment-header-491" class="dsq-comment-header">
                        <cite id="dsq-cite-491">
    http://www.NDepend.com                            <span id="dsq-author-user-491">Patrick Smacchia</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-491" class="dsq-comment-body">
                        <div id="dsq-comment-message-491" class="dsq-comment-message"><p>Sebastien, I know that Jb is working hard for dramatic performance gain in the Cecil future. I omited this info to keep it for further post, when the performance gain will be effectively available (as I didn&#8217;t talk about NDepend improvements before they are available). This is all about avoiding frustrations and noise, blogging about facts, not expectations.</p>
<p>And yes, we can put the hand in, as we already do by helping making Cecil a more robust fx by reporting every single problem NDepend users have because of Cecil (I would say around 15 issues reported during 2008).</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-492">
                    <div id="dsq-comment-header-492" class="dsq-comment-header">
                        <cite id="dsq-cite-492">
                                <span id="dsq-author-user-492">Sebastien Pouliot</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-492" class="dsq-comment-body">
                        <div id="dsq-comment-message-492" class="dsq-comment-message"><p>Well the example was about Cecil* but that was not the spirit of the lesson <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_wink.gif' alt=';-)' class='wp-smiley' /> </p>
<p>Today anyone with a binary-thinking about &#8220;his&#8221; code versus &#8220;other&#8221; code is making a {pick your size} mistake. There is a middle ground, which can be ignored or embraced, when you use open source inside your software (be it open source or not). Your (good) choice of such tools makes crossing into the &#8220;other&#8221; code a real possibility, i.e. something to consider and not a limitation (that&#8217;s the lesson <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_wink.gif' alt=';-)' class='wp-smiley' /> . </p>
<p>Now you don&#8217;t have to do this for &#8220;other&#8221; benefits since it will likely (and positively) affect your own code/software. In fact you should not, at least while doing performance work, make any difference between your code and open source code. Clearly you want  your software (!= your code) to get the maximum benefits out of your next coding hour/day/week &#8211; so why should you care where this next/best opportunity is ?</p>
<p>p.s. filling bug is great, but you can (generally) do this on any product (even if IMHO you&#8217;ll get better/faster result in an open source project <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_wink.gif' alt=';-)' class='wp-smiley' /> , but that&#8217;s padawan, not jedi stuff <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_wink.gif' alt=';-)' class='wp-smiley' /> </p>
<p>* that being said I concur that JB is doing an incredible job on Cecil and its future. Part of it is accepting changes (features, bug fixes and optimization) from anyone using Cecil. Clearly there&#8217;s no need to wait for the next big release to enjoy enhancements <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' /> </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-493">
                    <div id="dsq-comment-header-493" class="dsq-comment-header">
                        <cite id="dsq-cite-493">
                                <span id="dsq-author-user-493">Bob Dobalina</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-493" class="dsq-comment-body">
                        <div id="dsq-comment-message-493" class="dsq-comment-message"><p>Great post &#8211; I heartily agree with measuring, and at least several times, before cutting.</p>
<p>&#8230;but&#8230; one small spelling error gave me many giggles &#8211; I believe you meant &#8220;asses->s< - your limits&#8230;&#8221;  The way it is now, it&#8217;s plural for a donkey. <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_biggrin.gif' alt=':D' class='wp-smiley' /> </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-494">
                    <div id="dsq-comment-header-494" class="dsq-comment-header">
                        <cite id="dsq-cite-494">
    http://www.danvy.tv                            <span id="dsq-author-user-494">Alex Danvy</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-494" class="dsq-comment-body">
                        <div id="dsq-comment-message-494" class="dsq-comment-message"><p>Oh, I miss the Copper and Blitter chips. What a nice plateform was the Amiga.<br />
I really agree with the idea of mesure first then spend time to optimize.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-495">
                    <div id="dsq-comment-header-495" class="dsq-comment-header">
                        <cite id="dsq-cite-495">
    http://www.syterra.com/MikeStockdale.html                            <span id="dsq-author-user-495">Mike Stockdale</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-495" class="dsq-comment-body">
                        <div id="dsq-comment-message-495" class="dsq-comment-message"><p>Good post.</p>
<p>Performance tuning is so simple in concept: measure where it&#8217;s slow and make it faster, but often so difficult in practice!</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-496">
                    <div id="dsq-comment-header-496" class="dsq-comment-header">
                        <cite id="dsq-cite-496">
                                <span id="dsq-author-user-496">Will Dean</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-496" class="dsq-comment-body">
                        <div id="dsq-comment-message-496" class="dsq-comment-message"><p>Your file loading time sounds a bit unlikely unless those files (and the bits of the filesystem which refer to them) are all in cache already.</p>
<p>Can you really load 1700 files (presumably in multiple directories) in 200ms from a cold start?</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-497">
                    <div id="dsq-comment-header-497" class="dsq-comment-header">
                        <cite id="dsq-cite-497">
    http://www.NDepend.com                            <span id="dsq-author-user-497">Patrick Smacchia</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-497" class="dsq-comment-body">
                        <div id="dsq-comment-message-497" class="dsq-comment-message"><p>Will, indeed on a cold start files are taking more time to be loaded and it seems the analysis is 25% slower all in all (not only because src file loading). But cold start is just one on N, especially for a developer that works all day with the same set of source files.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-498">
                    <div id="dsq-comment-header-498" class="dsq-comment-header">
                        <cite id="dsq-cite-498">
                                <span id="dsq-author-user-498">Steve Nuchia</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-498" class="dsq-comment-body">
                        <div id="dsq-comment-message-498" class="dsq-comment-message"><p>&#8220;Tier&#8221; code isn&#8217;t a performance floor until you&#8217;ve minimized the amount of it you&#8217;re calling.  The comments about tweaking the open-source &#8220;tier&#8221; in this case miss the point, kinda.</p>
<p>You have to look at how you&#8217;re using it.  I know nothing about the specifics of this example (came here from sutter&#8217;s mill) but, generically, once I&#8217;m down to &#8220;library&#8221; and &#8220;system&#8221; code I want to look at the call graph and make sure I&#8217;m using good batch sizes, evaulate using streaming versions, whatever is appropriate to the situation.  Usually I can cut the &#8220;tier&#8221; time down substantially by changing the way I&#8217;m using it.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-499">
                    <div id="dsq-comment-header-499" class="dsq-comment-header">
                        <cite id="dsq-cite-499">
                                <span id="dsq-author-user-499">Me</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-499" class="dsq-comment-body">
                        <div id="dsq-comment-message-499" class="dsq-comment-message"><p>This pingback stuff is annoying the hell out of me. Get rid of it. Why bother showing this crap to your readers?</p>
</div>
                    </div>
                </li>
                </ul>
        </div>
    </div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://codebetter.com/patricksmacchia/2008/12/01/lessons-learned-from-a-real-world-focus-on-performance/';
    var disqus_identifier = '86 /blogs/patricksmacchia/archive/2008/12/01/lessons-learned-from-a-real-world-focus-on-performance.aspx';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'codebetter';
    var disqus_title = "Lessons learned from a real-world focus on performance";
        var disqus_config = function () {
        var config = this; // Access to the config object

        /* 
           All currently supported events:
            * preData — fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            DISQUS.request.get('?cf_action=sync_comments&post_id=86');
        });
                    };
    var facebookXdReceiverPath = 'http://cdn1.codebetter.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
        ],
        'trackback_url': "http:\/\/codebetter.com\/patricksmacchia\/2008\/12\/01\/lessons-learned-from-a-real-world-focus-on-performance\/trackback\/"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.67';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29416);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=2782afb'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29416&amp;n=2782afb' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29417);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=e94cea6'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29417&amp;n=e94cea6' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29418);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=9ba3022'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29418&amp;n=9ba3022' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29419);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=f467b52'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29419&amp;n=f467b52' /></a></noscript>
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(220407);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=68b8307'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=220407&amp;n=68b8307' /></a></noscript>				
				
				<ul class="xoxo">		
									</ul>	
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29421);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=3f8e353'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29421&amp;n=3f8e353' /></a></noscript>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="http://red-gate.com/">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="http://telerik.com">Telerik .NET Tools</a></li>
<li><a href="http://jetbrains.com/resharper/">JetBrains - ReSharper</a></li>
<li><a href="http://scootersoftware.com">Beyond Compare</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a></li>
<li><a href="http://umbraco.com" target="_blank">Umbraco</a></li>
<li><a href="http://nservicebus.com" target="_blank">NServiceBus</a></li>
<li><a href="http://ravendb.net" target="_blank">RavenDb</a></li>
<li><a href="http://www.websequencediagrams.com/" target="_blank">Web Sequence Diagrams</a></li>
	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '12<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPython.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = true; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>

<script type='text/javascript'>//<![CDATA[
    if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.4.2.min.js' type='text/javascript' %3E%3C/script%3E"));
    }//]]></script>
<script type='text/javascript' language='Javascript' src='http://s1.lqcdn.com/m.min.js?dt=2.3.110202.1'></script>
<script type='text/javascript' language='Javascript'> if(jQuery.LqmAds)jQuery.LqmAds();</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.410 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2012-11-09 21:34:35 -->
<!-- super cache -->