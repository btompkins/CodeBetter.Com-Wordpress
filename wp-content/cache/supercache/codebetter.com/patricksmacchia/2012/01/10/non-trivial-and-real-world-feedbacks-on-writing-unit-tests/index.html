<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Non-trivial and real-world feedbacks on writing Unit-Tests | Patrick Smacchia</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/patricksmacchia/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css?v=3912785705" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js?ver=3.4.2'></script>
<script type='text/javascript' src='http://dtym7iokkjlif.cloudfront.net/dough/1.0/recipe.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/patricksmacchia/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='It might be time to apply for a loan' href='http://codebetter.com/patricksmacchia/2011/12/14/it-might-be-time-to-apply-for-a-loan/' />
<link rel='next' title='Mythical man month : 10 lines per developer day' href='http://codebetter.com/patricksmacchia/2012/01/23/mythical-man-month-10-lines-per-developer-day/' />
<meta name="generator" content="WordPress 3.4.2" />
<link rel='shortlink' href='http://codebetter.com/patricksmacchia/?p=472' />

<!-- All in One SEO Pack 1.6.13.2 by Michael Torbert of Semper Fi Web Design[83,167] -->
<link rel="canonical" href="http://codebetter.com/patricksmacchia/2012/01/10/non-trivial-and-real-world-feedbacks-on-writing-unit-tests/" />
<!-- /all in one seo pack -->
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.3.3" type="text/css" media="screen" />

<!-- Start Shareaholic OgTags -->

	<!-- Shareaholic Notice: There is neither a featured nor gallery image set -->

<!-- End Shareaholic OgTags -->

<meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/dc168cf39155d7b5d39f696ca94d5980.js?v=5302176208">/*Is Cache!*/</script>
                	
	<script type='text/javascript' src='http://d1.openx.org/spcjs.php?id=7744&amp;target=_blank'></script>
	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>
<!-- BuySellAds Ad Code -->
<script type="text/javascript">
(function(){
  var bsa = document.createElement('script');
     bsa.type = 'text/javascript';
     bsa.async = true;
     bsa.src = 'http://s3.buysellads.com/ac/bsa.js';
  (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);
})();
</script>
<!-- End BuySellAds Ad Code -->
</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">
			<!-- BuySellAds Zone Code -->
<div id="bsap_1276080" class="bsarocks bsap_4fe632babdccc2b4b049e4f08cc3c549"></div>
<!-- End BuySellAds Zone Code --></div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-472" class="post-472 post type-post status-publish format-standard hentry category-uncategorized">
					<h1 class="entry-title">Non-trivial and real-world feedbacks on writing Unit-Tests</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/patricksmacchia/author/patricksmacchia/" title="View all posts by Patrick Smacchia">Patrick Smacchia</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/patricksmacchia/2012/01/10/non-trivial-and-real-world-feedbacks-on-writing-unit-tests/" title="7:02 pm" rel="bookmark"><span class="entry-date">January 10, 2012</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/patricksmacchia/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/patricksmacchia/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><!-- Start Shareaholic LikeButtonSetTop Automatic --><!-- End Shareaholic LikeButtonSetTop Automatic --><p>I began writing tests around 8 years ago and I must say this revolutionized my way of developing code. In this blog post, I’d like to group and share several non-trivial feedbacks gained over all these years of practicing real-world testing.</p>
<h1></h1>
<h1>Test Organization</h1>
<p><strong>There must be a one-to-one correspondence between classes tested and test fixture classes</strong>. Very simple classes like pure immutable entity (i.e simple constructors, simple getters, and readonly backing fields) can only be tested through test fixture classes corresponding to more complex tested classes.</p>
<p>The one-to-one correspondence stated above makes the following operations easy and straightforward:</p>
<ul>
<li>writing a new test suite for a currently created class,</li>
<li>writing some new tests for an existing class,</li>
<li>refactoring tests when refactoring some classes,</li>
<li>identifying which test to run to test a class.</li>
</ul>
<p>Tests must be written in dedicated tests assemblies because product assemblies must not be weighted with test code. Hence <strong>tests and tested code lives in different VS projects</strong>. These projects can live in the same VS solutions, or in different VS solutions.</p>
<p>Having tested code VS projects and tests VS projects living in the same VS solution is useful to navigate easily across tested code and tests.</p>
<p>If tested code and tests live in different VS solution, a global VS solution containing both code and tests VS project is still needed. Indeed, such global VS solution is useful to use refactoring tools to refactor at the same time tested code and tests</p>
<h1></h1>
<h1>Test-First and specifications</h1>
<p>I don’t abide by the test-first theory. Tests concerning a code portion should be written at the same time than the code portion. The reason I advocate to do so, is because <strong>not all edge cases can be faced up-front, even by expert of a domain and professional testers. Edge cases are discovered only when thoroughly implementing an algorithm.</strong></p>
<p>Test-first is still useful when tests can be written up-front by a domain expert or a client, with dedicated tooling such as <a href="http://fitnesse.org/FitNesse.UserGuide.OneMinuteDescription">FitNesse</a>. In this conditions test-first is a great communication mean that can remove many pesky misunderstanding.</p>
<p>However only <strong>the code itself is the complete specification</strong>. Tests can be seen as a specification scaffold, that is removed at runtime. Tests can also be seen as a secondary less-detailed specification, useful to ensure that the main specification, i.e the code itself, respects a range of requirements, materialized by tests assertions.</p>
<h1></h1>
<h1>Test and Code Contracts</h1>
<p>Calls from tests to tested code, shouldn’t violate tested code contracts. When a contract is violated by running tests, it means that the tested code is buggy or (non-exclusive) that the test is buggy.</p>
<p><a href="http://codebetter.com/patricksmacchia/2010/07/26/code-contracts-and-automatic-testing-are-pretty-much-the-same-thing/">Assertions in tests are not much different than code contract assertions</a>. The only real difference is that assertions in tests are not checked at production-time. But both kind of assertions are here for correctness, to buzz as soon as something goes wrong when running the code.</p>
<h1></h1>
<h1>Test Coverage</h1>
<p>The number of tests is a completely meaningless metric. Dozens of <em>[TestCase]</em> can be written in minutes, while a tricky integration test can takes days to be written. When it comes to test, significant metrics are:</p>
<ul>
<li>percentage of code covered by tests and</li>
<li>number of different assertions executed.</li>
</ul>
<p><strong>Not all classes need to be 100% covered by tests or even covered at all.</strong> Typically UI code is decoupled from logic, and UI code is hard to test properly, despite the progress in this domain. Notice that UI code decoupling, which is a good design practice, is naturally enforced by tests.</p>
<p>When testing a class, covering it 100% is a necessary goal. 90% coverage is not enough because empirically we observe that the 10% non-tested code contains most of unidentified bugs.</p>
<p>If to cover 10% of the code of a class it takes as much effort as covering the other 90%, it means that this 10% of code needs to be redesigned to be easily testable. Hence <strong>the 100% coverage practice is costly only when it forces the code to be well designed</strong>.</p>
<p>Having zero dead code is a natural consequence of having code 100% covered.</p>
<p>It is a good practice to tag a class 100% covered with an arbitrary <em>[FullCovered]</em> attribute because it documents for future developers in charge of an eventual refactoring, that the class must remain 100% covered.</p>
<p><strong>Code 100% covered by tests + containing all relevant contracts, is very hard to break. This is the magical practice to be very close to bug-free code. </strong></p>
<p>Personally I consider that the job is done only when all classes that can be covered by tests are indeed 100% covered by tests.</p>
<h1></h1>
<h1>Test Execution</h1>
<p>The concrete difference between unit tests and integrations tests is that unit tests are in-process only, they don’t require touching a DB, network or the file system. The distinction is useful because unit-tests are usually one or several orders of magnitude faster to run.</p>
<p>Tests must be run from the build machine to validate any code before it is committed.</p>
<p>Test should be fast to run, like a few minutes maximum, because tests must also be ran often on the developer machine, to detect regression as soon as possible.</p>
<p>Having a one-to-one correspondence between tested class and test class + 100% coverage, makes easy to identify which tests to run for a particular piece of code.</p>
<h1></h1>
<h1>Test and Refactoring</h1>
<p>Last released version of the product that is working fine in production, should stress out that bugs are more likely to appear on newly developed code and refactored code. Hence tests must be written in priority for newly developed code and refactored code.</p>
<p>When some refactored code is not properly tested, it is a good practice to write tests that should have been written in the first place. However this practice of testing refactored code is not mandatory because it can be pretty time consuming.</p>
<p>Code 100% covered by tests + containing all relevant contracts, can be refactored at whim. In these conditions, there are very few chances to miss a behavior regression.</p>
<h1></h1>
<h1>Test and Design</h1>
<p>Code that is hard to be covered by tests is bug-prone and need to be redesigned to be easily coverable by easy tests. This situation often results in creating one or several classes dedicated to handle the logic implemented formerly by the code hard to cover by tests.</p>
<p>The previous point can be restated this way: <strong>writing a complete test suite naturally leads to good design, enforcing low coupling and high cohesio</strong>n.</p>
<p>Singletons should be prohibited because they make the code hard to test. It is harder to re-cycle and re-initialize a singleton object for each tests, than it is to create an object for each test.</p>
<p>Mocking should be used to transform integration tests into unit-test, by abstracting tests from out-of-proc consideration like DB access, network access or file system. In these conditions mocking helps separating concerns in the code and hence, increases the design value.</p>
<p>Mocking is also useful to isolate code completely un-coverable by tests, like calls to <a href="http://msdn.microsoft.com/en-us/library/system.windows.forms.messagebox.show.aspx">MessageBox.Show()</a>.</p>
<h1></h1>
<h1>Test Tooling</h1>
<p>Personally I am happy with:</p>
<ul>
<li><a href="http://www.nunit.org/">NUnit</a>, I like the fact that only the <em>NUnit.Framwork.dll</em> needs to be referenced from VS tests project and that NUnit is supported by all testing tools.</li>
<li><a href="http://www.ncover.com/">NCover</a>, it is the fastest code coverage tools available. Its performance are almost magic since in coverage mode tests are executed almost as fast as without coverage. Contrary to VS coverage, the assembly instrumentation phase is completely transparent for the user, and coverage results files are easier to work with. Also NCover is <em>very</em> easy to use and integrates with most testing tools.</li>
<li><a href="http://www.testdriven.net/">TestDriven.NET</a>, its flawless VS integration made me addicted to it. <a href="http://www.jetbrains.com/resharper/features/unit_testing.html">Resharper</a> also comes with cool testing facilities but my addiction to the simplicity of TD.NET is too high.</li>
<li>When it comes to testing NDepend is especially suited to create rules to <a href="http://codebetter.com/patricksmacchia/2008/04/09/make-the-most-of-your-test-coverage-data/">continuously check for code coverage by tests</a>, to <a href="http://codebetter.com/patricksmacchia/2008/07/10/are-you-sure-added-and-refactored-code-is-covered-by-tests/">ensure that new and refactored code is properly covered by tests</a> and to <a href="http://www.ndepend.com/Doc_VS_AppWide.aspx">navigate between tested code and tests across VS solutions opened in different VS instances</a>.</li>
<li>It is worth also keeping an eye to <a href="http://continuoustests.com/">ContinuousTests</a> currently in beta to identify which tests to run when a portion of code is touched, and run them in background.</li>
</ul>
<div class="shr-publisher-472"></div><!-- Start Shareaholic LikeButtonSetBottom Automatic --><!-- End Shareaholic LikeButtonSetBottom Automatic -->											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/patricksmacchia/category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>. Bookmark the <a href="http://codebetter.com/patricksmacchia/2012/01/10/non-trivial-and-real-world-feedbacks-on-writing-unit-tests/" title="Permalink to Non-trivial and real-world feedbacks on writing Unit-Tests" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/patricksmacchia/2012/01/10/non-trivial-and-real-world-feedbacks-on-writing-unit-tests/feed/" title="Comments RSS to Non-trivial and real-world feedbacks on writing Unit-Tests" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-472 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/patricksmacchia/2011/12/14/it-might-be-time-to-apply-for-a-loan/" rel="prev"><span class="meta-nav">&larr;</span> It might be time to apply for a loan</a></div>
					<div class="nav-next"><a href="http://codebetter.com/patricksmacchia/2012/01/23/mythical-man-month-10-lines-per-developer-day/" rel="next">Mythical man month : 10 lines per developer day <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
                    <div id="dsq-content">
            <ul id="dsq-comments">
                    <li id="dsq-comment-1514">
                    <div id="dsq-comment-header-1514" class="dsq-comment-header">
                        <cite id="dsq-cite-1514">
                                <span id="dsq-author-user-1514">Anonymous</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-1514" class="dsq-comment-body">
                        <div id="dsq-comment-message-1514" class="dsq-comment-message"><p>+1 for the Testdriven.Net addiction</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-1517">
                    <div id="dsq-comment-header-1517" class="dsq-comment-header">
                        <cite id="dsq-cite-1517">
                                <span id="dsq-author-user-1517">Rémi BOURGAREL</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-1517" class="dsq-comment-body">
                        <div id="dsq-comment-message-1517" class="dsq-comment-message"><p>It&#8217;s an endless debate, but SQL query is code right ? So why should we exclude them from our unit test ? Unit testing is about testing a isolated unit of your software, because we can&#8217;t mock (ASFAIK) a sql server, our SQL queries are a unit. Refactoring often include refactoring so it seems important for me to include it in your test suite (even if there is problems like deleting the test data).</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-1518">
                    <div id="dsq-comment-header-1518" class="dsq-comment-header">
                        <cite id="dsq-cite-1518">
                                <span id="dsq-author-user-1518">Jim Cooper</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-1518" class="dsq-comment-body">
                        <div id="dsq-comment-message-1518" class="dsq-comment-message"><p>I agree with most of that, with a couple of exceptions.</p>
<p>Test first (or TDD) is definitely a better way to write and design code than writing tests and code at the same time. However, you don&#8217;t write ALL the tests first &#8211; you do one at a time (and I usually check in whenever everything goes green). It&#8217;s an iterative process.</p>
<p>However, you may need some framework code in place on a brand new project before you can write an integration test, depending on the project, tools, etc. But you should always use TDD for unit tests.</p>
<p>Secondly, you don&#8217;t always have to decouple tests from the file system. Some people go to insane lengths to do that when you can get away with just using a test area. It depends on the situation.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-1519">
                    <div id="dsq-comment-header-1519" class="dsq-comment-header">
                        <cite id="dsq-cite-1519">
                                <span id="dsq-author-user-1519">psmacchia</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-1519" class="dsq-comment-body">
                        <div id="dsq-comment-message-1519" class="dsq-comment-message"><p>As explained the problem I have with test first is that <br />
not all edge cases can be faced up-front. While I agree that test first is a good communicate mean from domain expert to the developer, it should be used only for such situation. </p>
<p>Moreover when I read the two statements <br />
you don&#8217;t write ALL the tests first <br />
and<br />
It&#8217;s an iterative process it sounds like you switch back and forth from test-first to code development to test rewriting&#8230;, or in other words you are developing tests at the same time than you are developing tested code.&gt;Secondly, you don&#8217;t always have to decouple tests from the file systemSure, I just write that if your tests are accessing the file system, they must be flagged as integration tests.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-1521">
                    <div id="dsq-comment-header-1521" class="dsq-comment-header">
                        <cite id="dsq-cite-1521">
    http://twitter.com/djkozora                            <span id="dsq-author-user-1521">Dennis Kozora</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-1521" class="dsq-comment-body">
                        <div id="dsq-comment-message-1521" class="dsq-comment-message"><p>&#8220;Code that is hard to<br />
be covered by tests is bug-prone and need to be redesigned to be easily<br />
coverable by easy tests&#8221; &#8230; which is exactly why you should start test first. You will avoid those mistakes. Test first encourages you to design for testability (easy to test). Its not about a &#8220;test&#8221;. A test is an automated specification that validates the &#8220;assumptions&#8221; we used for our design. </p>
<p>Misko Hevery has talked extensively about &#8220;testability&#8221;. Testability is not about writing tests but about designing software that is easy to test.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-1523">
                    <div id="dsq-comment-header-1523" class="dsq-comment-header">
                        <cite id="dsq-cite-1523">
                                <span id="dsq-author-user-1523">Anonymous</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-1523" class="dsq-comment-body">
                        <div id="dsq-comment-message-1523" class="dsq-comment-message"><p>This kind of test is named as integration test because it does not touch only in your code base. If the test exercises an object&#8217;s dependency then it is an integration test too. By the way, you can write and run integration test using NUnit or any other xUnit framework.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-1524">
                    <div id="dsq-comment-header-1524" class="dsq-comment-header">
                        <cite id="dsq-cite-1524">
                                <span id="dsq-author-user-1524">Patrick Smacchia</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-1524" class="dsq-comment-body">
                        <div id="dsq-comment-message-1524" class="dsq-comment-message"><p>For a real-world complex algorithm to develop it is not humanly possible to anticipate all edge cases that will need to be tested. The options are twofold:</p>
<p>A) you write test-first, you code, you write more tests to cover edge cases discovered while coding, you code, you write more tests&#8230;  this is what I am doing and I don&#8217;t call it test first. I call it &#8220;write code and tests at the same time&#8221;.</p>
<p>B) you write test-first, you code, and then you don&#8217;t write tests  to cover edge cases discovered while coding. -&gt; this lead to less than 100% coverage and I&#8217;ve explained why it is a bad practice.</p>
<p>For any sufficiently complex piece of code, there is no such thing like a case C) where you write test-first, you code, and everything works fine with 100% coverage.</p>
<p>To summarize, as Jim Cooper wrote below, test-first is an iterative process. Tests necessarily need to be refined iteratively while code is developed. I guess we are all doing it the same way, but I prefer to call it &#8220;write code and tests at the same time&#8221; than &#8220;test-first&#8221;.</p>
<p>&gt;Testability is not about writing tests but about designing software that is easy to test.      </p>
<p>100% agree, I stated this point through the remark (in bold): If to cover 10% of the code of a class it takes as much effort as<br />
covering the other 90%, it means that this 10% of code needs to be<br />
redesigned to be easily testable.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-1526">
                    <div id="dsq-comment-header-1526" class="dsq-comment-header">
                        <cite id="dsq-cite-1526">
    http://truewill.myopenid.com/                            <span id="dsq-author-user-1526">Bill Sorensen</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-1526" class="dsq-comment-body">
                        <div id="dsq-comment-message-1526" class="dsq-comment-message"><p>&#8220;There must be a one-to-one correspondence between classes tested and test fixture classes.&#8221;</p>
<p>How do you deal with cases where you need multiple fixtures? Tests 1, 2, and 3 against system-under-test class A need one complex setup, while tests 4, 5, and 6 against class A need another. This would seem to indicate that two test fixtures are appropriate, at least under NUnit.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-1527">
                    <div id="dsq-comment-header-1527" class="dsq-comment-header">
                        <cite id="dsq-cite-1527">
                                <span id="dsq-author-user-1527">psmacchia</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-1527" class="dsq-comment-body">
                        <div id="dsq-comment-message-1527" class="dsq-comment-message"><p>Of course if you estimate that you need more than one test fixture class, you are free to create many. In general, a class that needs many test fixture class might violate the Single Responsability Principle: <br />
<a href="http://en.wikipedia.org/wiki/Single_responsibility_principle" rel="nofollow">http://en.wikipedia.org/wiki/Single_responsibility_principle</a></p>
<p>Concerning the situation you described with multi-setup, it could be preferable to keep all tests in the same test fixure class with each test responsible for calling the right init. But if you are talking of dozens of tests, having many test fixture class makes sense, just to group tests appropriately.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-1528">
                    <div id="dsq-comment-header-1528" class="dsq-comment-header">
                        <cite id="dsq-cite-1528">
                                <span id="dsq-author-user-1528">Steve Py</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-1528" class="dsq-comment-body">
                        <div id="dsq-comment-message-1528" class="dsq-comment-message"><p>One point I would add is that sometimes 100% coverage isn&#8217;t 100%. With code that may have several combinations (Generally a candidate for re-factoring and simplification, but we&#8217;re talking about real-world systems) you cannot merely trust a 100% coverage stat without considering the &#8220;touch count&#8221; for how many times each line/statement was touched by tests. 100% merely means each line was touched _at least once_. Complex methods with touch-counts of 1 should scream of possible bugs and it would be a dangerous assumption that they&#8217;re safe just because they read 100% coverage.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-1529">
                    <div id="dsq-comment-header-1529" class="dsq-comment-header">
                        <cite id="dsq-cite-1529">
                                <span id="dsq-author-user-1529">psmacchia</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-1529" class="dsq-comment-body">
                        <div id="dsq-comment-message-1529" class="dsq-comment-message"><p>I would say that 100% coverage means pretty much 100% correctness, if (and only if) the code tested is stuffed with contract assertions. Indeed, in such conditions a statement covered by tests fullfils its unit action and all contextual data values are in well defined ranges, checked by contract assertions. The number of touch count is not really relevant. For example, if I know that a piece of code works fine for all positive integers,  I don&#8217;t need to test all 2 Billions positive values to increase the number of touch. Testing the 4 values 1, 10, 100.000, and int.MaxValue should be enough.<br />
To digress a bit, 100% coverage is not actually 100% coverage because of the way .NET code coverage tools works. Language construct such as ternary operator, inner method calls, or linq query are considered as one statement (i.e one monolithic breakpoint) by code coverage tools. For example if just the false expression of a ternary operator is covered, the  true expression is seen as covered as well.Hopefully, NCover is smarter on that and proposes the metric branch coverage which is more fine grained than the basic code coverage, and can handle this limitation of monolithic breakpoint.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-1530">
                    <div id="dsq-comment-header-1530" class="dsq-comment-header">
                        <cite id="dsq-cite-1530">
                                <span id="dsq-author-user-1530">garethevans1986</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-1530" class="dsq-comment-body">
                        <div id="dsq-comment-message-1530" class="dsq-comment-message"><p>Have you tried http://www.ncrunch.net/ - Watch the video on the site.<br />
GE</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-1531">
                    <div id="dsq-comment-header-1531" class="dsq-comment-header">
                        <cite id="dsq-cite-1531">
                                <span id="dsq-author-user-1531">Rodney Richardson</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-1531" class="dsq-comment-body">
                        <div id="dsq-comment-message-1531" class="dsq-comment-message"><p>If you require the same initialization/zetup for different test fixtures, consider inheritence with the setup on the base class. This still allows the freedom of one fixture per class, and shared setup code.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-1532">
                    <div id="dsq-comment-header-1532" class="dsq-comment-header">
                        <cite id="dsq-cite-1532">
                                <span id="dsq-author-user-1532">psmacchia</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-1532" class="dsq-comment-body">
                        <div id="dsq-comment-message-1532" class="dsq-comment-message"><p>Not yet but the video looks pretty awesome <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-1533">
                    <div id="dsq-comment-header-1533" class="dsq-comment-header">
                        <cite id="dsq-cite-1533">
                                <span id="dsq-author-user-1533">Christia Bjerre</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-1533" class="dsq-comment-body">
                        <div id="dsq-comment-message-1533" class="dsq-comment-message"><p>Thanks for a short and useful test pratice guide. Keeping in line with what you write here will help make better software faster and with high confidence.</p>
<p>The challenge is as usual how to make sure we don&#8217;t write code that is hard to test?</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-1535">
                    <div id="dsq-comment-header-1535" class="dsq-comment-header">
                        <cite id="dsq-cite-1535">
                                <span id="dsq-author-user-1535">psmacchia</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-1535" class="dsq-comment-body">
                        <div id="dsq-comment-message-1535" class="dsq-comment-message"><p>You can first write tests, then code that is de-facto testable! I don&#8217;t call this way of doing test-first, since here I am talking of an iterative process where you write a few tests, then write the few corresponding lines of code and methods, and repeat until the features and classes are completely implemented and 100% covered by tests.</p>
<p>With experience one can anticipates how to design the code as testable,. Personaly I often write first the code, then the associated tests, then repeat again.</p>
<p>Calling this iterative process test-first or code-first is just a philosophical chicken and egg problem. Once again the key is the experience, that makes the design of the code and the tests two  intricated sides of a unique problem.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-1551">
                    <div id="dsq-comment-header-1551" class="dsq-comment-header">
                        <cite id="dsq-cite-1551">
                                <span id="dsq-author-user-1551">Tomek Kaczanowski</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-1551" class="dsq-comment-body">
                        <div id="dsq-comment-message-1551" class="dsq-comment-message"><p>Interesting, but:<br />
1) test first is the right way to go,<br />
2) believing that 100% coverage means high quality tests and high quality code is a fallacy</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-1608">
                    <div id="dsq-comment-header-1608" class="dsq-comment-header">
                        <cite id="dsq-cite-1608">
    http://www.vincebullinger.com                            <span id="dsq-author-user-1608">Vince Bullinger</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-1608" class="dsq-comment-body">
                        <div id="dsq-comment-message-1608" class="dsq-comment-message"><p> Just randomly saying stuff doesn&#8217;t make it so. Why do you believe in number one? The author put out good reasons as to why you&#8217;re wrong and you basically just said &#8220;Nuh uh!&#8221;</p>
<p>He never said or even implied what you spoke against number two. In fact, you two seem to be in agreement.</p>
</div>
                    </div>
                </li>
                </ul>
        </div>
    </div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://codebetter.com/patricksmacchia/2012/01/10/non-trivial-and-real-world-feedbacks-on-writing-unit-tests/';
    var disqus_identifier = '472 http://codebetter.com/patricksmacchia/?p=472';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'codebetter';
    var disqus_title = "Non-trivial and real-world feedbacks on writing Unit-Tests";
        var disqus_config = function () {
        var config = this; // Access to the config object

        /* 
           All currently supported events:
            * preData — fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            DISQUS.request.get('?cf_action=sync_comments&post_id=472');
        });
                    };
    var facebookXdReceiverPath = 'http://cdn1.codebetter.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
        ],
        'trackback_url': "http:\/\/codebetter.com\/patricksmacchia\/2012\/01\/10\/non-trivial-and-real-world-feedbacks-on-writing-unit-tests\/trackback\/"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.67';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29416);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=2782afb'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29416&amp;n=2782afb' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29417);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=e94cea6'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29417&amp;n=e94cea6' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29418);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=9ba3022'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29418&amp;n=9ba3022' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29419);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=f467b52'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29419&amp;n=f467b52' /></a></noscript>
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(220407);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=68b8307'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=220407&amp;n=68b8307' /></a></noscript>				
				
				<ul class="xoxo">		
									</ul>	
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29421);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=3f8e353'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29421&amp;n=3f8e353' /></a></noscript>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="http://red-gate.com/">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="http://telerik.com">Telerik .NET Tools</a></li>
<li><a href="http://jetbrains.com/resharper/">JetBrains - ReSharper</a></li>
<li><a href="http://scootersoftware.com">Beyond Compare</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a></li>
<li><a href="http://umbraco.com" target="_blank">Umbraco</a></li>
<li><a href="http://nservicebus.com" target="_blank">NServiceBus</a></li>
<li><a href="http://ravendb.net" target="_blank">RavenDb</a></li>
<li><a href="http://www.websequencediagrams.com/" target="_blank">Web Sequence Diagrams</a></li>
	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '12<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPython.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = true; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>

<script type='text/javascript'>//<![CDATA[
    if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.4.2.min.js' type='text/javascript' %3E%3C/script%3E"));
    }//]]></script>
<script type='text/javascript' language='Javascript' src='http://s1.lqcdn.com/m.min.js?dt=2.3.110202.1'></script>
<script type='text/javascript' language='Javascript'> if(jQuery.LqmAds)jQuery.LqmAds();</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.437 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2012-11-09 18:31:44 -->
<!-- super cache -->