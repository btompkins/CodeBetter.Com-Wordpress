<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>RestBugs Ported to Node | Howard Dierking</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/howarddierking/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css?v=3912785705" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js?ver=3.4.2'></script>
<script type='text/javascript' src='http://dtym7iokkjlif.cloudfront.net/dough/1.0/recipe.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/howarddierking/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Getting Started with NodeJS &#8211; Migrating RestBugs' href='http://codebetter.com/howarddierking/2012/06/07/197/' />
<link rel='next' title='What’s Next for ASP.NET Web Optimization' href='http://codebetter.com/howarddierking/2012/08/03/whats-next-for-asp-net-web-optimization/' />
<meta name="generator" content="WordPress 3.4.2" />
<link rel='shortlink' href='http://codebetter.com/howarddierking/?p=201' />

<!-- All in One SEO Pack 1.6.13.2 by Michael Torbert of Semper Fi Web Design[83,131] -->
<meta name="keywords" content="uncategorized" />
<link rel="canonical" href="http://codebetter.com/howarddierking/2012/06/09/restbugs-ported-to-node/" />
<!-- /all in one seo pack -->
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.3.3" type="text/css" media="screen" />

<!-- Start Shareaholic OgTags -->

	<!-- Shareaholic Notice: There is neither a featured nor gallery image set -->

<!-- End Shareaholic OgTags -->

<meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/dc168cf39155d7b5d39f696ca94d5980.js?v=3981720249">/*Is Cache!*/</script>
                	
	<script type='text/javascript' src='http://d1.openx.org/spcjs.php?id=7744&amp;target=_blank'></script>
	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>
<!-- BuySellAds Ad Code -->
<script type="text/javascript">
(function(){
  var bsa = document.createElement('script');
     bsa.type = 'text/javascript';
     bsa.async = true;
     bsa.src = 'http://s3.buysellads.com/ac/bsa.js';
  (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);
})();
</script>
<!-- End BuySellAds Ad Code -->
</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">
			<!-- BuySellAds Zone Code -->
<div id="bsap_1276080" class="bsarocks bsap_4fe632babdccc2b4b049e4f08cc3c549"></div>
<!-- End BuySellAds Zone Code --></div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-201" class="post-201 post type-post status-publish format-standard hentry category-uncategorized">
					<h1 class="entry-title">RestBugs Ported to Node</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/howarddierking/author/howarddierking/" title="View all posts by Howard Dierking">Howard Dierking</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/howarddierking/2012/06/09/restbugs-ported-to-node/" title="5:36 am" rel="bookmark"><span class="entry-date">June 9, 2012</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/howarddierking/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/howarddierking/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><!-- Start Shareaholic LikeButtonSetTop Automatic --><!-- End Shareaholic LikeButtonSetTop Automatic --><p>I just merged my <a href="https://github.com/howarddierking/RestBugs/tree/master/RestBugs-Node">NodeJS port of the RestBugs</a> sample application and pushed it up to github. In case you&#8217;re not 100% sure what <a href="https://github.com/howarddierking/RestBugs">RestBugs</a> is, it&#8217;s an example of a hypermedia-driven bug management system (system including both client and service) that I originally created as a part of my <a href="http://www.pluralsight-training.net/microsoft/Courses/TableOfContents?courseName=rest-fundamentals">REST Fundamentals course for Pluralsight</a>.</p>
<p>The Node version is, for the most part, identical to <a href="https://github.com/howarddierking/RestBugs/tree/master/RestBugs%20Solution">the original ASP.NET Web API version</a>. The only major difference is that the Node version uses a MongoDB database rather than a static collection running in memory. This was primarily driven simply by my desire to play with MongoDB.</p>
<p>My boss asked me this morning what my overall thoughts were comparing the 2 different frameworks and approaches. My comments went something like this: Because there&#8217;s less hand-holding by tools coupled with the fact that there&#8217;s 10 million ways to do any specific thing, Node can *feel* like it has a bit of steep &#8220;trial and error-like&#8221; learning curve. However, for those that get over that curve, I can already see that it will be freaking amazing and it will be tough to have patience for platforms that require more work in the name of safety.</p>
<p>That&#8217;s my 2 cents for tonight &#8211; take it for what it&#8217;s worth.</p>
<p>Now, a favor to ask.</p>
<p>For all of you folks who are further down this road then I am, I want to learn from you. If you have a couple minutes to spare, <a href="https://github.com/howarddierking/RestBugs/blob/master/RestBugs-Node/app.js">take a look at my &lt; 200 lines</a> and let me know how I can improve my code &#8211; and thereby my skills. There are a couple specific areas where I&#8217;m particularly interested in improving at the moment:</p>
<ul>
<li>best patterns for error handling &#8211; particularly when I have all those nested closures</li>
<li>patterns for organizing my code (both modules and object design) &#8211; at the moment, everything&#8217;s in one file and my &#8220;domain logic&#8221; is module-scoped. This is workable because the sample isn&#8217;t that big, but I can see it becoming a problem for anything non-trivial. I had originally organized things into a &#8220;3-layer&#8221; type of design, with a Bug JavaScript object &#8211; but found it really painful constantly transforming JSON objects in and out. <strong>Would especially love to get your thoughts here</strong>.</li>
<li>good use of middleware &#8211; I was thinking that particularly for those post functions where I&#8217;m being sent an ID and I&#8217;m looking it up and working with a JSON object, it would be handy to push the lookup logic into a middleware function. Good idea? How does this work with errors or no value found?</li>
<li>other stuff jump out where I can improve?</li>
</ul>
<p>I am confident that this code (as well as my Node skills) is a shadow of what it can be &#8211; but I wanted to put something tangible up there and then get pointers on where to look next.</p>
<p>So, thanks in advance!</p>
<div class="shr-publisher-201"></div><!-- Start Shareaholic LikeButtonSetBottom Automatic --><!-- End Shareaholic LikeButtonSetBottom Automatic -->											</div><!-- .entry-content -->

					<div id="entry-author-info">
						<div id="author-avatar">
							<img alt='' src='http://0.gravatar.com/avatar/859e318f8403226ff4b912edf77fba2a?s=60&amp;d=http%3A%2F%2F0.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G' class='avatar avatar-60 photo' height='60' width='60' />						</div><!-- #author-avatar 	-->
						<div id="author-description">
							<h2>About Howard Dierking</h2>
							I like technology...a lot...							<div id="author-link">
								<a href="http://codebetter.com/howarddierking/author/howarddierking/" title="View all posts by Howard Dierking">View all posts by Howard Dierking &rarr;</a>
							</div><!-- #author-link	-->
						</div><!-- #author-description	-->
					</div><!-- .entry-author-info -->

					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/howarddierking/category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>. Bookmark the <a href="http://codebetter.com/howarddierking/2012/06/09/restbugs-ported-to-node/" title="Permalink to RestBugs Ported to Node" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/howarddierking/2012/06/09/restbugs-ported-to-node/feed/" title="Comments RSS to RestBugs Ported to Node" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-201 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/howarddierking/2012/06/07/197/" rel="prev"><span class="meta-nav">&larr;</span> Getting Started with NodeJS &#8211; Migrating RestBugs</a></div>
					<div class="nav-next"><a href="http://codebetter.com/howarddierking/2012/08/03/whats-next-for-asp-net-web-optimization/" rel="next">What’s Next for ASP.NET Web Optimization <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
                    <div id="dsq-content">
            <ul id="dsq-comments">
                    <li id="dsq-comment-339">
                    <div id="dsq-comment-header-339" class="dsq-comment-header">
                        <cite id="dsq-cite-339">
    http://kenegozi.com/blog                            <span id="dsq-author-user-339">Ken Egozi</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-339" class="dsq-comment-body">
                        <div id="dsq-comment-message-339" class="dsq-comment-message"><p>pretty good for someone claiming to be new to the techs.</p>
<p>a couple of things though:</p>
<p>as far as mongo related stuff &#8211; you&#8217;d want to use send an update that does the change server side in an atomic update, instead of &#8220;load, edit, save&#8221;. right now it is open to concurrency problems</p>
<p>you are also not showing how the db is set &#8211; specifically the bugs collections&#8217; indexes.<br />
you could  potentially drop the bugs collection instead of remove()ing the docs, then ensureIndex()s if relevant (probably is &#8211; an index on Status will make sense for e.g.)<br />
 <br />
as far as web app stuff = the POST actions should not generally be rendering html as a response, but instead redirect to a GET that will render. This will eliminate the problem with a user doing F5 (or back later on) and asked by the browser to re-send the POST</p>
<p>as far as node moduling &#8211; this example is simple enough to fit nicely in a single file.<br />
you could break the logic calls (like updateStatus, close, etc) into a separate module file, which would also potentially encapsulate db access. you could also use modules to declare group of routes (think mvc Controllers as a unit of grouping Actions) which in turn will delegate work to (a / some) logic modules. Since express is a lower-level fw than the likes of Rails/MVC/etc and is more similar in nature to Sinatra or Nancy, you enjoy the light-ness, but lose the guidance. which leaves you in common sense.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-340">
                    <div id="dsq-comment-header-340" class="dsq-comment-header">
                        <cite id="dsq-cite-340">
                                <span id="dsq-author-user-340">Jos de Jong</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-340" class="dsq-comment-body">
                        <div id="dsq-comment-message-340" class="dsq-comment-message"><p>You are right, it requires some effort to get familiar with Node.js. Javascript does not force you to structure your code, and does not force you do do things in a certain way. Nice about that is that you have all freedom to do it your way.<br />
You need some discipline to structure your code yourself.</p>
<p>NESTED CLOSURES</p>
<p>If you put your callbacks inline as a function parameter, your code gets deeply nested very quickly, which gives unreadable and hard to read code. Just split the callbacks from the function calls. Instead of:</p>
<p>    db.bugs.save(<br />
        newbug(req.body.title, req.body.description), <br />
        function(err, savedDoc) {<br />
            db.bugs.find( {status: &#8216;Backlog&#8217;}, function(err, docs) {<br />
            res.render(&#8216;bugs-all.html&#8217;, {<br />
                title: &#8216;Backlog&#8217;,<br />
                model: docs<br />
            });<br />
        });<br />
    });</p>
<p>you can write:</p>
<p>    var onFoundCallback = function(err, docs) {<br />
        res.render(&#8216;bugs-all.html&#8217;, {<br />
            title: &#8216;Backlog&#8217;,<br />
            model: docs<br />
        });<br />
    }</p>
<p>    var onSavedCallback = function(err, savedDoc) {<br />
        db.bugs.find( {status: &#8216;Backlog&#8217;}, onFoundCallback);<br />
    }</p>
<p>    db.bugs.save(newbug(req.body.title, req.body.description), onSavedCallback);</p>
<p>ERROR HANDLING</p>
<p>I personally very much dislike the way callbacks and errors are handled by most<br />
Node.js applications and libaries: when you use callbacks with two arguments (error, result), you need to check if there is an error in every callback. It is much nicer to provide callback functions: callback(res), and errback(err). You can just propagate the errback function without need to check for success and failure every time</p>
<p>The callback mechanism with a single callback method with two parameters:</p>
<p>  function add (a, b, callback) {<br />
      if ((typeof a != &#8216;number&#8217;) || (typeof b != &#8216;number&#8217;)) {<br />
          callback(&#8216;Error: invalid params&#8217;, undefined);<br />
      }<br />
      callback(undefined, a + b);<br />
  }</p>
<p>  function eval(callback) {<br />
      add(2, 3, function (error, res) {<br />
          // in each callback we MUST to check for errors<br />
          if (error) {<br />
              callback(error, undefined);<br />
          }<br />
          else {<br />
              add(res, 4, callback);<br />
          }<br />
      });<br />
  }</p>
<p>The callback mechanism with two callback methods with each a single parameter:</p>
<p>  function add (a, b, callback, errback) {<br />
      if ((typeof a != &#8216;number&#8217;) || (typeof b != &#8216;number&#8217;)) {<br />
          errback(&#8216;Error: invalid params&#8217;);<br />
      }<br />
      callback(a + b);<br />
  }</p>
<p>  function eval(callback, errback) {<br />
      var addNext = function (result) {<br />
          // the callback will only be executed when there is no error,<br />
          // so no need for error handling here!<br />
          add(res, 4, callback, errback);<br />
      }<br />
      add(2, 3, addNext, errback);<br />
  }</p>
<p>NAMESPACES, MODULES</p>
<p>You can just use namespacing and create prototypes &#8220;classes&#8221; like you do in other languages:</p>
<p>    // create a namespaces<br />
    var restbugs = {};<br />
    restbugs.services = {}; <br />
    <br />
    // constructor<br />
    restbugs.services.HtmlFormatter = function (options) {<br />
        this.options = options;<br />
    }<br />
    restbugs.services.HtmlFormatter.prototype.writeStream = function (value, stream) {<br />
        // &#8230; write stream<br />
    }<br />
    <br />
    // usage:<br />
    var formatter = new restbugs.services.HtmlFormatter();<br />
    formatter.writeStream(value, stream);</p>
<p>IDE</p>
<p>It helps a lot to use a helpful IDE. I use WebStorm since some time now, which is really amazing. It gives you a code outline, and when you properly comment your code with jsdoc annotations, it does typechecking for you (!!!). WebStorm has Node.js and Github integrated, which makes development really fun.</p>
<p>(I hope the code indentation in my post will not be lost when submitting. If so, sorry for that)</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-341">
                    <div id="dsq-comment-header-341" class="dsq-comment-header">
                        <cite id="dsq-cite-341">
                                <span id="dsq-author-user-341">Anonymous</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-341" class="dsq-comment-body">
                        <div id="dsq-comment-message-341" class="dsq-comment-message"><p>Now make a version with meteor! <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' />  <a href="http://www.meteor.com/" rel="nofollow">http://www.meteor.com/</a></p>
<p>Not sure if CoffeeScript would help with the node version clarity, though. </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-342">
                    <div id="dsq-comment-header-342" class="dsq-comment-header">
                        <cite id="dsq-cite-342">
    http://twitter.com/NotMyself                            <span id="dsq-author-user-342">Bobby Johnson</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-342" class="dsq-comment-body">
                        <div id="dsq-comment-message-342" class="dsq-comment-message"><p>One thing that I noticed, you have committed your dependencies to your git repo. You might want to look into adding a package.json instead. See here for an example https://github.com/Benvie/Node.js-Ultra-REPL/blob/master/package.json</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-347">
                    <div id="dsq-comment-header-347" class="dsq-comment-header">
                        <cite id="dsq-cite-347">
                                <span id="dsq-author-user-347">Wayne M</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-347" class="dsq-comment-body">
                        <div id="dsq-comment-message-347" class="dsq-comment-message"><p>Quick question being a total newb to Node.js but really liking the idea (IMO it&#8217;s as close to the &#8220;holy grail&#8221; as we have right now of a single unified platform).  You have everything going off of one HTML file, and have everything defined in the app.js file.  Is that because this is a demo/sample or is that the way a small Node.js app is meant to be when using the Express framework? I mean I suppose it would be trivial to give each grouping its own view if necessary, but just for my own sanity I want to verify how things are &#8220;supposed&#8221; to be done so I don&#8217;t tread down the wrong path when I start to play more with Node.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-349">
                    <div id="dsq-comment-header-349" class="dsq-comment-header">
                        <cite id="dsq-cite-349">
                                <span id="dsq-author-user-349">Caro Quintero</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-349" class="dsq-comment-body">
                        <div id="dsq-comment-message-349" class="dsq-comment-message"><p>I found a lot of useful information about this subject in this website http://freelancer.peggylopez.com/</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-350">
                    <div id="dsq-comment-header-350" class="dsq-comment-header">
                        <cite id="dsq-cite-350">
    http://blogs.msdn.com/gblock                            <span id="dsq-author-user-350">Glenn Block</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-350" class="dsq-comment-body">
                        <div id="dsq-comment-message-350" class="dsq-comment-message"><p>Nice job Howard</p>
<p>Closures:</p>
<p>On closures my main feedback is don&#8217;t nest to multiple levels. Instead used named functions which you can pass in rather than inlining a callback. As you mentioned the code gets very hairy to debug.</p>
<p>For example, here is a case where we do something similar for retrieving / updating task information against table storage.</p>
<p><a href="https://github.com/WindowsAzure/azure-sdk-for-node/blob/master/examples/tasklist/home.js " rel="nofollow">https://github.com/WindowsAzure/azure-sdk-for-node/blob/master/examples/tasklist/home.js </a></p>
<p>If you look at the markCompleted function we have a series of local named functions within which end up getting invoked as part of the invocation. In this case we chose to use a process object which we attached the functions to, but you don&#8217;t have to.</p>
<p>Another option is to use the event emitter syntax. Rob Conery has a nice post on that: http://wekeroad.com/2012/04/05/cleaning-up-deep-callback-nesting-with-nodes-eventemitter</p>
<p>Async:</p>
<p>Furthermore if you are running a series of steps that are async, there are some helpful modules out there like  &#8221;async&#8221; (<a href="https://github.com/caolan/async" rel="nofollow">https://github.com/caolan/async</a>). It simplifies calling a series of callbacks in succession without having the spaghetti code. It also has error handling such that if any of the callbacks fail it will automatically exit out and not continue processing the callbacks.</p>
<p>In our example we chose not to use async to keep things closer to the metal however if I was doing it for a production app, I would probably use async.</p>
<p>Factoring:</p>
<p>I generally recommend not keeping all the business logic int the entry js  i.e. app.js. App.js should be mainly for wiring things up and should not have to change that often. It&#8217;s easier to test if you have the code factored into a separate file. For example in the link I have above we moved all the handling logic to a home.js. Home is using protoype and designed with Dependency Injection so that it can be easily tested passing in a fake client.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-351">
                    <div id="dsq-comment-header-351" class="dsq-comment-header">
                        <cite id="dsq-cite-351">
    http://blogs.msdn.com/gblock                            <span id="dsq-author-user-351">Glenn Block</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-351" class="dsq-comment-body">
                        <div id="dsq-comment-message-351" class="dsq-comment-message"><p>+1 on including a package.json. You can also include a shrinkwrap.json (generated by doing npm shrinkwrap) which includes locked down versions of all the modules as package.json can often have a very liberal versioning policy.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-352">
                    <div id="dsq-comment-header-352" class="dsq-comment-header">
                        <cite id="dsq-cite-352">
    http://blogs.msdn.com/gblock                            <span id="dsq-author-user-352">Glenn Block</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-352" class="dsq-comment-body">
                        <div id="dsq-comment-message-352" class="dsq-comment-message"><p>One other feedback on your listening port. Instead of listening on a fixed port like 9200, consider doing app.listen(process.env.PORT || 9200). This will allow the app to work when deployed to cloud hosts i.e. heroku/azure etc which set the PORT environment variable for apps to listen on as you can&#8217;t choose the port. It will still continue to function locally as well as if the PORT variable is not set, it will default to 9200. This is a very common pattern.</p>
</div>
                    </div>
                </li>
                </ul>
        </div>
    </div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://codebetter.com/howarddierking/2012/06/09/restbugs-ported-to-node/';
    var disqus_identifier = '201 http://codebetter.com/howarddierking/?p=201';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'howarddierkingoncodebetter';
    var disqus_title = "RestBugs Ported to Node";
        var disqus_config = function () {
        var config = this; // Access to the config object

        /* 
           All currently supported events:
            * preData — fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            DISQUS.request.get('?cf_action=sync_comments&post_id=201');
        });
                    };
    var facebookXdReceiverPath = 'http://cdn1.codebetter.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
        ],
        'trackback_url': "http:\/\/codebetter.com\/howarddierking\/2012\/06\/09\/restbugs-ported-to-node\/trackback\/"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.67';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29416);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=2782afb'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29416&amp;n=2782afb' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29417);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=e94cea6'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29417&amp;n=e94cea6' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29418);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=9ba3022'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29418&amp;n=9ba3022' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29419);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=f467b52'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29419&amp;n=f467b52' /></a></noscript>
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3><div class="ub-grav" style="margin:5px 5px 0px 5px;float: none;"><img alt='' src='http://0.gravatar.com/avatar/859e318f8403226ff4b912edf77fba2a?s=96&amp;d=http%3A%2F%2F0.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D96&amp;r=G' class='avatar avatar-96 photo' height='96' width='96' /></div>I like technology...a lot...
</li><li id="tag_cloud-4" class="widget-container widget_tag_cloud"><h3 class="widget-title">Categories</h3><div class="tagcloud"><a href='http://codebetter.com/howarddierking/category/ado-net-data-services/' class='tag-link-4922' title='6 topics' style='font-size: 18.405405405405pt;'>ADO.NET Data Services</a>
<a href='http://codebetter.com/howarddierking/category/alt-net/' class='tag-link-1362' title='1 topic' style='font-size: 8pt;'>ALT.NET</a>
<a href='http://codebetter.com/howarddierking/category/appfabric/' class='tag-link-9202' title='1 topic' style='font-size: 8pt;'>AppFabric</a>
<a href='http://codebetter.com/howarddierking/category/architecture/' class='tag-link-2588' title='6 topics' style='font-size: 18.405405405405pt;'>architecture</a>
<a href='http://codebetter.com/howarddierking/category/async/' class='tag-link-9207' title='1 topic' style='font-size: 8pt;'>Async</a>
<a href='http://codebetter.com/howarddierking/category/auto-tagging/' class='tag-link-4908' title='1 topic' style='font-size: 8pt;'>auto tagging</a>
<a href='http://codebetter.com/howarddierking/category/bdd/' class='tag-link-2123' title='5 topics' style='font-size: 17.081081081081pt;'>BDD</a>
<a href='http://codebetter.com/howarddierking/category/ddd/' class='tag-link-1717' title='1 topic' style='font-size: 8pt;'>DDD</a>
<a href='http://codebetter.com/howarddierking/category/fiddler/' class='tag-link-9204' title='1 topic' style='font-size: 8pt;'>Fiddler</a>
<a href='http://codebetter.com/howarddierking/category/fluent-nhibernate/' class='tag-link-4911' title='1 topic' style='font-size: 8pt;'>Fluent NHibernate</a>
<a href='http://codebetter.com/howarddierking/category/hardware/' class='tag-link-4927' title='1 topic' style='font-size: 8pt;'>hardware</a>
<a href='http://codebetter.com/howarddierking/category/heroku/' class='tag-link-9209' title='1 topic' style='font-size: 8pt;'>Heroku</a>
<a href='http://codebetter.com/howarddierking/category/home-network/' class='tag-link-4909' title='1 topic' style='font-size: 8pt;'>Home Network</a>
<a href='http://codebetter.com/howarddierking/category/http/' class='tag-link-8127' title='5 topics' style='font-size: 17.081081081081pt;'>HTTP</a>
<a href='http://codebetter.com/howarddierking/category/international/' class='tag-link-9201' title='1 topic' style='font-size: 8pt;'>International</a>
<a href='http://codebetter.com/howarddierking/category/ioc/' class='tag-link-1361' title='1 topic' style='font-size: 8pt;'>IoC</a>
<a href='http://codebetter.com/howarddierking/category/msdn-magazine/' class='tag-link-4919' title='8 topics' style='font-size: 20.297297297297pt;'>MSDN Magazine</a>
<a href='http://codebetter.com/howarddierking/category/mspec/' class='tag-link-2130' title='2 topics' style='font-size: 11.405405405405pt;'>MSpec</a>
<a href='http://codebetter.com/howarddierking/category/my-setup/' class='tag-link-4926' title='2 topics' style='font-size: 11.405405405405pt;'>my setup</a>
<a href='http://codebetter.com/howarddierking/category/nhibernate/' class='tag-link-2527' title='1 topic' style='font-size: 8pt;'>NHibernate</a>
<a href='http://codebetter.com/howarddierking/category/oauth/' class='tag-link-9206' title='2 topics' style='font-size: 11.405405405405pt;'>OAuth</a>
<a href='http://codebetter.com/howarddierking/category/performance/' class='tag-link-4925' title='3 topics' style='font-size: 13.675675675676pt;'>performance</a>
<a href='http://codebetter.com/howarddierking/category/pivot/' class='tag-link-4931' title='7 topics' style='font-size: 19.351351351351pt;'>Pivot</a>
<a href='http://codebetter.com/howarddierking/category/r/' class='tag-link-4916' title='3 topics' style='font-size: 13.675675675676pt;'>R#</a>
<a href='http://codebetter.com/howarddierking/category/refactoring/' class='tag-link-4737' title='1 topic' style='font-size: 8pt;'>Refactoring</a>
<a href='http://codebetter.com/howarddierking/category/ruby/' class='tag-link-1723' title='1 topic' style='font-size: 8pt;'>Ruby</a>
<a href='http://codebetter.com/howarddierking/category/sinatra/' class='tag-link-9210' title='1 topic' style='font-size: 8pt;'>Sinatra</a>
<a href='http://codebetter.com/howarddierking/category/ssis/' class='tag-link-4921' title='6 topics' style='font-size: 18.405405405405pt;'>SSIS</a>
<a href='http://codebetter.com/howarddierking/category/tortoisesvn/' class='tag-link-4923' title='1 topic' style='font-size: 8pt;'>TortoiseSVN</a>
<a href='http://codebetter.com/howarddierking/category/uncategorized/' class='tag-link-1044' title='10 topics' style='font-size: 22pt;'>Uncategorized</a>
<a href='http://codebetter.com/howarddierking/category/virtualization/' class='tag-link-4918' title='1 topic' style='font-size: 8pt;'>virtualization</a>
<a href='http://codebetter.com/howarddierking/category/wcf/' class='tag-link-4928' title='7 topics' style='font-size: 19.351351351351pt;'>WCF</a>
<a href='http://codebetter.com/howarddierking/category/web/' class='tag-link-5485' title='9 topics' style='font-size: 21.243243243243pt;'>Web</a>
<a href='http://codebetter.com/howarddierking/category/web-api/' class='tag-link-9205' title='6 topics' style='font-size: 18.405405405405pt;'>Web API</a>
<a href='http://codebetter.com/howarddierking/category/windows-7/' class='tag-link-4917' title='1 topic' style='font-size: 8pt;'>Windows 7</a>
<a href='http://codebetter.com/howarddierking/category/windsor/' class='tag-link-4930' title='1 topic' style='font-size: 8pt;'>Windsor</a></div>
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(220407);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=68b8307'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=220407&amp;n=68b8307' /></a></noscript>				
				
				<ul class="xoxo">		
					<li id="archives-2" class="widget-container widget_archive"><h3 class="widget-title">Archives</h3>		<ul>
			<li><a href='http://codebetter.com/howarddierking/2012/11/' title='November 2012'>November 2012</a></li>
	<li><a href='http://codebetter.com/howarddierking/2012/10/' title='October 2012'>October 2012</a></li>
	<li><a href='http://codebetter.com/howarddierking/2012/08/' title='August 2012'>August 2012</a></li>
	<li><a href='http://codebetter.com/howarddierking/2012/06/' title='June 2012'>June 2012</a></li>
	<li><a href='http://codebetter.com/howarddierking/2012/03/' title='March 2012'>March 2012</a></li>
	<li><a href='http://codebetter.com/howarddierking/2011/11/' title='November 2011'>November 2011</a></li>
	<li><a href='http://codebetter.com/howarddierking/2011/10/' title='October 2011'>October 2011</a></li>
	<li><a href='http://codebetter.com/howarddierking/2011/09/' title='September 2011'>September 2011</a></li>
	<li><a href='http://codebetter.com/howarddierking/2011/07/' title='July 2011'>July 2011</a></li>
	<li><a href='http://codebetter.com/howarddierking/2011/05/' title='May 2011'>May 2011</a></li>
	<li><a href='http://codebetter.com/howarddierking/2011/03/' title='March 2011'>March 2011</a></li>
	<li><a href='http://codebetter.com/howarddierking/2011/02/' title='February 2011'>February 2011</a></li>
	<li><a href='http://codebetter.com/howarddierking/2011/01/' title='January 2011'>January 2011</a></li>
	<li><a href='http://codebetter.com/howarddierking/2010/12/' title='December 2010'>December 2010</a></li>
	<li><a href='http://codebetter.com/howarddierking/2010/10/' title='October 2010'>October 2010</a></li>
	<li><a href='http://codebetter.com/howarddierking/2010/09/' title='September 2010'>September 2010</a></li>
	<li><a href='http://codebetter.com/howarddierking/2010/01/' title='January 2010'>January 2010</a></li>
	<li><a href='http://codebetter.com/howarddierking/2009/12/' title='December 2009'>December 2009</a></li>
	<li><a href='http://codebetter.com/howarddierking/2009/11/' title='November 2009'>November 2009</a></li>
	<li><a href='http://codebetter.com/howarddierking/2009/10/' title='October 2009'>October 2009</a></li>
	<li><a href='http://codebetter.com/howarddierking/2009/09/' title='September 2009'>September 2009</a></li>
	<li><a href='http://codebetter.com/howarddierking/2009/08/' title='August 2009'>August 2009</a></li>
	<li><a href='http://codebetter.com/howarddierking/2009/07/' title='July 2009'>July 2009</a></li>
	<li><a href='http://codebetter.com/howarddierking/2009/05/' title='May 2009'>May 2009</a></li>
	<li><a href='http://codebetter.com/howarddierking/2009/04/' title='April 2009'>April 2009</a></li>
	<li><a href='http://codebetter.com/howarddierking/2009/03/' title='March 2009'>March 2009</a></li>
		</ul>
</li>				</ul>	
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29421);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=3f8e353'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29421&amp;n=3f8e353' /></a></noscript>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="http://red-gate.com/">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="http://telerik.com">Telerik .NET Tools</a></li>
<li><a href="http://jetbrains.com/resharper/">JetBrains - ReSharper</a></li>
<li><a href="http://scootersoftware.com">Beyond Compare</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a></li>
<li><a href="http://umbraco.com" target="_blank">Umbraco</a></li>
<li><a href="http://nservicebus.com" target="_blank">NServiceBus</a></li>
<li><a href="http://ravendb.net" target="_blank">RavenDb</a></li>
<li><a href="http://www.websequencediagrams.com/" target="_blank">Web Sequence Diagrams</a></li>
	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '12<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPython.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = true; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>

<script type='text/javascript'>//<![CDATA[
    if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.4.2.min.js' type='text/javascript' %3E%3C/script%3E"));
    }//]]></script>
<script type='text/javascript' language='Javascript' src='http://s1.lqcdn.com/m.min.js?dt=2.3.110202.1'></script>
<script type='text/javascript' language='Javascript'> if(jQuery.LqmAds)jQuery.LqmAds();</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.737 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2012-11-09 19:25:22 -->
<!-- super cache -->