<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Build your own CAB: Extensible Pub/Sub Event Aggregator with Generics | Jeremy D. Miller</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/jeremymiller/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='http://cdn1.codebetter.com/wp-includes/js/l10n.js?ver=20101110'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/jeremymiller/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Jeremy D. Miller' href='http://codebetter.com/jeremymiller/' />
<link rel='start' title='Bypass VSTS and get yourself a &quot;Poor Man&#8217;s IntelliJ&quot;' href='http://codebetter.com/jeremymiller/2005/04/12/bypass-vsts-and-get-yourself-a-poor-mans-intellij/' />
<link rel='prev' title='ALT.NET defined in C# Gibberish' href='http://codebetter.com/jeremymiller/2008/01/10/alt-net-defined-in-c-gibberish/' />
<link rel='next' title='Superman without the yellow sun' href='http://codebetter.com/jeremymiller/2008/01/15/superman-without-the-yellow-sun/' />
<meta name="generator" content="WordPress 3.1-beta1-16732" />
<link rel='canonical' href='http://codebetter.com/jeremymiller/2008/01/11/build-your-own-cab-extensible-pub-sub-event-aggregator-with-generics/' />
<link rel='shortlink' href='http://codebetter.com/jeremymiller/?p=480' />
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.0.7" type="text/css" media="screen" /><link rel="stylesheet" href="http://disqus.com/stylesheets/theshadetreedeveloper/disqus.css?v=2.0" type="text/css" media="screen" />	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
<meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.1" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/a8046d2f1fc1c08af413701218a11c1d.js">/*Is Cache!*/</script>
                	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>

</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">			</div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-480" class="post-480 post type-post status-publish format-standard hentry category-build-your-own-cab category-featured">
					<h1 class="entry-title">Build your own CAB: Extensible Pub/Sub Event Aggregator with Generics</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/jeremymiller/author/jeremymiller/" title="View all posts by Jeremy Miller">Jeremy Miller</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/jeremymiller/2008/01/11/build-your-own-cab-extensible-pub-sub-event-aggregator-with-generics/" title="6:35 pm" rel="bookmark"><span class="entry-date">January 11, 2008</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/jeremymiller/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/jeremymiller/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><p>There&#8217;s been a bit of chatter today on the <a href="http://tech.groups.yahoo.com/group/altdotnet/message/740">altdotnet list about whether to use the CAB, another framework, or roll your own</a>.&nbsp; It seemed like a good time to get off my duff and start writing some new installments in the <a href="http://codebetter.com/blogs/jeremy.miller/archive/2007/07/25/the-build-your-own-cab-series-table-of-contents.aspx">Build your own CAB</a> series.&nbsp;&nbsp;When I wrote an earlier installment on the <a href="http://codebetter.com/blogs/jeremy.miller/archive/2007/06/29/build-your-own-cab-11-event-aggregator.aspx">Event Aggregator pattern</a>, <a href="http://udidahan.weblogs.us/">Udi Dahan</a> left a suggestion in a comment for a more general usage of the pattern.&nbsp; Lo and behold, I found a reason to&nbsp;apply his suggestion&nbsp;to <a href="http://storyteller.tigris.org">StoryTeller</a> and came away pretty happy with the results.&nbsp; Coincidentally, CodeBetter-mate <a href="http://codebetter.com/blogs/glenn.block/default.aspx">Glenn Block</a> is writing some posts on the <a href="http://codebetter.com/blogs/glenn.block/archive/2008/01/07/spiking-around-notification-and-generic-notifiers-part-i.aspx">very same Event Aggregator pattern</a> with a similar design.&nbsp; I&#8217;ll use this to pressure him into finishing <b>his</b> series;-)</p>
<p>&nbsp;</p>
<h4>What&#8217;s the Problem?</h4>
<p>Ideally a single screen is basically self-contained.&nbsp; The View and Presenter talk to each other, the Presenter talks to some sort of service layer, and that&#8217;s that.&nbsp; But like any idyllic spot, the real world will intrude.&nbsp; A screen will often need to react to actions or events taking place&nbsp;in other parts of the UI.&nbsp; You may have a feature that broadcasts updated&nbsp;data from the server to the client that would need to update the display of a screen or the state of the UI.&nbsp; Some action taking place in one screen might affect other parts of the UI, and it can easily be more than one element of the UI.&nbsp; </p>
<p>At this point we&#8217;re facing a situation where a lot of screen elements, Views, and pieces of the application shell are interrelated and need to be synchronized.&nbsp; The problem we have right off the bat is how to get all of these pieces talking together in the first place.&nbsp; The next problem is how to avoid making the UI code a tangle of references from all these different parts trying to get a reference to each other just to talk to one another.&nbsp; If you&#8217;re not careful, you can create some nasty spaghetti code connecting all the disparate parts of the UI.</p>
<p>Once again, we&#8217;re going to reach for a <a href="http://en.wikipedia.org/wiki/Publish/subscribe">Publish/Subscribe</a> method for routing events from the origin of the event.&nbsp; To eliminate undesirable coupling between the event publishers and the event listeners we&#8217;re going to route all the notifications through a central messaging hub called an Event Aggregator.&nbsp; If a publisher can simply send a message to the Event Aggregator hub, the hub will relay that message to the proper listeners.&nbsp; New listeners can be added later&nbsp;to the Event Aggregator without the publishers being affected.&nbsp; </p>
<p>&nbsp;</p>
<h4>The Scenario</h4>
<p>Here&#8217;s my scenario from StoryTeller.&nbsp; I have a pane on the left&nbsp;that acts&nbsp;in the same capacity as&nbsp;the solution explorer from Visual Studio to show all of the open testing projects and provide access to all of the Tests and Test Suites.&nbsp; When a user adds a new testing project to the working set, another part of the UI called the FixtureExplorer needs to update its display to reflect the available Fixture classes for each project.&nbsp; This isn&#8217;t coded yet, but when a testing project is removed, I need all open tabs that are related to that project to be closed and removed from the UI.&nbsp;&nbsp;&nbsp; </p>
<p>The&nbsp;three main&nbsp;challenges I faced were </p>
<ol>
<li>How does the Event Aggregator know which listeners are interested in&nbsp;a given&nbsp;message?  </li>
<li>How to get a reference to the Event Aggregator?  </li>
<li>How to register the listeners?</li>
</ol>
<p>&nbsp;</p>
<h4>Message Routing with Generics</h4>
<p>I didn&#8217;t want my listeners to have to implement a&nbsp;generic handler method that would have to analyze a message coming in to decide what&nbsp;to do.&nbsp; For the sake of easier testing and more explicit code, I wanted a&nbsp;strongly typed method as part of a listeners public API that handled a specific message.&nbsp; Furthermore, to simplify the listeners, I want the Event Aggregator to&nbsp;be responsible for deciding what messages a given listener is interested in.&nbsp; And oh by the way, I have to be able to add new message types without changing the Event Aggregator.</p>
<p>In the end, the answer was really pretty simple.&nbsp; The listeners just need to implement the IListener&lt;T&gt; interface, where T is the type of a message.&nbsp; The Handle() method is where a listener reacts to&nbsp;an event message.&nbsp; </p>
<div style="background: white none repeat scroll 0% 50%;font-size: 12pt;color: black;font-family: courier new">
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">interface</span> <span style="color: teal">IListener</span>&lt;T&gt;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; {</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">void</span> Handle(T subject);</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; }</pre>
</div>
<p>For a concrete example of a&nbsp;listener, I have a class called FixtureExplorerPresenter that needs to listen to several events related to testing projects. To register as a listener, it just has to implement IListener for each event:</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 12pt;color: black;font-family: courier new">
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: teal">FixtureExplorerPresenter</span> : <span style="color: teal">IFixtureExplorerPresenter</span>,</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">IListener</span>&lt;<span style="color: teal">SystemLoaded</span>&gt;,</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">IListener</span>&lt;<span style="color: teal">SystemActivated</span>&gt;,</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">IListener</span>&lt;<span style="color: teal">SystemDeactivated</span>&gt;,</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">IListener</span>&lt;<span style="color: teal">SystemReloaded</span>&gt;,</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">IListener</span>&lt;<span style="color: teal">SystemRemoved</span>&gt;</pre>
</div>
<p>The listening methods look something like this:</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 12pt;color: black;font-family: courier new">
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// This is the implementation of the IListener&lt;SystemLoaded&gt; interface</span></pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// The Event Aggregator will call this method when a SystemLoaded message</span></pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// is published</span></pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <b><span style="color: blue">void</span> Handle(<span style="color: teal">SystemLoaded</span> subject)</b></pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">ISystemUnderTest</span> system = subject.SystemUnderTest;</pre>
<pre style="margin: 0px">&nbsp;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ReloadSystem(system);</pre>
<pre style="margin: 0px">&nbsp;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (isSystemActive(system))</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; loadNode(system);</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre>
</div>
<p>The details of what it&#8217;s doing isn&#8217;t that interesting, but I want to point out how easy it was in a listener to subscribe to an event.&nbsp; There&#8217;s no generic method that receives an event and then has to run it through a switch statement to figure out what to do.&nbsp; FixtureExplorerPresenter just gets a SystemLoaded event and works accordingly.&nbsp; In my unit tests for FixtureExplorerPresenter I can just walk right up to the class and call Handle(SystemLoaded) without having to set up anything of the rest of the system.</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 12pt;color: black;font-family: courier new">
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; [<span style="color: teal">Test</span>]</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">void</span> SystemLoadedReloadsTheFixturesForThatSystemAndResetsTheViewIfThisIsTheActiveSystem()</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">FixtureExplorerPresenter</span> presenter = _mocks.CreateMock&lt;<span style="color: teal">FixtureExplorerPresenter</span>&gt;(_view, _writer);</pre>
<pre style="margin: 0px">&nbsp;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">ISystemUnderTest</span> system = <span style="color: teal">ObjectMother</span>.SystemUnderTest();</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; presenter.ReloadSystem(system);</pre>
<pre style="margin: 0px">&nbsp;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">Expect</span>.Call(_view.ActiveSystemName).Return(system.Name);</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">SystemFixturesNode</span> theNode = <span style="color: blue">new</span> <span style="color: teal">SystemFixturesNode</span>(system, <span style="color: blue">new</span> <span style="color: teal">FixtureToken</span>[0]);</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">Expect</span>.Call(presenter.GetNode(system)).Return(theNode);</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _view.DisplayFixturesNode(theNode);</pre>
<pre style="margin: 0px">&nbsp;</pre>
<pre style="margin: 0px">&nbsp;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _mocks.ReplayAll();</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; presenter.Handle(<span style="color: blue">new</span> <span style="color: teal">SystemLoaded</span>(system));</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _mocks.VerifyAll();</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre>
</div>
<p>Creating the listeners was easy enough because all a listener had to do was implement IListener&lt;T&gt; interfaces for all the events it needed to listen to.&nbsp; We&#8217;ve still got an outstanding responsibility for publishing events to the correct listeners, so let&#8217;s turn our attention to the hub in our publish/subscribe eventing model.</p>
<p>In StoryTeller, events are published to the rest of the system by getting a reference to an instance of&nbsp;this interface (highly elided)&nbsp;shown below;</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 12pt;color: black;font-family: courier new">
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">interface</span> <span style="color: teal">ITestEventPublisher</span></pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; {</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">...</span></pre>
<pre style="margin: 0px">&nbsp;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">void</span> PublishEvent&lt;T&gt;(T subject);</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">void</span> AddListener(<span style="color: blue">object</span> listener);</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">void</span> RemoveListener(<span style="color: blue">object</span> listener);</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; }</pre>
</div>
<p>A client of the ITestEventPublisher interface just needs to call the PublishEvent&lt;T&gt;(T message) method to broadcast a message to the rest of the application.&nbsp; In one of the samples above I showed some code in the FixtureExplorerPresenter class&nbsp;that responded to a &#8220;SystemLoaded&#8221; event to update part of the screen.&nbsp; Here&#8217;s the other side of the publish/subscribe.&nbsp; Another part of the system called ApplicationController&nbsp;is responsible for loading new testing Projects into the test explorer.&nbsp; The ApplicationController.AddProject() method shown below needs to tell FixtureExplorerPresenter and the other listeners that a new&nbsp;&#8221;SystemUnderTest&#8221; has been loaded into the UI.&nbsp; Instead of calling FixtureExplorerPresenter directly and causing the n^2 messaging anti-pattern, it sends a SystemLoaded message to an ITestEventPublisher. </p>
<div style="background: white none repeat scroll 0% 50%;font-size: 12pt;color: black;font-family: courier new">
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">virtual</span> <span style="color: blue">void</span> AddProject(<span style="color: teal">IProject</span> project)</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">ISystemUnderTest</span> system = project.BuildSystem();</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _hierarchyNode.AddProject(project, system);</pre>
<pre style="margin: 0px">&nbsp;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// _publisher is an instance of the ITestEventPublisher interface</span></pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <b>_publisher.PublishEvent(<span style="color: blue">new</span> <span style="color: teal">SystemLoaded</span>(system));</b></pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre>
</div>
<p>The&nbsp;concrete method PublishEvent() is shown below:&nbsp;</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 12pt;color: black;font-family: courier new">
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">void</span> PublishEvent&lt;T&gt;(T subject)</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// _listeners is just an ArrayList of all the Listeners </span></pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">foreach</span> (<span style="color: blue">object</span> listener <span style="color: blue">in</span> _listeners)</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// Determine if a Listener handles the message of type T</span></pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// by trying to cast it</span></pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">IListener</span>&lt;T&gt; receiver = listener <span style="color: blue">as</span> <span style="color: teal">IListener</span>&lt;T&gt;;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (receiver != <span style="color: blue">null</span>)</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// I'm using SyncronizationContext to handle moving processing</span></pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// from a background thread to the UI thread without having </span></pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// to worry about it in the View or Presenter</span></pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _context.Send(<span style="color: blue">delegate</span> { receiver.Handle(subject); }, <span style="color: blue">null</span>);</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre>
</div>
<p>Connecting a message to the correct listeners is actually pretty simple.&nbsp; The TestEventPublisher object as an ArrayList of all the possible listeners.&nbsp; When it receives a message of type SystemLoaded,&nbsp;TestEventPublisher: </p>
<ul>
<li>Loops through each listener
</li>
<li>Checks if each listener implements the interface IListener&lt;SystemLoaded&gt;
</li>
<li>If it does implement that interface, it calls Handle(SystemLoaded) on the listener</li>
</ul>
<p>That&#8217;s it.&nbsp; Assuming that the TestEventPublisher &#8220;knows&#8221; about all the listenters, and a client of ITestEventPublisher &#8220;knows&#8221; how to get to the single instance of TestEventPublisher, event aggregation is easy.&nbsp; So let&#8217;s talk about getting the pieces together.</p>
<p>&nbsp;</p>
<h4>Getting Listeners and Publishers Together</h4>
<p>The easy part is just getting a reference to the single instance of the ITestEventPublisher.&nbsp; That&#8217;s just a little bit of vanilla StructureMap configuration:</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 12pt;color: black;font-family: courier new">
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; ForRequestedType&lt;<span style="color: teal">ITestEventPublisher</span>&gt;()</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .TheDefaultIsConcreteType&lt;<span style="color: teal">TestEventPublisher</span>&gt;()<b>.AsSingletons()</b>;</pre>
</div>
<p>The bolded part just directs StructureMap to only create one shared instance of ITestEventPublisher.&nbsp; Anything that needs to get at an ITestEventPublisher can just service location by a good ol&#8217;fashioned call to:</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 12pt;color: black;font-family: courier new">
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">ITestEventPublisher</span> eventPublisher = </pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">ObjectFactory</span>.GetInstance&lt;<span style="color: teal">ITestEventPublisher</span>&gt;();</pre>
</div>
<p>if you only need a transient reference to ITestEventPublisher.&nbsp;&nbsp;The mass majority of the time I just use constructor injection&nbsp;like my ApplicationController class:</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 12pt;color: black;font-family: courier new">
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> ApplicationController(</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">ICommandExecutor</span> executor, </pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">IContentPanel</span> panel, </pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">IProjectRepository</span> repository,</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <b><span style="color: teal">ITestEventPublisher</span> publisher,</b> </pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">IHierarchyNode</span> hierarchyNode)</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _executor = executor;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _panel = panel;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _repository = repository;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _publisher = publisher;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _hierarchyNode = hierarchyNode;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre>
</div>
<p>I do create ApplicationController from StructureMap, so all of the constructor arguments are located and passed into the constructor by StructureMap.&nbsp; All of the Command and Presenter classes that would need to broadcast event messages are generally created by StructureMap anyway, so the constructor injection method turns out to be pretty simple.</p>
<p>All that&#8217;s left is to make sure that the listeners are correctly registered with the TestEventPublisher, and that&#8217;s a little bit trickier.&nbsp; Before I start, I should say that this is just the way that I did this and not THE way to do this.&nbsp; In StoryTeller there are two different categories of listeners.&nbsp; There is one set of objects like the FixtureExplorerPresenter that are driving pieces of the application shell&nbsp;at all times.&nbsp; These objects are started as the application loads and registered with TestEventPublisher right off the bat.&nbsp; I&#8217;m using the fluent interface mechanism for configuring StructureMap in code as a more or less internal DSL (I refuse to argue with you if it&#8217;s actually a DSL or not).&nbsp; One of the advantages of an internal DSL written in just plain C#&nbsp;is that you can extend it at will or wrap it with other calls.&nbsp; I created a little wrapper around the method to register a type with StructureMap called Start():</p>
<p>&nbsp;</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 12pt;color: black;font-family: courier new">
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> <span style="color: blue">static</span> <span style="color: teal">List</span>&lt;<span style="color: teal">Type</span>&gt; _startables = <span style="color: blue">new</span> <span style="color: teal">List</span>&lt;<span style="color: teal">Type</span>&gt;();</pre>
<pre style="margin: 0px">&nbsp;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">protected</span> <span style="color: teal">CreatePluginFamilyExpression</span>&lt;T&gt; Start&lt;T&gt;() <span style="color: blue">where</span> T : <span style="color: teal">IStartable</span></pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">Type</span> type = <span style="color: blue">typeof</span> (T);</pre>
<pre style="margin: 0px">&nbsp;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// Just track which Types need to be started and registered with</span></pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// ITestEventPublisher as the application is loaded</span></pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _startables.Add(type);</pre>
<pre style="margin: 0px">&nbsp;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// Continue on with StructureMap configuration as usual</span></pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> ForRequestedType&lt;T&gt;();</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre>
</div>
<p>In the StructureMap bootstrapping, I just call Start() to denote a type that needs to be started right off the bat and registered with the event aggregator.&nbsp; Notice that our old friend FixtureExporerPresenter is one of the &#8220;Startables.&#8221;</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 12pt;color: black;font-family: courier new">
<pre style="margin: 0px"><b>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Start&lt;<span style="color: teal">IFixtureExplorerPresenter</span>&gt;()</b></pre>
<pre style="margin: 0px"><b>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .TheDefaultIsConcreteType&lt;<span style="color: teal">FixtureExplorerPresenter</span>&gt;().AsSingletons();</b></pre>
<pre style="margin: 0px">&nbsp;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Start&lt;<span style="color: teal">IApplicationController</span>&gt;()</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .TheDefaultIsConcreteType&lt;<span style="color: teal">ApplicationController</span>&gt;().AsSingletons();</pre>
<pre style="margin: 0px">&nbsp;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Start&lt;<span style="color: teal">ICommandExecutor</span>&gt;().TheDefaultIsConcreteType&lt;<span style="color: teal">CommandExecutor</span>&gt;().AsSingletons();</pre>
</div>
<p>&nbsp;</p>
<p>Part of the application bootstrapping is a call to this little routine.&nbsp; It just iterates through the &#8220;Startable&#8221; types, gets that type from StructureMap,&nbsp;and registers each by calling AddListener() on the event aggregator.</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 12pt;color: black;font-family: courier new">
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> <span style="color: blue">static</span> <span style="color: blue">void</span> attachListeners()</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">ITestEventPublisher</span> eventPublisher = </pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">ObjectFactory</span>.GetInstance&lt;<span style="color: teal">ITestEventPublisher</span>&gt;();</pre>
<pre style="margin: 0px">&nbsp;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">foreach</span> (<span style="color: teal">Type</span> type <span style="color: blue">in</span> _startables)</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">IStartable</span> startable = (<span style="color: teal">IStartable</span>) <span style="color: teal">ObjectFactory</span>.GetInstance(type);</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; startable.Start();</pre>
<pre style="margin: 0px">&nbsp;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <b>eventPublisher.AddListener(startable);</b></pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre>
</div>
<p>I also register the Presenter for each screen as a listener each time a new screen is opened.&nbsp; I&#8217;ll talk much more about this in a future post, but for right now let&#8217;s say that all screens are opened by a single class (sometimes it&#8217;s the ApplicationController, other times it&#8217;s what I call a ScreenCollection for a lack of a better name).&nbsp; By making all screen activation and deactivation go through a common point it&#8217;s now easy to perform bookkeeping operations on the screens.&nbsp; In the case of StoryTeller, I do this in the method that&#8217;s called to add a new screen to the main docking manager (the code is in ContentPanel if you&#8217;re playing along at home in the StoryTeller code):</p>
<p>&nbsp;</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 12pt;color: black;font-family: courier new">
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">void</span> OpenScreen(<span style="color: teal">IPresenter</span> presenter)</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <b>_publisher.AddListener(presenter);</b></pre>
<pre style="margin: 0px">&nbsp;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">...Other stuff that adds the screen to the docking manager</span></pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre>
</div>
<p>I mentioned above that I don&#8217;t use WeakReferences.&nbsp; To avoid a severe memory leak in the app, I need to remove a presenter from the publisher&#8217;s list of listeners whenever a screen is permanently closed.</p>
<p>&nbsp;</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 12pt;color: black;font-family: courier new">
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">void</span> Close(<span style="color: teal">ContentTab</span> tab)</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">bool</span> needToActivateDifferentScreen = tab.Equals(TabControl.SelectedTab);</pre>
<pre style="margin: 0px">&nbsp;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">IPresenter</span> presenter = tab.Presenter;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; presenter.Deactivate();</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <b>_publisher.RemoveListener(presenter);</b></pre>
<pre style="margin: 0px">&nbsp;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _tabControl.Items.Remove(tab);</pre>
<pre style="margin: 0px">&nbsp;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (needToActivateDifferentScreen &amp;&amp; _tabControl.Items.Count &gt; 0)</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">ContentTab</span> lastTab = getLastTab();</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; TabControl.SelectedTab = lastTab;</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre>
<pre style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</pre>
</div>
<p>If you&#8217;re not going to track the elements that need to be removed from the publish/subscribe registry, or just don&#8217;t want to do this, I&#8217;d recommend using WeakReferences inside your Event Aggregator class.</p>
<h4>Other Issues</h4>
<p>Some last little thoughts.&nbsp; </p>
<ul>
<li>I&#8217;m using SynchronizationContext for threading synchronization so that I don&#8217;t have to worry about events coming from a background thread.&nbsp; I&#8217;ve found that choking the background callbacks through just a couple different points can keep the rest of your code cleaner from the monotonous InvokeRequired()/Invoke() code.&nbsp; </li>
<li>I don&#8217;t think it matters in StoryTeller, but with other applications you may not want to immediately respond to an event if the screen is hidden or in an inactive tab.&nbsp; You&#8217;ll need more logic in these cases to delay an update activity.</li>
</ul>
<p>&nbsp;There&#8217;s probably other issues, but I want to hit &#8220;publish&#8221; now.&nbsp; Just throw in questions and I&#8217;ll see what I can do.</p>
											</div><!-- .entry-content -->

					<div id="entry-author-info">
						<div id="author-avatar">
							<img alt='' src='http://1.gravatar.com/avatar/db65c5c5cf9f1c51e842f733892eace1?s=60&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G' class='avatar avatar-60 photo' height='60' width='60' />						</div><!-- #author-avatar 	-->
						<div id="author-description">
							<h2>About Jeremy Miller</h2>
							Jeremy is the Chief Software Architect at Dovetail Software, the coolest ISV in Austin.  Jeremy began his IT career writing "Shadow IT" applications to automate his engineering documentation, then wandered into software development because it looked like more fun. Jeremy is the author of the open source StructureMap tool for Dependency Injection with .Net, StoryTeller for supercharged acceptance testing in .Net, and one of the principal developers behind FubuMVC.  Jeremy's thoughts on all things software can be found at The Shade Tree Developer at http://codebetter.com/jeremymiller.							<div id="author-link">
								<a href="http://codebetter.com/jeremymiller/author/jeremymiller/" title="View all posts by Jeremy Miller">View all posts by Jeremy Miller &rarr;</a>
							</div><!-- #author-link	-->
						</div><!-- #author-description	-->
					</div><!-- .entry-author-info -->

					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/jeremymiller/category/build-your-own-cab/" title="View all posts in Build your own CAB" rel="category tag">Build your own CAB</a>, <a href="http://codebetter.com/jeremymiller/category/featured/" title="View all posts in Featured" rel="category tag">Featured</a>. Bookmark the <a href="http://codebetter.com/jeremymiller/2008/01/11/build-your-own-cab-extensible-pub-sub-event-aggregator-with-generics/" title="Permalink to Build your own CAB: Extensible Pub/Sub Event Aggregator with Generics" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/jeremymiller/2008/01/11/build-your-own-cab-extensible-pub-sub-event-aggregator-with-generics/feed/" title="Comments RSS to Build your own CAB: Extensible Pub/Sub Event Aggregator with Generics" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-480 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/jeremymiller/2008/01/10/alt-net-defined-in-c-gibberish/" rel="prev"><span class="meta-nav">&larr;</span> ALT.NET defined in C# Gibberish</a></div>
					<div class="nav-next"><a href="http://codebetter.com/jeremymiller/2008/01/15/superman-without-the-yellow-sun/" rel="next">Superman without the yellow sun <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
					<div id="dsq-content">
			<ul id="dsq-comments">
					<li id="dsq-comment-3303">
					<div id="dsq-comment-header-3303" class="dsq-comment-header">
						<cite id="dsq-cite-3303">
	http://www.bluespire.com/blogs							<span id="dsq-author-user-3303">Rob</span>
							</cite>
					</div>
					<div id="dsq-comment-body-3303" class="dsq-comment-body">
						<div id="dsq-comment-message-3303" class="dsq-comment-message"><p>I think this is a really elegant way to solve the problem.  I&#8217;m not sure why it didn&#8217;t occur to me to do it like this before.  It must have been obvious to Udi, as this is a very common pattern in his area.  There is one thing I&#8217;m not sure of.  How would you handle the case of a &#8220;dataless&#8221; event?</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-3304">
					<div id="dsq-comment-header-3304" class="dsq-comment-header">
						<cite id="dsq-cite-3304">
	http://codebetter.com/blogs/jeremy.miller							<span id="dsq-author-user-3304">Jeremy D. Miller</span>
							</cite>
					</div>
					<div id="dsq-comment-body-3304" class="dsq-comment-body">
						<div id="dsq-comment-message-3304" class="dsq-comment-message"><p>Rob,</p>
<p>I didn&#8217;t do a very good job of explaining that the &#8220;T&#8221; in IListener<t> is the subject of the message.  You would just make a type called:</p>
<p>public class ThisJustHappened{}</p>
<p>and go PublishEvent(new ThisJustHappened())</p>
<p>to tell an IListener
<thisjusthappened>() to call it&#8217;s Handle</thisjusthappened>
<thisjusthappened>() method.  In this case, all the message type is good for is routing</thisjusthappened></t></p>
</div>
					</div>
				</li>
					<li id="dsq-comment-3305">
					<div id="dsq-comment-header-3305" class="dsq-comment-header">
						<cite id="dsq-cite-3305">
								<span id="dsq-author-user-3305">Nathan</span>
							</cite>
					</div>
					<div id="dsq-comment-body-3305" class="dsq-comment-body">
						<div id="dsq-comment-message-3305" class="dsq-comment-message"><p>This looks simple but clever. How would you compare this to injecting a list of listeners into your publisher via IoC ?</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-3306">
					<div id="dsq-comment-header-3306" class="dsq-comment-header">
						<cite id="dsq-cite-3306">
	http://codebetter.com/blogs/jeremy.miller							<span id="dsq-author-user-3306">Jeremy D. Miller</span>
							</cite>
					</div>
					<div id="dsq-comment-body-3306" class="dsq-comment-body">
						<div id="dsq-comment-message-3306" class="dsq-comment-message"><p>@Nathan,</p>
<p>I&#8217;m not sure that you could get away with injecting the listeners via IoC, or that you would want to.  Most of the listeners in StoryTeller wouldn&#8217;t even get created until well after the publisher.  It wouldn&#8217;t be quite as dynamic.</p>
<p>I guess my real answer is &#8220;don&#8217;t know&#8221;</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-3307">
					<div id="dsq-comment-header-3307" class="dsq-comment-header">
						<cite id="dsq-cite-3307">
	http://www.bluespire.com/blogs							<span id="dsq-author-user-3307">Rob</span>
							</cite>
					</div>
					<div id="dsq-comment-body-3307" class="dsq-comment-body">
						<div id="dsq-comment-message-3307" class="dsq-comment-message"><p>Thought you might find this interesting:</p>
<p><a href="http://mdavey.wordpress.com/2007/06/14/ui-automation/" rel="nofollow">http://mdavey.wordpress.com/2007/06/14/ui-automation/</a></p>
</div>
					</div>
				</li>
					<li id="dsq-comment-3308">
					<div id="dsq-comment-header-3308" class="dsq-comment-header">
						<cite id="dsq-cite-3308">
								<span id="dsq-author-user-3308">Reshef Mann</span>
							</cite>
					</div>
					<div id="dsq-comment-body-3308" class="dsq-comment-body">
						<div id="dsq-comment-message-3308" class="dsq-comment-message"><p>Is using the EventPublisher the way to communicate between presenters?<br />
Let me be clearer, say I have a file editor with a text editor component and a file browser tree which holds the tree of scripts I have. I have a presenter for each of there components. Should the message that tells the text editor presenter that the user wants to open a file (doubleclicks it in the tree) arrive by the event publisher?<br />
Thanks, Reshef</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-3309">
					<div id="dsq-comment-header-3309" class="dsq-comment-header">
						<cite id="dsq-cite-3309">
	http://codebetter.com/blogs/jeremy.miller							<span id="dsq-author-user-3309">Jeremy D. Miller</span>
							</cite>
					</div>
					<div id="dsq-comment-body-3309" class="dsq-comment-body">
						<div id="dsq-comment-message-3309" class="dsq-comment-message"><p>@Reshef,</p>
<p>That&#8217;s *a* way to do that.  In a very similar scenario, I had the Command that was fired off of the TreeNode just tell the ApplicationController to launch a new instance of the screen Presenter.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-3310">
					<div id="dsq-comment-header-3310" class="dsq-comment-header">
						<cite id="dsq-cite-3310">
	http://kentb.blogspot.com							<span id="dsq-author-user-3310">Kent Boogaart</span>
							</cite>
					</div>
					<div id="dsq-comment-body-3310" class="dsq-comment-body">
						<div id="dsq-comment-message-3310" class="dsq-comment-message"><p>Hey Jeremy,</p>
<p>Apologies again for the late reply &#8211; I&#8217;m slowly catching up on your excellent series on my bus trips to and from work. After reading this post I felt like putting together my own version of how I feel event aggregation could work. Basically, I made the event aggregator interface strongly typed (including the subscribe methods) and moved reflection usage into the auto-wiring code, where I feel it belongs. Also, publishes don&#8217;t need to implement an interface &#8211; they just use the event aggregator service.</p>
<p>Perhaps we should IM on this or something because I&#8217;m really keen to get your thoughts and the code is probably too long to post here. Basically, the usage looks like this:</p>
<p>public class MyClass : ISubscriber<somethinghappened><br />
{<br />
    public void Receive(SomethingHappened subject)<br />
    {<br />
        //something happened<br />
    }<br />
}</p>
<p>public class SomeOtherClass<br />
{<br />
    private IEventAggregator _eventAggregator = &#8230;;</p>
<p>    public void SomeMethod()<br />
    {<br />
        _eventAggregator.Publish(new SomethingHappened());<br />
    }<br />
}</p>
<p>Anyways, let me know.</p>
<p>Regards,<br />
Kent</somethinghappened></p>
</div>
					</div>
				</li>
				</ul>
		</div>
	</div>

<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

<script type="text/javascript">
/* <![CDATA[ */
	var disqus_url = 'http://codebetter.com/jeremymiller/2008/01/11/build-your-own-cab-extensible-pub-sub-event-aggregator-with-generics/ ';
	var disqus_identifier = '480 /blogs/jeremy.miller/archive/2008/01/11/build-your-own-cab-extensible-pub-sub-event-aggregator-with-generics.aspx';
	var disqus_container_id = 'disqus_thread';
	var disqus_domain = 'disqus.com';
	var disqus_shortname = 'theshadetreedeveloper';
	var disqus_title = "Build your own CAB: Extensible Pub\/Sub Event Aggregator with Generics";
		var disqus_config = function () {
	    var config = this; // Access to the config object

	    /* 
	       All currently supported events:
	        * preData  fires just before we request for initial data
	        * preInit - fires after we get initial data but before we load any dependencies
	        * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
	        * afterRender - fires when template is rendered but before we show it
	        * onReady - everything is done
	     */

		config.callbacks.preData.push(function() {
			// clear out the container (its filled for SEO/legacy purposes)
			document.getElementById(disqus_container_id).innerHTML = '';
		});
				config.callbacks.onReady.push(function() {
			// sync comments in the background so we don't block the page
			DISQUS.request.get('?cf_action=sync_comments&post_id=480');
		});
					};
	var facebookXdReceiverPath = 'http://cdn1.codebetter.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
	var DsqLocal = {
		'trackbacks': [
		],
		'trackback_url': "http:\/\/codebetter.com\/jeremymiller\/2008\/01\/11\/build-your-own-cab-extensible-pub-sub-event-aggregator-with-generics\/trackback\/"	};
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
	var dsq = document.createElement('script'); dsq.type = 'text/javascript';
	dsq.async = true;
	dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.61';
	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
					<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-new-features?utm_source=cb&utm_medium=button&utm_term=4328&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="125" height="125" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/ANTSPP5_125x125_M1.gif"></a>
					<embed width="125" height="125" flashvars="clickTARGET=_blank&amp;clickTAG=http%3A%2F%2Fd1.openx.org%2Fck.php%3Foaparams%3D2__bannerid%3D62753__zoneid%3D29419__cb%3Da0471ce5e8__r_id%3Dd42118811971f057012db20aa261c5c1__r_ts%3Dldef6x__oadest%3Dhttp%253A%252F%252Fwww.jetbrains.com%252Fresharper%252F%253Frs4cb125" allowscriptaccess="always" quality="high" name="Advertisement" id="Advertisement" style="" src="http://s3.amazonaws.com/CodeBetter/Creative/tc_125x125_simple2.swf" type="application/x-shockwave-flash">
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title">The Shade Tree Developer</h3>Jeremy is the Chief Software Architect at Dovetail Software, the coolest ISV in Austin.  Jeremy began his IT career writing "Shadow IT" applications to automate his engineering documentation, then wandered into software development because it looked like more fun. Jeremy is the author of the open source StructureMap tool for Dependency Injection with .Net, StoryTeller for supercharged acceptance testing in .Net, and one of the principal developers behind FubuMVC.  Jeremy's thoughts on all things software can be found at The Shade Tree Developer at http://codebetter.com/jeremymiller.
</li><li id="text-3" class="widget-container widget_text"><h3 class="widget-title">Upcoming posts&#8230;</h3>			<div class="textwidget"><p>How I'm using StoryTeller to test FubuMVC<br />
Building a "Lookup" html convention w/ FubuMVC<br />
FubuMVC's Configuration Model "Special Sauce"<br />
Managing Script dependencies with FubuMVC<br />
Authorization and FubuMVC<br />
Continuations<br />
Composing Views with FubuMVC<br />
Extensible Model Binding with FubuMVC<br />
Introducing "Bottles"<br />
Modular Packaging with FubuMVC<br />
Self-Installing Apps w/ FubuMVC<br />
Routing and Behavioral Conventions with FubuMVC<br />
What Should I Learn?</p>
</div>
		</li><li id="linkcat-1046" class="widget-container widget_links"><h3 class="widget-title">Blogroll</h3>
	<ul class='xoxo blogroll'>
<li><a href="http://twitter.com/jeremydmiller">Follow me on Twitter</a></li>
<li><a href="https://github.com/DarthFubuMVC/fubumvc" target="_blank">FubuMVC on GitHub</a></li>
<li><a href="https://github.com/jeremydmiller">My GitHub Page</a></li>
<li><a href="https://github.com/storyteller/storyteller">StoryTeller on GitHub</a></li>
<li><a href="https://github.com/structuremap/structuremap">StructureMap on GitHub</a></li>

	</ul>
</li>
		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				<script type="text/javascript" src="http://engine.theloungenet.com/z/15/adzerk1_2_5"></script>
				<div id="adzerk1"></div>
				
				<ul class="xoxo">		
					<li id="archives-2" class="widget-container widget_archive"><h3 class="widget-title">Archives</h3>		<ul>
			<li><a href='http://codebetter.com/jeremymiller/2011/01/' title='January 2011'>January 2011</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/12/' title='December 2010'>December 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/09/' title='September 2010'>September 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/08/' title='August 2010'>August 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/07/' title='July 2010'>July 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/06/' title='June 2010'>June 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/05/' title='May 2010'>May 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/03/' title='March 2010'>March 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/02/' title='February 2010'>February 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/01/' title='January 2010'>January 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/12/' title='December 2009'>December 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/11/' title='November 2009'>November 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/10/' title='October 2009'>October 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/09/' title='September 2009'>September 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/08/' title='August 2009'>August 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/07/' title='July 2009'>July 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/06/' title='June 2009'>June 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/05/' title='May 2009'>May 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/04/' title='April 2009'>April 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/03/' title='March 2009'>March 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/02/' title='February 2009'>February 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/01/' title='January 2009'>January 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/12/' title='December 2008'>December 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/11/' title='November 2008'>November 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/10/' title='October 2008'>October 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/09/' title='September 2008'>September 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/08/' title='August 2008'>August 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/07/' title='July 2008'>July 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/06/' title='June 2008'>June 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/05/' title='May 2008'>May 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/04/' title='April 2008'>April 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/03/' title='March 2008'>March 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/02/' title='February 2008'>February 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/01/' title='January 2008'>January 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/12/' title='December 2007'>December 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/11/' title='November 2007'>November 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/10/' title='October 2007'>October 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/09/' title='September 2007'>September 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/08/' title='August 2007'>August 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/07/' title='July 2007'>July 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/06/' title='June 2007'>June 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/05/' title='May 2007'>May 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/04/' title='April 2007'>April 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/03/' title='March 2007'>March 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/02/' title='February 2007'>February 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/01/' title='January 2007'>January 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/12/' title='December 2006'>December 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/11/' title='November 2006'>November 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/10/' title='October 2006'>October 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/09/' title='September 2006'>September 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/08/' title='August 2006'>August 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/07/' title='July 2006'>July 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/06/' title='June 2006'>June 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/05/' title='May 2006'>May 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/04/' title='April 2006'>April 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/03/' title='March 2006'>March 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/02/' title='February 2006'>February 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/01/' title='January 2006'>January 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/12/' title='December 2005'>December 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/11/' title='November 2005'>November 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/10/' title='October 2005'>October 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/09/' title='September 2005'>September 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/08/' title='August 2005'>August 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/07/' title='July 2005'>July 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/06/' title='June 2005'>June 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/05/' title='May 2005'>May 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/04/' title='April 2005'>April 2005</a></li>
		</ul>
</li><li id="recent-comments-3" class="widget-container widget_recent_comments"><h3 class="widget-title">What others have said&#8230;</h3><ul id="recentcomments"><li class="recentcomments"><a href='http://topsy.com/codebetter.com/jeremymiller/2011/01/28/announcing-the-new-atx-code-lunch/?utm_source=pingback&amp;utm_campaign=L2' rel='external nofollow' class='url'>Tweets that mention Announcing the new ATX Code Lunch | Jeremy D. Miller -- Topsy.com</a> on <a href="http://codebetter.com/jeremymiller/2011/01/28/announcing-the-new-atx-code-lunch/#comment-6765">Announcing the new ATX Code Lunch</a></li><li class="recentcomments"><a href='http://weblogs.asp.net/thangchung' rel='external nofollow' class='url'>thangchung</a> on <a href="http://codebetter.com/jeremymiller/2009/01/16/quot-buildup-quot-existing-objects-with-structuremap/#comment-6764">&quot;BuildUp&quot; Existing Objects with StructureMap</a></li><li class="recentcomments">Steven Gentile on <a href="http://codebetter.com/jeremymiller/2011/01/23/if-you-are-using-structuremap-with-mvc3-please-read-this/#comment-6763">If you are using StructureMap with MVC3, please read this:</a></li><li class="recentcomments">jabits on <a href="http://codebetter.com/jeremymiller/2011/01/16/a-train-of-thought-wrapping-up-codemash-2011/#comment-6761">A Train of Thought &ndash; Wrapping up CodeMash 2011</a></li><li class="recentcomments">Michael Meadows on <a href="http://codebetter.com/jeremymiller/2011/01/16/a-train-of-thought-wrapping-up-codemash-2011/#comment-6754">A Train of Thought &ndash; Wrapping up CodeMash 2011</a></li></ul></li>				</ul>	
				
				<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-csharp?utm_source=cb&utm_medium=rectangle&utm_term=4327&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="300" height="250" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/APP6_Launch_C%23_Jun10_300x250_M1.gif?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1458095516&amp;Signature=BIBDilUaLnZe1uKfVKyyTBxr%2BvE%3D"></a>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/" title="Search Results">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="/blogs/products/pages/64386.aspx">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="/blogs/products/pages/64615.aspx">Telerik</a></li>
<li><a href="/blogs/products/pages/142174.aspx">JetBrains - ReSharper</a></li>
<li><a href="/blogs/products/pages/Beyond-Compare.aspx">Beyond Compare</a></li>
<li><a href="/blogs/products/pages/.NET-Memory-Profiler.aspx">.NET Memory Profiler</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a> &lt;-- NEW Friend!</li>

	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '11<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = false; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.301 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-01-31 06:50:30 -->
<!-- super cache -->