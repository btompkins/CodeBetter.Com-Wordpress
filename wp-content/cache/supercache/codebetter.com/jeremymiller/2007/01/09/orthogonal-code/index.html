<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Orthogonal Code | Jeremy D. Miller</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/jeremymiller/xmlrpc.php" />
	                <link rel="stylesheet" href="http://codebetter.com/jeremymiller/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='http://codebetter.com/jeremymiller/wp-includes/js/l10n.js?ver=20101110'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/jeremymiller/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://codebetter.com/jeremymiller/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Jeremy D. Miller' href='http://codebetter.com/jeremymiller/' />
<link rel='start' title='Bypass VSTS and get yourself a &quot;Poor Man&#8217;s IntelliJ&quot;' href='http://codebetter.com/jeremymiller/2005/04/12/bypass-vsts-and-get-yourself-a-poor-mans-intellij/' />
<link rel='prev' title='It&#8217;s cool to show up on Google, but&#8230;' href='http://codebetter.com/jeremymiller/2007/01/07/its-cool-to-show-up-on-google-but/' />
<link rel='next' title='Automated Web Testing with Watin' href='http://codebetter.com/jeremymiller/2007/01/10/automated-web-testing-with-watin/' />
<meta name="generator" content="WordPress 3.1-beta1-16732" />
<link rel='canonical' href='http://codebetter.com/jeremymiller/2007/01/09/orthogonal-code/' />
<link rel='shortlink' href='http://codebetter.com/jeremymiller/?p=264' />
<meta name="_awb_version" content="2.0.3" /><link rel="stylesheet" href="http://codebetter.com/jeremymiller/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.0.6" type="text/css" media="screen" /><link rel="stylesheet" href="http://disqus.com/stylesheets/theshadetreedeveloper/disqus.css?v=2.0" type="text/css" media="screen" />	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
<meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.1" />
                <script type="text/javascript" src="http://codebetter.com/jeremymiller/wp-content/uploads/spacker-cache/a8046d2f1fc1c08af413701218a11c1d.js">/*Is Cache!*/</script>
                	<style type="text/css">body { padding-top:0px !important; }</style>

</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">			</div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-264" class="post-264 post type-post status-publish format-standard hentry category-maintainability">
					<h1 class="entry-title">Orthogonal Code</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/jeremymiller/author/jeremymiller/" title="View all posts by Jeremy Miller">Jeremy Miller</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/jeremymiller/2007/01/09/orthogonal-code/" title="4:57 am" rel="bookmark"><span class="entry-date">January 9, 2007</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/jeremymiller/feed/rss/"  rel="nofollow"><img src="http://codebetter.com/jeremymiller/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/jeremymiller/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><p>My employer, <a href="http://www.finetix.com/">Finetix</a>, added my blog to <a href="http://www.finetix.com/blogs/finetixblogs.html">their main feed</a> and my most recent post at the time&nbsp;just happened to be about Star Wars, so I thought I needed to put up&nbsp;my first&nbsp;&quot;Grown Up&quot; post of the year.&nbsp; Before you read on, I am assuming some reader&nbsp;familiarity with the ideas of <a href="/blogs/jeremy.miller/pages/129542.aspx">loose coupling, cohesive code</a>, and <a href="http://en.wikipedia.org/wiki/Information_hiding">encapsulation</a>.</p>
<p>Continuing&nbsp;where I left off from&nbsp;<a href="/blogs/jeremy.miller/archive/2006/12/06/On-Writing-Maintainable-Code.aspx">On Writing Maintainable Code</a>, it&#039;s time to talk about how to write code with a high degree of Orthogonality.&nbsp; Applied to software design, Orthogonality is the ability to change a conceptual part of the software system&nbsp;while minimizing&nbsp;impact to other parts of the software system.&nbsp; An orthogonal design separates different concerns of the system (data access, security, business logic)&nbsp;in a way that&nbsp;enables changes to be made in isolated areas of the code without rippling out.&nbsp;&nbsp;</p>
<p>Over time, and <strong>even within the originating project</strong>, software systems will need to accommodate changes to both their behavior and infrastructure.&nbsp; Later in the lifecycle, old dog software systems will need to learn new tricks for unforeseen requirements as the business environment changes.&nbsp;&nbsp;Also, you stand a much higher chance of being able to reuse your&nbsp;existing code to perform this&nbsp;new functionality with a system that&nbsp;has been&nbsp;decomposed into orthogonal pieces.&nbsp; My favorite analogy for orthogonal code is&nbsp;the Lego sets you had as a child.&nbsp; You can use a small Lego brick to build almost anything.&nbsp; A big piece shaped like a pirate ship can only be used to make a pirate ship.</p>
<p>The basic concepts&nbsp;for writing Orthogonal code are <a href="/blogs/jeremy.miller/pages/129542.aspx">loose coupling and high cohesion</a>.&nbsp;&nbsp;These concepts&nbsp;are well known, but far too often ignored&nbsp;or not entirely appreciated.&nbsp; Several years ago&nbsp;several of my &quot;Architect&quot; colleagues spent a week at an OOP bootcamp.&nbsp; For the next couple weeks&nbsp;&quot;Loosely Coupled&quot; was worked into every single conversation that we had.&nbsp; Two weeks&nbsp;after that&nbsp;they went back to designing web services that took&nbsp;SQL strings&nbsp;in their input messages&nbsp;and stuffing business logic into stored procedures.&nbsp; I think they largely&nbsp;missed the point.</p>
<p>You&#039;ve heard the mantra your entire software development career, as epitomized by this quote from <a href="/blogs/scott.bellware/">Scott Bellware</a>:</p>
<blockquote>
<p>Loosely-coupled, highly-cohesive, ya-da, ya-da, ya-da, blah, blah, blah &ndash; the [developer&#039;s] eyes roll back into his head and the archi-speak fades into a nice, lulling drone.</p>
</blockquote>
<p>Focus those eyes back to the front of your head and pay attention, because orthogonal code, maintainable code, testable code, understandable code &#8212; all of these goals are most likely accomplished by a strong focus on loose coupling and high cohesion resting on the bedrock of <a href="http://en.wikipedia.org/wiki/Information_hiding">Encapsulation</a>.&nbsp; Achieve better cohesion by paying attention to &quot;Tell, Don&#039;t Ask,&quot; the Law of Demeter, and the Single Responsibility Principle.&nbsp;&nbsp;Supercharge&nbsp;the loose&nbsp;coupling&nbsp;of your code&nbsp;by applying the Dependency Inversion Principle and the Open/Closed Principle.&nbsp; Get some testability into your code.&nbsp; </p>
<p>Don&#039;t write this post&nbsp;off as just academic hot air, this&nbsp;is about consistently&nbsp;leaving the office&nbsp;on time and protecting your company&#039;s code assets because you&#039;ll be much more likely to smoothly sustain a forward progress&nbsp;with your existing code.&nbsp;&nbsp;&nbsp;</p>
<p>&nbsp;</p>
<h4>Real World Example</h4>
<p>To gain an appreciation for orthogonal code, or the lack thereof, let&#039;s look at some poorly designed&nbsp;code that does not exhibit orthogonality.&nbsp; This isn&#039;t&nbsp;completely a&nbsp;contrived example either, this is largely&nbsp;taken and <strong>exaggerated&nbsp;from a preliminary version</strong> of a system that I later inherited.&nbsp; I chose this example because this code&nbsp;was hard to change, and major changes and extensions&nbsp;were necessary in its first year of life.&nbsp; Unfortunately, I&#039;ve commonly run across code like this in my career.&nbsp; Microsoft developers get a bad rap for having an inadequate&nbsp;command of good development principles and practices, but I&#039;ve seen this type of tightly coupled, uncohesive code in several different programming languages, environments, and organizations.</p>
<p>Here&#039;s the scenario, the architecture is a <a href="http://www.enterpriseintegrationpatterns.com/PipesAndFilters.html">Pipes and Filters</a>&nbsp;structure that involves a series of message processors that take an Xml&nbsp;input, interpret that data and perform business validations and/or transform the input message to an outgoing message, and then put&nbsp;a serialized copy of&nbsp;the&nbsp;outgoing message onto an MSMQ queue.&nbsp; The entry point method of one of the &quot;Filter&quot; classes looked like this:</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 10pt;color: black;font-family: courier new">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">void</span> Transform(<span style="color: teal">InputMessage</span> input)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// BusinessLogicClass needs some reference data before it can do the transform</span></p>
<p style="margin: 0px"><span style="color: green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Use a derivation of the original Data Access Application Block from MS</span></p>
<p style="margin: 0px"><span style="color: green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p>
<p style="margin: 0px"><span style="color: green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // First, gotta look up the connection string first</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">string</span> connectionString = <span style="color: teal">ConfigurationManager</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .ConnectionStrings[<span style="color: maroon">&quot;ReferenceData&quot;</span>].ConnectionString;</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">DataSet</span> dataSet =</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">SqlHelper</span>.ExecuteDataSet(<span style="color: maroon">&quot;select * from sometable where some_field = some_property_of_input&quot;</span>,</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; connectionString);</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// do a bunch of business logic processing to transform Input to Output.&nbsp; It&#039;s not shown here, but</span></p>
<p style="margin: 0px"><span style="color: green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // the processMessage() function has calls to the data access classes interjected into the </span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">OutputMessage</span> outputMessage = <span style="color: blue">this</span>.processMessage(input, dataSet);</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// then send the message on via MSMQ</span></p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// Look up the Queue name first</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">string</span> queueName = <span style="color: teal">ConfigurationManager</span>.AppSettings[<span style="color: maroon">&quot;BusinessLogicClassQueue&quot;</span>]</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (!<span style="color: teal">MessageQueue</span>.Exists(queueName))</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">MessageQueue</span>.Create(queueName, <span style="color: blue">true</span>);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">MessageQueue</span> queue = <span style="color: blue">new</span> <span style="color: teal">MessageQueue</span>(queueName);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">string</span> serializedOutput = serializeOutgoingMessage(outputMessage)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; queue.Send(serializedOutput);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
</div>
<p>Fine, that code was easy to <strong>write in the first pass</strong>, but how about easy to change?&nbsp; To understand?&nbsp; To extend?&nbsp; To test?&nbsp; In reality this code is probably&nbsp;several times&nbsp;bigger because I omitted quite a bit of try/catch logic around the data access and queue management.&nbsp; Not to mention that the actual business validation and transformation rules&nbsp;were complex.&nbsp;&nbsp;We&nbsp;can&nbsp;easily spot&nbsp;some significant problems with this code as wewalk through some of the possible changes to this code base.&nbsp; Let&#039;s&nbsp;talk about why&nbsp;a change could be difficult, and then&nbsp;in the sections below&nbsp;examine the application of orthogonal design principles to make&nbsp;these changes less painful.</p>
<ul>
<li>Change the queueing mechanism.&nbsp; Originally the system communicated between the logical filter classes running in multiple windows service processes&nbsp;by putting the outgoing Xml message into an MSMQ queue.&nbsp; Reflecting this choice, our Transform() method directly uses the classes in the System.Messaging to talk to MSMQ.&nbsp;
</li>
<li>Change configuration&nbsp;mechanisms.&nbsp; This method pulls its own configuration straight from the application config file.&nbsp; If the application needs some more sophisticated configuration infrastructure, this code, and every other piece of code,
</li>
<li>Change the database structure.&nbsp; Ok, it&#039;s the year 2007, and in the post ASP classic world we don&#039;t embed sql directly in our business logic code anymore, but sometimes it&#039;s good to remember why we follow good design principles.&nbsp; Changing the database structure could easily break the business logic.&nbsp; Just as importantly, writing the business&nbsp;logic&nbsp;was harder than it had to be because you had to slog through the data access machinery along the way.&nbsp; Even if the database structure doesn&#039;t change, you might want to take advantage of some sort of caching mechanism.&nbsp; If you <a href="/blogs/jeremy.miller/archive/2005/07/07/130095.aspx">don&#039;t have an encapsulated data access library</a>, you might end up needlessly repeating a&nbsp;large amount of&nbsp;boilerplate code&nbsp;around connection management (get connection string,&nbsp;open connection, attach transaction object, try/catch/finally exception handling).
</li>
<li>Change the business logic.&nbsp; Let&#039;s call this one a near certitude.&nbsp; As I&#039;ll show later, reusing the business logic <strong>while leaving the database and messaging queue behind</strong> may be the important change that has to be made later.
</li>
<li>Implement better (any)&nbsp;auditing or security.&nbsp; Where would you put the security and auditing?&nbsp; Everything seems to be jumbled together here.</li>
</ul>
<p>&nbsp;</p>
<h4>Encapsulation</h4>
<p>I&#039;ve often heard encapsulation described as &quot;shy&quot; code.&nbsp; Putting it another way, a lack of encapsulation is&nbsp;code walking around with its underwear on the outside.&nbsp;&nbsp;Classes that conceal&nbsp;their inner workings are easier to use.&nbsp; You don&#039;t have to do nearly as much hand holding with&nbsp;encapsulated classes&nbsp;because they know how to bootstrap themselves.</p>
<p>For a contrast in encapsulation, let&#039;s take a look at how the <font face="Courier New">Filter.Transform()</font> method performs its data access.&nbsp; The original system used a modified copy of the original Data Access Application Block (DAAB) class.&nbsp; The DAAB was an attempt to simplify data access by encapsulating some very common ADO.Net grunt work inside one monster sized class called SqlHelper.&nbsp; The DAAB was popular, but I always thought it was lacking, mostly because <strong>it did not&nbsp;provide enough encapsulation</strong> of ADO.Net to form the core of a solid Data Access Layer.&nbsp;&nbsp;Let&#039;s look at&nbsp;the signature of two of the most commonly used methods on the SqlHelper, then let&#039;s talk about where the DAAB just didn&#039;t go far enough.</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 10pt;color: black;font-family: courier new">
<p style="margin: 0px"><span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">int</span> ExecuteNonQuery(<span style="color: blue">string</span> connectionString, <span style="color: teal">CommandType</span> commandType, <span style="color: blue">string</span> commandText)</p>
</div>
<div style="background: white none repeat scroll 0% 50%;font-size: 10pt;color: black;font-family: courier new">
<p style="margin: 0px"><span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">int</span> ExecuteNonQuery(<span style="color: teal">SqlTransaction</span> transaction, <span style="color: teal">CommandType</span> commandType, <span style="color: blue">string</span> commandText)</p>
</div>
<p>That&#039;s not so terrible, and it does, after all,&nbsp;encapsulate the creation and manipulation&nbsp;of SqlCommand and exception handling.&nbsp; Take a look at what you *do* have to tell SqlHelper.&nbsp; You have to go look up the connection string separately every single time.&nbsp; If you need to do transactional sql statements (and you do), you&#039;re going to have to keep the SqlTransaction object around yourself and remember to pass it into the<font face="Courier New"> ExecuteNonQuery()</font> overload method on every single call.&nbsp; You also have to keep telling the SqlHelper what type of command you&#039;re using.&nbsp; In&nbsp;the real life example system, that led to an absurd amount of repeated, noise code like this:</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 10pt;color: black;font-family: courier new">
<p style="margin: 0px"><span style="color: teal">SqlHelper</span>.ExecuteNonQuery(<span style="color: teal">ConfigurationClass</span>.GetConnectionString(), <span style="color: teal">CommandType</span>.Text, <span style="color: maroon">&quot;some sql statement&quot;</span>);</p>
</div>
<p>Why should I have to tell my Data Access Layer (DAL)&nbsp;what it&#039;s database connection string is?&nbsp; What possible value is it to me to have to specify CommandType.Text repeatedly if that&#039;s the only CommandType I care about?&nbsp; If I&#039;m using transactions, I have to know about the Transaction class and shuttle it around between calls.&nbsp; In my opinion, the DAAB simply did not provide enough value.&nbsp; At most it was simply something that you could wrap further or use as sample code to write your own &#8212; and that&#039;s exactly what I did.</p>
<p>When I do have to use a classical DAL, I use a homegrown assembly that encapsulates all of my ADO.Net manipulation, mostly&nbsp;behind this core interface:</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 10pt;color: black;font-family: courier new">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">interface</span> <span style="color: teal">IDataSession</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">&#8230;</span></p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">void</span> BeginTransaction();</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">void</span> CommitTransaction();</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">void</span> RollbackTransaction();</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">int</span> ExecuteCommand(<span style="color: teal">IDbCommand</span> command);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">int</span> ExecuteSql(<span style="color: blue">string</span> sql);</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: teal">&#8230;</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
</div>
<p>The major advantage over something like DAAB is far more encapsulation of the underlying ADO.Net objects.&nbsp;&nbsp;Using this interface as my core, I can concentrate solely on&nbsp;the sql being used inside my DAL instead of&nbsp;so much tedious ADO.Net code.&nbsp; Consumers of the IDataSession interface don&#039;t have to know how to fetch the&nbsp;connection string or store a Transaction class somewhere because those details are encapsulated within the&nbsp;concrete implementations of&nbsp;IDataSession.&nbsp; </p>
<p>In case you&#039;re curious, and you have far too much time on your hands,&nbsp;my homegrown&nbsp;DAL assembly&nbsp;is now part of the StructureMap code, but you&#039;ll have to pull it down out of the Subversion trunk&nbsp;(<a href="http://sourceforge.net/projects/structuremap">http://sourceforge.net/projects/structuremap</a>).&nbsp; Given a choice I&#039;ll use NHibernate for persistence instead, but I still use StructureMap.DataAccess for test automation and utility code.&nbsp; I have not looked at the descendent version of the DAAB in the Enterprise Library, but I would have to&nbsp;assume that it&#039;s much improved from the DAAB.</p>
<p>&nbsp;</p>
<h4>Tell, Don&#039;t Ask</h4>
<p>One way to detect or prevent&nbsp;leakages in encapsulation is to follow the <a href="http://www.pragmaticprogrammer.com/ppllc/papers/1998_05.html">Tell, Don&#039;t Ask</a> principle.</p>
<blockquote>
<p>&#8230;you should endeavor to <em>tell</em> objects what you want them to do; do not <em>ask</em> them questions about their state, make a decision, and then tell them what to do.</p>
</blockquote>
<p>Here&#039;s an example violation of Tell, Don&#039;t Ask:</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 10pt;color: black;font-family: courier new">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">void</span> SelectAPointByAskingDetails(<span style="color: teal">DataPointSelector</span> selector)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green">// ask DataPointSelector for all of its internal Point&#039;s</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">Point</span>[] points = selector.AllPoints;</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green">// ask DataPointSelector what it&#039;s SelectionType is,</span></p>
<p style="margin: 0px"><span style="color: green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // then, depending on the SelectionType, pick the </span></p>
<p style="margin: 0px"><span style="color: green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green">// Point out of the Point array and set the SelectedPoint</span></span></p>
<p style="margin: 0px"><span style="color: green"><span style="color: green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green">// property on DataPointSelector</span></span></span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">switch</span>(selector.SelectionType)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">case</span> <span style="color: teal">SelectionType</span>.First:</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; selector.SelectedPoint = points[0];</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">break</span>;</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">case</span> <span style="color: teal">SelectionType</span>.Minumum:</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// loop through all the points and</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// find the &quot;minimum&quot; point, whatever that means</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">break</span>;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; </p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
</div>
<p>This &quot;Asking&quot; method knows a lot about the DataPointSelector, and it&#039;s making all of the decisions for DataPointSelector.&nbsp; Following Tell, Don&#039;t Ask would lead us to encapsulate the details of Point selection into DataPointSelector.&nbsp; After the encapsulation, the interaction with DataPointSelector is now:</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 10pt;color: black;font-family: courier new">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">void</span> SelectAPointByTelling(<span style="color: teal">DataPointSelector</span> selector)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; selector.SelectPoint();</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
</div>
<p>&quot;Pragmatic&quot; <a href="http://www.toolshed.com/blog/">Andy Hunt</a> explains &quot;Tell, Don&#039;t Ask&quot;&nbsp;very&nbsp;will in an episode of&nbsp;<a href="http://www.dotnetrocks.com/default.aspx?showNum=205">DotNetRocks</a>.</p>
<h4>You Will Follow the Law of Demeter!</h4>
<p>I&#039;ve always wanted to use that for a blog title, but I really don&#039;t think I can improve on the <a href="http://en.wikipedia.org/wiki/Law_of_Demeter">Wikipedia article on the Law of Demeter</a>. &nbsp;I mention it here because it&#039;s an important tool for increasing encapsulation in your code.&nbsp; Roughly, following the Law of Demeter increases encapsulation by avoiding long messaging chains like TopClass.Child.Helper.Connection.Close().&nbsp; Instead, open up a new Close() method on the TopClass and hide the entire chain of calls through its children.&nbsp; It&#039;s nothing but making sure that TopClass is wearing its underwear (Child.Helper.etc) under its clothes where it belongs.</p>
<h4>High Cohesion</h4>
<p>Code that is highly cohesive groups strongly related code into a common class, namespace, or module.&nbsp; On the flipside, a highly cohesive class is one that has narrowly focused responsibilities.&nbsp; Code with low cohesion either scatters related code throughout the system, or leads to classes with unrelated responsibilities.&nbsp; High Cohesion leads to code that is easier to understand, reduces duplication, enhances reusability, and generally makes code easier to maintain.&nbsp; </p>
<p>The Filter class flunks a test of cohesion, and also&nbsp;implies some greater problems throughout the codebase.&nbsp; To start fixing the Filter class, let&#039;s list the responsibilities of the Filter class.</p>
<ul>
<li>Fetching configuration
</li>
<li>Calling the database to get some reference data
</li>
<li>Performs the business validation and transformation logic
</li>
<li>Serializes the results into Xml
</li>
<li>Creates the messaging queue if it does not already exist
</li>
<li>Sends the output message to the outgoing messaging queue</li>
</ul>
<p>Wait, you say.&nbsp; The Filter class is probably&nbsp;the implementation of a single use case or story.&nbsp; That&#039;s cohesive right?&nbsp; Well, no, because even inside this&nbsp;single use case&nbsp;there&#039;s a mixture of business logic and system infrastructure.&nbsp; Chances are very good that you will want to reuse pieces of the infrastructural code outside of this single use case.&nbsp; Maybe more importantly, you want to avoid <strong>duplicating</strong> system infrastructure code so that you can accommodate changes in infrastructure more readily.</p>
<p>Let&#039;s take the immediate refactoring step of moving the messaging infrastructure code into a separate class and simply let Filter delegate to this new class.</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 10pt;color: black;font-family: courier new">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: teal">MessagingGateway</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">void</span> SendMessage(<span style="color: teal">OutputMessage</span> outputMessage)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// Look up the Queue name first</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">string</span> queueName = <span style="color: teal">ConfigurationManager</span>.AppSettings[<span style="color: maroon">&quot;BusinessLogicClassQueue&quot;</span>];</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (!<span style="color: teal">MessageQueue</span>.Exists(queueName))</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">MessageQueue</span>.Create(queueName, <span style="color: blue">true</span>);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">MessageQueue</span> queue = <span style="color: blue">new</span> <span style="color: teal">MessageQueue</span>(queueName);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">string</span> serializedOutput = serializeOutgoingMessage(outputMessage);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; queue.Send(serializedOutput);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> <span style="color: blue">string</span> serializeOutgoingMessage(<span style="color: teal">OutputMessage</span> message)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> <span style="color: blue">null</span>;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
</div>
<p>Now we&#039;ve gotten the details of the messaging infrastructure away from the rest of the flow of the Filter code in a class (MessagingGateway) that can be reused across multiple Filter classes.&nbsp; If we wanted or needed to, we could change the serialization to a binary format, use a different security mechanism on the queues, easily add more auditing, or maybe switch to an entirely different technology.&nbsp; Switching gears entirely, maybe you want to throw out the idea of queueing and run all of the Filter&#039;s in a single common AppDomain.&nbsp; Assuming that any new version of MessagingGateway encapsulates the details of its implementation,&nbsp;every single one of&nbsp;these changes could take place without altering the code in the Filter classes.&nbsp; That&#039;s orthogonality at it&#039;s best.</p>
<p>While doing research for this section I came across this great article from <a href="http://www.waysys.com/ws_content_bl_pgssd_ch06.html">Meilir Page-Jones on Cohesion</a>.&nbsp; It&#039;s from an introductory textbook on Structured Programming of all things, but it&#039;s readily applicable to today&#039;s&nbsp;OOP and&nbsp;I would think SOA paradigms.&nbsp;</p>
<h4>Single Responsibility Principle</h4>
<p>We improved the cohesion of the original Filter class by extracting out a class for MessagingGateway, but there are still unrelated responsibilities left in the Filter.Transform() method that could be pulled out.&nbsp; The new MessagingGateway class itself could use some improvement.&nbsp; So how many responsibilities can a class take on before cohesion is compromised?&nbsp; Exactly one, and that&#039;s known as the <a href="http://en.wikipedia.org/wiki/Single_responsibility_principle">Single Responsibility Principle</a>.</p>
<blockquote>
<p>A class should have only one reason to change.</p>
</blockquote>
<p>Taking a closer look at the new MessagingGateway above, we see at least two reasons it may have to change.&nbsp; The queueing itself obviously, but it MessagingGateway also pulls the address of the queue from the configuration file.&nbsp; It&#039;s very conceivable that the configuration strategy of an application could change to something more sophisticated.&nbsp;&nbsp;Specifically, I can remember a project where we could have collapsed 75&nbsp;servers, all of which were a single point of failure, into 12-14 redundant&nbsp;servers, except that the configuration code was scattered throughout the application instead of being encapsulated into a cohesive module of the system.&nbsp; Intermingling the&nbsp;code that retrieved&nbsp;configuration data with the rest of the system effectively eliminated a chance to remove a huge amount of support overhead while actually increasing uptime.&nbsp; </p>
<p>Off the top of my head, I can think of two ways to remove the details of the configuration storage from the MessagingGateway class.&nbsp; My strong&nbsp;preference is to simply poke in the queue name and whatever else configuration that the MessagingGateway needs into its constructor function (using <a href="http://structuremap.sourceforge.net">StructureMap</a> of course!).&nbsp; The other way, just to avoid branching off into a discussion on IoC/DI tools or builder classes, is to pull the access to the configuration into a centralized class.&nbsp; That class, and the new slightly simpler MessagingGateway,&nbsp;might look a bit like this:</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 10pt;color: black;font-family: courier new">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: teal">ConfigurationManager</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">string</span> ConnectionString</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">get</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> <span style="color: maroon">&quot;something&quot;</span>;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">&#8230;</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: teal">MessagingGateway</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">void</span> SendMessage(<span style="color: teal">OutputMessage</span> outputMessage)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// Look up the Queue name first</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">string</span> queueName = <span style="color: teal">ConfigurationManager</span>.QueueName;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: teal">&#8230;</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
</div>
<p>Taking the Single Responsibility Principle knife to our original <font face="Courier New">Filter.Transform()</font> method leads to pushing some of the responsibilities out into these new classes:&nbsp;</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 10pt;color: black;font-family: courier new">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: teal">DataAccessObjectForTheFilterClass</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: teal">ReferenceData</span> GetReferenceData(<span style="color: teal">InputMessage</span> input)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// go grab the connection string, call some sort of sql,</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// and put the data into some sort of usable data structure</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">&#8230;</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: teal">BusinessValidationAndTransformationProcessor</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: teal">OutputMessage</span> ProcessValidations(<span style="color: teal">InputMessage</span> message, <span style="color: teal">ReferenceData</span> referenceData)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// do a lot of business processing here, but only business processing</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">&#8230;</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
</div>
<p>The new version of the Filter.Transform() method&nbsp;delegates to the new granular, cohesive classes:&nbsp;</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 10pt;color: black;font-family: courier new">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">void</span> Transform(<span style="color: teal">InputMessage</span> input)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// Get the reference data</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">DataAccessObjectForTheFilterClass</span> dao = <span style="color: blue">new</span> <span style="color: teal">DataAccessObjectForTheFilterClass</span>();</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">ReferenceData</span> referenceData = dao.GetReferenceData(input);</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// Do the validation and transformation</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">BusinessValidationAndTransformationProcessor</span> processor = </p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">new</span> <span style="color: teal">BusinessValidationAndTransformationProcessor</span>();</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">OutputMessage</span> outputMessage = processor.ProcessValidations(input, referenceData);</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// Send out the outgoing message</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">MessagingGateway</span> messagingGateway = <span style="color: blue">new</span> <span style="color: teal">MessagingGateway</span>();</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; messagingGateway.SendMessage(outputMessage);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
</div>
<p>We pulled out the responsibility for configuration, data access, business validation, and the messaging infrastructure out of the main Filter class&nbsp;into cohesive classes.&nbsp; At this point, the Filter class is merely a &quot;Coordinator&quot; stereotype from <a href="http://www.wirfs-brock.com/PDFs/A%20Brief%20Tour%20of%20RDD%20in%202004.pdf">Responsibility Driven Design</a>.&nbsp;&nbsp;Centralizing&nbsp;the coordination of the various pieces into a dedicated coordinator is a great way to enhance the orthogonality of the code.</p>
<p>One of the client developers on my team asked me how do you know when you need to create a new class rather than add functionality to an existing class.&nbsp; I responded with &quot;One class, one responsibility.&quot;&nbsp; That leads us into a question of just what *is* a responsibility.&nbsp; My advice is to look for pieces of a class that don&#039;t seem to be related to the rest of the class and pull it out.&nbsp; I think the class being discussed that day was the Application Controller class that manages the basic shell of our WinForms application.&nbsp; Part of the UI is a panel of tabs for individual active views.&nbsp; Our ApplicationController class was starting to collect quite a few methods around managing the contents of the TabControl that weren&#039;t related to the rest of the ApplicationController.&nbsp; We pulled the functionality for managing the active view collection and the TabControl into a separate controller/view combination.&nbsp; Instead of one really big schizophrenic controller class, we had two smaller controller classes, both&nbsp;with a focused intent.&nbsp; There&#039;s a very important lesson in that.&nbsp; <strong>Many times you&#039;ll find that more classes lead to a simpler design by minimizing the complexity of any one single class.</strong></p>
<p>&nbsp;</p>
<h4>Loose Coupling</h4>
<p>Back to the&nbsp;original&nbsp;<font face="Courier New">Filter.Tranform()</font> method, the business logic in the&nbsp;Filter class is tightly bound to the configuration of the system, the messaging infrastructure, and knows directly about the SQL that gets passed into SqlHelper.&nbsp; In this design, the business logic inside of Filter is coupled very tightly to the infrastructure.&nbsp; So what does that really mean?</p>
<p>Just to see&nbsp;if someone is&nbsp;reading my blog, here&#039;s another real world scenario.&nbsp; Let&#039;s say you built your core software system 5-6 years ago before any of the&nbsp;Object/Relational Mapping&nbsp;persistance tools were considered mature.&nbsp; To fill the gap you wrote your own proprietary&nbsp;ORM and everything is great &#8212; for awhile.&nbsp; Fast forward to today and you realize that Hibernate or the forthcoming LINQ tools are significantly easier to use and have some functionality that you would like to have that isn&#039;t readily possible with your own homegrown ORM tool.&nbsp; If your business logic, user interface, and service layer are tightly coupled to your homegrown ORM, changing to another tool may not be economical.&nbsp; If you interspersed too&nbsp;much of the persistence code with the business logic or service layer code, you&#039;re effectively looking at a rewrite just to use the better tool.&nbsp; That&#039;s not the end of the world, but you&#039;ve just incurred an inefficiency that your competitors might not have by using the better tools.</p>
<p>You may absolutely not interpret this as a license to go build extra or unnecessary layers of abstraction on top of your persistence layer.&nbsp; When I use NHibernate I do encapsulate it behind thin wrapper interfaces, but anything beyond that might be getting into the realm of silly.&nbsp; Ted Neward recently&nbsp;skewered&nbsp;some folks&nbsp;for <a href="http://blogs.tedneward.com/2006/10/17/There+But+For+The+Grace+Of+God+And+The+Experiences+Of+Java+Go+I.aspx">too many abstraction layers</a>.&nbsp; All I want to say here is to keep as much distance between your persistence and business logic code as you possibly can.</p>
<p>I&#039;ve talked quite a bit about the coupling between the business logic and persistence code, but tight coupling might be lurking in a lot more corners of your system.</p>
<ul>
<li>In the implementation of a web service or any other integration point, strongly coupling the functionality of that service to the transport mechanism or Xml format often turns out to have negative effects.&nbsp; To the SOA enthusiasts of the world, I say to you that loose coupling doesn&#039;t stop once you&#039;re underneath the initial SOAP message.&nbsp; Loose coupling&nbsp;is just as important, in the small,&nbsp;in the code within a service.
</li>
<li>Singleton&#039;s or static classes are a very strong form of coupling
</li>
<li>Calls within a class to the constructor of another class is a subtle form of strong coupling</li>
</ul>
<h4>Dependency Inversion Principle</h4>
<p>Wait!&nbsp; You just said that a call to a constructor is a form of tight coupling?&nbsp; How?&nbsp;&nbsp;When we last left the&nbsp;Filter.Transform() method we had decomposed the&nbsp;responsibilities of the original scenario into cohesive classes, but the Filter class is creating the concrete helper classes directly.</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 10pt;color: black;font-family: courier new">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: teal">MessagingGateway</span> messagingGateway = <span style="color: blue">new</span> <span style="color: teal">MessagingGateway</span>();</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; messagingGateway.SendMessage(outputMessage);</p>
</div>
<p>In the code above, Filter knows exactly the class that performs the messaging, and it&#039;s dependent upon that MessagingGateway.&nbsp; We&#039;ve moved all of the details around interacting with MSMQ into MessagingGateway, so we could change the transport layer without modifying Filter, but what if we really do need to use Filter both&nbsp;with MSMQ and a web services transport layer?&nbsp; Simple, let&#039;s apply the <a href="/blogs/jeremy.miller/articles/129543.aspx">Dependency Inversion Principle</a> and extract out an interface for MessagingGateway that is independent on any of the concrete implementations of messaging transport.&nbsp; The second step is to make Filter depend on the abstracted interface.&nbsp; You do have to have a way to get the different implementations of IMessagingGateway into Filter, so we use just pass an instance of IMessagingGateway into Filter (Constructor Injection).</p>
<div style="background: white none repeat scroll 0% 50%;font-size: 10pt;color: black;font-family: courier new">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">interface</span> <span style="color: teal">IMessagingGateway</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">void</span> SendMessage(<span style="color: teal">OutputMessage</span> outputMessage);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: teal">MessagingGateway</span> : <span style="color: teal">IMessagingGateway</span></p>
</div>
<div style="background: white none repeat scroll 0% 50%;font-size: 10pt;color: black;font-family: courier new">
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; </p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: teal">Filter</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> <span style="color: blue">readonly</span> <span style="color: teal">IMessagingGateway</span> _messagingGateway;</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green">// Push in the IMessagingGateway in the constructor function</span></p>
<p style="margin: 0px"><span style="color: green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green">//&nbsp;so Filter doesn&#039;t even have to know which concrete</span></span></p>
<p style="margin: 0px"><span style="color: green"><span style="color: green">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green">// class is in here</span></span></span></p>
<p style="margin: 0px"><span style="color: green"><span style="color: green"></span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> Filter(<span style="color: teal">IMessagingGateway</span> messagingGateway)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _messagingGateway = messagingGateway;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">void</span> Transform(<span style="color: teal">InputMessage</span> input)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green">// Do the things that Filter.Transform() does</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &#8230;</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _messagingGateway.SendMessage(outputMessage);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
</div>
<p>Now, we&#039;ve got Filter receiving an abstracted IMessagingGateway from somewhere else, so it could work with completely different types of messaging infrastructure &#8212; or even work with no messaging.&nbsp; Don&#039;t just stop with the messaging either, abstract away the data access and the business&nbsp;validation and transformation code&nbsp;as well.</p>
<h4>Open/Closed Principle</h4>
<p>We&#039;ve busted the original Filter.Transform() method into&nbsp;smaller cohesive pieces, and&nbsp;decreased the coupling between the pieces by&nbsp;extracting out abstracted interfaces.&nbsp; Now we can talk about the ultimate principle for creating maintainable code &#8211;&nbsp;the <a href="http://c2.com/cgi/wiki?OpenClosedPrinciple">Open/Closed Principle</a> (OCP)..&nbsp; Verbatim, this principle is stated &quot;Software entities (classes, modules, functions, etc.) should be open for extension, but closed for modification.&quot;&nbsp; I used to think this only referred to the practice of creating <a href="/blogs/jeremy.miller/archive/2005/09/13/131897.aspx">plugin</a> extensibility points in your code, but that&#039;s only part of the OCP story.&nbsp; What I&#039;ve learned since then is that the essence of the Open/Closed Principle is being able to add new functionality to an existing codebase by writing completely new code with minimal modification of existing code.&nbsp; One of the major costs of extending an existing system is the potential for regression bugs&nbsp;in existing functionality.&nbsp; The&nbsp;most reliable&nbsp;way to minimize the&nbsp;creation of regression bugs is to avoid modifying the existing code.&nbsp; I&quot;ve consistently observed that&nbsp;I&#039;m&nbsp;always faster when&nbsp;I&#039;m&nbsp;building all new code versus making modifications in existing code. </p>
<p>I&#039;ve found that the OCP pattern is going to emerge in two basic ways:</p>
<ol>
<li>&quot;Pluggability.&quot;&nbsp; This is the obvious usage, but maybe not the most effective.&nbsp; By &quot;pluggability&quot; I really just mean the ability to create a new class or group of classes to implement a new feature and make only minimal changes to the existing code to call into the new code.&nbsp;&nbsp;For example, we can&nbsp;create new functionality in Filter.Transform() by injecting in all new implementations of IMessagingGateway.&nbsp; If we&#039;ve abstracted the business rules, we can even change strictly the business rules by creating a new class and simply passing it in at the proper place.&nbsp;&nbsp;Following the OCP doesn&#039;t have to mean the full-blown ideal of runtime plugins (shameless plug:&nbsp; Dependency Injection tools like <a href="http://structuremap.sourceforce.net">StructureMap</a> make this much easier and more reliable;)).
</li>
<li>The second, and possibly more powerful OCP usage, is recombining existing classes or components to create new functionality.&nbsp; In the real world system behind my Filter.Transform() example, we had a need in a later project to use the transformation logic completely independent of the pipes and filters architecture in a brand new web service.&nbsp; If the&nbsp;transformation logic is decoupled from&nbsp;the&nbsp;rest of the Filter.Transform() method, we can simply take that cohesive business validation class and use it in the entirely new context.&nbsp; In real life that functionality was very strongly coupled to the pipes and filters architecture and I spent several days doing refactoring just to&nbsp;expose that functionality.</li>
</ol>
<p>Think of this scenario as well from my new career in financial applications.&nbsp;&nbsp;Say you have an analysis engine inside your web application that&nbsp;pulls its&nbsp;transactional data from a database and it works great for quite awhile.&nbsp; Then one day your CEO comes in and says that they have a great&nbsp;opportunity if&nbsp;you can only mate the&nbsp;existing analysis engine to data entered into an Excel sheet so a trader can run simulations.&nbsp; Can you do that?&nbsp; If the analytic engine makes a lot of &quot;pull&quot; calls to the data access layer, or is tightly coupled in some other way to the database, you&nbsp;might miss out on that opportunity.&nbsp; On the other hand, if in your existing architecture you simply &quot;push&quot; all of the data into the analytics engine that it needs, it&#039;s going to be relatively easy to take the cohesive analytics engine and use it in a completely new context.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h4>Testability</h4>
<p>A while back, <a href="/blogs/scott.bellware/default.aspx">Scott Bellware</a> vociferously wrote that there is <a href="/blogs/scott.bellware/archive/2006/08/22/148491.aspx">no sustainability without testability</a> (and by inference, automated tests).&nbsp; I&nbsp;could not&nbsp;agree more.&nbsp; Part of modifying existing code is verifying both the correctness of the new code and regression testing the old code to prevent regression bugs.&nbsp; Regression testing is a major cost and a significant&nbsp;risk to modifying existing software.&nbsp; A high degree of test automation can alleviate these concerns, but an effective and&nbsp;efficient test automation strategy is only enabled by a good design &#8212; specifically an orthogonal structure that enables opportunities for focused <a href="http://en.wikipedia.org/wiki/White_box_testing">whitebox testing</a>.</p>
<p>There&nbsp;was a <a href="http://tech.groups.yahoo.com/group/testdrivendevelopment/message/20982">good discussion</a> on the <a href="http://tech.groups.yahoo.com/group/testdrivendevelopment">Test Driven Development group on Yahoo</a> about&nbsp;the relationship between&nbsp;Testability and good design.&nbsp; The discussion was kicked off by someone asking if there really was a linkage between testability and good design?&nbsp; I emphatically believe that <strong>designs that are not testable are bad designs</strong>.&nbsp; I&#039;m not sure whether or not&nbsp;I&#039;d say that testability is a first class goal in design, or simply a vital means towards making working code.&nbsp; Regardless, testability alone is enough of a reason to strive for orthogonal code structures.&nbsp; Code that is easy to test is easy to make work.</p>
<p>Testability largely coincides happily with the principles of the good design you were striving for anyway:&nbsp; loose coupling and high cohesion.&nbsp; Automated testing is much simpler when it&#039;s easy to isolate functionality (loose coupling) and when you can test one small thing at a time (cohesion).&nbsp; One of the very significant values of using Test Driven Development is that the technique is very effective at sniffing out coupling or cohesion problems.&nbsp; When it&#039;s hard to write the unit tests, it&#039;s usually indicative of low cohesion or tight coupling.</p>
<h4>Putting it All Together</h4>
<p>Alright, we know some of&nbsp;the principles of writing orthogonal code and we&#039;ve taken a long look at&nbsp;the coupling and cohesion issues around a&nbsp;sample system.&nbsp; As I said earlier, my sample scenario was from a real project I was part of two years ago.&nbsp; Do your best Keith Jackson imitation here &#8212; in that real world system, the original team hit the &quot;Granddaddy&nbsp;of Them All&quot; &#8211;&nbsp;The Great Refactoring of Aught Five.&nbsp; The pipes and filters architecture was killing them with complexity.&nbsp; The code was slow, hard to deploy, difficult to troubleshoot, and nasty to test.&nbsp;&nbsp;I don&#039;t remember how long it took, but they stopped and ripped out&nbsp;some of the pipes and filters support to collapse the application into a single AppDomain.&nbsp; Performance went up, deployment got easier, and testing and troubleshooting improved somewhat.&nbsp; </p>
<p>All the same though, I would call the Great Refactoring a mild failure because it could have been done more efficiently and left the code in a better state.&nbsp; They didn&#039;t completely remove the pipes and filter motiff, largely because refactoring any farther would have been too difficult because the code was not orthogonal.&nbsp; The time spent doing the Great Refactoring was pure overhead, because not a single bit of business functionality was added.&nbsp; I say overhead because the refactoring could have been several times easier and quicker if they had religiously followed orthogonal design concepts from the very beginning.&nbsp; With an orthogonal structure they could have thrown away the messaging infrastructure and the filter coordination code away, but&nbsp;reused the business logic and data access classes largely unchanged.&nbsp; If the refactoring had been less risky, and orthogonal code would have mitigated the risk, they might have eased the refactoring by simply starting it&nbsp;early instead of waiting until they were backed into a corner.</p>
<h4>Lastly, on the Pipes and Filters Scenario</h4>
<p>I apologize to the original team for doing this at their expense, but they provided a near perfect object lesson on a couple fronts and I bet they&#039;d agree with many of my conclusions two years later.&nbsp; The original impetus for using the Pipes and Filters architecture being spread across multiple windows services was to be able to scale the system &quot;vertically&quot;&nbsp;across multiple systems.&nbsp; </p>
<p>From my perspective, the project was jeopardized by committing far too early to a complex design upfront without any significant&nbsp;deviation or adaptation&nbsp;until things got really bad.&nbsp; The entire skeleton of the system was layed out before doing any significant testing or even&nbsp;unit testing.&nbsp; A large impetus for the XP YAGNI ideal is that it&#039;s considerably easier to start simple and add complexity as needed than it is to eliminate or change unnecessary complexity.&nbsp; I think that building good systems is very largely dependent upon getting feedback and verification on your design early and often&nbsp;and then using those lessons.&nbsp; Some of the team&nbsp;was used to heavy RUP style upfront design instead of an adaptive approach.&nbsp; They dumped the UML, but didn&#039;t replace it with an adaptive design approach.&nbsp; UML or not, pay attention to your design so you know when you&#039;re going off the rails.</p>
<p>Another lesson that we *all* need to take away from this is to keep learning and get some exposure to new ideas and different ways of thinking.&nbsp; Consciously or unconsciously, the team lead on the project chose the pipes and filters model because he had a deep background in mainframe applications and it was a comfortable style for him.&nbsp; Even after the big refactoring the pipes and filter model left a lot of &quot;noise&quot; code in the system that made the flow of the code very, very difficult to follow and generally bloated the codebase.&nbsp; I still think that a Domain Model&nbsp;+ Service Layer organization would have&nbsp;been much more suitable and far simpler.&nbsp; This <a href="http://weblogs.asp.net/bsimser/archive/2007/01/04/development-mottos-to-keep-the-team-spirit-alive.aspx">development motto from Bil Simser</a> captures the myopia towards the comfortable for me:</p>
<blockquote>
<p><em>&quot;If all you do is what you know, you&#039;ll never grow.&quot;</em></p>
</blockquote>
<p>The pipes and filters architecture included a lot of support for metadata driven composition of the filters along the way to make the addition of new workflows easier through configuration.&nbsp; In reality the extra metadata-driven pipeline infrastructure just turned into a great deal of intellectual overhead in understanding and troubleshooting the system.&nbsp; When it came time to build new functionality into the system, we struggled to reuse existing functionality because it was too tightly coupled to the pipeline extensibility mechanism.&nbsp; Ironically, I felt that one of the biggest impediments to adding a new workflow to the system was the very extensibility&nbsp;mechanism put into the code for new workflows.</p>
<p>&nbsp;</p>
<h4>Wait, there&#039;s more&#8230;&nbsp;</h4>
<p>I&#039;ve got much more to say on writing maintainable code in this ongoing&nbsp;series, but it&#039;s going to wait awhile.&nbsp; I&#039;m all blogged out for now.</p>
											</div><!-- .entry-content -->

					<div id="entry-author-info">
						<div id="author-avatar">
							<img alt='' src='http://1.gravatar.com/avatar/db65c5c5cf9f1c51e842f733892eace1?s=60&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G' class='avatar avatar-60 photo' height='60' width='60' />						</div><!-- #author-avatar 	-->
						<div id="author-description">
							<h2>About Jeremy Miller</h2>
							Jeremy is the Chief Software Architect at Dovetail Software, the coolest ISV in Austin.  Jeremy began his IT career writing "Shadow IT" applications to automate his engineering documentation, then wandered into software development because it looked like more fun. Jeremy is the author of the open source StructureMap tool for Dependency Injection with .Net, StoryTeller for supercharged acceptance testing in .Net, and one of the principal developers behind FubuMVC.  Jeremy's thoughts on all things software can be found at The Shade Tree Developer at http://codebetter.com/jeremymiller.							<div id="author-link">
								<a href="http://codebetter.com/jeremymiller/author/jeremymiller/" title="View all posts by Jeremy Miller">View all posts by Jeremy Miller &rarr;</a>
							</div><!-- #author-link	-->
						</div><!-- #author-description	-->
					</div><!-- .entry-author-info -->

					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/jeremymiller/category/maintainability/" title="View all posts in Maintainability" rel="category tag">Maintainability</a>. Bookmark the <a href="http://codebetter.com/jeremymiller/2007/01/09/orthogonal-code/" title="Permalink to Orthogonal Code" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/jeremymiller/2007/01/09/orthogonal-code/feed/" title="Comments RSS to Orthogonal Code" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-264 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/jeremymiller/2007/01/07/its-cool-to-show-up-on-google-but/" rel="prev"><span class="meta-nav">&larr;</span> It&#8217;s cool to show up on Google, but&#8230;</a></div>
					<div class="nav-next"><a href="http://codebetter.com/jeremymiller/2007/01/10/automated-web-testing-with-watin/" rel="next">Automated Web Testing with Watin <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
					<div id="dsq-content">
			<ul id="dsq-comments">
					<li id="dsq-comment-1312">
					<div id="dsq-comment-header-1312" class="dsq-comment-header">
						<cite id="dsq-cite-1312">
	http://www.UdiDahan.com							<span id="dsq-author-user-1312">Udi Dahan &#8211; The Software Simplist</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1312" class="dsq-comment-body">
						<div id="dsq-comment-message-1312" class="dsq-comment-message"><p>You rock!</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1313">
					<div id="dsq-comment-header-1313" class="dsq-comment-header">
						<cite id="dsq-cite-1313">
	http://exceptionz.wordpress.com							<span id="dsq-author-user-1313">Maruis Marais</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1313" class="dsq-comment-body">
						<div id="dsq-comment-message-1313" class="dsq-comment-message"><p>Jeremy is back with a great blog posts. Brilliant&#8230;</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1314">
					<div id="dsq-comment-header-1314" class="dsq-comment-header">
						<cite id="dsq-cite-1314">
	http://haacked.com/							<span id="dsq-author-user-1314">Haacked</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1314" class="dsq-comment-body">
						<div id="dsq-comment-message-1314" class="dsq-comment-message"><p>Well done!</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1315">
					<div id="dsq-comment-header-1315" class="dsq-comment-header">
						<cite id="dsq-cite-1315">
								<span id="dsq-author-user-1315">dgon</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1315" class="dsq-comment-body">
						<div id="dsq-comment-message-1315" class="dsq-comment-message"><p>Terrific job in putting together several important cocepts.<br />
I will make this a must-read to all people in my team for them to realize what all those  mean and why such things are important.</p>
<p>Thanks a lot</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1316">
					<div id="dsq-comment-header-1316" class="dsq-comment-header">
						<cite id="dsq-cite-1316">
	http://www.base4.net/blog.aspx							<span id="dsq-author-user-1316">Alex James</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1316" class="dsq-comment-body">
						<div id="dsq-comment-message-1316" class="dsq-comment-message"><p>Excellent article&#8230;<br />
One thing though the link to StructureMap goes to a nasty place by accident.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1317">
					<div id="dsq-comment-header-1317" class="dsq-comment-header">
						<cite id="dsq-cite-1317">
	http://blogs.giffordconsulting.com							<span id="dsq-author-user-1317">Tim Gifford</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1317" class="dsq-comment-body">
						<div id="dsq-comment-message-1317" class="dsq-comment-message"><p>Perfect!</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1318">
					<div id="dsq-comment-header-1318" class="dsq-comment-header">
						<cite id="dsq-cite-1318">
								<span id="dsq-author-user-1318">Damon</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1318" class="dsq-comment-body">
						<div id="dsq-comment-message-1318" class="dsq-comment-message"><p>Great writing Jeremy. It&#8217;s fantastic to have someone put out some real world code to explain these concepts. You&#8217;ve raised the bar for blog posting in 2007.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1319">
					<div id="dsq-comment-header-1319" class="dsq-comment-header">
						<cite id="dsq-cite-1319">
								<span id="dsq-author-user-1319">Groover</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1319" class="dsq-comment-body">
						<div id="dsq-comment-message-1319" class="dsq-comment-message"><p>Nice way of tying a lot of hard core architecture concepts together. It usually takes a few years of building systems and reading patterns books to figure this stuff out on your own (at least for me).</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1320">
					<div id="dsq-comment-header-1320" class="dsq-comment-header">
						<cite id="dsq-cite-1320">
	http://lozanotek.com							<span id="dsq-author-user-1320">Javier Lozano</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1320" class="dsq-comment-body">
						<div id="dsq-comment-message-1320" class="dsq-comment-message"><p>This is an AWESOME read! I&#8217;m sending the link to everyone on my dev team!</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1321">
					<div id="dsq-comment-header-1321" class="dsq-comment-header">
						<cite id="dsq-cite-1321">
	http://kjellsj.blogspot.com							<span id="dsq-author-user-1321">KjellSJ</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1321" class="dsq-comment-body">
						<div id="dsq-comment-message-1321" class="dsq-comment-message"><p>I think the importance of testability as a measure of design quality and reusability/agility still is underrated by most developers, just think about the heated discussions about TDD last year. I think it is time to start talking about test smells and design smells in addition to the wellknown code smells, especially wrt service-orientation: <a href="http://kjellsj.blogspot.com/2007/01/test-smell-design-smell.html" rel="nofollow">http://kjellsj.blogspot.com/2007/01/test-smell-design-smell.html</a></p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1322">
					<div id="dsq-comment-header-1322" class="dsq-comment-header">
						<cite id="dsq-cite-1322">
								<span id="dsq-author-user-1322">Girish Maskeri</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1322" class="dsq-comment-body">
						<div id="dsq-comment-message-1322" class="dsq-comment-message"><p>Excellent post!  I have read quite a number of articles on maintainability but I think this is the first one to tease out the concepts using real life actual code and not some foo and bar examples.</p>
<p>Great work!</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1323">
					<div id="dsq-comment-header-1323" class="dsq-comment-header">
						<cite id="dsq-cite-1323">
	http://haf.se							<span id="dsq-author-user-1323">Henrik Feldt</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1323" class="dsq-comment-body">
						<div id="dsq-comment-message-1323" class="dsq-comment-message"><p>Hello Jeremy,</p>
<p>Before I go into the discussion of architecture &#8212; let me just ask a quick question &#8212; what is messaging?</p>
<p>The article was a good read and indeed one of the few posts out there that deal with the problems and intricacies of software architecture on a deeper level than the (sometimes) academical mumbo-jumbo that&#8217;s indeed very easy to write. (i.e.: &#8220;You should use n-tier architecture and abstract the implementation details away from layers higher up in the architecture&#8230; &#8221; &#8212; yes, but what does that mean?)</p>
<p>I&#8217;ve been struggling with getting my own applications up to date in architecture wise, and reoccurring concepts that are talked about, but not really explained by people on the net, are inversion of control, service oriented architecture, domain driven design and implementation and design-pattern choices concerning O/R-mapping together with business rules and business constraints.</p>
<p>#How would you implement business constraints?<br />
I&#8217;ve been creating my own exceptions, inherits from ApplicationException and checking for those in the presentation layer. I&#8217;ve gotten the feel that there is a large difference between data validation in the presentation/presenters-layers and business rule validation&#8230; Data validation being just checks, that the user inserts proper data, like e-mails, required fields, but when it comes down to checking the business constraints, like &#8212; the order in a e-commerce system must be associated with a customer &#8212; the presentation layer isn&#8217;t the best place to put it&#8230; Instead I cast these application-specific exceptions from the domain layer and check for them. Is this similar to what you do?</p>
<p>#In what context and where would you place your Transform method?<br />
I recently did a project for a university class&#8230; To cut things short, there are application specific methods, like your transform method, or in the system we built, a method returning all the Course(s) possible to take for a Student, i.e. </p>
<p>courses that the student were not actively taking (as could be found in Student&#8217;s ActiveCourses-property), </p>
<p>courses the Student hadn&#8217;t already taken (As could be found by the class Result with an internal constructor which had 1 reference to the student, 1 reference to the course and 1 grade object, all publicly exposed, </p>
<p>courses the Student had the requirements for, to take, as could be found in the RequiredCourses property of every Course-object and finally,</p>
<p>courses that didn&#8217;t violate the fact that one Student should really just be allowed to read courses with credits aggregated to integer x.</p>
<p>We had some choices: 1) Put the logic in the CourseDao that inherited a generic NHibernate data access object, by using stuff like &#8220;left join&#8221; and &#8220;outer join&#8221; etc with the high query language in NHibernate, or<br />
2) Put the logic in the Student domain object, where we&#8217;d have to reference the dao-layers in order to get all the course objects of the application (I didn&#8217;t pick this because we reasoned that the domain objects should indeed be free of data access logic like described in (1)), or<br />
3) create a mixture of a repository object and (what we named) a logic-objects, that indeed loads all the required domain objects from the dao-objects (man&#8230; objects!), and then looped through the courses of the system with a foreach and checked the business constraints in the loop.</p>
<p>The reasoning we had behind this was that 1) was indeed a nice way to go, considering the indexing taking place in the database, that would speed up the search enormously compared to route 3. It would also be a lot easier to write because of the keywords (joins) in the data definition language (DDL -> HQL). However, it would put the business logic in the data-layer which is a violation of the orthogonal design, given that the business layer shouldn&#8217;t ever have a reference to either nhibernate or the data layer, but rather define all it&#8217;s required methods through the interfaces, which the data access objects in the data layer in turn, implemented, because then the data layer would suddenly be concerned with fetching application specific data.</p>
<p>Summarily, we opted for path 1 because of the performance requirements; but what&#8217;s your take on it?</p>
<p>#I&#8217;m also curious of the testing you&#8217;d do for the classes in this article, and how your team conducts its testing?<br />
&#8211; And do you know any great articles about (unit?) testing?</p>
<p>Do you happen to know how the words domain object repository (for fetching domain objects), data access objects (for fetching domain objects) and service oriented architecture and its specific implementation details (which also seems to be used for fetching domain objects) mingle together? I&#8217;m having some trouble finding good information on this since it seems I have to buy a host of books in order to find out anything about it.</p>
<p>#I&#8217;m also a bit curious on different takes on inversion of control, such as tutorials or articles; perhaps you could give me a hint?</p>
<p>#How does service oriented architecture fit in with web services?</p>
<p>#Would you put your security checks in the refactored Transform method you have (re-)written above, or would you do some nice tricks with Declarative programming with attributes on top of the class which contains the Transform method, or would you have the runtime and perhaps even the presentation layer do the security checks and assume that the calls to the transform method are secure? And what about the distinction of being able to rely on the presentation layer to supply data, i.e. the client is under your control, and that of the client being totally unreliable, like the web?</p>
<p>#Would the transform method be a part of a larger middle-ware?</p>
<p>Like you notice, I have quite a few questions <img src='http://codebetter.com/jeremymiller/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> &#8230; I would be very very interested in hearing your answers to them, or perhaps just your favorite questions :p!</p>
<p>(I should really start blogging&#8230;)</p>
<p>Regards<br />
Henrik</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1324">
					<div id="dsq-comment-header-1324" class="dsq-comment-header">
						<cite id="dsq-cite-1324">
								<span id="dsq-author-user-1324">Jon Paul Davies</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1324" class="dsq-comment-body">
						<div id="dsq-comment-message-1324" class="dsq-comment-message"><p>Great article. More please.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1325">
					<div id="dsq-comment-header-1325" class="dsq-comment-header">
						<cite id="dsq-cite-1325">
	http://colinjack.blogspot.com/							<span id="dsq-author-user-1325">Colin Jack</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1325" class="dsq-comment-body">
						<div id="dsq-comment-message-1325" class="dsq-comment-message"><p>Really really good stuff, you thought of writing a book? <img src='http://codebetter.com/jeremymiller/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> </p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1326">
					<div id="dsq-comment-header-1326" class="dsq-comment-header">
						<cite id="dsq-cite-1326">
	http://www.factoryfast.com.au							<span id="dsq-author-user-1326">rugs</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1326" class="dsq-comment-body">
						<div id="dsq-comment-message-1326" class="dsq-comment-message"><p>Not just the technical aspects, but the entire thinking around your post is one that is sorely needed amongst many developers, architects, and business analysts. In my old company, the failure to think in this way resulted in just way too many headaches  deadlines not met, projects gone awry, and even spare parts going missing because of a system with too many holes and other things. The result of laziness upfront is money loss, especially when you&#8217;re looking at what you&#8217;re looking at here. Thank you for a very informative and excellent post!</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1327">
					<div id="dsq-comment-header-1327" class="dsq-comment-header">
						<cite id="dsq-cite-1327">
	http://www.portraitkingdom.com							<span id="dsq-author-user-1327">portrait artist</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1327" class="dsq-comment-body">
						<div id="dsq-comment-message-1327" class="dsq-comment-message"><p>Do you ever run out of things in your mind?  Youre such a genius and it seems like you always exceed our expectations.  Whats your secret?  Where do you get all the inspiration?</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1328">
					<div id="dsq-comment-header-1328" class="dsq-comment-header">
						<cite id="dsq-cite-1328">
	http://www.portraitkingdom.com/portrait-paintings.html							<span id="dsq-author-user-1328">oil portrait paintings</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1328" class="dsq-comment-body">
						<div id="dsq-comment-message-1328" class="dsq-comment-message"><p>Orthogonal coding is really new to me.  I guess because I wasnt born to be a programmer.  Hard coding is something that is really difficult for me to tackle.  Thanks for your post.  Ive learned something new again.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1329">
					<div id="dsq-comment-header-1329" class="dsq-comment-header">
						<cite id="dsq-cite-1329">
	http://www.chatsitesi.biz/sehirler							<span id="dsq-author-user-1329">chat sitesi</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1329" class="dsq-comment-body">
						<div id="dsq-comment-message-1329" class="dsq-comment-message"><p>Cool post . .This means that there is no way for other people<br />
Thank you</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1330">
					<div id="dsq-comment-header-1330" class="dsq-comment-header">
						<cite id="dsq-cite-1330">
	http://www.mahjonghub.com/							<span id="dsq-author-user-1330">mah jong download</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1330" class="dsq-comment-body">
						<div id="dsq-comment-message-1330" class="dsq-comment-message"><p>Very interesting topic will bookmark your site to check if you write more about in the future</p>
</div>
					</div>
				</li>
				</ul>
		</div>
	</div>

<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

<script type="text/javascript">
/* <![CDATA[ */
	var disqus_url = 'http://codebetter.com/jeremymiller/2007/01/09/orthogonal-code/ ';
	var disqus_identifier = '264 /blogs/jeremy.miller/archive/2007/01/08/Orthogonal-Code.aspx';
	var disqus_container_id = 'disqus_thread';
	var disqus_domain = 'disqus.com';
	var disqus_shortname = 'theshadetreedeveloper';
	var disqus_title = "Orthogonal Code";
		var disqus_config = function () {
	    var config = this; // Access to the config object

	    /* 
	       All currently supported events:
	        * preData  fires just before we request for initial data
	        * preInit - fires after we get initial data but before we load any dependencies
	        * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
	        * afterRender - fires when template is rendered but before we show it
	        * onReady - everything is done
	     */

		config.callbacks.preData.push(function() {
			// clear out the container (its filled for SEO/legacy purposes)
			document.getElementById(disqus_container_id).innerHTML = '';
		});
				config.callbacks.onReady.push(function() {
			// sync comments in the background so we don't block the page
			DISQUS.request.get('?cf_action=sync_comments&post_id=264');
		});
					};
	var facebookXdReceiverPath = 'http://codebetter.com/jeremymiller/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
	var DsqLocal = {
		'trackbacks': [
		],
		'trackback_url': "http:\/\/codebetter.com\/jeremymiller\/2007\/01\/09\/orthogonal-code\/trackback\/"	};
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
	var dsq = document.createElement('script'); dsq.type = 'text/javascript';
	dsq.async = true;
	dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.61';
	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
					<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-new-features?utm_source=cb&utm_medium=button&utm_term=4328&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="125" height="125" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/ANTSPP5_125x125_M1.gif"></a>
					<embed width="125" height="125" flashvars="clickTARGET=_blank&amp;clickTAG=http%3A%2F%2Fd1.openx.org%2Fck.php%3Foaparams%3D2__bannerid%3D62753__zoneid%3D29419__cb%3Da0471ce5e8__r_id%3Dd42118811971f057012db20aa261c5c1__r_ts%3Dldef6x__oadest%3Dhttp%253A%252F%252Fwww.jetbrains.com%252Fresharper%252F%253Frs4cb125" allowscriptaccess="always" quality="high" name="Advertisement" id="Advertisement" style="" src="http://s3.amazonaws.com/CodeBetter/Creative/tc_125x125_simple2.swf" type="application/x-shockwave-flash">
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title">The Shade Tree Developer</h3>Jeremy is the Chief Software Architect at Dovetail Software, the coolest ISV in Austin.  Jeremy began his IT career writing "Shadow IT" applications to automate his engineering documentation, then wandered into software development because it looked like more fun. Jeremy is the author of the open source StructureMap tool for Dependency Injection with .Net, StoryTeller for supercharged acceptance testing in .Net, and one of the principal developers behind FubuMVC.  Jeremy's thoughts on all things software can be found at The Shade Tree Developer at http://codebetter.com/jeremymiller.
</li><li id="linkcat-1046" class="widget-container widget_links"><h3 class="widget-title">Blogroll</h3>
	<ul class='xoxo blogroll'>
<li><a href="http://twitter.com/jeremydmiller">Follow me on Twitter</a></li>
<li><a href="https://github.com/DarthFubuMVC/fubumvc" target="_blank">FubuMVC on GitHub</a></li>
<li><a href="https://github.com/jeremydmiller">My GitHub Page</a></li>
<li><a href="https://github.com/storyteller/storyteller">StoryTeller on GitHub</a></li>
<li><a href="https://github.com/structuremap/structuremap">StructureMap on GitHub</a></li>

	</ul>
</li>
		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				<script type="text/javascript" src="http://engine.theloungenet.com/z/15/adzerk1_2_5"></script>
				<div id="adzerk1"></div>
				
				<ul class="xoxo">		
					<li id="archives-2" class="widget-container widget_archive"><h3 class="widget-title">Archives</h3>		<ul>
			<li><a href='http://codebetter.com/jeremymiller/2011/01/' title='January 2011'>January 2011</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/12/' title='December 2010'>December 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/09/' title='September 2010'>September 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/08/' title='August 2010'>August 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/07/' title='July 2010'>July 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/06/' title='June 2010'>June 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/05/' title='May 2010'>May 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/03/' title='March 2010'>March 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/02/' title='February 2010'>February 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/01/' title='January 2010'>January 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/12/' title='December 2009'>December 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/11/' title='November 2009'>November 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/10/' title='October 2009'>October 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/09/' title='September 2009'>September 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/08/' title='August 2009'>August 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/07/' title='July 2009'>July 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/06/' title='June 2009'>June 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/05/' title='May 2009'>May 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/04/' title='April 2009'>April 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/03/' title='March 2009'>March 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/02/' title='February 2009'>February 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/01/' title='January 2009'>January 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/12/' title='December 2008'>December 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/11/' title='November 2008'>November 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/10/' title='October 2008'>October 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/09/' title='September 2008'>September 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/08/' title='August 2008'>August 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/07/' title='July 2008'>July 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/06/' title='June 2008'>June 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/05/' title='May 2008'>May 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/04/' title='April 2008'>April 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/03/' title='March 2008'>March 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/02/' title='February 2008'>February 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/01/' title='January 2008'>January 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/12/' title='December 2007'>December 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/11/' title='November 2007'>November 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/10/' title='October 2007'>October 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/09/' title='September 2007'>September 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/08/' title='August 2007'>August 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/07/' title='July 2007'>July 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/06/' title='June 2007'>June 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/05/' title='May 2007'>May 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/04/' title='April 2007'>April 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/03/' title='March 2007'>March 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/02/' title='February 2007'>February 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/01/' title='January 2007'>January 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/12/' title='December 2006'>December 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/11/' title='November 2006'>November 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/10/' title='October 2006'>October 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/09/' title='September 2006'>September 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/08/' title='August 2006'>August 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/07/' title='July 2006'>July 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/06/' title='June 2006'>June 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/05/' title='May 2006'>May 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/04/' title='April 2006'>April 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/03/' title='March 2006'>March 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/02/' title='February 2006'>February 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/01/' title='January 2006'>January 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/12/' title='December 2005'>December 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/11/' title='November 2005'>November 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/10/' title='October 2005'>October 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/09/' title='September 2005'>September 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/08/' title='August 2005'>August 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/07/' title='July 2005'>July 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/06/' title='June 2005'>June 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/05/' title='May 2005'>May 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/04/' title='April 2005'>April 2005</a></li>
		</ul>
</li><li id="recent-comments-3" class="widget-container widget_recent_comments"><h3 class="widget-title">What others have said&#8230;</h3><ul id="recentcomments"><li class="recentcomments"><a href='http://codeofrob.com/' rel='external nofollow' class='url'>Rob Ashton</a> on <a href="http://codebetter.com/jeremymiller/2011/01/16/a-train-of-thought-wrapping-up-codemash-2011/#comment-6752">A Train of Thought &ndash; Wrapping up CodeMash 2011</a></li><li class="recentcomments"><a href='http://www.best-registrycleaner.net' rel='external nofollow' class='url'>Best Registry Cleaner</a> on <a href="http://codebetter.com/jeremymiller/2009/01/20/create-your-own-auto-registration-convention-with-structuremap/#comment-6747">Create your own Auto Registration Convention with StructureMap</a></li><li class="recentcomments">Eric Turnbow on <a href="http://codebetter.com/jeremymiller/2005/11/07/using-the-chain-of-responsibility-pattern/#comment-6745">Using the Chain of Responsibility Pattern</a></li><li class="recentcomments"><a href='http://twitter.com/lazycoder' rel='external nofollow' class='url'>Scott Koon</a> on <a href="http://codebetter.com/jeremymiller/2011/01/16/a-train-of-thought-wrapping-up-codemash-2011/#comment-6744">A Train of Thought &ndash; Wrapping up CodeMash 2011</a></li><li class="recentcomments"><a href='http://thezendev.com' rel='external nofollow' class='url'>Dan Martin</a> on <a href="http://codebetter.com/jeremymiller/2011/01/16/a-train-of-thought-wrapping-up-codemash-2011/#comment-6743">A Train of Thought &ndash; Wrapping up CodeMash 2011</a></li></ul></li>				</ul>	
				
				<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-csharp?utm_source=cb&utm_medium=rectangle&utm_term=4327&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="300" height="250" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/APP6_Launch_C%23_Jun10_300x250_M1.gif?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1458095516&amp;Signature=BIBDilUaLnZe1uKfVKyyTBxr%2BvE%3D"></a>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/" title="Search Results">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="/blogs/products/pages/64386.aspx">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="/blogs/products/pages/64615.aspx">Telerik</a></li>
<li><a href="/blogs/products/pages/142174.aspx">JetBrains - ReSharper</a></li>
<li><a href="/blogs/products/pages/Beyond-Compare.aspx">Beyond Compare</a></li>
<li><a href="/blogs/products/pages/.NET-Memory-Profiler.aspx">.NET Memory Profiler</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a> &lt;-- NEW Friend!</li>

	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '11<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter//third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = false; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.468 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-01-18 10:10:30 -->
<!-- super cache -->