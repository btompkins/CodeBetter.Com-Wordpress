<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Our “Extension Properties” Story | Jeremy D. Miller</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/jeremymiller/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css?v=3912785705" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js?ver=3.4.2'></script>
<script type='text/javascript' src='http://dtym7iokkjlif.cloudfront.net/dough/1.0/recipe.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/jeremymiller/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Wanna see how Dovetail builds software (or not, it&#8217;s a free country)?' href='http://codebetter.com/jeremymiller/2010/02/13/wanna-see-how-dovetail-builds-software-or-not-it-s-a-free-country/' />
<link rel='next' title='Preview of the new StoryTeller Test Editor &#8212; Looking for Feedback' href='http://codebetter.com/jeremymiller/2010/02/19/preview-of-the-new-storyteller-test-editor-looking-for-feedback/' />
<meta name="generator" content="WordPress 3.4.2" />
<link rel='shortlink' href='http://codebetter.com/jeremymiller/?p=764' />

<!-- All in One SEO Pack 1.6.13.2 by Michael Torbert of Semper Fi Web Design[83,145] -->
<link rel="canonical" href="http://codebetter.com/jeremymiller/2010/02/16/our-extension-properties-story/" />
<!-- /all in one seo pack -->
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.3.3" type="text/css" media="screen" />

<!-- Start Shareaholic OgTags -->

	<!-- Shareaholic Notice: There is neither a featured nor gallery image set -->

<!-- End Shareaholic OgTags -->

	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
<meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/dc168cf39155d7b5d39f696ca94d5980.js?v=5302176208">/*Is Cache!*/</script>
                	
	<script type='text/javascript' src='http://d1.openx.org/spcjs.php?id=7744&amp;target=_blank'></script>
	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>
<!-- BuySellAds Ad Code -->
<script type="text/javascript">
(function(){
  var bsa = document.createElement('script');
     bsa.type = 'text/javascript';
     bsa.async = true;
     bsa.src = 'http://s3.buysellads.com/ac/bsa.js';
  (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);
})();
</script>
<!-- End BuySellAds Ad Code -->
</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">
			<!-- BuySellAds Zone Code -->
<div id="bsap_1276080" class="bsarocks bsap_4fe632babdccc2b4b049e4f08cc3c549"></div>
<!-- End BuySellAds Zone Code --></div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-764" class="post-764 post type-post status-publish format-standard hentry category-fubumvc category-structuremap">
					<h1 class="entry-title">Our “Extension Properties” Story</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/jeremymiller/author/jeremymiller/" title="View all posts by Jeremy Miller">Jeremy Miller</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/jeremymiller/2010/02/16/our-extension-properties-story/" title="2:51 pm" rel="bookmark"><span class="entry-date">February 16, 2010</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/jeremymiller/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/jeremymiller/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><!-- Start Shareaholic LikeButtonSetTop Automatic --><!-- End Shareaholic LikeButtonSetTop Automatic --><p> Late last year I made myself a promise that I would resuscitate my blog instead of just tweeting drivel.&nbsp; I don&rsquo;t particularly feel up (or self important enough) to the old <a href="/blogs/jeremy.miller/archive/2007/01/08/Orthogonal-Code.aspx">10 page missives of yore</a>, so I&rsquo;m just going to write about the project and OSS work I&rsquo;m doing this year and see if any of it is useful or interesting.</p>
<p>I&rsquo;ve built software in some capacity for a dozen years.&nbsp; My first couple projects were exciting just because it was my first couple projects, but for the most part, I&rsquo;ve always felt like everybody else worked on cooler projects than I did &ndash; until I started at Dovetail anyway.&nbsp; Yesterday I (mostly) wrapped up a crucial subsystem for us on our story for &ldquo;extension properties that I thought was cool enough to share.</p>
<p>We know from experience that our customers need to add some of their own fields to track their own special data in the system.&nbsp; Here&rsquo;s the facts, requirements, and assumptions we&rsquo;ve made about these extension properties:</p>
<ol>
<li>We&rsquo;re assuming that the extension properties will be completely set up by our professional services folks during the deployment product, so we don&rsquo;t have to open up any magic way for the customers to change the database schema and screens on the fly.</li>
<li>Our &ldquo;professional services&rdquo; guys sit 10 feet from me and they&rsquo;re perfectly capable of some coding</li>
<li>We really need an &ldquo;<a href="http://msdn.microsoft.com/en-us/magazine/cc546578.aspx">Open / Closed</a>&rdquo; architecture.&nbsp; By this I mean that we absolutely must be able to add these customer specific properties to their own installation without any impact or change to our core codebase.&nbsp; Nothing destroys a small ISV like having to maintain customer specific </li>
<li>The extension properties have to be editable on the screen</li>
<li>The extension properties have to be available inside our rules engine</li>
<li>I&rsquo;d really, really like to reuse all our existing infrastructure for validation, persistence, and html conventions for these extension properties.&nbsp; I&rsquo;m lazy and I don&rsquo;t want to write a lot of special infrastructure.</li>
</ol>
<p>&nbsp;</p>
<h4><b>Step 1:&nbsp; Adding Extends&lt;T&gt; to the Domain Model</b></h4>
<p>My original thought was to just make the extension properties live in a name/value collection on all of our entities.&nbsp; It&rsquo;s a simple solution and the quickie NHibernate spike I did made it clear that the persistence wouldn&rsquo;t be a problem.&nbsp; However, we make use of a *lot* of conventions and validation policies in our application that utilize the type system and our validation attributes to drive behavior.&nbsp; Using the name/value approach meant that I threw all that away.&nbsp; Instead, I decided that the extension properties would just live in a separate class like this one that I use for testing:</p>
<div style="border-bottom: black thin solid;border-left: black thin solid;font-family: courier new;background: white;color: black;font-size: 10pt;border-top: black thin solid;border-right: black thin solid">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// This object would be attached to our </span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// Site objects in our Domain Model</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">SiteExtensions</span> : <span style="color: #2b91af">Extends</span>&lt;<span style="color: #2b91af">Site</span>&gt;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [<span style="color: #2b91af">Required</span>, <span style="color: #2b91af">ShowNew</span>]</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">string</span> ExtraString { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">int</span> ExtraNumber { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: #2b91af">DateTime</span>? ExtraDate { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// Fake property and a fake list I use to test</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// multi-level lists</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [<span style="color: #2b91af">ListValue</span>(<span style="color: #a31515">"Year"</span>), <span style="color: #2b91af">ShowNew</span>]</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">string</span> Year { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [<span style="color: #2b91af">ListValue</span>(<span style="color: #a31515">"Make"</span>), <span style="color: #2b91af">ShowNew</span>]</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">string</span> Make { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [<span style="color: #2b91af">ListValue</span>(<span style="color: #a31515">"Model"</span>), <span style="color: #2b91af">ShowNew</span>]</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">string</span> Model { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
</div>
<p>&nbsp;</p>
<p>A couple notes about this class.&nbsp; As you see, it inherits from the Extends&lt;TEntity&gt; class where TEntity is the type in our domain model that is being extended.&nbsp; Extends&lt;TEntity&gt; is strictly a marker interface with no functionality.</p>
<div style="border-bottom: black thin solid;border-left: black thin solid;font-family: courier new;background: white;color: black;font-size: 10pt;border-top: black thin solid;border-right: black thin solid">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">Extends</span>&lt;T&gt; <span style="color: blue">where</span> T : <span style="color: #2b91af">DomainEntity</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
</div>
<p>&nbsp;</p>
<p>You might also notice that the SiteExtensions class is decorated with several attributes (Required, ShowNew, ListValue, etc.).&nbsp; These attributes are mostly for our server side validation, but they also drive Html construction in the web pages and tie into client side validation with jQuery validation (more on this later).</p>
<p>&nbsp;</p>
<h4><b>Step 2:&nbsp; Discovering Extension Properties on Application Startup</b></h4>
<p>So far, so good, but now I need to hook the SiteExtensions objects to Site objects while keeping the SiteExtensions class in a totally separate assembly specific to that particular customer.&nbsp; First, all of our domain model classes implement a <a href="http://martinfowler.com/eaaCatalog/layerSupertype.html">layer supertype</a> class called &ldquo;DomainEntity,&rdquo; so this becomes a natural way to connect our domain entities to their extension properties:</p>
<div style="border-bottom: black thin solid;border-left: black thin solid;font-family: courier new;background: white;color: black;font-size: 10pt;border-top: black thin solid;border-right: black thin solid">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; [<span style="color: #2b91af">Serializable</span>]</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">DomainEntity</span> : <span style="color: #2b91af">Entity</span>, <span style="color: #2b91af">IValidated</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">object</span> ExtendedProperties { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
</div>
<p>Next, I need to discover the proper extension property class for each domain model type (if any) at runtime.&nbsp; I decided to store that information in a simple static class called &ldquo;ExtensionProperties&rdquo; that acts as a well known place in the system to query for the proper type of extension class:</p>
<div style="border-bottom: black thin solid;border-left: black thin solid;font-family: courier new;background: white;color: black;font-size: 10pt;border-top: black thin solid;border-right: black thin solid">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">class</span> <span style="color: #2b91af">ExtensionProperties</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> <span style="color: blue">static</span> <span style="color: blue">readonly</span> <span style="color: #2b91af">Cache</span>&lt;<span style="color: #2b91af">Type</span>, <span style="color: #2b91af">Type</span>&gt; _types = <span style="color: blue">new</span> <span style="color: #2b91af">Cache</span>&lt;<span style="color: #2b91af">Type</span>, <span style="color: #2b91af">Type</span>&gt;();</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">void</span> Register(<span style="color: #2b91af">Type</span> entityType, <span style="color: #2b91af">Type</span> extensionType)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _types[entityType] = extensionType;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">void</span> ClearAll()</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _types.ClearAll();</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">bool</span> HasExtensionFor(<span style="color: #2b91af">Type</span> entityType)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> _types.Has(entityType);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: #2b91af">Type</span> ExtensionFor(<span style="color: #2b91af">Type</span> type)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> _types[type];</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
</div>
<p>&nbsp;</p>
<p>Now that we&rsquo;ve got ExtensionProperties, we need to discover the available extension properties at application startup and register them with ExtensionProperties.&nbsp; Unsurprisingly, I used StructureMap to discover the extension property types.&nbsp; First off, we&rsquo;re doing customer extensions by placing their customizations in separate assemblies that are placed into our application bin.&nbsp; At the moment, our convention is that these assemblies must contain &ldquo;Extensions&rdquo; somewhere in their assembly name to be picked up.&nbsp; So knowing that assumption, I created an auto-registration policy in StructureMap that scans all the &ldquo;Extensions&rdquo; assemblies in our application base directory and discovers the Extends&lt;T&gt; types:</p>
<div style="border-bottom: black thin solid;border-left: black thin solid;font-family: courier new;background: white;color: black;font-size: 10pt;border-top: black thin solid;border-right: black thin solid">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">ExtensionRegistry</span> : <span style="color: #2b91af">Registry</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> ExtensionRegistry()</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Scan(x =&gt;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #2b91af">ExtensionProperties</span>.ClearAll();</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; x.AssembliesFromApplicationBaseDirectory(assem =&gt; assem.GetName().Name.Contains(<span style="color: #a31515">&#8220;Extensions&#8221;</span>));</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; x.Convention&lt;<span style="color: #2b91af">ExtensionScanner</span>&gt;();</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// This little guy just finds any type that inherits from</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// Extends&lt;T&gt; and registers that type against &#8220;T&#8221; in </span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: green">// our wellknown ExtensionProperties class</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">ExtensionScanner</span> : <span style="color: #2b91af">IRegistrationConvention</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">void</span> Process(<span style="color: #2b91af">Type</span> type, <span style="color: #2b91af">Registry</span> graph)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (type.BaseType.IsGenericType &amp;&amp; type.BaseType.GetGenericTypeDefinition() == <span style="color: blue">typeof</span> (<span style="color: #2b91af">Extends</span>&lt;&gt;))</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> entityType = type.BaseType.GetGenericArguments()[0];</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #2b91af">ExtensionProperties</span>.Register(entityType, type);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
</div>
<p>&nbsp;</p>
<h4><b>Step 3:&nbsp; Persisting the little devils</b></h4>
<p>The goal is definitely to make the properties on the extension classes persistent, and I&rsquo;d really prefer not to write custom SQL for this one off need, so it&rsquo;s time to teach NHibernate how to persist these extension types &ndash; if they exist.&nbsp; The Extends&lt;T&gt; objects are really just part of the domain entity that they extend, so let&rsquo;s just say we put the backing fields directly onto the proper table for each entity.&nbsp; We *might* have a conflict with the extension properties and later versions of our product, so let&rsquo;s make a little naming convention for these backing fields and say that all extension fields in the database have to be prepended with &ldquo;x_&rdquo; like this (yes kids, I *can* write Sql by hand if I absolutely have to):</p>
<div style="border-bottom: black thin solid;border-left: black thin solid;font-family: courier new;background: white;color: black;font-size: 10pt;border-top: black thin solid;border-right: black thin solid">
<p style="margin: 0px"><span style="color: blue">BEGIN TRANSACTION</span></p>
<p style="margin: 0px">GO</p>
<p style="margin: 0px"><span style="color: blue">ALTER TABLE </span>dbo.Site <span style="color: blue">ADD</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; x_ExtraString nvarchar(50) <span style="color: blue">NULL</span>,</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; x_ExtraNumber <span style="color: blue">int NULL</span>,</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; x_ExtraDate <span style="color: blue">datetime NULL</span>,</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; x_Year nvarchar(20) <span style="color: blue">NULL</span>,</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; x_Make nvarchar(50) <span style="color: blue">NULL</span>,</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; x_Model nvarchar(100) <span style="color: blue">NULL</span></p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px"><span style="color: blue">COMMIT</span></p>
</div>
<p>&nbsp;</p>
<p>Now I need to alter our NHibernate mappings *if* a domain entity has an extension type attached to it.&nbsp; Back in the bad old HBM.XML days this used to be a klooge, but Fluent NHibernate (FNH) made it very simple.&nbsp; Let&rsquo;s just treat the Extends&lt;T&gt; type as a &ldquo;<a href="https://www.hibernate.org/hib_docs/nhibernate/html/components.html">Component</a>&rdquo; on the main entity type.&nbsp; We have our own base class that extends FNH&rsquo;s ClassMap&lt;T&gt; called DomainMap&lt;T&gt; to specify NHibernate mappings with our own policies, so let&rsquo;s just add a bit of code to that base class that will dynamically create a component mapping to the extension property type if it exists:</p>
<div style="border-bottom: black thin solid;border-left: black thin solid;font-family: courier new;background: white;color: black;font-size: 10pt;border-top: black thin solid;border-right: black thin solid">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">abstract</span> <span style="color: blue">class</span> <span style="color: #2b91af">DomainMap</span>&lt;T&gt; : <span style="color: #2b91af">ClassMap</span>&lt;T&gt;, <span style="color: #2b91af">IDomainMap</span> <span style="color: blue">where</span> T : <span style="color: #2b91af">DomainEntity</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">protected</span> DomainMap()</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// For every DomainEntity class, use the Id property</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// as the Primary Key / Object Identifier</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Id(x =&gt; x.Id).ColumnName(<span style="color: #a31515">&#8220;id&#8221;</span>).GeneratedBy.GuidComb();</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WithTable(<span style="color: blue">typeof</span>(T).Name);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Map(x =&gt; x.LastModified);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Map(x =&gt; x.Created);</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (<span style="color: #2b91af">ExtensionProperties</span>.HasExtensionFor(<span style="color: blue">typeof</span>(T)))</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> componentType = <span style="color: blue">typeof</span> (<span style="color: #2b91af">ExtensionComponent</span>&lt;&gt;)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .MakeGenericType(<span style="color: #2b91af">ExtensionProperties</span>.ExtensionFor(<span style="color: blue">typeof</span> (T)));</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> component = <span style="color: #2b91af">Activator</span>.CreateInstance(componentType) <span style="color: blue">as</span> <span style="color: #2b91af">IMappingPart</span>;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AddPart(component);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">ExtensionComponent</span>&lt;T&gt; : <span style="color: #2b91af">ComponentPart</span>&lt;T&gt;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> ExtensionComponent()</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : <span style="color: blue">base</span>(<span style="color: #2b91af">ReflectionHelper</span>.GetProperty&lt;<span style="color: #2b91af">DomainEntity</span>&gt;(x =&gt; x.ExtendedProperties), <span style="color: blue">false</span>)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetAttribute(<span style="color: #a31515">&#8220;class&#8221;</span>, <span style="color: blue">typeof</span>(T).AssemblyQualifiedName);</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// Assume that all properties are persistable</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">typeof</span>(T).GetProperties()</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .Where(x =&gt; x.DeclaringType == <span style="color: blue">typeof</span>(T))</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .Each(prop =&gt;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// See the &#8220;x_&#8221; prefix for the naming convention?</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Map(prop, <span style="color: #a31515">&#8220;x_&#8221;</span> + prop.Name);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
</div>
<p>The awesome thing about using an &ldquo;<a href="http://www.martinfowler.com/bliki/DomainSpecificLanguage.html">internal DSL</a>&rdquo; like that in Fluent NHibernate is that you still have every single bit of the real language at your disposal.&nbsp; The code above effectively extends our NHibernate mapping to persist all the properties of the Extends&lt;T&gt; objects whenever the host entity is persisted.&nbsp; By doing this we largely make the extension property persistence transparent to the main code.</p>
<p>&nbsp;</p>
<h4><b>Step 3:&nbsp; Validating the Extension Properties</b></h4>
<p>This part is actually pretty simple, but it doesn&rsquo;t really translate all that well to other codebases.&nbsp; For validation we use a homegrown mini-framework I built years ago that lives (largely abandoned) in the <a href="http://code.google.com/p/shadetree/">ShadeTree</a> repository on Google Code (it hasn&rsquo;t changed a lot since <a href="/blogs/jeremy.miller/archive/2007/06/13/build-your-own-cab-part-9-domain-centric-validation-with-the-notification-pattern.aspx">this post on the Notification pattern</a>).&nbsp; This tooling allows you to mix validation between attributes and special methods on a Domain Entity.&nbsp; Going back to our DomainEntity supertype, we make it implement the ShadeTree &ldquo;IValidated&rdquo; interface and in the single Validate(Notification) method, we do a transparent pass through to validate the extension properties:</p>
<div style="border-bottom: black thin solid;border-left: black thin solid;font-family: courier new;background: white;color: black;font-size: 10pt;border-top: black thin solid;border-right: black thin solid">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; [<span style="color: #2b91af">Serializable</span>]</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">DomainEntity</span> : <span style="color: #2b91af">Entity</span>, <span style="color: #2b91af">IValidated</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">virtual</span> <span style="color: blue">void</span> Validate(<span style="color: #2b91af">Notification</span> notification)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (ExtendedProperties == <span style="color: blue">null</span>) <span style="color: blue">return</span>;</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #2b91af">Validator</span>.ValidateObject(ExtendedProperties, notification);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">object</span> ExtendedProperties { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
</div>
<p>&nbsp;</p>
<p>Not really much to this.&nbsp; Your mechanics will be different for other validation frameworks, but the principle is still the same.&nbsp; Just validate the extension property object if it exists and add those messages to whatever your framework uses for its Notification.</p>
<p>&nbsp;</p>
<h4><b>Step 4:&nbsp; Putting this stuff on the screen</b></h4>
<p>Most of our online forms present the main fields in a pretty standard 2 column layout.&nbsp; For the moment, we&rsquo;re trying to get away with just adding any extension properties to the bottom of the two columns and hope that&rsquo;s good enough for most clients.&nbsp; Once Chad and I made that assumption I moved onto making a new Html helper that would dynamically add the labels and editable fields for any extension properties:</p>
<div style="border-bottom: black thin solid;border-left: black thin solid;font-family: courier new;background: white;color: black;font-size: 10pt;border-top: black thin solid;border-right: black thin solid">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="background: #ffee62">&lt;%</span><span style="color: blue">=this</span>.ExtensionFieldsForView()<span style="background: #ffee62">%&gt;</span></p>
</div>
<p>&nbsp;</p>
<p>This helper needs to discover the proper extension type, if any, and write a label/field pair for each property it discovers on that extension object:</p>
<div style="border-bottom: black thin solid;border-left: black thin solid;font-family: courier new;background: white;color: black;font-size: 10pt;border-top: black thin solid;border-right: black thin solid">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// Discover what extension type, if any, is valid for the ViewModel of this page</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: #2b91af">HtmlTag</span> ExtensionFieldsForView&lt;TViewModel&gt;(<span style="color: blue">this</span> <span style="color: #2b91af">IDovetailViewWithModel</span>&lt;TViewModel&gt; view) <span style="color: blue">where</span> TViewModel : <span style="color: blue">class</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> form = buildFormFor(view);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> entityModel = view.Model <span style="color: blue">as</span> <span style="color: #2b91af">EditEntityModel</span>;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> form == <span style="color: blue">null</span> ? <span style="color: #2b91af">HtmlTag</span>.Empty() : form.WriteView(entityModel.Target);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> <span style="color: blue">static</span> <span style="color: #2b91af">IExtensionForm</span> buildFormFor&lt;TViewModel&gt;(<span style="color: #2b91af">IDovetailViewWithModel</span>&lt;TViewModel&gt; view) <span style="color: blue">where</span> TViewModel : <span style="color: blue">class</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> editModel = view.Model <span style="color: blue">as</span> <span style="color: #2b91af">EditEntityModel</span>;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (editModel == <span style="color: blue">null</span>) <span style="color: blue">return</span> <span style="color: blue">null</span>;</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> entityType = editModel.EntityType;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (!<span style="color: #2b91af">ExtensionProperties</span>.HasExtensionFor(entityType)) <span style="color: blue">return</span> <span style="color: blue">null</span>;</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// The Form &#8220;magic&#8221; happens in ExtensionForm&lt;,&gt;</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> extensionType = <span style="color: #2b91af">ExtensionProperties</span>.ExtensionFor(entityType);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> extenderFormType = <span style="color: blue">typeof</span>(<span style="color: #2b91af">ExtensionForm</span>&lt;,&gt;).MakeGenericType(extensionType, entityType);</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> (<span style="color: #2b91af">IExtensionForm</span>)view.Container.GetInstance(extenderFormType);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
</div>
<p>One of my goals with the extension properties was to utilize our existing infrastructure for Html generation.&nbsp; We have a large investment in the <a href="/blogs/jeremy.miller/archive/2010/01/29/shrink-your-views-with-fubumvc-html-conventions.aspx">FubuMVC Html conventions</a> and it makes our form creation quick and consistent.&nbsp; In order to use the Html conventions with our extension properties, I use this utility class to mediate between the dynamically discovered extension properties and the Fubu Html conventions:</p>
<div style="border-bottom: black thin solid;border-left: black thin solid;font-family: courier new;background: white;color: black;font-size: 10pt;border-top: black thin solid;border-right: black thin solid">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">interface</span> <span style="color: #2b91af">IExtensionForm</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #2b91af">HtmlTag</span> WriteNew();</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #2b91af">HtmlTag</span> WriteView(<span style="color: #2b91af">DomainEntity</span> entity);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">ExtensionForm</span>&lt;T, TEntity&gt; : <span style="color: #2b91af">IExtensionForm</span> <span style="color: blue">where</span> T : <span style="color: #2b91af">Extends</span>&lt;TEntity&gt;, <span style="color: blue">new</span>() <span style="color: blue">where</span> TEntity : <span style="color: #2b91af">DomainEntity</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> <span style="color: blue">readonly</span> <span style="color: #2b91af">TagGenerator</span>&lt;T&gt; _tags;</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> ExtensionForm(<span style="color: #2b91af">TagGenerator</span>&lt;T&gt; tags)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _tags = tags;</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// This is consistent w/ our naming convention</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _tags.ElementPrefix = <span style="color: blue">typeof</span> (TEntity).Name;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> <span style="color: #2b91af">HtmlTag</span> writeFields(<span style="color: blue">string</span> profileName, <span style="color: #2b91af">IEnumerable</span>&lt;<span style="color: #2b91af">PropertyInfo</span>&gt; properties)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _tags.SetProfile(profileName);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> <span style="color: blue">new</span> <span style="color: #2b91af">HtmlTag</span>(<span style="color: #a31515">&#8220;dl&#8221;</span>, x =&gt;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; x.AddClass(<span style="color: #a31515">&#8220;details&#8221;</span>);</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; properties.Each(prop =&gt;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; x.Add(<span style="color: #a31515">&#8220;dt&#8221;</span>).Text(<span style="color: #2b91af">LocalizationManager</span>.GetHeader(prop));</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> request = _tags.GetRequest(<span style="color: blue">new</span> FubuMVC.Core.Util.<span style="color: #2b91af">SingleProperty</span>(prop));</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #2b91af">HtmlTag</span> inputTag = _tags.InputFor(request);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; x.Add(<span style="color: #a31515">&#8220;dd&#8221;</span>).Child(inputTag);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: #2b91af">HtmlTag</span> WriteNew()</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _tags.Model = <span style="color: blue">new</span> T();</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> writeFields(<span style="color: #2b91af">TagProfile</span>.DEFAULT, <span style="color: #2b91af">ExtensionFieldRegistry</span>.NewProperties&lt;T&gt;());</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } </p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: #2b91af">HtmlTag</span> WriteView(<span style="color: #2b91af">DomainEntity</span> entity)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _tags.Model = (T) entity.ExtendedProperties ?? <span style="color: blue">new</span> T();</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> writeFields(<span style="color: #2b91af">DovetailViewActivator</span>.EDIT_PROFILE, <span style="color: #2b91af">ExtensionFieldRegistry</span>.ViewProperties&lt;T&gt;());</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
</div>
<p>&nbsp;</p>
<p>TagGenerator&lt;T&gt; is the main service in FubuMVC.UI for generating HtmlTag&rsquo;s by convention.&nbsp; As you can probably surmise from the code above, our localization machinery can lookup the header name for a PropertyInfo (or Expression) and that&rsquo;s how we build the labels.&nbsp; The actual editor tag is completely generated by the FubuMVC machinery based on its policies that we&rsquo;ve configured:</p>
<div style="border-bottom: black thin solid;border-left: black thin solid;font-family: courier new;background: white;color: black;font-size: 10pt;border-top: black thin solid;border-right: black thin solid">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">DovetailHtmlConventions</span> : <span style="color: #2b91af">HtmlConventionRegistry</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> DovetailHtmlConventions()</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; validationAttributes();</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; numbers();</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dates();</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Editors.Builder&lt;<span style="color: #2b91af">ListValueDropdownBuilder</span>&gt;();</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Editors.IfPropertyIs&lt;<span style="color: blue">bool</span>&gt;().BuildBy(request =&gt; <span style="color: blue">new</span> <span style="color: #2b91af">CheckboxTag</span>(request.Value&lt;<span style="color: blue">bool</span>&gt;())</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .Style(<span style="color: #a31515">&#8220;width&#8221;</span>, <span style="color: #a31515">&#8220;auto !important&#8221;</span>)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .Attr(<span style="color: #a31515">&#8220;value&#8221;</span>, request.ElementId));</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Editors.Always.Modify((request, tag) =&gt;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tag.Attr(<span style="color: #a31515">&#8220;label&#8221;</span>, request.Header());</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tag.Attr(<span style="color: #a31515">&#8220;name&#8221;</span>, request.ElementId);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> <span style="color: blue">void</span> numbers()</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Editors.IfPropertyIs&lt;<span style="color: #2b91af">Int32</span>&gt;().Attr(<span style="color: #a31515">&#8220;max&#8221;</span>, <span style="color: #2b91af">Int32</span>.MaxValue);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Editors.IfPropertyIs&lt;<span style="color: #2b91af">Int16</span>&gt;().Attr(<span style="color: #a31515">&#8220;max&#8221;</span>, <span style="color: #2b91af">Int16</span>.MaxValue);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Editors.IfPropertyIs&lt;<span style="color: #2b91af">Int64</span>&gt;().Attr(<span style="color: #a31515">&#8220;max&#8221;</span>, <span style="color: #2b91af">Int64</span>.MaxValue);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Editors.IfPropertyTypeIs(t =&gt; t.IsIntegerBased()).AddClass(<span style="color: #a31515">&#8220;integer&#8221;</span>);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Editors.IfPropertyTypeIs(t =&gt; t.IsFloatingPoint()).AddClass(<span style="color: #a31515">&#8220;number&#8221;</span>);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> <span style="color: blue">void</span> dates()</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Editors.IfPropertyTypeIs(t =&gt; t.IsDateTime()).Modify(x =&gt;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (!x.HasMetaData(<span style="color: #2b91af">EditInPlaceBuilder</span>.EDITABLE_ATTRIBUTE_NAME))</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; x.AddClass(<span style="color: #a31515">&#8220;DatePicker&#8221;</span>);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Editors.If(prop =&gt; prop.Accessor.InnerProperty.IsDateAndTime()).Modify(x =&gt;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (!x.HasMetaData(<span style="color: #2b91af">EditInPlaceBuilder</span>.EDITABLE_ATTRIBUTE_NAME))</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; x.AddClass(<span style="color: #a31515">&#8220;time-picker&#8221;</span>);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> <span style="color: blue">void</span> validationAttributes()</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Editors.AddClassForAttribute&lt;<span style="color: #2b91af">RequiredAttribute</span>&gt;(<span style="color: #a31515">&#8220;required&#8221;</span>);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Editors.ModifyForAttribute&lt;<span style="color: #2b91af">MaximumStringLengthAttribute</span>&gt;((tag, att) =&gt;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (att.Length &lt; <span style="color: #2b91af">Entity</span>.UnboundedStringLength)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tag.Attr(<span style="color: #a31515">&#8220;maxlength&#8221;</span>, att.Length);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Editors.ModifyForAttribute&lt;<span style="color: #2b91af">GreaterOrEqualToZeroAttribute</span>&gt;(tag =&gt; tag.Attr(<span style="color: #a31515">&#8220;min&#8221;</span>, 0));</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Editors.ModifyForAttribute&lt;<span style="color: #2b91af">GreaterThanZeroAttribute</span>&gt;(tag =&gt; tag.Attr(<span style="color: #a31515">&#8220;min&#8221;</span>, 1));</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
</div>
<p>And of course, by using the normal Html conventions to build the Html input tags, we get the jQuery validation integration for our extension properties.</p>
<p>&nbsp;</p>
<p>Oh, and because Reflection scanning can be expensive, we cache the PropertyInfo&rsquo;s for each extension type:</p>
<div style="border-bottom: black thin solid;border-left: black thin solid;font-family: courier new;background: white;color: black;font-size: 10pt;border-top: black thin solid;border-right: black thin solid">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: blue">class</span> <span style="color: #2b91af">ExtensionFieldRegistry</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> <span style="color: blue">static</span> <span style="color: blue">readonly</span> <span style="color: #2b91af">Cache</span>&lt;<span style="color: #2b91af">Type</span>, <span style="color: #2b91af">IEnumerable</span>&lt;<span style="color: #2b91af">PropertyInfo</span>&gt;&gt; _newProps</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = <span style="color: blue">new</span> <span style="color: #2b91af">Cache</span>&lt;<span style="color: #2b91af">Type</span>,<span style="color: #2b91af">IEnumerable</span>&lt;<span style="color: #2b91af">PropertyInfo</span>&gt;&gt;(findNewProps);</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> <span style="color: blue">static</span> <span style="color: blue">readonly</span> <span style="color: #2b91af">Cache</span>&lt;<span style="color: #2b91af">Type</span>, <span style="color: #2b91af">IEnumerable</span>&lt;<span style="color: #2b91af">PropertyInfo</span>&gt;&gt; _viewProps</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = <span style="color: blue">new</span> <span style="color: #2b91af">Cache</span>&lt;<span style="color: #2b91af">Type</span>,<span style="color: #2b91af">IEnumerable</span>&lt;<span style="color: #2b91af">PropertyInfo</span>&gt;&gt;(findViewProps);</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> <span style="color: blue">static</span> <span style="color: #2b91af">IEnumerable</span>&lt;<span style="color: #2b91af">PropertyInfo</span>&gt; findNewProps(<span style="color: #2b91af">Type</span> type)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> type.GetProperties().Where(x =&gt; x.DeclaringType == type &amp;&amp; x.HasAttribute&lt;<span style="color: #2b91af">ShowNewAttribute</span>&gt;());</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">private</span> <span style="color: blue">static</span> <span style="color: #2b91af">IEnumerable</span>&lt;<span style="color: #2b91af">PropertyInfo</span>&gt; findViewProps(<span style="color: #2b91af">Type</span> type)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> type.GetProperties().Where(x =&gt; x.DeclaringType == type);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: #2b91af">IEnumerable</span>&lt;<span style="color: #2b91af">PropertyInfo</span>&gt; NewProperties&lt;T&gt;()</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> _newProps[<span style="color: blue">typeof</span> (T)];</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">static</span> <span style="color: #2b91af">IEnumerable</span>&lt;<span style="color: #2b91af">PropertyInfo</span>&gt; ViewProperties&lt;T&gt;()</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> _viewProps[<span style="color: blue">typeof</span> (T)];</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
</div>
<p>&nbsp;</p>
<h4><b>Step 5:&nbsp; Getting data from the browser to the server</b></h4>
<p>One more step (we also do edit in place editing of the extension properties in the UI, but that code is a mess and I&rsquo;m not showing it to anyone until it&rsquo;s cleaner).&nbsp; We have the html tags on the browser and NHibernate knows how to persist the fields.&nbsp; All we have to do now is get the data from the browser and marshal it into the new extension property type on the server.&nbsp; The ViewModels for submitting the &ldquo;new&rdquo; forms all inherit from this base type that, conveniently enough, has a property for the extension properties:</p>
<div style="border-bottom: black thin solid;border-left: black thin solid;font-family: courier new;background: white;color: black;font-size: 10pt;border-top: black thin solid;border-right: black thin solid">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">UpdateEntityModel</span>&lt;T&gt; : <span style="color: #2b91af">IItemRequest</span> <span style="color: blue">where</span> T : <span style="color: #2b91af">DomainEntity</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: #2b91af">Extends</span>&lt;T&gt; ExtendedProperties { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: #2b91af">Guid</span> Id{ <span style="color: blue">get</span>; <span style="color: blue">set</span>; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
</div>
<p>I&rsquo;m omitting some (lots) of code here, but I used an extension point on FubuMVC&rsquo;s model binding to &ldquo;fill&rdquo; that ExtendedProperties property above with this code:</p>
<div style="border-bottom: black thin solid;border-left: black thin solid;font-family: courier new;background: white;color: black;font-size: 10pt;border-top: black thin solid;border-right: black thin solid">
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">ExtensionPropertyBinder</span> : <span style="color: #2b91af">IPropertyBinder</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// This only applies to properties that close Extends&lt;&gt;</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">bool</span> Matches(<span style="color: #2b91af">PropertyInfo</span> property)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">return</span> property.PropertyType.Closes(<span style="color: blue">typeof</span> (<span style="color: #2b91af">Extends</span>&lt;&gt;));</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">public</span> <span style="color: blue">void</span> Bind(<span style="color: #2b91af">PropertyInfo</span> property, <span style="color: #2b91af">IBindingContext</span> context)</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> entityType = property.PropertyType.GetGenericArguments()[0];</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// If there is no Extends&lt;&gt; for the entity type, do nothing</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">if</span> (!<span style="color: #2b91af">ExtensionProperties</span>.HasExtensionFor(entityType))</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">return</span>;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue">var</span> extensionType = <span style="color: #2b91af">ExtensionProperties</span>.ExtensionFor(entityType);</p>
<p style="margin: 0px">&nbsp;</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// direct the FubuMVC model binding to resolve an object of the</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// extensionType using &#8220;entityType.Name&#8221; as the prefix on the form data,</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: green">// and place the newly created object using the specified property</span></p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context.BindChild(property, extensionType, entityType.Name);</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px">&nbsp;&nbsp;&nbsp; }</p>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h4><b>Wrapping Up</b></h4>
<p>We&rsquo;ll see how it goes in the end, but I&rsquo;m relatively happy with how it all turned out.&nbsp; The end result is that we can just build a very simple class with properties and some attribute declarations, put that assembly in the right spot, and voila!, the right stuff appears on the screen.</p>
<p>Lots of stuff to throw at you, but I&rsquo;ll try to answer any questions.</p>
<div class="shr-publisher-764"></div><!-- Start Shareaholic LikeButtonSetBottom Automatic --><!-- End Shareaholic LikeButtonSetBottom Automatic -->											</div><!-- .entry-content -->

					<div id="entry-author-info">
						<div id="author-avatar">
							<img alt='' src='http://1.gravatar.com/avatar/db65c5c5cf9f1c51e842f733892eace1?s=60&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=G' class='avatar avatar-60 photo' height='60' width='60' />						</div><!-- #author-avatar 	-->
						<div id="author-description">
							<h2>About Jeremy Miller</h2>
							Jeremy is the Chief Software Architect at Dovetail Software, the coolest ISV in Austin.  Jeremy began his IT career writing "Shadow IT" applications to automate his engineering documentation, then wandered into software development because it looked like more fun. Jeremy is the author of the open source StructureMap tool for Dependency Injection with .Net, StoryTeller for supercharged acceptance testing in .Net, and one of the principal developers behind FubuMVC.  Jeremy's thoughts on all things software can be found at The Shade Tree Developer at http://codebetter.com/jeremymiller.							<div id="author-link">
								<a href="http://codebetter.com/jeremymiller/author/jeremymiller/" title="View all posts by Jeremy Miller">View all posts by Jeremy Miller &rarr;</a>
							</div><!-- #author-link	-->
						</div><!-- #author-description	-->
					</div><!-- .entry-author-info -->

					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/jeremymiller/category/fubumvc/" title="View all posts in FubuMVC" rel="category tag">FubuMVC</a>, <a href="http://codebetter.com/jeremymiller/category/structuremap/" title="View all posts in StructureMap" rel="category tag">StructureMap</a>. Bookmark the <a href="http://codebetter.com/jeremymiller/2010/02/16/our-extension-properties-story/" title="Permalink to Our “Extension Properties” Story" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/jeremymiller/2010/02/16/our-extension-properties-story/feed/" title="Comments RSS to Our “Extension Properties” Story" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-764 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/jeremymiller/2010/02/13/wanna-see-how-dovetail-builds-software-or-not-it-s-a-free-country/" rel="prev"><span class="meta-nav">&larr;</span> Wanna see how Dovetail builds software (or not, it&#8217;s a free country)?</a></div>
					<div class="nav-next"><a href="http://codebetter.com/jeremymiller/2010/02/19/preview-of-the-new-storyteller-test-editor-looking-for-feedback/" rel="next">Preview of the new StoryTeller Test Editor &#8212; Looking for Feedback <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
                    <div id="dsq-content">
            <ul id="dsq-comments">
                    <li id="dsq-comment-6213">
                    <div id="dsq-comment-header-6213" class="dsq-comment-header">
                        <cite id="dsq-cite-6213">
                                <span id="dsq-author-user-6213">Shane</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-6213" class="dsq-comment-body">
                        <div id="dsq-comment-message-6213" class="dsq-comment-message"><p>Jeremy, thanks for sharing this.  I&#8217;ve approached this many different ways over the years and you&#8217;ve given me a great perspective on how we could do it better.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-6214">
                    <div id="dsq-comment-header-6214" class="dsq-comment-header">
                        <cite id="dsq-cite-6214">
    http://www.blogcoward.com                            <span id="dsq-author-user-6214">jdn</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-6214" class="dsq-comment-body">
                        <div id="dsq-comment-message-6214" class="dsq-comment-message"><p>I just printed this out to re-read later&#8230;.11 pages.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-6215">
                    <div id="dsq-comment-header-6215" class="dsq-comment-header">
                        <cite id="dsq-cite-6215">
    http://codebetter.com/members/jmiller/default.aspx                            <span id="dsq-author-user-6215">Jeremy D. Miller</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-6215" class="dsq-comment-body">
                        <div id="dsq-comment-message-6215" class="dsq-comment-message"><p>@jdn,</p>
<p>Doesn&#8217;t count.  It&#8217;s just copy/paste code, not real content;)</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-6216">
                    <div id="dsq-comment-header-6216" class="dsq-comment-header">
                        <cite id="dsq-cite-6216">
    http://www.blogcoward.com                            <span id="dsq-author-user-6216">jdn</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-6216" class="dsq-comment-body">
                        <div id="dsq-comment-message-6216" class="dsq-comment-message"><p>@Jeremy</p>
<p>Yeah, I give you that.  Still good stuff (TM) worth printing out to re-read.</p>
<p>Please continue.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-6217">
                    <div id="dsq-comment-header-6217" class="dsq-comment-header">
                        <cite id="dsq-cite-6217">
    http://elegantcode.com                            <span id="dsq-author-user-6217">Ryan Kelley</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-6217" class="dsq-comment-body">
                        <div id="dsq-comment-message-6217" class="dsq-comment-message"><p>Jeremy,</p>
<p>Thank you for sharing this. You can bet I will be picking your brain a bit more on this. We are working on some stuff now that we were just talking about this on.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-6218">
                    <div id="dsq-comment-header-6218" class="dsq-comment-header">
                        <cite id="dsq-cite-6218">
    http://www.bjro.de                            <span id="dsq-author-user-6218">Bjoern Rochel</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-6218" class="dsq-comment-body">
                        <div id="dsq-comment-message-6218" class="dsq-comment-message"><p>A+ post. Thank you for sharing this, Jeremy.   Would love to here more about this</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-6219">
                    <div id="dsq-comment-header-6219" class="dsq-comment-header">
                        <cite id="dsq-cite-6219">
    http://craniometrics.blogspot.com                            <span id="dsq-author-user-6219">J Healy</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-6219" class="dsq-comment-body">
                        <div id="dsq-comment-message-6219" class="dsq-comment-message"><p>An interesting approach to a problem Ayende touched on in his &#8220;Multi Tenancy &#8211; Extensible Data Model&#8221; post back in August 2008 :<br />
 <a href="http://ayende.com/Blog/archive/2008/08/07/Multi-Tenancy--Extensible-Data-Model.aspx" rel="nofollow">http://ayende.com/Blog/archive/2008/08/07/Multi-Tenancy&#8211;Extensible-Data-Model.aspx</a></p>
<p>Would love to see a working code sample of it in action &#8211; would make a great MSDN article as well.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-6220">
                    <div id="dsq-comment-header-6220" class="dsq-comment-header">
                        <cite id="dsq-cite-6220">
                                <span id="dsq-author-user-6220">Khalid Abuhakmeh</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-6220" class="dsq-comment-body">
                        <div id="dsq-comment-message-6220" class="dsq-comment-message"><p>I liked the whole idea until you got to the database part. You were concerned about effecting your code base, but you were fine with modifying your existing database tables. I feel a better approach would be to &#8220;quarantine&#8221; the extension properties in a brand new table and let NHibernate join the two.</p>
<p>You could take your extensions one step further and have the assembly migrate changes to and from the database. I don&#8217;t know how a DBA might feel about that, but it really gives more power to the developer.</p>
<p>I am playing devil&#8217;s advocate now, How would a client add an extended property that is a list of things?</p>
<p>Overall, really good post and definitely starred in Chrome.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-6221">
                    <div id="dsq-comment-header-6221" class="dsq-comment-header">
                        <cite id="dsq-cite-6221">
                                <span id="dsq-author-user-6221">David Fauber</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-6221" class="dsq-comment-body">
                        <div id="dsq-comment-message-6221" class="dsq-comment-message"><p>Thanks for sharing this stuff, the parts I immediately grasp are really cool although some of it I&#8217;m going to need to actually sit down and hack through to really absorb it.  I think I&#8217;m still having a hard time fully embracing convention over config as it feels like it would be somewhat anti-discoverable for someone that just got dropped in the middle of the codebase, but I&#8217;m working on it.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-6222">
                    <div id="dsq-comment-header-6222" class="dsq-comment-header">
                        <cite id="dsq-cite-6222">
    http://craniometrics.blogspot.com                            <span id="dsq-author-user-6222">J Healy</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-6222" class="dsq-comment-body">
                        <div id="dsq-comment-message-6222" class="dsq-comment-message"><p>I agree with Khalid that there are often scenarios requiring seperate persistence of the extension properties and would be interested to hear your thoughts on that.</p>
<p>I would also be interested in hearing more about the view generation.</p>
<p>This all might make for a good alt.Net Seattle session&#8230;</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-6223">
                    <div id="dsq-comment-header-6223" class="dsq-comment-header">
                        <cite id="dsq-cite-6223">
    http://www.pacquiaovsclottey.info                            <span id="dsq-author-user-6223">blogger</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-6223" class="dsq-comment-body">
                        <div id="dsq-comment-message-6223" class="dsq-comment-message"><p>What is the importance of blog using aspx under by asp.net?</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-6224">
                    <div id="dsq-comment-header-6224" class="dsq-comment-header">
                        <cite id="dsq-cite-6224">
    http://smellegantcode.wordpress.com                            <span id="dsq-author-user-6224">Daniel Earwicker</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-6224" class="dsq-comment-body">
                        <div id="dsq-comment-message-6224" class="dsq-comment-message"><p>This is excellent. The views have &#8220;extension&#8221; stuff, customer-specific addenda, which automatically links together database -> model -> presentation for each field. (Although I agree with Khalid that it&#8217;s a shame the DDL SQL is not also generated from the attributes &#8211; either that or store the extensions in a flexible name/value format that doesn&#8217;t require customisations to the RDBMS schema).</p>
<p>I tried to say the same thing the other day but unfortunately in a more pretentious, obscure, abstract way: <a href="http://smellegantcode.wordpress.com/2010/02/11/multidimensional-separation-of-concerns/" rel="nofollow">http://smellegantcode.wordpress.com/2010/02/11/multidimensional-separation-of-concerns/</a></p>
<p>So how much of the stuff in your &#8220;core platform&#8221; could actually be described in this way? Could some of your core view/models be generated entirely of extensions? Maybe over time you could increase the expressiveness of the extension declaration system so more and more of your custom code can be swallowed up into &#8220;mere&#8221; extensions. Eventually for many views/models they would end up totally blank, all their content coming from extensions. How about multiple extensions contributing to a view in some controllable way?</p>
<p>The advantage of this is that the core platform itself becomes a rich library of examples for anyone who wants to extend it. And it makes it practical to think not just about adding custom extensions here and there but also hiding parts, or arbitrarily re-arranging the site.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-6225">
                    <div id="dsq-comment-header-6225" class="dsq-comment-header">
                        <cite id="dsq-cite-6225">
                                <span id="dsq-author-user-6225">Patrick</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-6225" class="dsq-comment-body">
                        <div id="dsq-comment-message-6225" class="dsq-comment-message"><p>I do wonder how the database aspect of this will play out long term. Heres a scenario:</p>
<p>If you rename a column in sql server 2005 and have management studio generate a script for the change, you will see that it will:</p>
<p>1. Create a tmp table with the renamed field name<br />
2. Migrate all records from the production table to the tmp table.<br />
3. Rename the tmp table to the production table name.</p>
<p>For all customers who have additional fields in that particular table, you will lose all of the additional field data (assuming you dont create a unique script for each customer). Im not saying this is the only way to rename a field through DDL, but it does illustrate added friction in versioning your schema.</p>
<p>I don&#8217;t know enough about your domain, but I would probably model the table like&#8230;<br />
ID|Table|TableID|PropertyName|PropertyValue</p>
<p>I understand this adds complexity to general queries, and you rely on the application to handle data type issues, but it keeps all of your customers on the same schema and I think that holds a lot of value.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-6226">
                    <div id="dsq-comment-header-6226" class="dsq-comment-header">
                        <cite id="dsq-cite-6226">
    http://codebetter.com/members/jmiller/default.aspx                            <span id="dsq-author-user-6226">Jeremy D. Miller</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-6226" class="dsq-comment-body">
                        <div id="dsq-comment-message-6226" class="dsq-comment-message"><p>@Patrick,</p>
<p>The database migration issue is a real problem, but then again, I&#8217;m never ever going to just run willy nilly into Sql Server and rename columns.</p>
<p>This:</p>
<p>ID|Table|TableID|PropertyName|PropertyValue</p>
<p>is not something I&#8217;d ever recommend or want to use (been there, got the tee shirt, it sucked).</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-6227">
                    <div id="dsq-comment-header-6227" class="dsq-comment-header">
                        <cite id="dsq-cite-6227">
                                <span id="dsq-author-user-6227">sebastien</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-6227" class="dsq-comment-body">
                        <div id="dsq-comment-message-6227" class="dsq-comment-message"><p>I&#8217;m having a similar issue but my properties change on a row basis. I will have many different Extends<site> depending the type of Site for example.<br />
So far, I end up using an xml column containing those extended properties and a column with the name of the Extends</site><site> type to instanciate.<br />
Maybe extra column with a convention like x_subtype_propertyname would be better though. I was afraid of having to many column and too many sparse column.</p>
<p>Any better suggestion on how to support this ?</site></p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-6228">
                    <div id="dsq-comment-header-6228" class="dsq-comment-header">
                        <cite id="dsq-cite-6228">
    http://realfiction.net                            <span id="dsq-author-user-6228">Frank Quednau</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-6228" class="dsq-comment-body">
                        <div id="dsq-comment-message-6228" class="dsq-comment-message"><p>As it seems, the current Fluent NH does not have any non-generic &#8220;AddPart&#8221; type method anymore. The way to go right now is outline here at (<a href="http://support.fluentnhibernate.org/discussions/help/34-conventionally-adding-components-dynamically" rel="nofollow">http://support.fluentnhibernate.org/discussions/help/34-conventionally-adding-components-dynamically</a>), which is somewhat uglier. Incidentally, the rest of the code looks much like yours&#8230;I also had the feeling that this should be solvable based on IConvention stuff, but if I understand the comments in that support thread correctly it isn&#8217;t deemed possible right now&#8230; </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-6229">
                    <div id="dsq-comment-header-6229" class="dsq-comment-header">
                        <cite id="dsq-cite-6229">
                                <span id="dsq-author-user-6229">Bert</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-6229" class="dsq-comment-body">
                        <div id="dsq-comment-message-6229" class="dsq-comment-message"><p>This works fine (with some adjustments) for Property Mappings, but what about HasMany mappings?</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-7383">
                    <div id="dsq-comment-header-7383" class="dsq-comment-header">
                        <cite id="dsq-cite-7383">
                                <span id="dsq-author-user-7383">Guest</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-7383" class="dsq-comment-body">
                        <div id="dsq-comment-message-7383" class="dsq-comment-message"><p>Any chance you rewrote this to Loquacious mappings? </p>
</div>
                    </div>
                </li>
                </ul>
        </div>
    </div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://codebetter.com/jeremymiller/2010/02/16/our-extension-properties-story/';
    var disqus_identifier = '764 /blogs/jeremy.miller/archive/2010/02/16/our-extension-properties-story.aspx';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'theshadetreedeveloper';
    var disqus_title = "Our “Extension Properties” Story";
        var disqus_config = function () {
        var config = this; // Access to the config object

        /* 
           All currently supported events:
            * preData — fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            DISQUS.request.get('?cf_action=sync_comments&post_id=764');
        });
                    };
    var facebookXdReceiverPath = 'http://cdn1.codebetter.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
        ],
        'trackback_url': "http:\/\/codebetter.com\/jeremymiller\/2010\/02\/16\/our-extension-properties-story\/trackback\/"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.67';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29416);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=2782afb'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29416&amp;n=2782afb' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29417);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=e94cea6'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29417&amp;n=e94cea6' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29418);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=9ba3022'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29418&amp;n=9ba3022' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29419);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=f467b52'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29419&amp;n=f467b52' /></a></noscript>
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title">The Shade Tree Developer</h3>Jeremy is the Chief Software Architect at Dovetail Software, the coolest ISV in Austin.  Jeremy began his IT career writing "Shadow IT" applications to automate his engineering documentation, then wandered into software development because it looked like more fun. Jeremy is the author of the open source StructureMap tool for Dependency Injection with .Net, StoryTeller for supercharged acceptance testing in .Net, and one of the principal developers behind FubuMVC.  Jeremy's thoughts on all things software can be found at The Shade Tree Developer at http://codebetter.com/jeremymiller.
</li><li id="text-3" class="widget-container widget_text"><h3 class="widget-title">Upcoming posts&#8230;</h3>			<div class="textwidget"><p>How I'm using StoryTeller to test FubuMVC<br />
Building a "Lookup" html convention w/ FubuMVC<br />
FubuMVC's Configuration Model "Special Sauce"<br />
Managing Script dependencies with FubuMVC<br />
Authorization and FubuMVC<br />
Continuations<br />
Composing Views with FubuMVC<br />
Extensible Model Binding with FubuMVC<br />
Introducing "Bottles"<br />
Modular Packaging with FubuMVC<br />
Self-Installing Apps w/ FubuMVC<br />
Routing and Behavioral Conventions with FubuMVC<br />
What Should I Learn?</p>
</div>
		</li><li id="linkcat-1046" class="widget-container widget_links"><h3 class="widget-title">Blogroll</h3>
	<ul class='xoxo blogroll'>
<li><a href="http://twitter.com/jeremydmiller">Follow me on Twitter</a></li>
<li><a href="https://github.com/DarthFubuMVC/fubumvc" target="_blank">FubuMVC on GitHub</a></li>
<li><a href="https://github.com/jeremydmiller">My GitHub Page</a></li>
<li><a href="https://github.com/storyteller/storyteller">StoryTeller on GitHub</a></li>
<li><a href="https://github.com/structuremap/structuremap">StructureMap on GitHub</a></li>

	</ul>
</li>
		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(220407);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=68b8307'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=220407&amp;n=68b8307' /></a></noscript>				
				
				<ul class="xoxo">		
					<li id="archives-2" class="widget-container widget_archive"><h3 class="widget-title">Archives</h3>		<ul>
			<li><a href='http://codebetter.com/jeremymiller/2012/01/' title='January 2012'>January 2012</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2011/09/' title='September 2011'>September 2011</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2011/07/' title='July 2011'>July 2011</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2011/06/' title='June 2011'>June 2011</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2011/05/' title='May 2011'>May 2011</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2011/04/' title='April 2011'>April 2011</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2011/03/' title='March 2011'>March 2011</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2011/01/' title='January 2011'>January 2011</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/12/' title='December 2010'>December 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/09/' title='September 2010'>September 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/08/' title='August 2010'>August 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/07/' title='July 2010'>July 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/06/' title='June 2010'>June 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/05/' title='May 2010'>May 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/03/' title='March 2010'>March 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/02/' title='February 2010'>February 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2010/01/' title='January 2010'>January 2010</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/12/' title='December 2009'>December 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/11/' title='November 2009'>November 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/10/' title='October 2009'>October 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/09/' title='September 2009'>September 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/08/' title='August 2009'>August 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/07/' title='July 2009'>July 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/06/' title='June 2009'>June 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/05/' title='May 2009'>May 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/04/' title='April 2009'>April 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/03/' title='March 2009'>March 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/02/' title='February 2009'>February 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2009/01/' title='January 2009'>January 2009</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/12/' title='December 2008'>December 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/11/' title='November 2008'>November 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/10/' title='October 2008'>October 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/09/' title='September 2008'>September 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/08/' title='August 2008'>August 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/07/' title='July 2008'>July 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/06/' title='June 2008'>June 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/05/' title='May 2008'>May 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/04/' title='April 2008'>April 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/03/' title='March 2008'>March 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/02/' title='February 2008'>February 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2008/01/' title='January 2008'>January 2008</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/12/' title='December 2007'>December 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/11/' title='November 2007'>November 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/10/' title='October 2007'>October 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/09/' title='September 2007'>September 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/08/' title='August 2007'>August 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/07/' title='July 2007'>July 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/06/' title='June 2007'>June 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/05/' title='May 2007'>May 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/04/' title='April 2007'>April 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/03/' title='March 2007'>March 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/02/' title='February 2007'>February 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2007/01/' title='January 2007'>January 2007</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/12/' title='December 2006'>December 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/11/' title='November 2006'>November 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/10/' title='October 2006'>October 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/09/' title='September 2006'>September 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/08/' title='August 2006'>August 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/07/' title='July 2006'>July 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/06/' title='June 2006'>June 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/05/' title='May 2006'>May 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/04/' title='April 2006'>April 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/03/' title='March 2006'>March 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/02/' title='February 2006'>February 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2006/01/' title='January 2006'>January 2006</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/12/' title='December 2005'>December 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/11/' title='November 2005'>November 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/10/' title='October 2005'>October 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/09/' title='September 2005'>September 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/08/' title='August 2005'>August 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/07/' title='July 2005'>July 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/06/' title='June 2005'>June 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/05/' title='May 2005'>May 2005</a></li>
	<li><a href='http://codebetter.com/jeremymiller/2005/04/' title='April 2005'>April 2005</a></li>
		</ul>
</li><li id="recent-comments-3" class="widget-container widget_recent_comments"><h3 class="widget-title">What others have said&#8230;</h3><ul id="recentcomments"><li class="recentcomments"><a href='http://zacherygaines.webstarts.com/' rel='external nofollow' class='url'>KadeemFulton</a> on <a href="http://codebetter.com/jeremymiller/2007/07/26/the-build-your-own-cab-series-table-of-contents/#comment-7523">The Build Your Own CAB Series Table of Contents</a></li><li class="recentcomments"><a href='http://jonsonbettly.wordpress.com/' rel='external nofollow' class='url'>ScottWorkman</a> on <a href="http://codebetter.com/jeremymiller/2007/07/26/the-build-your-own-cab-series-table-of-contents/#comment-7517">The Build Your Own CAB Series Table of Contents</a></li><li class="recentcomments">haihao on <a href="http://codebetter.com/jeremymiller/2008/10/18/profile-s-in-structuremap/#comment-7513">Profile’s in StructureMap</a></li><li class="recentcomments">neon on <a href="http://codebetter.com/jeremymiller/2008/09/10/using-the-structuremap-container-independently-of-objectfactory/#comment-7512">Using the StructureMap Container independently of ObjectFactory</a></li><li class="recentcomments">weaponfan on <a href="http://codebetter.com/jeremymiller/2008/09/25/using-structuremap-2-5-to-inject-your-entity-objects-into-services/#comment-7511">Using StructureMap 2.5 to inject your Entity objects into Services</a></li></ul></li>				</ul>	
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29421);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=3f8e353'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29421&amp;n=3f8e353' /></a></noscript>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="http://red-gate.com/">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="http://telerik.com">Telerik .NET Tools</a></li>
<li><a href="http://jetbrains.com/resharper/">JetBrains - ReSharper</a></li>
<li><a href="http://scootersoftware.com">Beyond Compare</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a></li>
<li><a href="http://umbraco.com" target="_blank">Umbraco</a></li>
<li><a href="http://nservicebus.com" target="_blank">NServiceBus</a></li>
<li><a href="http://ravendb.net" target="_blank">RavenDb</a></li>
<li><a href="http://www.websequencediagrams.com/" target="_blank">Web Sequence Diagrams</a></li>
	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '12<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPython.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = true; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>

<script type='text/javascript'>//<![CDATA[
    if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.4.2.min.js' type='text/javascript' %3E%3C/script%3E"));
    }//]]></script>
<script type='text/javascript' language='Javascript' src='http://s1.lqcdn.com/m.min.js?dt=2.3.110202.1'></script>
<script type='text/javascript' language='Javascript'> if(jQuery.LqmAds)jQuery.LqmAds();</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.918 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2012-11-09 12:06:19 -->
<!-- super cache -->