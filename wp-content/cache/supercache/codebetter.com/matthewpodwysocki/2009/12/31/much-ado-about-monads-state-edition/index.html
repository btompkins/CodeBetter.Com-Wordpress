<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Much Ado About Monads – State Edition | Matthew Podwysocki</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/matthewpodwysocki/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css?v=3912785705" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js?ver=3.4.2'></script>
<script type='text/javascript' src='http://dtym7iokkjlif.cloudfront.net/dough/1.0/recipe.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/matthewpodwysocki/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Going Hybrid &#8211; Implementing a Shopping Cart in F#' href='http://codebetter.com/matthewpodwysocki/2009/12/14/going-hybrid-implementing-a-shopping-cart-in-f/' />
<link rel='next' title='Much Ado About Monads – Reader Edition' href='http://codebetter.com/matthewpodwysocki/2010/01/07/much-ado-about-monads-reader-edition/' />
<meta name="generator" content="WordPress 3.4.2" />
<link rel='shortlink' href='http://codebetter.com/matthewpodwysocki/?p=190' />

<!-- All in One SEO Pack 1.6.13.2 by Michael Torbert of Semper Fi Web Design[83,150] -->
<link rel="canonical" href="http://codebetter.com/matthewpodwysocki/2009/12/31/much-ado-about-monads-state-edition/" />
<!-- /all in one seo pack -->
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.3.3" type="text/css" media="screen" />

<!-- Start Shareaholic OgTags -->

	<!-- Shareaholic Notice: There is neither a featured nor gallery image set -->

<!-- End Shareaholic OgTags -->

<meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/dc168cf39155d7b5d39f696ca94d5980.js?v=5302176208">/*Is Cache!*/</script>
                	
	<script type='text/javascript' src='http://d1.openx.org/spcjs.php?id=7744&amp;target=_blank'></script>
	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>
<!-- BuySellAds Ad Code -->
<script type="text/javascript">
(function(){
  var bsa = document.createElement('script');
     bsa.type = 'text/javascript';
     bsa.async = true;
     bsa.src = 'http://s3.buysellads.com/ac/bsa.js';
  (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);
})();
</script>
<!-- End BuySellAds Ad Code -->
</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">
			<!-- BuySellAds Zone Code -->
<div id="bsap_1276080" class="bsarocks bsap_4fe632babdccc2b4b049e4f08cc3c549"></div>
<!-- End BuySellAds Zone Code --></div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-190" class="post-190 post type-post status-publish format-standard hentry category-f category-functional-programming category-haskell">
					<h1 class="entry-title">Much Ado About Monads – State Edition</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/matthewpodwysocki/author/matthewpodwysocki/" title="View all posts by Matthew Podwysocki">Matthew Podwysocki</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/matthewpodwysocki/2009/12/31/much-ado-about-monads-state-edition/" title="3:39 am" rel="bookmark"><span class="entry-date">December 31, 2009</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/matthewpodwysocki/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/matthewpodwysocki/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><!-- Start Shareaholic LikeButtonSetTop Automatic --><!-- End Shareaholic LikeButtonSetTop Automatic --><p>Over the past year, I’ve had the opportunity to be a technical reviewer of a number of books including <a href="http://blogs.msdn.com/chrsmith/">Chris Smith’s</a> <a href="http://www.amazon.com/Programming-Animal-Guide-Chris-Smith/dp/0596153643/">Programming F# book</a>.&#160; During my recent trips, I had the chance to sit down and read through the book once again, and in particular Chapter 10 on Computation Expressions (aka Monads).&#160; A section worth noting in here is the use of the <a href="http://www.haskell.org/all_about_monads/html/statemonad.html">State Monad</a> in order to create a library for web scripting.&#160; In the past, I’ve had a series on Much Ado About Monads where I look at the basic Monads such as Maybe and List, but this time, let’s look at what we can do with the State Monad.</p>
<h2>Keeping Track of State</h2>
<p>Before we get started looking at the state monad and what it entails, let’s look at the overall goal.&#160; What are we trying to solve?&#160; Taking the example of the web scripting DSL, as we perform actions such as clicking a button, we change the state of the system and this state is returned to use each and every call.&#160; This state then needs to passed along to the next step for processing.&#160; This state becomes cumbersome as we have to manage it for each and every call in our function.&#160; What we end up with is a messy API that looks like this:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">[</span><span style="color: #000000">&lt;</span><span style="color: #000000">Fact</span><span style="color: #000000">&gt;</span><span style="color: #000000">]
</span><span style="color: #0000FF">let</span><span style="color: #000000"> ``Can find CodeBetter on Bing``() </span><span style="color: #000000">=</span><span style="color: #000000">
  </span><span style="color: #0000FF">let</span><span style="color: #000000"> state1 </span><span style="color: #000000">=</span><span style="color: #000000"> openPage </span><span style="color: #800000">"</span><span style="color: #800000">http://bing.com</span><span style="color: #800000">"</span><span style="color: #000000">
  </span><span style="color: #0000FF">let</span><span style="color: #000000"> state2 </span><span style="color: #000000">=</span><span style="color: #000000"> enterText </span><span style="color: #800000">"</span><span style="color: #800000">q</span><span style="color: #800000">"</span><span style="color: #000000"> </span><span style="color: #800000">"</span><span style="color: #800000">CodeBetter</span><span style="color: #800000">"</span><span style="color: #000000"> state1
  </span><span style="color: #0000FF">let</span><span style="color: #000000"> state3 </span><span style="color: #000000">=</span><span style="color: #000000"> clickButton </span><span style="color: #800000">"</span><span style="color: #800000">go</span><span style="color: #800000">"</span><span style="color: #000000"> state2
  </span><span style="color: #0000FF">let</span><span style="color: #000000"> (result, state4) </span><span style="color: #000000">=</span><span style="color: #000000"> containsText </span><span style="color: #800000">"</span><span style="color: #800000">CodeBetter</span><span style="color: #800000">"</span><span style="color: #000000"> state3
  isTrue result
  </span><span style="color: #0000FF">let</span><span style="color: #000000"> state5 </span><span style="color: #000000">=</span><span style="color: #000000"> closePage state4 </span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>But what I really want is this state to be managed for me underneath the covers so that I don’t have to be reminded of it every call I make.&#160; In this example, we’ll manage our browser object underneath the covers, so that any time we have a call with our bang ( ! ) notation, we’re really invoking some function on our state.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">[</span><span style="color: #000000">&lt;</span><span style="color: #000000">Fact</span><span style="color: #000000">&gt;</span><span style="color: #000000">]
</span><span style="color: #0000FF">let</span><span style="color: #000000"> ``Can find CodeBetter on Bing``() </span><span style="color: #000000">=</span><span style="color: #000000">
  runScript ( 
    state {
      </span><span style="color: #0000FF">do</span><span style="color: #000000">!</span><span style="color: #000000"> openPage </span><span style="color: #800000">"</span><span style="color: #800000">http://bing.com</span><span style="color: #800000">"</span><span style="color: #000000">
      </span><span style="color: #0000FF">do</span><span style="color: #000000">!</span><span style="color: #000000"> enterText </span><span style="color: #800000">"</span><span style="color: #800000">q</span><span style="color: #800000">"</span><span style="color: #000000"> </span><span style="color: #800000">"</span><span style="color: #800000">CodeBetter</span><span style="color: #800000">"</span><span style="color: #000000">
      </span><span style="color: #0000FF">do</span><span style="color: #000000">!</span><span style="color: #000000"> clickButton </span><span style="color: #800000">"</span><span style="color: #800000">go</span><span style="color: #800000">"</span><span style="color: #000000">
      </span><span style="color: #0000FF">let</span><span style="color: #000000">!</span><span style="color: #000000"> result </span><span style="color: #000000">=</span><span style="color: #000000"> containsText </span><span style="color: #800000">"</span><span style="color: #800000">CodeBetter</span><span style="color: #800000">"</span><span style="color: #000000">
      isTrue result
      </span><span style="color: #0000FF">do</span><span style="color: #000000">!</span><span style="color: #000000"> closePage })</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>In the book, Chris used the State Monad to model this state.&#160; When we say State Monad, what we really mean is an abstraction for a function which takes a state and returns an immediate value and some new state value.&#160; In this case, each action we perform such as entering text or clicking a button would alter our state object and return a new one which must be persisted for the next call..&#160; </p>
<p>Now that we defined the problem and generally speaking what the State Monad is, let’s go ahead and define it.&#160; To do this, we’ll need an overarching container to describe our state.&#160; In this case, we have the State&lt;’a, ‘s&gt; type which the ‘a is our result type and the ‘s is our state type.&#160; This State constructor takes a function which takes a state parameter and returns a tuple of our result and our modified state. </p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">type</span><span style="color: #000000"> State</span><span style="color: #000000">&lt;</span><span style="color: #800000">'</span><span style="color: #800000">a,</span><span style="color: #800000">'</span><span style="color: #000000">s</span><span style="color: #000000">&gt;</span><span style="color: #000000"> </span><span style="color: #000000">=</span><span style="color: #000000"> State of (</span><span style="color: #800000">'</span><span style="color: #800000">s -&gt; </span><span style="color: #800000">'</span><span style="color: #000000">a </span><span style="color: #000000">*</span><span style="color: #000000"> </span><span style="color: #800000">'</span><span style="color: #800000">s)</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>In addition, we’ll need a way to run our State so that we can provide it with an initial state and return both our result and our new state.&#160; Let’s create a function called runState which takes our State and an initial state, and returns a tuple of our result and new state.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">let</span><span style="color: #000000"> runState (State s) initialState </span><span style="color: #000000">=</span><span style="color: #000000"> s initialState</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>To make this useful, we need the ability to both get and set our state.&#160; The getState function should return a State with our constructing function takes our state and returns a tuple pair containing our state.&#160; Conversely, our putState function should take a state value and construct a State with the function which returns a tuple state of unit and our state.&#160; These functions will be important as we need to obtain and modify our state.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">let</span><span style="color: #000000"> getState </span><span style="color: #000000">=</span><span style="color: #000000"> State (</span><span style="color: #0000FF">fun</span><span style="color: #000000"> s </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000"> (s,s))
</span><span style="color: #0000FF">let</span><span style="color: #000000"> putState s </span><span style="color: #000000">=</span><span style="color: #000000"> State (</span><span style="color: #0000FF">fun</span><span style="color: #000000"> _ </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000"> ((),s))</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Next, we’ll need the ability to both evaluate and execute the state.&#160; What I mean by evaluate is that we want the end result and throw away the resulting state.&#160; Conversely, the execute state returns the modified state and ignores the result.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">let</span><span style="color: #000000"> evalState m s </span><span style="color: #000000">=</span><span style="color: #000000"> runState m s </span><span style="color: #000000">|&gt;</span><span style="color: #000000"> fst
</span><span style="color: #0000FF">let</span><span style="color: #000000"> execState m s </span><span style="color: #000000">=</span><span style="color: #000000"> runState m s </span><span style="color: #000000">|&gt;</span><span style="color: #000000"> snd</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Now that we have a way to run our computations, let’s get to the monad part.&#160; As you may remember from previous posts, the monad must support three basic rules.&#160; First, a type construction, for each underlying type, we must be able to get the corresponding monadic type.&#160; Second, we must have a function that maps an underlying value to a value in the corresponding monadic type, which is called the return function.&#160; Third, we must have a binding operation where the first argument is a value in a monadic type, its second argument is a function that maps from the underlying type of the first argument to another monadic type, and its result is in that other monadic type.</p>
<p>Let’s first tackle the return function.&#160; You should recall that our return function must have the following signature, keeping in mind that M defined below is our monadic type.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">val</span><span style="color: #000000"> returnF : </span><span style="color: #800000">'</span><span style="color: #800000">a -&gt; M&lt;</span><span style="color: #800000">'</span><span style="color: #000000">a</span><span style="color: #000000">&gt;</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>In the case of the State Monad, it should look like this where we take in a value and return a State of ‘a and our state.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">val</span><span style="color: #000000"> returnF : </span><span style="color: #800000">'</span><span style="color: #800000">a -&gt; State&lt;</span><span style="color: #800000">'</span><span style="color: #000000">a,</span><span style="color: #800000">'</span><span style="color: #800000">s&gt;</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Now, let’s look at the implementation.&#160; In this case we have a parameter a, which when given an initial state will produce a tuple of that value and our state. </p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">let</span><span style="color: #000000"> returnF a </span><span style="color: #000000">=</span><span style="color: #000000"> State (</span><span style="color: #0000FF">fun</span><span style="color: #000000"> s </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000"> (a,s))</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Next, we need to define the bind operation.&#160; As you may recall, our bind operation must look like the following code, keeping in mind that M defined below is our monadic type.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">val</span><span style="color: #000000"> bind : M</span><span style="color: #000000">&lt;</span><span style="color: #800000">'</span><span style="color: #800000">a&gt; -&gt; (</span><span style="color: #800000">'</span><span style="color: #000000">a </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000"> M</span><span style="color: #000000">&lt;</span><span style="color: #800000">'</span><span style="color: #800000">b&gt;) -&gt; M&lt;</span><span style="color: #800000">'</span><span style="color: #000000">b</span><span style="color: #000000">&gt;</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>In the case of our State Monad, it should look like this:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">val</span><span style="color: #000000"> bind : State</span><span style="color: #000000">&lt;</span><span style="color: #800000">'</span><span style="color: #800000">a&gt; -&gt; (</span><span style="color: #800000">'</span><span style="color: #000000">a </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000"> State</span><span style="color: #000000">&lt;</span><span style="color: #800000">'</span><span style="color: #800000">b&gt;) -&gt; State&lt;</span><span style="color: #800000">'</span><span style="color: #000000">b</span><span style="color: #000000">&gt;</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Let’s break this down a little more to show what is really going on underneath the covers.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">val</span><span style="color: #000000"> bind : (</span><span style="color: #800000">'</span><span style="color: #800000">s -&gt; (</span><span style="color: #800000">'</span><span style="color: #000000">a,</span><span style="color: #800000">'</span><span style="color: #800000">s))       -&gt; </span><span style="color: #800000">
</span><span style="color: #000000">           (</span><span style="color: #800000">'</span><span style="color: #800000">a -&gt; </span><span style="color: #800000">'</span><span style="color: #000000">s </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000"> (</span><span style="color: #800000">'</span><span style="color: #800000">b,</span><span style="color: #800000">'</span><span style="color: #000000">s)) </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000"> 
           (</span><span style="color: #800000">'</span><span style="color: #800000">s -&gt; (</span><span style="color: #800000">'</span><span style="color: #000000">b,</span><span style="color: #800000">'</span><span style="color: #800000">s))</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>What we see is that the first argument is a function which takes some initial state and produces a tuple of a value and our new state.&#160; Our second argument is a function that takes a value and our new states and then generates a tuple of our new state and newer state.&#160; What our goal is to combine these two functions into a larger function from an initial state to a tuple of our new value and newest state.&#160; </p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">let</span><span style="color: #000000"> bind m k </span><span style="color: #000000">=</span><span style="color: #000000"> 
  State (</span><span style="color: #0000FF">fun</span><span style="color: #000000"> s </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000"> </span><span style="color: #0000FF">let</span><span style="color: #000000"> (a,s</span><span style="color: #800000">'</span><span style="color: #800000">) = runState m s in runState (k a) s</span><span style="color: #800000">'</span><span style="color: #000000">)</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Taking these two functions together, we can now create a builder which can provide us some syntactic sugar when writing functions using the state monad.&#160; </p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">type</span><span style="color: #000000"> StateBuilder() </span><span style="color: #000000">=</span><span style="color: #000000">
  </span><span style="color: #0000FF">member</span><span style="color: #000000"> this.Return a </span><span style="color: #000000">=</span><span style="color: #000000"> State (</span><span style="color: #0000FF">fun</span><span style="color: #000000"> s </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000"> (a, s))
  </span><span style="color: #0000FF">member</span><span style="color: #000000"> this.Bind(m, k) </span><span style="color: #000000">=</span><span style="color: #000000"> 
    State (</span><span style="color: #0000FF">fun</span><span style="color: #000000"> s </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000"> </span><span style="color: #0000FF">let</span><span style="color: #000000"> (a,s</span><span style="color: #800000">'</span><span style="color: #800000">) = runState m s in runState (k a) s</span><span style="color: #800000">'</span><span style="color: #000000">)
</span><span style="color: #0000FF">let</span><span style="color: #000000"> state </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> StateBuilder()</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>To try it out, let’s take a simple example of the state monad in action.&#160; We’ll create a function call tick which when given an initial state, will bind n to that state.&#160; Then, we will take our existing state, increment it by one and then persist again.&#160; Finally, we’ll return our n, which is our initial state.&#160; Below is what the code will look like once we’re through.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">let</span><span style="color: #000000"> tick </span><span style="color: #000000">=</span><span style="color: #000000"> state {
  </span><span style="color: #0000FF">let</span><span style="color: #000000">!</span><span style="color: #000000"> n </span><span style="color: #000000">=</span><span style="color: #000000"> getState
  </span><span style="color: #0000FF">do</span><span style="color: #000000">!</span><span style="color: #000000"> putState (n </span><span style="color: #000000">+</span><span style="color: #000000"> </span><span style="color: #800080">1</span><span style="color: #000000">)
  </span><span style="color: #0000FF">return</span><span style="color: #000000"> n }</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>We can run this by calling the runState function which will give us the tuple of our value and our new state.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">&gt;</span><span style="color: #000000"> runState tick </span><span style="color: #800080">3</span><span style="color: #000000">;;
</span><span style="color: #0000FF">val</span><span style="color: #000000"> it : </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #000000">*</span><span style="color: #000000"> </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #000000">=</span><span style="color: #000000"> (</span><span style="color: #800080">3</span><span style="color: #000000">, </span><span style="color: #800080">4</span><span style="color: #000000">)</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Let’s take a look at another example, this time of a managing the state of a queue.</p>
<h2>Queue Example</h2>
<p>In this example, we’re going to implement a <a href="http://en.wikipedia.org/wiki/Queue_%28data_structure%29">queue</a>, which is a standard FIFO collection.&#160; Using a structure like an F# list, we can model both the enqueue, which is to add to the end of the list, and the dequeue, which is to take from the front of the list.&#160; </p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">let</span><span style="color: #000000"> enqueue a lst </span><span style="color: #000000">=</span><span style="color: #000000"> ((), lst @ [a])
</span><span style="color: #0000FF">let</span><span style="color: #000000"> dequeue (hd::tl) </span><span style="color: #000000">=</span><span style="color: #000000"> (hd, tl)</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>The idea behind these functions is that when you enqueue an item, you get back a tuple of a unit and our value appended to our list.&#160; Conversely, when we dequeue an item, we simply return a tuple of our head of our list and the rest of the values.&#160; Using these functions, we could write a simple workflow to add an item to the list, then grab the first item, multiply it by three, enqueue it back to the list, and finally return the head that we dequeued earlier as well as our queue.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">let</span><span style="color: #000000"> workflow initialState </span><span style="color: #000000">=</span><span style="color: #000000">
  </span><span style="color: #0000FF">let</span><span style="color: #000000"> ((), state1) </span><span style="color: #000000">=</span><span style="color: #000000"> enqueue </span><span style="color: #800080">4</span><span style="color: #000000"> initialState
  </span><span style="color: #0000FF">let</span><span style="color: #000000"> (a, state2) </span><span style="color: #000000">=</span><span style="color: #000000"> dequeue state1
  </span><span style="color: #0000FF">let</span><span style="color: #000000"> ((), state3) </span><span style="color: #000000">=</span><span style="color: #000000"> enqueue (a </span><span style="color: #000000">*</span><span style="color: #000000"> </span><span style="color: #800080">3</span><span style="color: #000000">) state2
  (a, state3)</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>As you can see, the code is quite messy and cumbersome as we have to keep binding to a new state to pass along to the next function.&#160; That gets unwieldy quite quickly.&#160; Instead, if we apply some of the lessons learned from above, we can clean this up quite a bit.&#160; What if we could rewrite our enqueue and dequeue using the State Monad and then have our stateful computation abstracted for us?&#160; Going back to the drawing board, we could rewrite our functions as so:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">let</span><span style="color: #000000"> enqueue a </span><span style="color: #000000">=</span><span style="color: #000000"> State (</span><span style="color: #0000FF">fun</span><span style="color: #000000"> s </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000"> ((), s @ [a]))
</span><span style="color: #0000FF">let</span><span style="color: #000000"> dequeue </span><span style="color: #000000">=</span><span style="color: #000000"> State (</span><span style="color: #0000FF">fun</span><span style="color: #000000"> (hd::tl) </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000"> (hd, tl))</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>The enqueue function takes a value, and when given an initial queue state, returns a tuple of unit and the value appended to our queue state.&#160;&#160; Our dequeue function, when given a state of our list with a head and tail, returns a tuple of our head and tail.&#160; Now, we can rewrite our workflow from above like the following to use the state builder.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">let</span><span style="color: #000000"> workflow </span><span style="color: #000000">=</span><span style="color: #000000"> state {
  </span><span style="color: #0000FF">let</span><span style="color: #000000">!</span><span style="color: #000000"> queue </span><span style="color: #000000">=</span><span style="color: #000000"> getState
  </span><span style="color: #0000FF">do</span><span style="color: #000000">!</span><span style="color: #000000"> enqueue </span><span style="color: #800080">4</span><span style="color: #000000">
  </span><span style="color: #0000FF">let</span><span style="color: #000000">!</span><span style="color: #000000"> hd </span><span style="color: #000000">=</span><span style="color: #000000"> dequeue
  </span><span style="color: #0000FF">do</span><span style="color: #000000">!</span><span style="color: #000000"> enqueue (hd </span><span style="color: #000000">*</span><span style="color: #000000"> </span><span style="color: #800080">3</span><span style="color: #000000">)
  </span><span style="color: #0000FF">return</span><span style="color: #000000"> hd }</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Like the previous example, we’re first getting passed an initial state, which we bind to queue.&#160; Then we enqueue four to the list, take the head of the list, then add it back to the list after multiplying the value by three.&#160; Finally, we return hd, which behind the scenes will return to us a tuple of that head value and our queue.&#160; Let’s run it through real quickly to take a look at what it does:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">&gt;</span><span style="color: #000000"> runState workflow [</span><span style="color: #800080">3</span><span style="color: #000000">..</span><span style="color: #800080">6</span><span style="color: #000000">];;
</span><span style="color: #0000FF">val</span><span style="color: #000000"> it : </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #000000">*</span><span style="color: #000000"> </span><span style="color: #0000FF">int</span><span style="color: #000000"> list </span><span style="color: #000000">=</span><span style="color: #000000"> (</span><span style="color: #800080">3</span><span style="color: #000000">, [</span><span style="color: #800080">4</span><span style="color: #000000">; </span><span style="color: #800080">5</span><span style="color: #000000">; </span><span style="color: #800080">6</span><span style="color: #000000">; </span><span style="color: #800080">4</span><span style="color: #000000">; </span><span style="color: #800080">9</span><span style="color: #000000">])</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>As you can see, if we give an initial state of a list from 3 to 6, the function will return the head of 3 and the rest of our list with both the 4 and our head of 3 multiplied by 3.&#160; This is quite useful for knowing when we find ourselves having to carry around some form of state from each function call manually.&#160; Instead, using this technique, we can abstract this out and have it managed for us.</p>
<p>But what about this browser example that I showed in the beginning?&#160; Could we really do something with it?</p>
<h2>The Browser Example</h2>
<p>The first example I gave above of using a web browser to somehow manage the state behind the scenes to create some sort of DSL is interesting.&#160; In fact, we could take some of the lessons learned here and apply them immediately to our solution.&#160; Taking a library such as <a href="http://watin.sourceforge.net/">WatiN</a>, we could manage the state of our browser behind the scenes and then use custom functions to manipulate the state of the browser.</p>
<p>Let’s take a few of the functions listed above and implement them in the state monad for things such as opening and closing a browser, entering text into a field and clicking a button.&#160; As you’ll see, each time we get the Browser out of state and then return our action, whether it be closing our browser, entering text or finding out whether some text exists on a page. </p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">open</span><span style="color: #000000"> WatiN.Core

</span><span style="color: #0000FF">let</span><span style="color: #000000"> openPage (url:</span><span style="color: #0000FF">string</span><span style="color: #000000">) </span><span style="color: #000000">=</span><span style="color: #000000"> state {
  </span><span style="color: #0000FF">let</span><span style="color: #000000">!</span><span style="color: #000000"> (browser : Browser) </span><span style="color: #000000">=</span><span style="color: #000000"> getState
  </span><span style="color: #0000FF">return</span><span style="color: #000000"> browser.GoTo(url) }

</span><span style="color: #0000FF">let</span><span style="color: #000000"> enterText (textBox : </span><span style="color: #0000FF">string</span><span style="color: #000000">) (text : </span><span style="color: #0000FF">string</span><span style="color: #000000">) </span><span style="color: #000000">=</span><span style="color: #000000"> state {
  </span><span style="color: #0000FF">let</span><span style="color: #000000">!</span><span style="color: #000000"> (browser : Browser) </span><span style="color: #000000">=</span><span style="color: #000000"> getState
  </span><span style="color: #0000FF">return</span><span style="color: #000000"> browser.TextField(Find.ByName(textBox)).TypeText(text) }
 
</span><span style="color: #0000FF">let</span><span style="color: #000000"> containsText (text : </span><span style="color: #0000FF">string</span><span style="color: #000000">) </span><span style="color: #000000">=</span><span style="color: #000000"> state {
  </span><span style="color: #0000FF">let</span><span style="color: #000000">!</span><span style="color: #000000"> (browser : Browser) </span><span style="color: #000000">=</span><span style="color: #000000"> getState
  </span><span style="color: #0000FF">return</span><span style="color: #000000"> browser.ContainsText(text) }
 
</span><span style="color: #0000FF">let</span><span style="color: #000000"> clickButton (buttonText : </span><span style="color: #0000FF">string</span><span style="color: #000000">) </span><span style="color: #000000">=</span><span style="color: #000000"> state {
  </span><span style="color: #0000FF">let</span><span style="color: #000000">!</span><span style="color: #000000"> (browser : Browser) </span><span style="color: #000000">=</span><span style="color: #000000"> getState
  </span><span style="color: #0000FF">return</span><span style="color: #000000"> browser.Button(Find.ByName(buttonText)).Click() }

</span><span style="color: #0000FF">let</span><span style="color: #000000"> closePage </span><span style="color: #000000">=</span><span style="color: #000000"> state {
  </span><span style="color: #0000FF">let</span><span style="color: #000000">!</span><span style="color: #000000"> (browser : Browser) </span><span style="color: #000000">=</span><span style="color: #000000"> getState
  </span><span style="color: #0000FF">return</span><span style="color: #000000"> browser.Dispose() }</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Then we can behind the scenes manage our Browser instance, whichever Browser we so choose.&#160; We can create a function called runScript which calls our overall function with an initial state of a new Browser.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">let</span><span style="color: #000000"> runScript (script:State</span><span style="color: #000000">&lt;</span><span style="color: #800000">'</span><span style="color: #800000">a,Browser&gt;) =</span><span style="color: #800000">
</span><span style="color: #000000">  evalState script (</span><span style="color: #0000FF">new</span><span style="color: #000000"> IE() :</span><span style="color: #000000">&gt;</span><span style="color: #000000"> Browser)</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Once this is defined we should be able to run our test as before and actually have it work while using xUnit.net and some custom assertions that I made.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">[</span><span style="color: #000000">&lt;</span><span style="color: #000000">Fact</span><span style="color: #000000">&gt;</span><span style="color: #000000">]
</span><span style="color: #0000FF">let</span><span style="color: #000000"> ``Can find CodeBetter on Bing``() </span><span style="color: #000000">=</span><span style="color: #000000">
  runScript ( 
    state {
      </span><span style="color: #0000FF">do</span><span style="color: #000000">!</span><span style="color: #000000"> openPage </span><span style="color: #800000">"</span><span style="color: #800000">http://bing.com</span><span style="color: #800000">"</span><span style="color: #000000">
      </span><span style="color: #0000FF">do</span><span style="color: #000000">!</span><span style="color: #000000"> enterText </span><span style="color: #800000">"</span><span style="color: #800000">q</span><span style="color: #800000">"</span><span style="color: #000000"> </span><span style="color: #800000">"</span><span style="color: #800000">CodeBetter</span><span style="color: #800000">"</span><span style="color: #000000">
      </span><span style="color: #0000FF">do</span><span style="color: #000000">!</span><span style="color: #000000"> clickButton </span><span style="color: #800000">"</span><span style="color: #800000">go</span><span style="color: #800000">"</span><span style="color: #000000">
      </span><span style="color: #0000FF">let</span><span style="color: #000000">!</span><span style="color: #000000"> result </span><span style="color: #000000">=</span><span style="color: #000000"> containsText </span><span style="color: #800000">"</span><span style="color: #800000">CodeBetter</span><span style="color: #800000">"</span><span style="color: #000000">
      isTrue result
      </span><span style="color: #0000FF">do</span><span style="color: #000000">!</span><span style="color: #000000"> closePage })</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>This works great and seems like an interesting abstraction for a DSL, but, is this monad abuse?</p>
<h2>The Practicality of It All</h2>
<p>What you’ve noticed from my runScript and those other functions which deal with manipulating the Browser, you’ll notice that I never did persist state again once I had the initial state.&#160; The reason for this is that the mutable state is really being managed by the Browser object behind the scenes anyways, and any subsequent call does not return me a new browser, but instead mutates the existing instance.&#160; Instead, we should more focus on an implementation of an abstraction which deals with persisting the initial state only once and only allows reads, which of course brings us to the Reader Monad which we’ll talk about next time in this series.</p>
<p>Another question does come up though about whether in a multi-paradigm language such as F# that this abstraction is needed at all?&#160; After all, we have many other patterns we could apply as well.&#160; It’s an interesting question and well open to debate.&#160; But knowing of these abstractions can give you more options as you consider how we manage state in our applications.</p>
<h2>Conclusion</h2>
<p>By looking at Monads, we can discover what abstractions can be accomplished with them, but just as well, <a href="http://www.haskell.org/haskellwiki/What_a_Monad_is_not">what they are not about</a>.&#160; Certainly, functional languages don’t need them, but they certainly can be quite useful.&#160; When we find repeated behavior, such as maintaining state, this abstraction can be quite powerful.&#160; Practically though in languages such as F#, they can be useful, but other patterns and abstractions can as well.&#160; Find the right abstraction and use it.</p>
<div class="shr-publisher-190"></div><!-- Start Shareaholic LikeButtonSetBottom Automatic --><!-- End Shareaholic LikeButtonSetBottom Automatic -->											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/matthewpodwysocki/category/f/" title="View all posts in F#" rel="category tag">F#</a>, <a href="http://codebetter.com/matthewpodwysocki/category/functional-programming/" title="View all posts in Functional Programming" rel="category tag">Functional Programming</a>, <a href="http://codebetter.com/matthewpodwysocki/category/haskell/" title="View all posts in Haskell" rel="category tag">Haskell</a>. Bookmark the <a href="http://codebetter.com/matthewpodwysocki/2009/12/31/much-ado-about-monads-state-edition/" title="Permalink to Much Ado About Monads – State Edition" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/matthewpodwysocki/2009/12/31/much-ado-about-monads-state-edition/feed/" title="Comments RSS to Much Ado About Monads – State Edition" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-190 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/matthewpodwysocki/2009/12/14/going-hybrid-implementing-a-shopping-cart-in-f/" rel="prev"><span class="meta-nav">&larr;</span> Going Hybrid &#8211; Implementing a Shopping Cart in F#</a></div>
					<div class="nav-next"><a href="http://codebetter.com/matthewpodwysocki/2010/01/07/much-ado-about-monads-reader-edition/" rel="next">Much Ado About Monads – Reader Edition <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
    </div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://codebetter.com/matthewpodwysocki/2009/12/31/much-ado-about-monads-state-edition/';
    var disqus_identifier = '190 /blogs/matthew.podwysocki/archive/2009/12/30/much-ado-about-monads-state-edition.aspx';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'matthewpodwysocki';
    var disqus_title = "Much Ado About Monads – State Edition";
        var disqus_config = function () {
        var config = this; // Access to the config object

        /* 
           All currently supported events:
            * preData — fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            DISQUS.request.get('?cf_action=sync_comments&post_id=190');
        });
                    };
    var facebookXdReceiverPath = 'http://cdn1.codebetter.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
        ],
        'trackback_url': "http:\/\/codebetter.com\/matthewpodwysocki\/2009\/12\/31\/much-ado-about-monads-state-edition\/trackback\/"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.67';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29416);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=2782afb'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29416&amp;n=2782afb' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29417);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=e94cea6'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29417&amp;n=e94cea6' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29418);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=9ba3022'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29418&amp;n=9ba3022' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29419);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=f467b52'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29419&amp;n=f467b52' /></a></noscript>
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(220407);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=68b8307'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=220407&amp;n=68b8307' /></a></noscript>				
				
				<ul class="xoxo">		
									</ul>	
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29421);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=3f8e353'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29421&amp;n=3f8e353' /></a></noscript>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="http://red-gate.com/">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="http://telerik.com">Telerik .NET Tools</a></li>
<li><a href="http://jetbrains.com/resharper/">JetBrains - ReSharper</a></li>
<li><a href="http://scootersoftware.com">Beyond Compare</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a></li>
<li><a href="http://umbraco.com" target="_blank">Umbraco</a></li>
<li><a href="http://nservicebus.com" target="_blank">NServiceBus</a></li>
<li><a href="http://ravendb.net" target="_blank">RavenDb</a></li>
<li><a href="http://www.websequencediagrams.com/" target="_blank">Web Sequence Diagrams</a></li>
	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '12<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPython.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = true; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>

<script type='text/javascript'>//<![CDATA[
    if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.4.2.min.js' type='text/javascript' %3E%3C/script%3E"));
    }//]]></script>
<script type='text/javascript' language='Javascript' src='http://s1.lqcdn.com/m.min.js?dt=2.3.110202.1'></script>
<script type='text/javascript' language='Javascript'> if(jQuery.LqmAds)jQuery.LqmAds();</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.544 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2012-11-09 21:39:40 -->
<!-- super cache -->