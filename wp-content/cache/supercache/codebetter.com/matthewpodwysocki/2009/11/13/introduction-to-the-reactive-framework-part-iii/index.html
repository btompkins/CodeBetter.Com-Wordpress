<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Introduction to the Reactive Framework Part III | Matthew Podwysocki</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/matthewpodwysocki/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css?v=3912785705" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js?ver=3.4.2'></script>
<script type='text/javascript' src='http://dtym7iokkjlif.cloudfront.net/dough/1.0/recipe.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/matthewpodwysocki/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='[ANN] DC ALT.NET – 11/24/2009 “Stop Talking, Start Teaching” with Jeff Casimir' href='http://codebetter.com/matthewpodwysocki/2009/11/10/ann-dc-alt-net-11-24-2009-stop-talking-start-teaching-with-jeff-casimir/' />
<link rel='next' title='Introduction to the Reactive Framework Part IV' href='http://codebetter.com/matthewpodwysocki/2009/11/15/introduction-to-the-reactive-framework-part-iv/' />
<meta name="generator" content="WordPress 3.4.2" />
<link rel='shortlink' href='http://codebetter.com/matthewpodwysocki/?p=182' />

<!-- All in One SEO Pack 1.6.13.2 by Michael Torbert of Semper Fi Web Design[83,158] -->
<link rel="canonical" href="http://codebetter.com/matthewpodwysocki/2009/11/13/introduction-to-the-reactive-framework-part-iii/" />
<!-- /all in one seo pack -->
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.3.3" type="text/css" media="screen" />

<!-- Start Shareaholic OgTags -->

	<!-- Shareaholic Notice: There is neither a featured nor gallery image set -->

<!-- End Shareaholic OgTags -->

<meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/dc168cf39155d7b5d39f696ca94d5980.js?v=5302176208">/*Is Cache!*/</script>
                	
	<script type='text/javascript' src='http://d1.openx.org/spcjs.php?id=7744&amp;target=_blank'></script>
	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>
<!-- BuySellAds Ad Code -->
<script type="text/javascript">
(function(){
  var bsa = document.createElement('script');
     bsa.type = 'text/javascript';
     bsa.async = true;
     bsa.src = 'http://s3.buysellads.com/ac/bsa.js';
  (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);
})();
</script>
<!-- End BuySellAds Ad Code -->
</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">
			<!-- BuySellAds Zone Code -->
<div id="bsap_1276080" class="bsarocks bsap_4fe632babdccc2b4b049e4f08cc3c549"></div>
<!-- End BuySellAds Zone Code --></div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-182" class="post-182 post type-post status-publish format-standard hentry category-c category-event-based-porgramming category-reactive-framework">
					<h1 class="entry-title">Introduction to the Reactive Framework Part III</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/matthewpodwysocki/author/matthewpodwysocki/" title="View all posts by Matthew Podwysocki">Matthew Podwysocki</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/matthewpodwysocki/2009/11/13/introduction-to-the-reactive-framework-part-iii/" title="4:06 am" rel="bookmark"><span class="entry-date">November 13, 2009</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/matthewpodwysocki/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/matthewpodwysocki/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><!-- Start Shareaholic LikeButtonSetTop Automatic --><!-- End Shareaholic LikeButtonSetTop Automatic --><p>In my previous post in the Introduction to the Reactive Framework series, I discussed the duality between the IEnumerable/IEnumerator and IObservable/IObserver and how that enables us to generalize the ideas from LINQ to Objects to LINQ to Observables/Events.&#160; After the last post, I was asked how we go from events to Observables, so let’s tackle that in this post.</p>
<p>Before we get started, let’s get caught up to where we are today:</p>
<ul>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2009/10/19/f-october-2009-ctp-beta2-f-rx-together-at-last.aspx">Part I – Introduction</a> </li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2009/11/03/introduction-to-the-reactive-framework-part-ii.aspx">Part II – Duality of Enumerable/Observable</a> </li>
</ul>
<h2>From Events&#8230;</h2>
<p>Let’s start out by looking at the way we’d usually do event-based programming in .NET.&#160; First, if we have the need to pass data as arguments to our event, we’ll need to create a class which inherits from EventArgs, and in this case we have a class called SomeEventArgs.&#160; This class holds nothing more than just a simple object value.</p>
</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> SomeEventArgs : EventArgs {
    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">object</span><span style="color: #000000"> Value { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">private</span><span style="color: #000000"> </span><span style="color: #0000FF">set</span><span style="color: #000000">; }

    </span><span style="color: #0000FF">public</span><span style="color: #000000"> SomeEventArgs(</span><span style="color: #0000FF">object</span><span style="color: #000000"> value) {
        Value </span><span style="color: #000000">=</span><span style="color: #000000"> value
    }
}</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
</p>
<p>Then we’d have a class which exposes an event with an EventHandler of our SomeEventArgs.&#160; At some point along the way we’d have a method which invokes our event, keeping in mind that we need to check for nulls before invoking.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> SomeClass
{
    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">event</span><span style="color: #000000"> EventHandler</span><span style="color: #000000">&lt;</span><span style="color: #000000">SomeEventArgs</span><span style="color: #000000">&gt;</span><span style="color: #000000"> SomeEvent;
    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">event</span><span style="color: #000000"> EventHandler</span><span style="color: #000000">&lt;</span><span style="color: #000000">SomeEventArgs</span><span style="color: #000000">&gt;</span><span style="color: #000000"> OtherEvent;
    
    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">void</span><span style="color: #000000"> InvokeEvent(</span><span style="color: #0000FF">object</span><span style="color: #000000"> value) {
        </span><span style="color: #0000FF">var</span><span style="color: #000000"> handler </span><span style="color: #000000">=</span><span style="color: #000000"> SomeEvent;
        </span><span style="color: #0000FF">if</span><span style="color: #000000">(handler </span><span style="color: #000000">!=</span><span style="color: #000000"> </span><span style="color: #0000FF">null</span><span style="color: #000000">)
            handler(</span><span style="color: #0000FF">this</span><span style="color: #000000">, </span><span style="color: #0000FF">new</span><span style="color: #000000"> SomeEventArgs(value));
    }
    </span><span style="color: #008000">//</span><span style="color: #008000"> Other event invoking code here</span><span style="color: #008000">
</span><span style="color: #000000">}</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Now to do something useful with it, you can subscribe and unsubscribe by using the += and –= operators.&#160; In this case, I actually declared a method called SomeHandler which will react to the event arguments that I give it.&#160; </p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">var</span><span style="color: #000000"> someClass </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> SomeClass();

</span><span style="color: #008000">//</span><span style="color: #008000"> Add handler</span><span style="color: #008000">
</span><span style="color: #000000">someClass.SomeEvent </span><span style="color: #000000">+=</span><span style="color: #000000"> SomeHandler;

</span><span style="color: #008000">//</span><span style="color: #008000"> Remove handler</span><span style="color: #008000">
</span><span style="color: #000000">someClass.SomeEvent </span><span style="color: #000000">-=</span><span style="color: #000000"> SomeHandler;</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
</p>
<p>Our SomeHandler method must follow the signature with the sender as an object and the EventArgs derived class, whatever it might be.&#160; At this point we react to anything that we’re subscribed to in this method.&#160; </p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">private</span><span style="color: #000000"> </span><span style="color: #0000FF">void</span><span style="color: #000000"> SomeHandler(</span><span style="color: #0000FF">object</span><span style="color: #000000"> sender, SomeEventArgs e) {
    </span><span style="color: #008000">//</span><span style="color: #008000"> Some handler code</span><span style="color: #008000">
</span><span style="color: #000000">}</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>The problem with this solution is that it isn’t quite compositional.&#160; What do I mean by that?&#160; What if I want to combine this SomeEvent firing with another event?&#160; Or if I want to ensure that an event gets posted on a certain synchronization context?&#160; Or if I want to throttle the firing of an event to a certain threshold?&#160; All of those are a tad more difficult using standard out of the box .NET events, but, we can with Observables.&#160; So, how do we get there?</p>
<h2>To Observables</h2>
<p>Unlike F#, we don’t get Observables for free when we use events, so we have a little work ahead of us.&#160; In order for us to go from events to Observables , we simply need to use the Observable.FromEvent method.&#160; There are several flavors that we can use.&#160; The first option is to use a little “magic string” juice to wrap our event in an IObservable.&#160; This method takes the object to bind for the event and the event name as a string.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">static</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> EventExtensions {
    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">static</span><span style="color: #000000"> IObservable</span><span style="color: #000000">&lt;</span><span style="color: #000000">Event</span><span style="color: #000000">&lt;</span><span style="color: #000000">SomeEventArgs</span><span style="color: #000000">&gt;&gt;</span><span style="color: #000000"> GetSomeEvent(
        </span><span style="color: #0000FF">this</span><span style="color: #000000"> SomeClass someClass) {
    
    </span><span style="color: #0000FF">return</span><span style="color: #000000"> Observable.FromEvent</span><span style="color: #000000">&lt;</span><span style="color: #000000">SomeEventArgs</span><span style="color: #000000">&gt;</span><span style="color: #000000">(
        someClass, </span><span style="color: #800000">"</span><span style="color: #800000">SomeEvent</span><span style="color: #800000">"</span><span style="color: #000000">);
}
</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>This method then returns to us an IObservable&lt;Event&lt;SomeEventArgs&gt;&gt; which allows us to get access to the EventArgs and the Sender through their respective properties on the Event class.&#160; Personally, I’m not a fan of magic strings at all and if I can get away with not using them, all the better.&#160; Luckily, there are other options.&#160; The next option is to use Action&lt;EventHandler&lt;EventArgs&gt;&gt; arguments for both the subscribe and unsubscribe.&#160; Keep in mind that this only works for those events which are declared to use EventHandler&lt;TEventArgs&gt;.&#160; </p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">static</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> EventExtensions {
    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">static</span><span style="color: #000000"> IObservable</span><span style="color: #000000">&lt;</span><span style="color: #000000">Event</span><span style="color: #000000">&lt;</span><span style="color: #000000">SomeEventArgs</span><span style="color: #000000">&gt;&gt;</span><span style="color: #000000"> GetSomeEvent(
        </span><span style="color: #0000FF">this</span><span style="color: #000000"> SomeClass someClass) {
    
    </span><span style="color: #0000FF">return</span><span style="color: #000000"> Observable.FromEvent</span><span style="color: #000000">&lt;</span><span style="color: #000000">SomeEventArgs</span><span style="color: #000000">&gt;</span><span style="color: #000000">(
        h </span><span style="color: #000000">=&gt;</span><span style="color: #000000"> someClass.SomeEvent </span><span style="color: #000000">+=</span><span style="color: #000000"> h,
        h </span><span style="color: #000000">=&gt;</span><span style="color: #000000"> someClass.SomeEvent </span><span style="color: #000000">-=</span><span style="color: #000000"> h);
}
</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
</p>
<p>If your given event doesn’t have the signature of EventHandler&lt;TEventArgs&gt;, you can still take advantage of the Reactive Framework as well.&#160; In this instance, let’s extend the WPF IInputElement to wrap the MouseMove event as an IObservable&lt;Event&lt;MouseEventArgs&gt;&gt;.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">static</span><span style="color: #000000"> IObservable</span><span style="color: #000000">&lt;</span><span style="color: #000000">Event</span><span style="color: #000000">&lt;</span><span style="color: #000000">MouseEventArgs</span><span style="color: #000000">&gt;&gt;</span><span style="color: #000000"> GetMouseMove(
    </span><span style="color: #0000FF">this</span><span style="color: #000000"> IInputElement inputElement)
{
    </span><span style="color: #0000FF">return</span><span style="color: #000000"> Observable.FromEvent(
        (EventHandler</span><span style="color: #000000">&lt;</span><span style="color: #000000">MouseEventArgs</span><span style="color: #000000">&gt;</span><span style="color: #000000"> h) </span><span style="color: #000000">=&gt;</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> MouseEventHandler(h),
        h </span><span style="color: #000000">=&gt;</span><span style="color: #000000"> inputElement.MouseMove </span><span style="color: #000000">+=</span><span style="color: #000000"> h,
        h </span><span style="color: #000000">=&gt;</span><span style="color: #000000"> inputElement.MouseMove </span><span style="color: #000000">-=</span><span style="color: #000000"> h);
}</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>What this does for us behind the scenes is create an IObservable/IObserver to handle the events as they happen.&#160; Each invocation of the event causes the OnNext to be fired with the Event&lt;TEventArgs&gt; argument.&#160; In this case, the OnComplete and OnException are not implemented as part of the IObserver instance.</p>
<h2>An Example</h2>
<p>Let’s create a little example of drawing on a canvas in WPF.&#160; In order to do that, we’ll need not only the MouseMove extension as we have above, but also MouseLeftButtonDown and MouseLeftButtonUp.&#160; Each of those extension methods should follow the same pattern as above in terms of needing the extra parameter to convert the EventHandler&lt;MouseButtonEventArgs&gt; to a MouseButtonEventHandler.&#160; </p>
<p>First, we need to capture position of the mouse during our mouse moves.&#160; After that, we’ll need to zip together the mouse move and another mouse move that is one ahead in order to capture a delta.&#160; Finally, we’ll capture the mouse downs and the mouse deltas until the mouse ups happen.&#160; Listed below is code to make that happen.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">var</span><span style="color: #000000"> mouseMoves </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">from</span><span style="color: #000000"> mm </span><span style="color: #0000FF">in</span><span style="color: #000000"> mainCanvas.GetMouseMove()
                 let location </span><span style="color: #000000">=</span><span style="color: #000000"> mm.EventArgs.GetPosition(mainCanvas)
                 </span><span style="color: #0000FF">select</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> { location.X, location.Y};
                 
</span><span style="color: #0000FF">var</span><span style="color: #000000"> mouseDiffs </span><span style="color: #000000">=</span><span style="color: #000000"> mouseMoves
    .Skip(</span><span style="color: #800080">1</span><span style="color: #000000">)
    .Zip(mouseMoves, (l, r) </span><span style="color: #000000">=&gt;</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> {X1 </span><span style="color: #000000">=</span><span style="color: #000000"> l.X, Y1 </span><span style="color: #000000">=</span><span style="color: #000000"> l.Y, X2 </span><span style="color: #000000">=</span><span style="color: #000000"> r.X, Y2 </span><span style="color: #000000">=</span><span style="color: #000000"> r.Y});

</span><span style="color: #0000FF">var</span><span style="color: #000000"> mouseDrag </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">from</span><span style="color: #000000"> _  </span><span style="color: #0000FF">in</span><span style="color: #000000"> mainCanvas.GetMouseLeftButtonDown()
                </span><span style="color: #0000FF">from</span><span style="color: #000000"> md </span><span style="color: #0000FF">in</span><span style="color: #000000"> mouseDiffs.Until(
                    mainCanvas.GetMouseLeftButtonUp())
                </span><span style="color: #0000FF">select</span><span style="color: #000000"> md;</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>The code should read rather straight forward as we attach to the mainCanvas object in order to draw.&#160; The interesting functions are the mouseDiffs and the mouseDrag.&#160; The mouseDiffs takes the mouseMoves and then skips 1 ahead and zips it with another mouseMoves, and projects to hold both left and right values.&#160; The mouseDrag function takes events from left mouse button down and then from mouseDiffs until the left mouse button up Observable happens.&#160; </p>
<p>Now that we have our mouseDrag, what can we do with it?&#160; Well, let’s go ahead and draw on our canvas:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">var</span><span style="color: #000000"> mouseSub </span><span style="color: #000000">=</span><span style="color: #000000"> mouseDrag.Subscribe(item </span><span style="color: #000000">=&gt;</span><span style="color: #000000">
{
    </span><span style="color: #0000FF">var</span><span style="color: #000000"> line </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> Line
                  {
                      Stroke </span><span style="color: #000000">=</span><span style="color: #000000"> Brushes.LightSteelBlue,
                      X1 </span><span style="color: #000000">=</span><span style="color: #000000"> item.X1,
                      X2 </span><span style="color: #000000">=</span><span style="color: #000000"> item.X2,
                      Y1 </span><span style="color: #000000">=</span><span style="color: #000000"> item.Y1,
                      Y2 </span><span style="color: #000000">=</span><span style="color: #000000"> item.Y2,
                      StrokeThickness </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #800080">5</span><span style="color: #000000">
                  };
    mainCanvas.Children.Add(line);
});</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Our mouseSub subscription creates a new line with our coordinates from zipped mouseDrag Observable and then adds it to our canvas.&#160; Consider how little code was required to make this happen, and try doing that with standard .NET events.&#160; Quite frankly, this kind of solution makes event-based programming using .NET events expressive enough to be usable.</p>
<h2>Conclusion</h2>
<p>As I’ve stated before, the LiveLabs Reactive Framework gives us the ability to harness reactive programming and treat events as the first class citizens they should have been using LINQ expressions and other standard LINQ combinators.&#160; Still, there is much to cover in this series with the standard LINQ combinators, the monadic heritage of this solution and more.</p>
<div class="shr-publisher-182"></div><!-- Start Shareaholic LikeButtonSetBottom Automatic --><!-- End Shareaholic LikeButtonSetBottom Automatic -->											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/matthewpodwysocki/category/c/" title="View all posts in C#" rel="category tag">C#</a>, <a href="http://codebetter.com/matthewpodwysocki/category/event-based-porgramming/" title="View all posts in Event-based Porgramming" rel="category tag">Event-based Porgramming</a>, <a href="http://codebetter.com/matthewpodwysocki/category/reactive-framework/" title="View all posts in Reactive Framework" rel="category tag">Reactive Framework</a>. Bookmark the <a href="http://codebetter.com/matthewpodwysocki/2009/11/13/introduction-to-the-reactive-framework-part-iii/" title="Permalink to Introduction to the Reactive Framework Part III" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/matthewpodwysocki/2009/11/13/introduction-to-the-reactive-framework-part-iii/feed/" title="Comments RSS to Introduction to the Reactive Framework Part III" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-182 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/matthewpodwysocki/2009/11/10/ann-dc-alt-net-11-24-2009-stop-talking-start-teaching-with-jeff-casimir/" rel="prev"><span class="meta-nav">&larr;</span> [ANN] DC ALT.NET – 11/24/2009 “Stop Talking, Start Teaching” with Jeff Casimir</a></div>
					<div class="nav-next"><a href="http://codebetter.com/matthewpodwysocki/2009/11/15/introduction-to-the-reactive-framework-part-iv/" rel="next">Introduction to the Reactive Framework Part IV <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
                    <div id="dsq-content">
            <ul id="dsq-comments">
                    <li id="dsq-comment-435">
                    <div id="dsq-comment-header-435" class="dsq-comment-header">
                        <cite id="dsq-cite-435">
    http://devnonsense.blogspot.com                            <span id="dsq-author-user-435">Martinho Fernandes</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-435" class="dsq-comment-body">
                        <div id="dsq-comment-message-435" class="dsq-comment-message"><p>Great example, Matt.</p>
<p>Now, any idea when these goodies will be out here in the wild? I have been toying with the assembly from the Silverlight Toolkit (after hacking it so it depends on the &#8220;regular&#8221; framework, not the Silverlight one) and I&#8217;m starting to love it.</p>
<p>Looking forward to the monadic heritage post, and something about the combinators that don&#8217;t exist in standard LINQ (Spawn, Reify, Amb, Dispatch&#8230;)</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-436">
                    <div id="dsq-comment-header-436" class="dsq-comment-header">
                        <cite id="dsq-cite-436">
    http://www.dump-split.com                            <span id="dsq-author-user-436">Ivan Maček</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-436" class="dsq-comment-body">
                        <div id="dsq-comment-message-436" class="dsq-comment-message"><p>I really love Reactive Framework’s approach!<br />
When can we expect CTP? <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-437">
                    <div id="dsq-comment-header-437" class="dsq-comment-header">
                        <cite id="dsq-cite-437">
    http://codebetter.com/members/Matthew.Podwysocki/default.aspx                            <span id="dsq-author-user-437">Matthew.Podwysocki</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-437" class="dsq-comment-body">
                        <div id="dsq-comment-message-437" class="dsq-comment-message"><p>@Ivan,</p>
<p>Hopefully soon, but I&#8217;m not the one to answer the question.  Looking forward to the Rx talk at PDC which should go a bit further than my posts have.</p>
<p>Matt</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-438">
                    <div id="dsq-comment-header-438" class="dsq-comment-header">
                        <cite id="dsq-cite-438">
    http://codebetter.com/members/Matthew.Podwysocki/default.aspx                            <span id="dsq-author-user-438">Matthew.Podwysocki</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-438" class="dsq-comment-body">
                        <div id="dsq-comment-message-438" class="dsq-comment-message"><p>@Martinho,</p>
<p>Just as I answered Ivan, it&#8217;s not my place to say, but hopefully soon.  There are only so many things you can do with the Silverlight bits, I totally understand.</p>
<p>Yes, I hope to cover those combinators in the upcoming series.</p>
<p>Matt</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-439">
                    <div id="dsq-comment-header-439" class="dsq-comment-header">
                        <cite id="dsq-cite-439">
    http://www.minddriven.de                            <span id="dsq-author-user-439">Matthias</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-439" class="dsq-comment-body">
                        <div id="dsq-comment-message-439" class="dsq-comment-message"><p>Does anybody know what &#8220;Amb&#8221; means?</p>
<p>Thanks, Matthias</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-440">
                    <div id="dsq-comment-header-440" class="dsq-comment-header">
                        <cite id="dsq-cite-440">
    http://codebetter.com/members/Matthew.Podwysocki/default.aspx                            <span id="dsq-author-user-440">Matthew.Podwysocki</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-440" class="dsq-comment-body">
                        <div id="dsq-comment-message-440" class="dsq-comment-message"><p>@Matthias,</p>
<p>It means that it returns the Observable that reacts first and I&#8217;ll cover that in a later post.</p>
<p>Matt</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-441">
                    <div id="dsq-comment-header-441" class="dsq-comment-header">
                        <cite id="dsq-cite-441">
                                <span id="dsq-author-user-441">Robert Taylor</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-441" class="dsq-comment-body">
                        <div id="dsq-comment-message-441" class="dsq-comment-message"><p>I actually built a WPF app using .NET events just to see what it took. I was planning to maybe show this to others along with the Rx Version. However, there seem to be a few errors in what you have written (which may be related to a version change). </p>
<p>IObservable<event <MouseEventArgs>>  should be<br />
IObservable<ievent <MouseEventArgs>></p>
<p>and mouseDiffs.Until doesn&#8217;t compile. It seems as if this should be mouseDiffs.TakeUntil.</p>
<p>Do you have a working project that you could make available?</ievent></event></p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-442">
                    <div id="dsq-comment-header-442" class="dsq-comment-header">
                        <cite id="dsq-cite-442">
    http://codebetter.com/members/Matthew.Podwysocki/default.aspx                            <span id="dsq-author-user-442">Matthew.Podwysocki</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-442" class="dsq-comment-body">
                        <div id="dsq-comment-message-442" class="dsq-comment-message"><p>@Robert,</p>
<p>Yes, this is old code as Event became IEvent and Until became TakeUntil.</p>
<p>Matt</p>
</div>
                    </div>
                </li>
                </ul>
        </div>
    </div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://codebetter.com/matthewpodwysocki/2009/11/13/introduction-to-the-reactive-framework-part-iii/';
    var disqus_identifier = '182 /blogs/matthew.podwysocki/archive/2009/11/12/introduction-to-the-reactive-framework-part-iii.aspx';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'matthewpodwysocki';
    var disqus_title = "Introduction to the Reactive Framework Part III";
        var disqus_config = function () {
        var config = this; // Access to the config object

        /* 
           All currently supported events:
            * preData — fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            DISQUS.request.get('?cf_action=sync_comments&post_id=182');
        });
                    };
    var facebookXdReceiverPath = 'http://cdn1.codebetter.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
        ],
        'trackback_url': "http:\/\/codebetter.com\/matthewpodwysocki\/2009\/11\/13\/introduction-to-the-reactive-framework-part-iii\/trackback\/"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.67';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29416);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=2782afb'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29416&amp;n=2782afb' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29417);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=e94cea6'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29417&amp;n=e94cea6' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29418);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=9ba3022'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29418&amp;n=9ba3022' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29419);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=f467b52'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29419&amp;n=f467b52' /></a></noscript>
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(220407);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=68b8307'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=220407&amp;n=68b8307' /></a></noscript>				
				
				<ul class="xoxo">		
									</ul>	
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29421);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=3f8e353'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29421&amp;n=3f8e353' /></a></noscript>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="http://red-gate.com/">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="http://telerik.com">Telerik .NET Tools</a></li>
<li><a href="http://jetbrains.com/resharper/">JetBrains - ReSharper</a></li>
<li><a href="http://scootersoftware.com">Beyond Compare</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a></li>
<li><a href="http://umbraco.com" target="_blank">Umbraco</a></li>
<li><a href="http://nservicebus.com" target="_blank">NServiceBus</a></li>
<li><a href="http://ravendb.net" target="_blank">RavenDb</a></li>
<li><a href="http://www.websequencediagrams.com/" target="_blank">Web Sequence Diagrams</a></li>
	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '12<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPython.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = true; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>

<script type='text/javascript'>//<![CDATA[
    if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.4.2.min.js' type='text/javascript' %3E%3C/script%3E"));
    }//]]></script>
<script type='text/javascript' language='Javascript' src='http://s1.lqcdn.com/m.min.js?dt=2.3.110202.1'></script>
<script type='text/javascript' language='Javascript'> if(jQuery.LqmAds)jQuery.LqmAds();</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.700 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2012-11-09 20:50:23 -->
<!-- super cache -->