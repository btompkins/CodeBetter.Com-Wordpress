<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Functional Solution for the Shortest Path Problem | Matthew Podwysocki</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/matthewpodwysocki/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css?v=3912785705" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js?ver=3.4.2'></script>
<script type='text/javascript' src='http://dtym7iokkjlif.cloudfront.net/dough/1.0/recipe.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/matthewpodwysocki/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Haskell and Collective Intelligence' href='http://codebetter.com/matthewpodwysocki/2009/04/17/haskell-and-collective-intelligence/' />
<link rel='next' title='[ANN] DC ALT.NET (4/29/2009) – Refactoring with George Dinwiddie' href='http://codebetter.com/matthewpodwysocki/2009/04/21/ann-dc-alt-net-4-29-2009-refactoring-with-george-dinwiddie/' />
<meta name="generator" content="WordPress 3.4.2" />
<link rel='shortlink' href='http://codebetter.com/matthewpodwysocki/?p=129' />

<!-- All in One SEO Pack 1.6.13.2 by Michael Torbert of Semper Fi Web Design[83,160] -->
<link rel="canonical" href="http://codebetter.com/matthewpodwysocki/2009/04/21/functional-solution-for-the-shortest-path-problem/" />
<!-- /all in one seo pack -->
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.3.3" type="text/css" media="screen" />

<!-- Start Shareaholic OgTags -->

	<!-- Shareaholic Notice: There is neither a featured nor gallery image set -->

<!-- End Shareaholic OgTags -->

<meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/dc168cf39155d7b5d39f696ca94d5980.js?v=5302176208">/*Is Cache!*/</script>
                	
	<script type='text/javascript' src='http://d1.openx.org/spcjs.php?id=7744&amp;target=_blank'></script>
	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>
<!-- BuySellAds Ad Code -->
<script type="text/javascript">
(function(){
  var bsa = document.createElement('script');
     bsa.type = 'text/javascript';
     bsa.async = true;
     bsa.src = 'http://s3.buysellads.com/ac/bsa.js';
  (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);
})();
</script>
<!-- End BuySellAds Ad Code -->
</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">
			<!-- BuySellAds Zone Code -->
<div id="bsap_1276080" class="bsarocks bsap_4fe632babdccc2b4b049e4f08cc3c549"></div>
<!-- End BuySellAds Zone Code --></div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-129" class="post-129 post type-post status-publish format-standard hentry category-uncategorized">
					<h1 class="entry-title">Functional Solution for the Shortest Path Problem</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/matthewpodwysocki/author/matthewpodwysocki/" title="View all posts by Matthew Podwysocki">Matthew Podwysocki</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/matthewpodwysocki/2009/04/21/functional-solution-for-the-shortest-path-problem/" title="5:01 am" rel="bookmark"><span class="entry-date">April 21, 2009</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/matthewpodwysocki/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/matthewpodwysocki/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><!-- Start Shareaholic LikeButtonSetTop Automatic --><!-- End Shareaholic LikeButtonSetTop Automatic --><p>As part of my dive into the <a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2009/04/11/functional-programming-and-collective-intelligence-iv.aspx">Collective Intelligence series</a>, I’ve found myself many times taking code that was written in an imperative coding style and moving it towards a pure functional style with immutable data structures instead of ones, the application of functions instead of for loops (which is an upcoming post), and the elimination of state.&#160; This was also a major part of my talk this past weekend at the Philly.NET code camp on Functional Programming in .NET.</p>
<p>Recently, <a href="http://blogs.msdn.com/chrsmith/">Chris Smith</a>, of the F# team fame, wrote a post on <a href="http://blogs.msdn.com/chrsmith/archive/2009/04/08/f-and-the-pfx-round-1.aspx">F# and the PFX Round 1</a> in which he tackles the problem of solving the <a href="http://en.wikipedia.org/wiki/Shortest_path_problem">Shortest Path Problem</a>.&#160; I had <a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2009/04/13/from-imperative-to-functional-transposing-maps.aspx">an earlier post on the subject</a> when talking about transposing maps so that we can change a person centric map to an item one, and to also fill in the matrix of cities and distances.&#160; But, back to the problem at hand, Chris first tackles the problem using C# and its overly verbose syntax for the problem at hand, and then proceeds to solve it using F# and the ConcurrentDictionary which is part of the upcoming Parallel Extensions for .NET in the 4.0 CLR release.&#160; </p>
<p>Stepping back for a second, I thought to myself, the ConcurrentDictionary being a mutable collection, I decided to see if I could rewrite this using nothing but immutable collections and the write in a pure way so that IO does not take place, and instead returns the answer.&#160; </p>
<h2>The Rewrite</h2>
<p>One thing I like to do is sometimes go to Haskell as the language of choice in order to solve the problem functionally.&#160; Languages such as F# and Scala are more pragmatic in terms of using imperative and object oriented constructs, but my goal here is to solve in a completely functional manner without any “cheating”.&#160; </p>
<p>The first task was to transpose and combine the map so that I fill out the matrix of connections between cities and distances between them.&#160; In order to do this, we must fold the outer map with a seed of the incoming map, then fold the inner map, and then transpose the values onto the new outgoing map.&#160; Below is the code implementation of that:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">import</span><span style="color: #000000"> Prelude </span><span style="color: #0000FF">hiding</span><span style="color: #000000"> (lookup)
</span><span style="color: #0000FF">import</span><span style="color: #000000"> Data.Map(Map(..), (</span><span style="color: #000000">!</span><span style="color: #000000">), empty, findWithDefault, foldWithKey, fromList, insert, lookup)
 
</span><span style="color: #0000FF">data</span><span style="color: #000000"> City </span><span style="color: #000000">=</span><span style="color: #000000"> Boise
          </span><span style="color: #000000">|</span><span style="color: #000000"> LosAngeles
          </span><span style="color: #000000">|</span><span style="color: #000000"> NewYork
          </span><span style="color: #000000">|</span><span style="color: #000000"> Seattle
          </span><span style="color: #000000">|</span><span style="color: #000000"> StLouis
          </span><span style="color: #000000">|</span><span style="color: #000000"> Phoenix
          </span><span style="color: #000000">|</span><span style="color: #000000"> Boston
          </span><span style="color: #000000">|</span><span style="color: #000000"> Chicago
          </span><span style="color: #000000">|</span><span style="color: #000000"> Denver
          </span><span style="color: #0000FF">deriving</span><span style="color: #000000"> (Show, Eq, Ord)
          
</span><span style="color: #0000FF">type</span><span style="color: #000000"> CityMatrix </span><span style="color: #000000">=</span><span style="color: #000000"> Map City (Map City Int)
          
transposeCombine :: (Ord k) </span><span style="color: #000000">=&gt;</span><span style="color: #000000"> Map k (Map k a) </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000"> Map k (Map k a)
transposeCombine m </span><span style="color: #000000">=</span><span style="color: #000000">
  foldWithKey transpose m m
    </span><span style="color: #0000FF">where</span><span style="color: #000000"> transpose k1 m</span><span style="color: #800000">'</span><span style="color: #800000"> acc =</span><span style="color: #800000">
</span><span style="color: #000000">            </span><span style="color: #0000FF">let</span><span style="color: #000000"> transposeInner k2 v acc</span><span style="color: #800000">'</span><span style="color: #800000"> =</span><span style="color: #800000">
</span><span style="color: #000000">                 insert k2 (insert k1 v $ findWithDefault empty k2 acc</span><span style="color: #800000">'</span><span style="color: #800000">) acc</span><span style="color: #800000">'</span><span style="color: #000000">
            </span><span style="color: #0000FF">in</span><span style="color: #000000"> foldWithKey transposeInner acc m</span><span style="color: #800000">'</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Now that we have defined the transposeCombine, we can now take our matrix and fill it out completely with our given cities and distances between the waypoints.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">distanceBetweenCities :: CityMatrix
distanceBetweenCities </span><span style="color: #000000">=</span><span style="color: #000000">
  transposeCombine $
  fromList
    [
        (Boise, fromList [(Seattle, </span><span style="color: #800080">496</span><span style="color: #000000">),(Denver, </span><span style="color: #800080">830</span><span style="color: #000000">),(Chicago, </span><span style="color: #800080">1702</span><span style="color: #000000">)]),
        (Seattle, fromList [(LosAngeles, </span><span style="color: #800080">1141</span><span style="color: #000000">),(Denver, </span><span style="color: #800080">1321</span><span style="color: #000000">)]),
        (LosAngeles, fromList [(Denver, </span><span style="color: #800080">1022</span><span style="color: #000000">),(Phoenix, </span><span style="color: #800080">371</span><span style="color: #000000">)]),
        (Phoenix, fromList [(Denver, </span><span style="color: #800080">809</span><span style="color: #000000">),(StLouis, </span><span style="color: #800080">1504</span><span style="color: #000000">)]),
        (Denver, fromList [(StLouis, </span><span style="color: #800080">588</span><span style="color: #000000">),(Chicago, </span><span style="color: #800080">1009</span><span style="color: #000000">)]),
        (Chicago, fromList [(NewYork, </span><span style="color: #800080">811</span><span style="color: #000000">),(Boston, </span><span style="color: #800080">986</span><span style="color: #000000">)]),
        (StLouis, fromList [(Chicago, </span><span style="color: #800080">300</span><span style="color: #000000">)]),
        (Boston, fromList [(StLouis, </span><span style="color: #800080">986</span><span style="color: #000000">)]),
        (NewYork, fromList [(Boston, </span><span style="color: #800080">211</span><span style="color: #000000">)])
    ]</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>When we call the transpose inside of our distanceBetweenCities function which for example will ensure that LosAngeles will now be linked to Denver, Phoenix and Seattle.&#160; Now that we have our complete matrix, we can now define our shortestPathBetween function which takes two cities and will return a tuple of the total distance traveled and a list of cities visited on our journey.&#160; As we visit each city, we determine if we’ve been there before, and if we haven’t, we’ll add it to our list, and if not, we’ll determine whether it is the optimal distance.&#160; If the distance is the most optimal, we’ll add, else we’ll continue on with the folding through the collection.&#160; Below is a representation in Haskell on how to do this.&#160; You’ll notice the bang notation for indexes on a map.&#160; For lists, that notation shouldn’t usually be used, but for maps is quite acceptable.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">shortestPathBetween :: City </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000"> City </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000"> (Int, [City])
shortestPathBetween startCity endCity </span><span style="color: #000000">=</span><span style="color: #000000">
  shortestPaths </span><span style="color: #000000">!</span><span style="color: #000000"> endCity
    </span><span style="color: #0000FF">where</span><span style="color: #000000"> shortestPaths </span><span style="color: #000000">=</span><span style="color: #000000"> searchForShortestPath startCity </span><span style="color: #800080">0</span><span style="color: #000000"> [] empty
          searchForShortestPath currentCity distanceSoFar citiesVisitedSoFar accMap </span><span style="color: #000000">=</span><span style="color: #000000">
            </span><span style="color: #008000">--</span><span style="color: #008000"> Go through each destination</span><span style="color: #008000">
</span><span style="color: #000000">            </span><span style="color: #0000FF">let</span><span style="color: #000000"> visitDestinations m </span><span style="color: #000000">=</span><span style="color: #000000">
                  foldWithKey accSearch m $ distanceBetweenCities </span><span style="color: #000000">!</span><span style="color: #000000"> currentCity
                    </span><span style="color: #0000FF">where</span><span style="color: #000000"> accSearch city distance </span><span style="color: #000000">=</span><span style="color: #000000">
                            searchForShortestPath city (distance </span><span style="color: #000000">+</span><span style="color: #000000"> distanceSoFar) (citiesVisitedSoFar </span><span style="color: #000000">++</span><span style="color: #000000"> [city])
                </span><span style="color: #008000">--</span><span style="color: #008000"> Insert a destination</span><span style="color: #008000">
</span><span style="color: #000000">                insertDestination </span><span style="color: #000000">=</span><span style="color: #000000"> visitDestinations $ insert currentCity (distanceSoFar, citiesVisitedSoFar) accMap
            
            </span><span style="color: #008000">--</span><span style="color: #008000"> Is this an optimal route?</span><span style="color: #008000">
</span><span style="color: #000000">            </span><span style="color: #0000FF">in</span><span style="color: #000000"> </span><span style="color: #0000FF">case</span><span style="color: #000000"> M.lookup currentCity accMap </span><span style="color: #0000FF">of</span><span style="color: #000000">
              Nothing </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000"> insertDestination
              Just (shortestKnownPath, _) </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">
                         </span><span style="color: #0000FF">case</span><span style="color: #000000"> distanceSoFar </span><span style="color: #000000">&lt;</span><span style="color: #000000"> shortestKnownPath </span><span style="color: #0000FF">of</span><span style="color: #000000">
                           True </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000"> insertDestination
                           _ </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000"> accMap</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Given this function, we can now calculate the distance between Seattle and New York such as the following in GHCi:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">*</span><span style="color: #000000">Main</span><span style="color: #000000">&gt;</span><span style="color: #000000"> shortestPathBetween Seattle NewYork
(</span><span style="color: #800080">3009</span><span style="color: #000000">,[Boise,Chicago,NewYork])
</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>But I don’t want to leave the original language out of a possible solution as well, so let’s revisit the solution using F# as well.&#160; As always, you can find the complete code <a href="http://gist.github.com/98840">here</a>.</p>
<h2>The F# Solution</h2>
</p>
</p>
<p>As above, we need to define the the transposeCombine function.&#160; In Haskell, I made judicious use of the let in and where as to not need any lambda expressions to keep my code concise and highly readable.&#160; When implementing in F#, it’s important to use operators such as the forward or the tupled forward to help us make the code a bit more concise.&#160; </p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">#light</span><span style="color: #000000">
 
[</span><span style="color: #000000">&lt;</span><span style="color: #000000">AutoOpen</span><span style="color: #000000">&gt;</span><span style="color: #000000">]
</span><span style="color: #0000FF">module</span><span style="color: #000000"> Operators </span><span style="color: #000000">=</span><span style="color: #000000">
  </span><span style="color: #0000FF">let</span><span style="color: #000000"> (</span><span style="color: #000000">||&gt;</span><span style="color: #000000">) (x, y) f </span><span style="color: #000000">=</span><span style="color: #000000"> f x y
 
</span><span style="color: #0000FF">module</span><span style="color: #000000"> Map </span><span style="color: #000000">=</span><span style="color: #000000">
  </span><span style="color: #0000FF">let</span><span style="color: #000000"> transposeCombine m </span><span style="color: #000000">=</span><span style="color: #000000">
    (m, m) </span><span style="color: #000000">||&gt;</span><span style="color: #000000"> Map.fold_left (</span><span style="color: #0000FF">fun</span><span style="color: #000000"> acc k1 m</span><span style="color: #800000">'</span><span style="color: #800000"> -&gt;</span><span style="color: #800000">
</span><span style="color: #000000">      (acc, m</span><span style="color: #800000">'</span><span style="color: #800000">) ||&gt; Map.fold_left (fun acc</span><span style="color: #800000">'</span><span style="color: #000000"> k2 v </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">
        acc</span><span style="color: #800000">'
</span><span style="color: #000000">        </span><span style="color: #000000">|&gt;</span><span style="color: #000000"> Map.add k2 (Map.add k1 v (defaultArg (acc</span><span style="color: #800000">'</span><span style="color: #800000"> |&gt; Map.tryfind k2) Map.empty))</span><span style="color: #800000">
</span><span style="color: #000000">    ))
 
</span><span style="color: #0000FF">type</span><span style="color: #000000"> City </span><span style="color: #000000">=</span><span style="color: #000000">
    </span><span style="color: #000000">|</span><span style="color: #000000"> Boise   </span><span style="color: #000000">|</span><span style="color: #000000"> LosAngeles </span><span style="color: #000000">|</span><span style="color: #000000"> NewYork </span><span style="color: #000000">|</span><span style="color: #000000"> Seattle
    </span><span style="color: #000000">|</span><span style="color: #000000"> StLouis </span><span style="color: #000000">|</span><span style="color: #000000"> Phoenix    </span><span style="color: #000000">|</span><span style="color: #000000"> Boston  </span><span style="color: #000000">|</span><span style="color: #000000"> Chicago
    </span><span style="color: #000000">|</span><span style="color: #000000"> Denver</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Now that we have this in place, we can now concentrate on the implementation of our shortestPathBetween function which once again, takes a start city and end city and returns a tuple of total distance and a list of all cities visited.&#160; The only real differences between the F# version and Haskell is the elimination of the lambda expressions in the Haskell version and the reordering using the let/in and where statements.&#160; The rest should stay the same in terms of name and intent:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">let</span><span style="color: #000000"> shortestPathBetween startCity endCity </span><span style="color: #000000">=</span><span style="color: #000000">
  </span><span style="color: #0000FF">let</span><span style="color: #000000"> rec searchForShortestPath currentCity distanceSoFar citiesVisitedSoFar accMap </span><span style="color: #000000">=</span><span style="color: #000000">
    </span><span style="color: #0000FF">let</span><span style="color: #000000"> visitDestinations m </span><span style="color: #000000">=</span><span style="color: #000000">
      (m, distanceBetweenCities.[currentCity])
        </span><span style="color: #000000">||&gt;</span><span style="color: #000000"> Map.fold_left
          (</span><span style="color: #0000FF">fun</span><span style="color: #000000"> acc city distance </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">
             searchForShortestPath city (distance </span><span style="color: #000000">+</span><span style="color: #000000"> distanceSoFar) (citiesVisitedSoFar @ [city]) acc)
 
    </span><span style="color: #0000FF">match</span><span style="color: #000000"> Map.tryfind currentCity accMap </span><span style="color: #0000FF">with</span><span style="color: #000000">
    </span><span style="color: #000000">|</span><span style="color: #000000"> None </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000"> accMap </span><span style="color: #000000">|&gt;</span><span style="color: #000000"> Map.add currentCity (distanceSoFar, citiesVisitedSoFar) </span><span style="color: #000000">|&gt;</span><span style="color: #000000"> visitDestinations
    </span><span style="color: #000000">|</span><span style="color: #000000"> Some x </span><span style="color: #0000FF">-&gt;</span><span style="color: #000000">
        </span><span style="color: #0000FF">let</span><span style="color: #000000"> (shortestKnownPath, _) </span><span style="color: #000000">=</span><span style="color: #000000"> x
        </span><span style="color: #0000FF">if</span><span style="color: #000000"> distanceSoFar </span><span style="color: #000000">&lt;</span><span style="color: #000000"> shortestKnownPath </span><span style="color: #0000FF">then</span><span style="color: #000000">
          accMap </span><span style="color: #000000">|&gt;</span><span style="color: #000000"> Map.add currentCity (distanceSoFar, citiesVisitedSoFar) </span><span style="color: #000000">|&gt;</span><span style="color: #000000"> visitDestinations
        </span><span style="color: #0000FF">else</span><span style="color: #000000"> accMap
 
  </span><span style="color: #0000FF">let</span><span style="color: #000000"> shortestPaths </span><span style="color: #000000">=</span><span style="color: #000000"> searchForShortestPath startCity </span><span style="color: #800080">0</span><span style="color: #000000"> [] Map.empty
  shortestPaths.[endCity]</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>So, as you can see, we can create rather concise algorithms for finding the shortest distance between the two cities using immutable data structures, the application of functions, and the lack of state.&#160; You can find the full source for the F# solution <a href="http://gist.github.com/102148">here</a>.</p>
<h2>Conclusion</h2>
<p>Where does this leave us?&#160; Well, because we’re using immutable data structures, it can lead to any number of optimizations.&#160; This is not to say that automatically because we’re having no side effects and immutable data structures, that we’ll automatically be able to parallelize our functions, as some algorithms may be harder than others to accomplish that task of mass parallelization.&#160; But, it does give us a path forward for thinking about these problems in new ways.&#160; Of course there are other algorithms to explore in this area as well which includes <a href="http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm">Dijkstra’s algorithm</a>, <a href="http://en.wikipedia.org/wiki/A*_search_algorithm">A*</a>, <a href="http://en.wikipedia.org/wiki/Floyd-Warshall_algorithm">Floyd-Warshall</a> among others.</p>
<div class="shr-publisher-129"></div><!-- Start Shareaholic LikeButtonSetBottom Automatic --><!-- End Shareaholic LikeButtonSetBottom Automatic -->											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/matthewpodwysocki/category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>. Bookmark the <a href="http://codebetter.com/matthewpodwysocki/2009/04/21/functional-solution-for-the-shortest-path-problem/" title="Permalink to Functional Solution for the Shortest Path Problem" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/matthewpodwysocki/2009/04/21/functional-solution-for-the-shortest-path-problem/feed/" title="Comments RSS to Functional Solution for the Shortest Path Problem" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-129 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/matthewpodwysocki/2009/04/17/haskell-and-collective-intelligence/" rel="prev"><span class="meta-nav">&larr;</span> Haskell and Collective Intelligence</a></div>
					<div class="nav-next"><a href="http://codebetter.com/matthewpodwysocki/2009/04/21/ann-dc-alt-net-4-29-2009-refactoring-with-george-dinwiddie/" rel="next">[ANN] DC ALT.NET (4/29/2009) – Refactoring with George Dinwiddie <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
                    <div id="dsq-content">
            <ul id="dsq-comments">
                    <li id="dsq-comment-322">
                    <div id="dsq-comment-header-322" class="dsq-comment-header">
                        <cite id="dsq-cite-322">
    http://www.commongenius.com                            <span id="dsq-author-user-322">David Nelson</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-322" class="dsq-comment-body">
                        <div id="dsq-comment-message-322" class="dsq-comment-message"><p>Do you have a link to the full F# source? The F# solution is missing the definitions of CityMatrix and distanceBetweenCities, and I don&#8217;t know either language well enough to translate between them.</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-323">
                    <div id="dsq-comment-header-323" class="dsq-comment-header">
                        <cite id="dsq-cite-323">
    http://codebetter.com/members/Matthew.Podwysocki/default.aspx                            <span id="dsq-author-user-323">Matthew.Podwysocki</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-323" class="dsq-comment-body">
                        <div id="dsq-comment-message-323" class="dsq-comment-message"><p>@David</p>
<p>Sure, it can be found here:<br />
<a href="http://gist.github.com/102148" rel="nofollow">http://gist.github.com/102148</a></p>
<p>Updating the post now.</p>
<p>Matt</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-324">
                    <div id="dsq-comment-header-324" class="dsq-comment-header">
                        <cite id="dsq-cite-324">
                                <span id="dsq-author-user-324">David Barr</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-324" class="dsq-comment-body">
                        <div id="dsq-comment-message-324" class="dsq-comment-message"><p>This comes very late, I know.<br />
Have you tried using the shortest path implementation in FGL/Haskell?<br />
<a href="http://hackage.haskell.org/packages/archive/fgl/5.4.2.2/doc/html/Data-Graph-Inductive-Query-SP.html" rel="nofollow">http://hackage.haskell.org/packages/archive/fgl/5.4.2.2/doc/html/Data-Graph-Inductive-Query-SP.html</a></p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-325">
                    <div id="dsq-comment-header-325" class="dsq-comment-header">
                        <cite id="dsq-cite-325">
    http://codebetter.com/members/Matthew.Podwysocki/default.aspx                            <span id="dsq-author-user-325">Matthew.Podwysocki</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-325" class="dsq-comment-body">
                        <div id="dsq-comment-message-325" class="dsq-comment-message"><p>@David,</p>
<p>Thanks!  Looks like it could be useful.</p>
<p>Matt</p>
</div>
                    </div>
                </li>
                </ul>
        </div>
    </div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://codebetter.com/matthewpodwysocki/2009/04/21/functional-solution-for-the-shortest-path-problem/';
    var disqus_identifier = '129 /blogs/matthew.podwysocki/archive/2009/04/21/functional-solution-for-the-shortest-path-problem.aspx';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'matthewpodwysocki';
    var disqus_title = "Functional Solution for the Shortest Path Problem";
        var disqus_config = function () {
        var config = this; // Access to the config object

        /* 
           All currently supported events:
            * preData — fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            DISQUS.request.get('?cf_action=sync_comments&post_id=129');
        });
                    };
    var facebookXdReceiverPath = 'http://cdn1.codebetter.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
        ],
        'trackback_url': "http:\/\/codebetter.com\/matthewpodwysocki\/2009\/04\/21\/functional-solution-for-the-shortest-path-problem\/trackback\/"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.67';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29416);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=2782afb'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29416&amp;n=2782afb' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29417);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=e94cea6'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29417&amp;n=e94cea6' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29418);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=9ba3022'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29418&amp;n=9ba3022' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29419);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=f467b52'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29419&amp;n=f467b52' /></a></noscript>
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(220407);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=68b8307'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=220407&amp;n=68b8307' /></a></noscript>				
				
				<ul class="xoxo">		
									</ul>	
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29421);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=3f8e353'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29421&amp;n=3f8e353' /></a></noscript>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="http://red-gate.com/">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="http://telerik.com">Telerik .NET Tools</a></li>
<li><a href="http://jetbrains.com/resharper/">JetBrains - ReSharper</a></li>
<li><a href="http://scootersoftware.com">Beyond Compare</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a></li>
<li><a href="http://umbraco.com" target="_blank">Umbraco</a></li>
<li><a href="http://nservicebus.com" target="_blank">NServiceBus</a></li>
<li><a href="http://ravendb.net" target="_blank">RavenDb</a></li>
<li><a href="http://www.websequencediagrams.com/" target="_blank">Web Sequence Diagrams</a></li>
	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '12<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPython.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = true; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>

<script type='text/javascript'>//<![CDATA[
    if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.4.2.min.js' type='text/javascript' %3E%3C/script%3E"));
    }//]]></script>
<script type='text/javascript' language='Javascript' src='http://s1.lqcdn.com/m.min.js?dt=2.3.110202.1'></script>
<script type='text/javascript' language='Javascript'> if(jQuery.LqmAds)jQuery.LqmAds();</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.449 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2012-11-09 19:12:34 -->
<!-- super cache -->