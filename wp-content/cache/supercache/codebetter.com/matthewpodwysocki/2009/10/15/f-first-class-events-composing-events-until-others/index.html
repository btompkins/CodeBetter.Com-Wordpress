<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>F# First Class Events – Composing Events Until Others | Matthew Podwysocki</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/matthewpodwysocki/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css?v=3912785705" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js?ver=3.4.2'></script>
<script type='text/javascript' src='http://dtym7iokkjlif.cloudfront.net/dough/1.0/recipe.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/matthewpodwysocki/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Introducing the Reactive Framework Part I' href='http://codebetter.com/matthewpodwysocki/2009/10/14/introducing-the-reactive-framework-part-i/' />
<link rel='next' title='[ANN] DC ALT.NET 10/22/2009 – MongoDB with David James' href='http://codebetter.com/matthewpodwysocki/2009/10/16/ann-dc-alt-net-10-22-2009-mongodb-with-david-james/' />
<meta name="generator" content="WordPress 3.4.2" />
<link rel='shortlink' href='http://codebetter.com/matthewpodwysocki/?p=176' />

<!-- All in One SEO Pack 1.6.13.2 by Michael Torbert of Semper Fi Web Design[83,166] -->
<link rel="canonical" href="http://codebetter.com/matthewpodwysocki/2009/10/15/f-first-class-events-composing-events-until-others/" />
<!-- /all in one seo pack -->
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.3.3" type="text/css" media="screen" />

<!-- Start Shareaholic OgTags -->

	<!-- Shareaholic Notice: There is neither a featured nor gallery image set -->

<!-- End Shareaholic OgTags -->

<meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/dc168cf39155d7b5d39f696ca94d5980.js?v=5302176208">/*Is Cache!*/</script>
                	
	<script type='text/javascript' src='http://d1.openx.org/spcjs.php?id=7744&amp;target=_blank'></script>
	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>
<!-- BuySellAds Ad Code -->
<script type="text/javascript">
(function(){
  var bsa = document.createElement('script');
     bsa.type = 'text/javascript';
     bsa.async = true;
     bsa.src = 'http://s3.buysellads.com/ac/bsa.js';
  (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);
})();
</script>
<!-- End BuySellAds Ad Code -->
</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">
			<!-- BuySellAds Zone Code -->
<div id="bsap_1276080" class="bsarocks bsap_4fe632babdccc2b4b049e4f08cc3c549"></div>
<!-- End BuySellAds Zone Code --></div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-176" class="post-176 post type-post status-publish format-standard hentry category-event-based-porgramming category-f category-functional-programming category-reactive-framework">
					<h1 class="entry-title">F# First Class Events – Composing Events Until Others</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/matthewpodwysocki/author/matthewpodwysocki/" title="View all posts by Matthew Podwysocki">Matthew Podwysocki</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/matthewpodwysocki/2009/10/15/f-first-class-events-composing-events-until-others/" title="5:43 am" rel="bookmark"><span class="entry-date">October 15, 2009</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/matthewpodwysocki/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/matthewpodwysocki/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><!-- Start Shareaholic LikeButtonSetTop Automatic --><!-- End Shareaholic LikeButtonSetTop Automatic --><p>After <a href="http://weblogs.asp.net/podwysocki/archive/2009/10/14/introducing-the-reactive-framework-part-i.aspx#7229940">a comment on my last post</a> in regards to First Class Events in F#, I thought I’d revisit them briefly before going back to the <a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2009/10/14/introducing-the-reactive-framework-part-i.aspx">Reactive Framework series</a>.&#160; In particular, this comment was in regards to implementing the until combinator using F# First Class Events.&#160; As part of my hacking during this series, I came across a rather identical solution to the one that was posted, so I thought it’d be worth exploring.</p>
<h2>Implementing Until</h2>
<p>The idea behind the until event combinator is to that we will return values from our event until any notification from the other event occurs.&#160; In order to accomplish this, we must subscribe to the other event and if it has fired, then we reset a flag to not fire.&#160; We then have to subscribe to the main event and only trigger when the flag is set to true.&#160; Let’s look through how this code might look.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterSmartContent">
<pre style="background-color: #ffffff;overflow: auto"><span style="color: #0000ff">module</span><span style="color: #000000"> Event </span><span style="color: #000000">=</span><span style="color: #000000">

 </span><span style="color: #0000ff">let</span><span style="color: #000000"> until (other: IEvent</span><span style="color: #000000">&lt;</span><span style="color: #000000">_,_</span><span style="color: #000000">&gt;</span><span style="color: #000000">) (source: IEvent</span><span style="color: #000000">&lt;</span><span style="color: #000000">_,_</span><span style="color: #000000">&gt;</span><span style="color: #000000">) </span><span style="color: #000000">=</span><span style="color: #000000">
   </span><span style="color: #0000ff">let</span><span style="color: #000000"> event </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000ff">new</span><span style="color: #000000"> Event</span><span style="color: #000000">&lt;</span><span style="color: #000000">_</span><span style="color: #000000">&gt;</span><span style="color: #000000">()
   </span><span style="color: #0000ff">let</span><span style="color: #000000"> fire </span><span style="color: #000000">=</span><span style="color: #000000"> ref </span><span style="color: #0000ff">true</span><span style="color: #000000">
   other .Add(</span><span style="color: #0000ff">fun</span><span style="color: #000000"> _    </span><span style="color: #0000ff">-&gt;</span><span style="color: #000000"> fire :</span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000ff">false</span><span style="color: #000000">)
   source.Add(</span><span style="color: #0000ff">fun</span><span style="color: #000000"> args </span><span style="color: #0000ff">-&gt;</span><span style="color: #000000"> </span><span style="color: #0000ff">if</span><span style="color: #000000"> </span><span style="color: #000000">!</span><span style="color: #000000">fire </span><span style="color: #0000ff">then</span><span style="color: #000000"> event.Trigger args)
   event.Publish</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>In order for us to modify the fire flag, we must use a ref cell.&#160; The reason being is that local mutables are always stack allocated which is why you cannot capture them inside a closure.&#160; One comment that was made about this solution was that we added two subscriptions for creating this single event.&#160; That indeed can be a problem as Tess Ferrandez points out about <a href="http://blogs.msdn.com/tess/archive/2006/01/23/net-memory-leak-case-study-the-event-handlers-that-made-the-memory-baloon.aspx">event handlers that made the memory balloon</a> where you hook up to static event handlers that long outlive pages.&#160; That’s not necessarily something we’ll address here, and it’s rare that we’ll run into this situation.</p>
<p>Now that we have this until defined, what can we do with it?&#160; In my previous post, we used the WebClient to track the progress changed of a download until the download has completed.&#160; We’ll use that same logic here using our F# first class events.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterSmartContent">
<pre style="background-color: #ffffff;overflow: auto"><span style="color: #0000ff">open</span><span style="color: #000000"> System
</span><span style="color: #0000ff">open</span><span style="color: #000000"> System.Net

</span><span style="color: #0000ff">type</span><span style="color: #000000"> IDelegateEvent</span><span style="color: #000000">&lt;</span><span style="color: #800000">'</span><span style="color: #800000">Del when </span><span style="color: #800000">'</span><span style="color: #000000">Del :</span><span style="color: #000000">&gt;</span><span style="color: #000000"> Delegate </span><span style="color: #000000">&gt;</span><span style="color: #000000"> </span><span style="color: #0000ff">with</span><span style="color: #000000">
  </span><span style="color: #0000ff">member</span><span style="color: #000000"> this.Subscribe(d) </span><span style="color: #000000">=</span><span style="color: #000000">
    this.AddHandler(d)
    { </span><span style="color: #0000ff">new</span><span style="color: #000000"> IDisposable </span><span style="color: #0000ff">with</span><span style="color: #000000">
        </span><span style="color: #0000ff">member</span><span style="color: #000000"> disp.Dispose() </span><span style="color: #000000">=</span><span style="color: #000000">
          this.RemoveHandler(d) }

</span><span style="color: #0000ff">let</span><span style="color: #000000"> wc </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000ff">new</span><span style="color: #000000"> WebClient(Credentials </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000ff">new</span><span style="color: #000000"> NetworkCredential(</span><span style="color: #800000">&quot;</span><span style="color: #800000">foo</span><span style="color: #800000">&quot;</span><span style="color: #000000">,</span><span style="color: #800000">&quot;</span><span style="color: #800000">bar</span><span style="color: #800000">&quot;</span><span style="color: #000000">))

</span><span style="color: #0000ff">let</span><span style="color: #000000"> progSub </span><span style="color: #000000">=</span><span style="color: #000000">
  wc.DownloadProgressChanged
  </span><span style="color: #000000">|&gt;</span><span style="color: #000000"> Event.until wc.DownloadStringCompleted
  </span><span style="color: #000000">|&gt;</span><span style="color: #000000"> </span><span style="color: #0000ff">fun</span><span style="color: #000000"> event </span><span style="color: #0000ff">-&gt;</span><span style="color: #000000"> 
       event.Subscribe(</span><span style="color: #0000ff">fun</span><span style="color: #000000"> _ args </span><span style="color: #0000ff">-&gt;</span><span style="color: #000000"> printfn </span><span style="color: #800000">&quot;</span><span style="color: #800000">%d%% Complete</span><span style="color: #800000">&quot;</span><span style="color: #000000"> args.ProgressPercentage)

</span><span style="color: #0000ff">let</span><span style="color: #000000"> downloadSub </span><span style="color: #000000">=</span><span style="color: #000000">
  wc.DownloadStringCompleted.Subscribe (</span><span style="color: #0000ff">fun</span><span style="color: #000000"> _ args </span><span style="color: #0000ff">-&gt;</span><span style="color: #000000"> printfn </span><span style="color: #800000">&quot;</span><span style="color: #800000">%s</span><span style="color: #800000">&quot;</span><span style="color: #000000"> args.Result)   </span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Here, once again I’m using the extension method I created that allows us to dispose of our event handlers easily through an IDisposable interface.&#160; This follows the design of the Reactive Framework, and quite frankly, makes a lot of sense.&#160; What we’re able to do is create our DownloadProgressChanged subscription which listens until the DownloadStringCompleted event and then we output our percentage complete as it goes along.&#160; The download subscription is much like before in that we subscribe to the event and can dispose at any time later in our program.</p>
<h2>Adding Some Monadic Magic</h2>
<p>Let’s add another wrinkle here to our solution.&#160; What if we want to create our mouse drag event like we had from the previous post using the Reactive Framework?&#160; Let’s review the code that was required in Rx to make this happen.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterSmartContent">
<pre style="background-color: #ffffff;overflow: auto"><span style="color: #0000ff">var</span><span style="color: #000000"> mouseDrag </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000ff">from</span><span style="color: #000000"> md </span><span style="color: #0000ff">in</span><span style="color: #000000"> </span><span style="color: #0000ff">this</span><span style="color: #000000">.GetMouseDown()
                </span><span style="color: #0000ff">from</span><span style="color: #000000"> mm </span><span style="color: #0000ff">in</span><span style="color: #000000"> </span><span style="color: #0000ff">this</span><span style="color: #000000">.GetMouseMove().Until(</span><span style="color: #0000ff">this</span><span style="color: #000000">.GetMouseUp())
                </span><span style="color: #0000ff">select</span><span style="color: #000000"> mm;</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>I may have hinted in the previous post, that LINQ to Objects is an implementation of the list monad and the Reactive Framework is an implementation of the continuation monad.&#160; As Erik points out in one of his recent Channel 9 episodes, indeed many of the interesting things we’re finding in programming are coming in monadic form.&#160; We’ll cover exactly what that means in a later post, but what if we could apply the same kind of logic from the above and apply it to F# first class events as well?&#160; </p>
<p>In order to make this happen, we need to implement a bind/collect combinator.&#160; This bind function follows the basic pattern of:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterSmartContent">
<pre style="background-color: #ffffff;overflow: auto"><span style="color: #0000ff">val</span><span style="color: #000000"> bind : M</span><span style="color: #000000">&lt;</span><span style="color: #800000">'</span><span style="color: #800000">a&gt; -&gt; (</span><span style="color: #800000">'</span><span style="color: #000000">a </span><span style="color: #0000ff">-&gt;</span><span style="color: #000000"> M</span><span style="color: #000000">&lt;</span><span style="color: #800000">'</span><span style="color: #800000">b&gt;) -&gt; M&lt;</span><span style="color: #800000">'</span><span style="color: #000000">b</span><span style="color: #000000">&gt;</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Where the M is some monadic type.&#160; In the case of LINQ to Objects, this is the SelectMany method and the M type is an IEnumerable&lt;T&gt;.&#160; If we were to construct the collect combinator from scratch for an IEnumerable&lt;T&gt;, it might look like the following:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">let</span><span style="color: #000000"> collect f </span><span style="color: #000000">=</span><span style="color: #000000"> Seq.map f </span><span style="color: #000000">&gt;&gt;</span><span style="color: #000000"> Seq.concat</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>And our approach to doing this with events should be no different.&#160; In this case, we also need to implement the concat combinator as well as that does not exist in the base libraries but pretty simple to create.&#160; First, with the concat, we need to take in a IEvent of an IEvent and concatenate them together in a way that we get only an IEvent as a return.&#160; In order to do so, we need to add a handle to our source, which in turn listens to the inner events and triggers our new event that we later publish.&#160; Secondly, we’ll need to implement the collect combinator much like we had above, but this time for events.&#160; Below is what the code might look like.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">module</span><span style="color: #000000"> Event </span><span style="color: #000000">=</span><span style="color: #000000">

 </span><span style="color: #0000FF">let</span><span style="color: #000000"> concat (source: IEvent</span><span style="color: #000000">&lt;</span><span style="color: #000000">IEvent</span><span style="color: #000000">&lt;</span><span style="color: #000000">_,_</span><span style="color: #000000">&gt;&gt;</span><span style="color: #000000">) </span><span style="color: #000000">=</span><span style="color: #000000">
   </span><span style="color: #0000FF">let</span><span style="color: #000000"> event </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> Event</span><span style="color: #000000">&lt;</span><span style="color: #000000">_</span><span style="color: #000000">&gt;</span><span style="color: #000000">()
   source.Add (Event.listen event.Trigger)
   event.Publish

 </span><span style="color: #0000FF">let</span><span style="color: #000000"> collect f </span><span style="color: #000000">=</span><span style="color: #000000">
   Event.map f </span><span style="color: #000000">&gt;&gt;</span><span style="color: #000000"> concat</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Now that we have a basis for binding together our events, let’s create a monadic builder so that we could write event expressions much as we would for sequence expressions.&#160; In this case, we only need the bind and not the return for this instance.&#160; A simple return wouldn’t make sense to yield a single value through an event.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">type</span><span style="color: #000000"> EventBuilder() </span><span style="color: #000000">=</span><span style="color: #000000">
  </span><span style="color: #0000FF">member</span><span style="color: #000000"> this.Bind(m, f) </span><span style="color: #000000">=</span><span style="color: #000000"> Event.collect f m
</span><span style="color: #0000FF">let</span><span style="color: #000000"> event </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> EventBuilder()</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Now that we have this defined, F# gives us some syntactic sugar much like the do notation in Haskell.&#160; Let’s now add an extension method to the WinForms Control class.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterSmartContent">
<pre style="background-color: #ffffff;overflow: auto"><span style="color: #0000ff">type</span><span style="color: #000000"> System.Windows.Forms.Control </span><span style="color: #0000ff">with</span><span style="color: #000000">
  </span><span style="color: #0000ff">member</span><span style="color: #000000"> this.MouseDrag </span><span style="color: #000000">=</span><span style="color: #000000"> event {
    </span><span style="color: #0000ff">let</span><span style="color: #000000">!</span><span style="color: #000000"> _ </span><span style="color: #000000">=</span><span style="color: #000000"> this.MouseDown
    </span><span style="color: #0000ff">return</span><span style="color: #000000">!</span><span style="color: #000000"> this.MouseMove </span><span style="color: #000000">|&gt;</span><span style="color: #000000"> Event.until this.MouseUp }</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>And there you have it!&#160; We now have a mouse drag event exposed on our control class which tracks only when the mouse button is down and our mouse is moving.&#160; To get an idea of what it’s doing behind the scenes, I’ll also include the non-syntactic sugar version.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterSmartContent">
<pre style="background-color: #ffffff;overflow: auto"><span style="color: #0000ff">type</span><span style="color: #000000"> System.Windows.Forms.Control </span><span style="color: #0000ff">with</span><span style="color: #000000">
  </span><span style="color: #0000ff">member</span><span style="color: #000000"> this.MouseDrag </span><span style="color: #000000">=</span><span style="color: #000000"> 
    event.Bind(this.MouseDown, </span><span style="color: #0000ff">fun</span><span style="color: #000000"> _ </span><span style="color: #0000ff">-&gt;</span><span style="color: #000000">
      this.MouseMove </span><span style="color: #000000">|&gt;</span><span style="color: #000000"> Event.until this.MouseUp)</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>And now we can subscribe to this much like any other event and have it track our mouse.</p>
<h2>Conclusion</h2>
<p>Creating composable events using F# first class events is a pretty compelling story.&#160; One of the driving ideas behind the Reactive Framework in terms of composable events does in fact come from F#.&#160; Come .NET 4.0, it will be interesting on how Rx and F# First Class Events can co-exist and in fact compliment each other.&#160; Now back to the Reactive Framework series.</p>
<div class="shr-publisher-176"></div><!-- Start Shareaholic LikeButtonSetBottom Automatic --><!-- End Shareaholic LikeButtonSetBottom Automatic -->											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/matthewpodwysocki/category/event-based-porgramming/" title="View all posts in Event-based Porgramming" rel="category tag">Event-based Porgramming</a>, <a href="http://codebetter.com/matthewpodwysocki/category/f/" title="View all posts in F#" rel="category tag">F#</a>, <a href="http://codebetter.com/matthewpodwysocki/category/functional-programming/" title="View all posts in Functional Programming" rel="category tag">Functional Programming</a>, <a href="http://codebetter.com/matthewpodwysocki/category/reactive-framework/" title="View all posts in Reactive Framework" rel="category tag">Reactive Framework</a>. Bookmark the <a href="http://codebetter.com/matthewpodwysocki/2009/10/15/f-first-class-events-composing-events-until-others/" title="Permalink to F# First Class Events – Composing Events Until Others" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/matthewpodwysocki/2009/10/15/f-first-class-events-composing-events-until-others/feed/" title="Comments RSS to F# First Class Events – Composing Events Until Others" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-176 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/matthewpodwysocki/2009/10/14/introducing-the-reactive-framework-part-i/" rel="prev"><span class="meta-nav">&larr;</span> Introducing the Reactive Framework Part I</a></div>
					<div class="nav-next"><a href="http://codebetter.com/matthewpodwysocki/2009/10/16/ann-dc-alt-net-10-22-2009-mongodb-with-david-james/" rel="next">[ANN] DC ALT.NET 10/22/2009 – MongoDB with David James <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
                    <div id="dsq-content">
            <ul id="dsq-comments">
                    <li id="dsq-comment-408">
                    <div id="dsq-comment-header-408" class="dsq-comment-header">
                        <cite id="dsq-cite-408">
    http://codebetter.com/members/Paks/default.aspx                            <span id="dsq-author-user-408">Paks</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-408" class="dsq-comment-body">
                        <div id="dsq-comment-message-408" class="dsq-comment-message"><p>I got the idea of using concat to implement bind after watching the presentation Erik Meijer and Wes Dyer did on Channel 9 about the Rx Framework. There Erik talke about the implementation of SelectMany and Why it was very easy to implement if you implemented concat first. That video is a must if you want to learn about the internals of the Rx Framework.</p>
<p>Now, Erik also talks about two ways one can implement concat.  One is like the one you implemented here. The other one forgets about older event streams once events for a new stream start to fire. Have you thought about how to implement that one on F#?</p>
<p>Another question:<br />
I see that you prefer to use &#8220;new Event<>&#8221; instead of &#8220;Event.create&#8221;. Why is that?</p>
<p>I know there is no difference since Event.create is implemented like this:<br />
 let create< 'T>() =<br />
            let ev = new Event< 'T>()<br />
            ev.Trigger, ev.Publish</p>
<p>But I still wonder why you chose to create the events explicitly.</p>
<p>Nice post <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> </p>
<p>Note: I also expended some time trying to understand what Monadic &#8220;return&#8221; means for Events. My head spinned a lot thinking about that one. <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' />  </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-409">
                    <div id="dsq-comment-header-409" class="dsq-comment-header">
                        <cite id="dsq-cite-409">
    http://codebetter.com/members/Paks/default.aspx                            <span id="dsq-author-user-409">Paks</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-409" class="dsq-comment-body">
                        <div id="dsq-comment-message-409" class="dsq-comment-message"><p>Using the same technique used for &#8220;until&#8221;, we can implement  &#8220;take&#8221; like this:</p>
<p>module Event =<br />
    let take (count: int) (source: IEvent< 'del,'T>) =<br />
        let remaining = ref count<br />
        let fire,evt = Event.create()<br />
        source |> Event.listen(fun args -> if !remaining > 0 then decr remaining; fire(args))<br />
        evt</p>
<p>Again not being able to unsubscribe from the source once the count reaches 0 is a drag <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_sad.gif' alt=':(' class='wp-smiley' /> </p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-410">
                    <div id="dsq-comment-header-410" class="dsq-comment-header">
                        <cite id="dsq-cite-410">
    http://codebetter.com/members/Matthew.Podwysocki/default.aspx                            <span id="dsq-author-user-410">Matthew.Podwysocki</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-410" class="dsq-comment-body">
                        <div id="dsq-comment-message-410" class="dsq-comment-message"><p>@Paks</p>
<p>The reason for not using Event.create is that it may be deprecated in the future in favor of the more explicit implementation of new Event<_>().</p>
<p>As for unsubscribing like the way that the Reactive Framework does it, no I haven&#8217;t.  It&#8217;s not worth my effort when I could just as easily fold in Rx instead of F# First Class Events.</p>
<p>Matt</p>
<p></_></p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-411">
                    <div id="dsq-comment-header-411" class="dsq-comment-header">
                        <cite id="dsq-cite-411">
    http://codebetter.com/members/Matthew.Podwysocki/default.aspx                            <span id="dsq-author-user-411">Matthew.Podwysocki</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-411" class="dsq-comment-body">
                        <div id="dsq-comment-message-411" class="dsq-comment-message"><p>@Paks</p>
<p>Yes, you could implement a whole set of combinators using that same approach including:</p>
<p>- take<br />
- takeWhile<br />
- skip<br />
- skipWhile</p>
<p>I have all of those included here:<br />
<a href="http://gist.github.com/211922" rel="nofollow">http://gist.github.com/211922</a></p>
<p>Matt</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-412">
                    <div id="dsq-comment-header-412" class="dsq-comment-header">
                        <cite id="dsq-cite-412">
    http://codebetter.com/members/Paks/default.aspx                            <span id="dsq-author-user-412">Paks</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-412" class="dsq-comment-body">
                        <div id="dsq-comment-message-412" class="dsq-comment-message"><p>In looking at the code at <a href="http://gist.github.com/211922" rel="nofollow">http://gist.github.com/211922</a> I found a bug in skipWhile</p>
<p>The error is in &#8220;if !ok then&#8221;. Change it to &#8220;if ok then&#8221;<br />
The way it is, it would never skip an event.</p>
<p>  let skipWhile predicate (sourceEvent:IEvent< 'del, 'a>) =<br />
    let event = new Event<_>()<br />
    let ok = ref true<br />
    sourceEvent.Add(fun args -><br />
                      if ok then<br />
                        ok := predicate args<br />
                      else<br />
                        event.Trigger args)<br />
    event.Publish</p>
<p>Cesar</_></p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-413">
                    <div id="dsq-comment-header-413" class="dsq-comment-header">
                        <cite id="dsq-cite-413">
    http://codebetter.com/members/Paks/default.aspx                            <span id="dsq-author-user-413">Paks</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-413" class="dsq-comment-body">
                        <div id="dsq-comment-message-413" class="dsq-comment-message"><p>takeWhile has the same issue as skipWhile. It would never fire.</p>
<p>Cesar</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-414">
                    <div id="dsq-comment-header-414" class="dsq-comment-header">
                        <cite id="dsq-cite-414">
    http://codebetter.com/members/Matthew.Podwysocki/default.aspx                            <span id="dsq-author-user-414">Matthew.Podwysocki</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-414" class="dsq-comment-body">
                        <div id="dsq-comment-message-414" class="dsq-comment-message"><p>@Paks</p>
<p>Actually the code is correct.  The (!) operator is not the &#8220;not&#8221; operator that it is from C#; instead it is to get the value of a ref cell.  Leaving off this operator will make this code fail to compile as I cannot check the count of a ref<int>.  Run them through F# and you&#8217;ll find they work exactly as written.</p>
<p>Matt</int></p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-415">
                    <div id="dsq-comment-header-415" class="dsq-comment-header">
                        <cite id="dsq-cite-415">
    http://codebetter.com/members/Paks/default.aspx                            <span id="dsq-author-user-415">Paks</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-415" class="dsq-comment-body">
                        <div id="dsq-comment-message-415" class="dsq-comment-message"><p>Hehehehe, you&#8217;re right. I got confused for a moment.<br />
 <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> </p>
</div>
                    </div>
                </li>
                </ul>
        </div>
    </div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://codebetter.com/matthewpodwysocki/2009/10/15/f-first-class-events-composing-events-until-others/';
    var disqus_identifier = '176 /blogs/matthew.podwysocki/archive/2009/10/15/f-first-class-events-composing-events-until-others.aspx';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'matthewpodwysocki';
    var disqus_title = "F# First Class Events – Composing Events Until Others";
        var disqus_config = function () {
        var config = this; // Access to the config object

        /* 
           All currently supported events:
            * preData — fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            DISQUS.request.get('?cf_action=sync_comments&post_id=176');
        });
                    };
    var facebookXdReceiverPath = 'http://cdn1.codebetter.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
        ],
        'trackback_url': "http:\/\/codebetter.com\/matthewpodwysocki\/2009\/10\/15\/f-first-class-events-composing-events-until-others\/trackback\/"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.67';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29416);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=2782afb'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29416&amp;n=2782afb' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29417);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=e94cea6'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29417&amp;n=e94cea6' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29418);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=9ba3022'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29418&amp;n=9ba3022' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29419);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=f467b52'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29419&amp;n=f467b52' /></a></noscript>
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(220407);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=68b8307'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=220407&amp;n=68b8307' /></a></noscript>				
				
				<ul class="xoxo">		
									</ul>	
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29421);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=3f8e353'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29421&amp;n=3f8e353' /></a></noscript>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="http://red-gate.com/">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="http://telerik.com">Telerik .NET Tools</a></li>
<li><a href="http://jetbrains.com/resharper/">JetBrains - ReSharper</a></li>
<li><a href="http://scootersoftware.com">Beyond Compare</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a></li>
<li><a href="http://umbraco.com" target="_blank">Umbraco</a></li>
<li><a href="http://nservicebus.com" target="_blank">NServiceBus</a></li>
<li><a href="http://ravendb.net" target="_blank">RavenDb</a></li>
<li><a href="http://www.websequencediagrams.com/" target="_blank">Web Sequence Diagrams</a></li>
	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '12<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPython.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = true; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>

<script type='text/javascript'>//<![CDATA[
    if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.4.2.min.js' type='text/javascript' %3E%3C/script%3E"));
    }//]]></script>
<script type='text/javascript' language='Javascript' src='http://s1.lqcdn.com/m.min.js?dt=2.3.110202.1'></script>
<script type='text/javascript' language='Javascript'> if(jQuery.LqmAds)jQuery.LqmAds();</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.568 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2012-11-09 20:26:39 -->
<!-- super cache -->