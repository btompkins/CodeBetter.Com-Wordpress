<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>IronRuby and the Reactive Extensions Together Again – Taming User Input | Matthew Podwysocki</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/matthewpodwysocki/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css?v=3912785705" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js?ver=3.4.2'></script>
<script type='text/javascript' src='http://dtym7iokkjlif.cloudfront.net/dough/1.0/recipe.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/matthewpodwysocki/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='IronRuby and the Reactive Extensions for .NET Together at Last' href='http://codebetter.com/matthewpodwysocki/2010/08/05/ironruby-and-the-reactive-extensions-for-net-together-at-last/' />
<link rel='next' title='Dojo Deferred and the Reactive Extensions for JavaScript' href='http://codebetter.com/matthewpodwysocki/2010/08/12/dojo-deferred-and-the-reactive-extensions-for-javascript/' />
<meta name="generator" content="WordPress 3.4.2" />
<link rel='shortlink' href='http://codebetter.com/matthewpodwysocki/?p=236' />

<!-- All in One SEO Pack 1.6.13.2 by Michael Torbert of Semper Fi Web Design[83,184] -->
<link rel="canonical" href="http://codebetter.com/matthewpodwysocki/2010/08/09/ironruby-and-the-reactive-extensions-together-again-taming-user-input/" />
<!-- /all in one seo pack -->
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.3.3" type="text/css" media="screen" />

<!-- Start Shareaholic OgTags -->

	<meta property='og:image' content='http://s3.amazonaws.com:80/CodeBetter/CommunityServer.Blogs.Components.WeblogFiles/matthew/podwysocki/image_thumb_347BED52.png?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1919787603&amp;Signature=NJk%2fDT2xLyfdYZOJS6pE9CvVQwo%3d' />

<!-- End Shareaholic OgTags -->

<meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/dc168cf39155d7b5d39f696ca94d5980.js?v=5302176208">/*Is Cache!*/</script>
                	
	<script type='text/javascript' src='http://d1.openx.org/spcjs.php?id=7744&amp;target=_blank'></script>
	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>
<!-- BuySellAds Ad Code -->
<script type="text/javascript">
(function(){
  var bsa = document.createElement('script');
     bsa.type = 'text/javascript';
     bsa.async = true;
     bsa.src = 'http://s3.buysellads.com/ac/bsa.js';
  (document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(bsa);
})();
</script>
<!-- End BuySellAds Ad Code -->
</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">
			<!-- BuySellAds Zone Code -->
<div id="bsap_1276080" class="bsarocks bsap_4fe632babdccc2b4b049e4f08cc3c549"></div>
<!-- End BuySellAds Zone Code --></div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-236" class="post-236 post type-post status-publish format-standard hentry category-event-based-porgramming category-reactive-framework category-ruby">
					<h1 class="entry-title">IronRuby and the Reactive Extensions Together Again – Taming User Input</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/matthewpodwysocki/author/matthewpodwysocki/" title="View all posts by Matthew Podwysocki">Matthew Podwysocki</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/matthewpodwysocki/2010/08/09/ironruby-and-the-reactive-extensions-together-again-taming-user-input/" title="5:51 pm" rel="bookmark"><span class="entry-date">August 9, 2010</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/matthewpodwysocki/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/matthewpodwysocki/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><!-- Start Shareaholic LikeButtonSetTop Automatic --><!-- End Shareaholic LikeButtonSetTop Automatic --><p>In the <a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/08/06/ironruby-and-the-reactive-extensions-together-again-events.aspx">previous post</a>, I talked about how <a href="http://ironruby.codeplex.com/">IronRuby 1.1</a> now supports extension methods, and that it not only supports LINQ to objects, but with relative ease it also supports the <a href="http://msdn.microsoft.com/en-us/devlabs/ee794896.aspx">Reactive Extensions for .NET</a>.&#160; We covered a little example of taking a Ruby Enumerable and turn it into an .NET Observable instance and then projecting and filtering the data.&#160; In this post, we’ll go a little bit further by showing how you can also use events as well and how we can tame user input.</p>
<h2>What Does the Future Hold?</h2>
<p>Before we continue this series, I thought I’d address the elephant in the room in terms of what the future holds for IronRuby.&#160; <a href="http://twitter.com/jschementi">Jimmy Schementi</a>, the former PM of the IronRuby project laid out what has been going on <a href="http://blog.jimmy.schementi.com/2010/08/start-spreading-news-future-of-jimmy.html">in his blog</a> and the <a href="http://rubyforge.org/pipermail/ironruby-core/2010-August/007310.html">IronRuby core mailing list</a> (which if you want to see it stick around, <a href="http://rubyforge.org/mailman/listinfo/ironruby-core">join the community</a>).&#160; Keep in mind that at the time of this writing, no decision has been made one way or the other as to its future.&#160; My hope is that the community does indeed stand up and either continue on IronRuby, or a bridge effort such as RubyCLR as they are both valuable things to have.</p>
<p>Either way, this blog series, however many posts it may be, will continue as I think it might have some value to some folks out there.&#160; So with that, onto today’s subject.</p>
<h2>Taming User Input</h2>
<p>In this post, I’m going to take an example we had from the Reactive Extensions for .NET Hands on Labs and apply it to a version using IronRuby and WPF.&#160; The idea behind this example is that calls to such things as HTTP calls such as Web Services, REST and so forth can be expensive.&#160; Imagine if you were a really fast typer at over 100 words per minute, and then having each new character cause a new request to be sent.&#160; Chances are you’d overload the system, and not only that, but also have a chance of the results coming back in out of order.&#160; So, how do we fix that?&#160; By using the Reactive Extensions for .NET together with IronRuby, we can make this scenario work quite nicely.</p>
<h2>Removing the Boilerplate</h2>
<p>Getting started, we’ll need to get some boilerplate out of the way including referencing the proper assemblies for a .NET 4 solution.&#160; In order for us to do so, let’s move the assembly includes to a separate file.&#160; Since we’re going to be using WPF and the Reactive Extensions, we’ll create two separate files, rxnet.rb and wpf.rb.&#160; The rxnet.rb contains all specific assemblies related to the Reactive Extensions such as the following:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">load_assembly </span><span style="color: #800000">'</span><span style="color: #800000">System.CoreEx</span><span style="color: #800000">'</span><span style="color: #000000">
load_assembly </span><span style="color: #800000">'</span><span style="color: #800000">System.Interactive</span><span style="color: #800000">'</span><span style="color: #000000">
load_assembly </span><span style="color: #800000">'</span><span style="color: #800000">System.Reactive</span><span style="color: #800000">'</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>And our wpf.rb contains the following assemblies:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">load_assembly </span><span style="color: #800000">'</span><span style="color: #800000">WindowsBase</span><span style="color: #800000">'</span><span style="color: #000000">
load_assembly </span><span style="color: #800000">'</span><span style="color: #800000">PresentationCore</span><span style="color: #800000">'</span><span style="color: #000000">
load_assembly </span><span style="color: #800000">'</span><span style="color: #800000">PresentationFramework</span><span style="color: #800000">'</span><span style="color: #000000">
load_assembly </span><span style="color: #800000">'</span><span style="color: #800000">System.Xaml</span><span style="color: #800000">'</span><span style="color: #000000">
load_assembly </span><span style="color: #800000">'</span><span style="color: #800000">System.CoreEx</span><span style="color: #800000">'</span><span style="color: #000000">
load_assembly </span><span style="color: #800000">'</span><span style="color: #800000">System.Reactive</span><span style="color: #800000">'</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Now we can make this available any number of ways, either through a quick gem, or just copying these files directly to the lib folder for IronRuby.&#160; Once we’ve decided on a given path, then we could reference all we need by the following for this post:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">require </span><span style="color: #800000">'</span><span style="color: #800000">System.Core</span><span style="color: #800000">'</span><span style="color: #000000">
require </span><span style="color: #800000">'</span><span style="color: #800000">wpf</span><span style="color: #800000">'</span><span style="color: #000000">
require </span><span style="color: #800000">'</span><span style="color: #800000">rxnet</span><span style="color: #800000">'</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Now that our boilerplate is out of the way, let’s get on to the solution.</p>
<h2>Starting the Solution</h2>
<p>Once we have finished that, we are free to include the namespaces and the extension method namespaces which include both System and System::Linq namespaces.&#160; The IObservable extensions for the standard operators reside in System::Linq, and the overloads for the IObservable&lt;T&gt;.subscribe reside in the System namespace.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">include System
include System::Linq
include System::Windows
include System::Windows::Controls

using_clr_extensions System
using_clr_extensions System::Linq</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Now, let’s create a standard WPF Window class with a StackPanel which contains two elements, our TextBox for entering data and a ListBox for showing the results.&#160; </p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">class</span><span style="color: #000000"> RubyWindow </span><span style="color: #000000">&lt;</span><span style="color: #000000"> Window

    </span><span style="color: #0000FF">def</span><span style="color: #000000"> initialize
        </span><span style="color: #0000FF">self</span><span style="color: #000000">.Title </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #800000">'</span><span style="color: #800000">Hello Ruby!</span><span style="color: #800000">'</span><span style="color: #000000">
        
        stackpanel </span><span style="color: #000000">=</span><span style="color: #000000"> StackPanel.new
        @textbox </span><span style="color: #000000">=</span><span style="color: #000000"> TextBox.new
        @listbox </span><span style="color: #000000">=</span><span style="color: #000000"> ListBox.new
        stackpanel.children.add(@textbox)
        stackpanel.children.add(@listbox)
        </span><span style="color: #0000FF">self</span><span style="color: #000000">.content </span><span style="color: #000000">=</span><span style="color: #000000"> stackpanel
        
        initialize_handlers
    </span><span style="color: #0000FF">end</span><span style="color: #000000">

</span><span style="color: #0000FF">end</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Once we’ve done this, now let’s get to the interesting part.&#160; After setting the content of our Window to the StackPanel, let’s hook up the to the TextChanged event of our TextBox by calling Observable.from_event generic method (FromEvent) with the arguments of TextChangedEventArgs.&#160; </p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">def</span><span style="color: #000000"> initialize_handlers

    @textbox_changed </span><span style="color: #000000">=</span><span style="color: #000000"> Observable.
        method(:from_event).
        of(TextChangedEventArgs).
        call(@textbox, </span><span style="color: #800000">'</span><span style="color: #800000">TextChanged</span><span style="color: #800000">'</span><span style="color: #000000">)

</span><span style="color: #0000FF">end</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>This is all fine and interesting, but the TextChangedEventArgs doesn’t actually give us the text of our TextBox, so, let’s fix that to call select, passing in our IEvent&lt;TextChangedEventArgs&gt; argument and then retrieving the text property from the sender, which in this case was the TextBox.&#160; In order for us to call generic methods using IronRuby, we need to make use of the following pattern in which we specify the method we want to call, of what type and then we can invoke it via the call method.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">some_object.
    method(:some_method).
    of(SomeType).
    call(some_args)</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>To see this in action, we’ll apply the same pattern to call the from_event method of type TextChangedEventArgs, and then we invoke via call with our @textbox and the ‘TextChanged’ event.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">def</span><span style="color: #000000"> initialize_handlers

    @textbox_changed </span><span style="color: #000000">=</span><span style="color: #000000"> Observable.
        method(:from_event).
        of(TextChangedEventArgs).
        call(@textbox, </span><span style="color: #800000">'</span><span style="color: #800000">TextChanged</span><span style="color: #800000">'</span><span style="color: #000000">).
        select(lambda { </span><span style="color: #000000">|</span><span style="color: #000000">event</span><span style="color: #000000">|</span><span style="color: #000000"> event.sender.text })        

</span><span style="color: #0000FF">end</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>One distinct advantage we have here while using a dynamic language such as Ruby, we’re able to get the text from the sender without having to cast.&#160; For example, using C#, we’d have to do the following:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterSmartContent">
<pre style="background-color: #ffffff;overflow: auto"><span style="color: #000000">var textChanged </span><span style="color: #000000">=</span><span style="color: #000000"> 
    Observable.FromEvent</span><span style="color: #000000">&lt;</span><span style="color: #000000">TextChangedEventArgs</span><span style="color: #000000">&gt;</span><span style="color: #000000">(textbox, </span><span style="color: #800000">&quot;</span><span style="color: #800000">TextChanged</span><span style="color: #800000">&quot;</span><span style="color: #000000">)
        .Select(ev </span><span style="color: #000000">=&gt;</span><span style="color: #000000"> ((TextBox)sender).Text);</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>We can subscribe to the resulting observable and then have the items added to the ListBox.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">def</span><span style="color: #000000"> initialize_handlers

    @textbox_changed </span><span style="color: #000000">=</span><span style="color: #000000"> Observable.
        method(:from_event).
        of(TextChangedEventArgs).
        call(@textbox, </span><span style="color: #800000">'</span><span style="color: #800000">TextChanged</span><span style="color: #800000">'</span><span style="color: #000000">).
        select(lambda { </span><span style="color: #000000">|</span><span style="color: #000000">event</span><span style="color: #000000">|</span><span style="color: #000000"> event.sender.text })        

    @textbox_changed.
        subscribe(lambda {</span><span style="color: #000000">|</span><span style="color: #000000">text</span><span style="color: #000000">|</span><span style="color: #000000"> @listbox.items.add(text))

</span><span style="color: #0000FF">end</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>This is great, but as you may notice, all of our input is immediately put into the below ListBox.&#160; This may or may not be a problem, but imagine we’re calling an external service, then ultimately it’d be a huge issue to have hundreds of calls going out at once because we’re fast typers.&#160; Let’s fix that by using the throttle method (Throttle) which allows us to specify a timeout time before the event is fired.&#160; If there are no other events that happen in the specified timeframe, then we get the result, else we keep waiting until that timeout.&#160; So, let’s now throttle our input.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">def</span><span style="color: #000000"> initialize_handlers

    @textbox_changed </span><span style="color: #000000">=</span><span style="color: #000000"> Observable.
        method(:from_event).
        of(TextChangedEventArgs).
        call(@textbox, </span><span style="color: #800000">'</span><span style="color: #800000">TextChanged</span><span style="color: #800000">'</span><span style="color: #000000">).
        select(lambda { </span><span style="color: #000000">|</span><span style="color: #000000">event</span><span style="color: #000000">|</span><span style="color: #000000"> event.sender.text })        

    @textbox_changed.
        throttle(TimeSpan.from_milliseconds(</span><span style="color: #000000">500</span><span style="color: #000000">))
        subscribe(lambda {</span><span style="color: #000000">|</span><span style="color: #000000">text</span><span style="color: #000000">|</span><span style="color: #000000"> @listbox.items.add(text))

</span><span style="color: #0000FF">end</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Now we can run it and watch the results, and it should just work, right?&#160; Not so much…</p>
<p><a href="http://codebetter.com/cfs-file.ashx/__key/CommunityServer.Blogs.Components.WeblogFiles/matthew.podwysocki/image_5F00_4BA767D0.png"><img style="border-bottom: 0px;border-left: 0px;border-top: 0px;border-right: 0px" border="0" alt="image" src="http://s3.amazonaws.com:80/CodeBetter/CommunityServer.Blogs.Components.WeblogFiles/matthew/podwysocki/image_thumb_347BED52.png?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1919787603&amp;Signature=NJk%2fDT2xLyfdYZOJS6pE9CvVQwo%3d" width="434" height="217" /></a> </p>
<p>The problem is that once we start throttling our input, we’re launching a new thread to make this happen.&#160; This newly spawned thread cannot access the object to modify the items.&#160; Instead, we have to think about Schedulers, which I’ll cover all of them in a later post, but sufficed to say, we have some options.&#160; The easiest of which is the observe_on_dispatcher method (ObserveOnDispatcher) which allows us to observe this sequence on the control’s dispatcher.&#160; Let’s change the code to fix this issue:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">def</span><span style="color: #000000"> initialize_handlers

    @textbox_changed </span><span style="color: #000000">=</span><span style="color: #000000"> Observable.
        method(:from_event).
        of(TextChangedEventArgs).
        call(@textbox, </span><span style="color: #800000">'</span><span style="color: #800000">TextChanged</span><span style="color: #800000">'</span><span style="color: #000000">).
        select(lambda { </span><span style="color: #000000">|</span><span style="color: #000000">event</span><span style="color: #000000">|</span><span style="color: #000000"> event.sender.text })        

    @textbox_changed.
        throttle(TimeSpan.from_milliseconds(</span><span style="color: #000000">500</span><span style="color: #000000">)).
        observe_on_dispatcher.
        subscribe(lambda {</span><span style="color: #000000">|</span><span style="color: #000000">text</span><span style="color: #000000">|</span><span style="color: #000000"> @listbox.items.add(text))

</span><span style="color: #0000FF">end</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>And now we can start typing, and sure enough our text is throttled, including copying the sentence and pasting it.</p>
<p><a href="http://codebetter.com/cfs-file.ashx/__key/CommunityServer.Blogs.Components.WeblogFiles/matthew.podwysocki/image_5F00_28E63013.png"><img style="border-bottom: 0px;border-left: 0px;border-top: 0px;border-right: 0px" border="0" alt="image" src="http://s3.amazonaws.com:80/CodeBetter/CommunityServer.Blogs.Components.WeblogFiles/matthew/podwysocki/image_thumb_68B01698.png?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1919787603&amp;Signature=5Uf25Oqdy3GJyeLUT7xyDq6avEo%3d" width="304" height="223" /></a> </p>
<p>But you’ll notice that we now have a duplicate because of the copy/paste operation.&#160; What we really want is to have distinct values only in our ListBox.&#160; To make that happen, we’ll need to use the distinct_until_changed method (DistinctUntilChanged) which then eliminates those duplicates.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">def</span><span style="color: #000000"> initialize_handlers

    @textbox_changed </span><span style="color: #000000">=</span><span style="color: #000000"> Observable.
        method(:from_event).
        of(TextChangedEventArgs).
        call(@textbox, </span><span style="color: #800000">'</span><span style="color: #800000">TextChanged</span><span style="color: #800000">'</span><span style="color: #000000">).
        select(lambda { </span><span style="color: #000000">|</span><span style="color: #000000">event</span><span style="color: #000000">|</span><span style="color: #000000"> event.sender.text })        

    @textbox_changed.
        throttle(TimeSpan.from_milliseconds(</span><span style="color: #000000">500</span><span style="color: #000000">)).
        observe_on_dispatcher.
        distinct_until_changed.
        subscribe(lambda {</span><span style="color: #000000">|</span><span style="color: #000000">text</span><span style="color: #000000">|</span><span style="color: #000000"> @listbox.items.add(text))

</span><span style="color: #0000FF">end</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>And we can run the same experiment and sure enough our result is throttled and we receive no duplicates from item to item.</p>
<p><a href="http://codebetter.com/cfs-file.ashx/__key/CommunityServer.Blogs.Components.WeblogFiles/matthew.podwysocki/image_5F00_364C4319.png"><img style="border-bottom: 0px;border-left: 0px;border-top: 0px;border-right: 0px" border="0" alt="image" src="http://s3.amazonaws.com:80/CodeBetter/CommunityServer.Blogs.Components.WeblogFiles/matthew/podwysocki/image_thumb_24037C57.png?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1919787603&amp;Signature=3byXSTecMIO%2b226DWqQuCrX8IWw%3d" width="285" height="234" /></a></p>
<p>And there you have it, a simple case of taming user input, all with the use of IronRuby and the Reactive Extensions for .NET. </p>
<h2>Conclusion</h2>
</p>
</p>
</p>
</p>
</p>
<p>With the Reactive Extensions for .NET, we have a nice cross-language support for building a bridge to asynchronous and event-based programming.&#160; Coming with the latest release of IronRuby, we now have the ability, and a rather nice one at that, to consume extension methods that are predefined in other languages, which opens a whole new set of opportunities for interoperability.&#160; In the coming posts, I’ll take a look at what else I can do in this space to see that we can fact help solve some of the hardest problems around asynchronous and event-based programming.</p>
<p>As for the future of IronRuby, best to get involved and help where you can if you want to see it be a success!</p>
<p>So with that, <a href="http://msdn.microsoft.com/en-us/devlabs/ee794896.aspx">download it</a>, and <a href="http://social.msdn.microsoft.com/Forums/en-US/rx/threads">give the team feedback!</a></p>
<div class="shr-publisher-236"></div><!-- Start Shareaholic LikeButtonSetBottom Automatic --><!-- End Shareaholic LikeButtonSetBottom Automatic -->											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/matthewpodwysocki/category/event-based-porgramming/" title="View all posts in Event-based Porgramming" rel="category tag">Event-based Porgramming</a>, <a href="http://codebetter.com/matthewpodwysocki/category/reactive-framework/" title="View all posts in Reactive Framework" rel="category tag">Reactive Framework</a>, <a href="http://codebetter.com/matthewpodwysocki/category/ruby/" title="View all posts in Ruby" rel="category tag">Ruby</a>. Bookmark the <a href="http://codebetter.com/matthewpodwysocki/2010/08/09/ironruby-and-the-reactive-extensions-together-again-taming-user-input/" title="Permalink to IronRuby and the Reactive Extensions Together Again – Taming User Input" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/matthewpodwysocki/2010/08/09/ironruby-and-the-reactive-extensions-together-again-taming-user-input/feed/" title="Comments RSS to IronRuby and the Reactive Extensions Together Again – Taming User Input" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-236 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/matthewpodwysocki/2010/08/05/ironruby-and-the-reactive-extensions-for-net-together-at-last/" rel="prev"><span class="meta-nav">&larr;</span> IronRuby and the Reactive Extensions for .NET Together at Last</a></div>
					<div class="nav-next"><a href="http://codebetter.com/matthewpodwysocki/2010/08/12/dojo-deferred-and-the-reactive-extensions-for-javascript/" rel="next">Dojo Deferred and the Reactive Extensions for JavaScript <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
                    <div id="dsq-content">
            <ul id="dsq-comments">
                    <li id="dsq-comment-532">
                    <div id="dsq-comment-header-532" class="dsq-comment-header">
                        <cite id="dsq-cite-532">
    http://www.charlesstrahan.com                            <span id="dsq-author-user-532">Charles Strahan</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-532" class="dsq-comment-body">
                        <div id="dsq-comment-message-532" class="dsq-comment-message"><p>That&#8217;s pretty cool. Just the other day, I was trying to determine the most concise way to throttle user input, as I needed to hit a DB for auto-completion. Very neat solution.</p>
<p>I haven&#8217;t checked out the HOL &#8211; I&#8217;ll have to take a look. Thanks for the post, Matt.</p>
<p>-Charles</p>
</div>
                    </div>
                </li>
                    <li id="dsq-comment-533">
                    <div id="dsq-comment-header-533" class="dsq-comment-header">
                        <cite id="dsq-cite-533">
    http://codebetter.com/members/Matthew.Podwysocki/default.aspx                            <span id="dsq-author-user-533">Matthew.Podwysocki</span>
                            </cite>
                    </div>
                    <div id="dsq-comment-body-533" class="dsq-comment-body">
                        <div id="dsq-comment-message-533" class="dsq-comment-message"><p>@Charles,</p>
<p>Yes, please do check out the HOLs as we have a lot more to offer there and feedback would be appreciated!</p>
<p>Matt</p>
</div>
                    </div>
                </li>
                </ul>
        </div>
    </div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://codebetter.com/matthewpodwysocki/2010/08/09/ironruby-and-the-reactive-extensions-together-again-taming-user-input/';
    var disqus_identifier = '236 /blogs/matthew.podwysocki/archive/2010/08/09/ironruby-and-the-reactive-extensions-together-again-taming-user-input.aspx';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'matthewpodwysocki';
    var disqus_title = "IronRuby and the Reactive Extensions Together Again – Taming User Input";
        var disqus_config = function () {
        var config = this; // Access to the config object

        /* 
           All currently supported events:
            * preData — fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            DISQUS.request.get('?cf_action=sync_comments&post_id=236');
        });
                    };
    var facebookXdReceiverPath = 'http://cdn1.codebetter.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
        ],
        'trackback_url': "http:\/\/codebetter.com\/matthewpodwysocki\/2010\/08\/09\/ironruby-and-the-reactive-extensions-together-again-taming-user-input\/trackback\/"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.67';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29416);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=2782afb'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29416&amp;n=2782afb' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29417);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=e94cea6'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29417&amp;n=e94cea6' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29418);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=9ba3022'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29418&amp;n=9ba3022' /></a></noscript><script type='text/javascript'><!--// <![CDATA[
    OA_show(29419);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=f467b52'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29419&amp;n=f467b52' /></a></noscript>
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(220407);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=68b8307'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=220407&amp;n=68b8307' /></a></noscript>				
				
				<ul class="xoxo">		
									</ul>	
				
<script type='text/javascript'><!--// <![CDATA[
    OA_show(29421);
// ]]> --></script><noscript><a target='_blank' href='http://d1.openx.org/ck.php?n=3f8e353'><img border='0' alt='' src='http://d1.openx.org/avw.php?zoneid=29421&amp;n=3f8e353' /></a></noscript>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="http://red-gate.com/">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="http://telerik.com">Telerik .NET Tools</a></li>
<li><a href="http://jetbrains.com/resharper/">JetBrains - ReSharper</a></li>
<li><a href="http://scootersoftware.com">Beyond Compare</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a></li>
<li><a href="http://umbraco.com" target="_blank">Umbraco</a></li>
<li><a href="http://nservicebus.com" target="_blank">NServiceBus</a></li>
<li><a href="http://ravendb.net" target="_blank">RavenDb</a></li>
<li><a href="http://www.websequencediagrams.com/" target="_blank">Web Sequence Diagrams</a></li>
	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '12<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPython.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = true; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>

<script type='text/javascript'>//<![CDATA[
    if (typeof jQuery == 'undefined') {
        document.write(unescape("%3Cscript src='http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.4.2.min.js' type='text/javascript' %3E%3C/script%3E"));
    }//]]></script>
<script type='text/javascript' language='Javascript' src='http://s1.lqcdn.com/m.min.js?dt=2.3.110202.1'></script>
<script type='text/javascript' language='Javascript'> if(jQuery.LqmAds)jQuery.LqmAds();</script>
 
</body>
</html>
<!-- Dynamic page generated in 2.387 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2012-11-09 18:00:23 -->
<!-- super cache -->