<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Rob Ashton</title>
	<atom:link href="http://codebetter.com/robashton/feed/" rel="self" type="application/rss+xml" />
	<link>http://codebetter.com/robashton</link>
	<description>CodeBetter.Com - Stuff you need to Code Better!</description>
	<lastBuildDate>Mon, 03 Sep 2012 13:38:36 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.4.2</generator>
		<item>
		<title>Keeping JS Sane</title>
		<link>http://codebetter.com/robashton/2012/09/03/keeping-js-sane/</link>
		<comments>http://codebetter.com/robashton/2012/09/03/keeping-js-sane/#comments</comments>
		<pubDate>Mon, 03 Sep 2012 09:30:15 +0000</pubDate>
		<dc:creator>Rob Ashton</dc:creator>
				<category><![CDATA[Uncategorized]]></category>

		<guid isPermaLink="false">http://codebetter.com/robashton/?p=41</guid>
		<description><![CDATA[I gave a talk at #DDD10 this Saturday about keeping JS sane, I had some questions after about the list of things I ran through so documented in all its glory are my current thoughts on development with a dynamic&#160;&#8230; <a href="http://codebetter.com/robashton/2012/09/03/keeping-js-sane/">Continue&#160;reading&#160;<span class="meta-nav">&#8594;</span></a>]]></description>
			<content:encoded><![CDATA[<p>I gave a talk at #DDD10 this Saturday about keeping JS sane, I had some questions after about the list of things I ran through so documented in all its glory are my current thoughts on development with a dynamic language like JS.</p>
<p><strong>Javascript sucks and it doesn&#8217;t matter</strong></p>
<p>Yes, you can add arrays to numbers to strings to whatever else you like and get bizarre and hilarious results. Yes, you can write code with more callbacks than Lara Croft on a dating website &#8211; but if you&#8217;re doing these things in production code then you deserve what is coming to you &#8211; and that&#8217;s before I even ask if you have tests which would exercise that code and raise the common errors anyway.</p>
<p>And yes, it&#8217;s a dynamic language and you don&#8217;t get all that compile-time goodness you&#8217;re used to, you don&#8217;t get all of the re-factoring support you&#8217;re used to in [insert your IDE here] and you don&#8217;t get all of the magical intellisense that helps you from having to think but you do get all the other advantages inherent in a scripting system which I&#8217;m not going to talk about because man it&#8217;s a boring subject and it has been talked to death by a million language nerds and shouldn&#8217;t you just be writing Clojure anyway?</p>
<p>Tldr: Most of the craziness in JS won&#8217;t ever affect you, and if it does your tests will save you.</p>
<p><strong>Use JSHint/JSLint</strong></p>
<p>This is not just something that is a &#8216;nice to have&#8217;, this is not something that you read in a blog entry and go &#8216;oh, we should do that sometime&#8217;, this is genuinely something you should be setting up at the very start of a project and integrating with whatever editor it is you are using to give you and your team feedback as you pour your efforts into a project full of files.</p>
<p>Yeah &#8211; there are two of them and yeah you need to pick one. If your team is really going to have an argument over it, just flip a coin and move on because the difference is pretty much that JSLint tends towards being a crockford-style-enforcer rather than just a sanity checker, this is irrelevant for most people.</p>
<p>In each of your projects, you can have a .jshintrc file dictating what my preferences are for that directory &#8211; and you can turn off a lot of the warnings if you have a case of the &#8216;I know better&#8217; (or your code doesn&#8217;t use semi-colons). This doesn&#8217;t stop the instant feedback every time you save being incredibly useful in shortening the feedback loop between code-change and code-breakage.</p>
<p>To get and run jshint on your project, the following steps are all you need.</p>
<p>- Install nodejs<br />
- type &#8216;npm install -g jshint&#8217;<br />
- type &#8216;jshint ./src/*&#8217;</p>
<p>&nbsp;</p>
<p>By setting this up in your build process/editing process/etc, you are pretty much covering half of the &#8216;good things&#8217; automatically leaving you able to spend a bit more time focusing on the large rather than the small.</p>
<p><strong>Write tests, no not those tests, the other tests</strong></p>
<p>Yeah, testing is a pain, and yet even if we have a nice suite of tests for our backend .NET/Java/Whatevs we often don&#8217;t bother writing any for our front-end because it&#8217;s difficult to isolate logic for testing away from the browser, and testing code inside the browser means setting up godawful tooling and build scripts. This high initial pain putting people off is understandable, which is why for the most part the trick is &#8216;not to bother with all of that&#8217;.</p>
<p>I&#8217;m a fan of headless browsers, of which there is again a choice of two main players (Zombie and Phantom), both can be driven from Javascript to test Javascript, and both can be set up with little effort as part of the build scripts. Let&#8217;s show you how easy this actually is with zombie.</p>
<p>- Install nodejs<br />
- type &#8216;npm install zombie&#8217;<br />
- Write code like the following in a JS file</p>
<pre class="brush: jscript; title: ; notranslate">
var Browser = require('zombie')
  , client = new Browser()

client.visit('http://localhost', function() {
  client.fill('title', 'This is an awesome blog entry')
  client.click('submit')
})
</pre>
<p>- Run the file with &#8216;node myfile&#8217;</p>
<p>Combine this with a test runner like mocha (<em>npm install -g mocha</em>) and you have a way to test pretty much everything across your web application. Yeah &#8211; you won&#8217;t be able to test animations and transitions and whatever but you can at least make sure your functional code works effectively.</p>
<p>You can even do crazy things like grab handles to the real JS objects present within the application and assert on them, so for example:</p>
<pre class="brush: jscript; title: ; notranslate">
var title = client.execute(&quot;$('#title'))
title.css('background-color').should.equal('#FFF')
</pre>
<p>Or</p>
<pre class="brush: jscript; title: ; notranslate">
var app = client.execute('global_application_object');
app.currentView.should.equal('/ponies')
</pre>
<p>All of this assumes that you can easily bootstrap your application and that you have decent in-memory implementations of things like persistence (if you want to be able keep your tests fast). In .NET this could mean using SQLite with NHibernate for example or if you&#8217;re starting from the beginning maybe just writing everything to in-memory implementations and doing your real persistence work later in development (a sane way to work anyway tbh).</p>
<p>Anyway, that&#8217;s up to you &#8211; I would advocate that for *most* logic in *most* applications that this sort of headless full-stack testing is a better use of time and energy than striving for isolated unit tests for most scenarios (You can always drop down to testing components in isolation where necessary anyway &#8211; follow the pain and all that).</p>
<p>By having a half decent suite of tests that describe the behaviour expected from the application, you&#8217;ll likely catch a lot of silly mistakes that would otherwise slip through to production. The tooling now exists to make testing easy so there is little excuse not to do it.</p>
<p><strong>Use coffeescript</strong></p>
<p>I actually don&#8217;t like Coffeescript all that much, I don&#8217;t really like Ruby all that much either &#8211; the best languages are the ones with a few constructs to pick up and run with instead of 15 million ways to avoid writing an if statement or for-loop.</p>
<p>That said, JS isn&#8217;t very terse, Coffeescript is &#8211; and I value that sometimes, I especially value it in my tests where I don&#8217;t have the same problems of mapping between the languages as I would in the multitude of browsers that we have to support these days.</p>
<p><em>Consider this test:</em></p>
<pre class="brush: jscript; title: ; notranslate">
Scenario(&quot;Basic Lobbying&quot;, function() {
  var context = new ManualContext()
    , bob = null
  
  Given(&quot;A server in a clean state&quot;, function(done) {
    context.start(done)
  })
  When(&quot;bob connects&quot;, function(done) {
    bob = context.add_client_called('bob', done)
  })
  Then(&quot;bob should have a canvas displayed&quot;, function() {
    bob.should_have_element('canvas')
  })
  And(&quot;bob should be told he is the only one&quot;, function() {
    bob.clientCount().should.include('only player')
  })
  And(&quot;bob should be waiting for other players&quot;, function() {
    bob.isWaiting().should.equal(true)
  })
  And(&quot;bob shouldn't see the text input controls&quot;, function() {
    bob.can_see_text_input().should.equal(false)
  })
  And(&quot;bob shouldn't see the paintbrush controls&quot;, function() {
    bob.can_see_paintbrushes().should.equal(false)
  })
  And(&quot;bob shouldn't see the time left&quot;, function() {
    bob.can_see_time_left().should.equal(false)
  })
})
</pre>
<p><em>Now written in Coffeescript</em></p>
<pre class="brush: jscript; title: ; notranslate">
Scenario &quot;Basic Lobbying&quot;, -&gt;
  context = new ManualContext()
  bob = null
  
  Given &quot;a server in a clean state&quot;, (done) -&gt;
    context.start done
  When &quot;bob connects&quot;, (done) -&gt;
    bob = context.add_client_called 'bob', done
  Then &quot;bob should have a canvas displayed&quot;, -&gt;
    bob.should_have_element('canvas')
  And &quot;bob should be told he is the only one&quot;, -&gt;
    bob.clientCount().should.include('only player')
  And &quot;bob should be waiting for other players&quot;, -&gt;
    bob.isWaiting().should.equal(true)
  And &quot;bob shouldn't see the text input controls&quot;, -&gt;
    bob.can_see_text_input().should.equal(false)
  And &quot;bob shouldn't see the paintbrush controls&quot;, -&gt;
    bob.can_see_paintbrushes().should.equal(false)
  And &quot;bob shouldn't see the time left&quot;, -&gt;
    bob.can_see_time_left().should.equal(false)
</pre>
<p>There isn&#8217;t a huge amount of difference, but I really value the lack of noise in Coffeesript-driven-tests and it saves from bothering with more hideous ways of doing things like Cucumber/etc.</p>
<p><strong>Don&#8217;t use Coffeescript</strong></p>
<p>Enough has been written about this in every single mailing list item that even dares to mention coffeescript since the dawn of time, but basically it turns out that JS is nice enough in most cases and Coffeescript is just a nice way of keeping things terse and learning JS. It can cause a lot of problems itself (usually around debugging &#8211; even though browsers are beginning to implement source-code maps, that&#8217;s not going to be universal) and you end up having to learn JS and map it to the CS in your head as you write it (at least to begin with)</p>
<p>Whatever, I advise you learn JS and perhaps allow CS for places where you feel terseness really adds a pile more value.</p>
<p><strong>Manage your dependencies</strong></p>
<p>Before getting into a conversation about module systems in Javascript, it needs pointing out that having a web of dependencies between your own code files is a bad thing. Like a lot of the pains in JS, the best way to avoid the pain is to avoid creating the pain in the first place.</p>
<p>For example, if you find yourself missing &#8216;re-factoring across the entire solution&#8217;, you should question why you need that in the first place, if you have libraries which are in use across in so many places across the code-base and they&#8217;re not stable and shipped as separate packages with a sensible backwards compatability story then you should be questioning this instead of falling back on tooling to cover up a pain.</p>
<p>Thinking in terms of components can be really useful, a component within your project should have a single task to do and should hopefully just expose a single object to do that task. It should ideally be standalone or at least declare its dependencies explicitly somewhere.</p>
<p>This is somewhat a double edged sword for Javascript, there is no in-built module/package system which means a dozen competing ways of managing code across an application now exist. That competition means that (hopefully) the community has got this whole thing pretty much nailed.</p>
<p><strong>CommonJS</strong></p>
<p>CommonJS seems a bit over-cooked (like most specs) if you go to read the standard itself, but given the most popular implementation of CommonJS isn&#8217;t even an implementation of CommonJS (the NodeJS implementation) there isn&#8217;t much point in doing that.</p>
<p>What it effectively boils down to is that rather than relying on code files sticking things into the global namespace, and a build process/include order that takes into account the dependencies, that the code files themselves declare what their dependencies are.</p>
<p>So, instead of</p>
<pre class="brush: jscript; title: ; notranslate">
(function(exports) {
  var privateVariable = null
  function EventBus() {}
  exports.EventBus = EventBus
})(window)
</pre>
<p>and</p>
<pre class="brush: jscript; title: ; notranslate">
(function(exports) {
  EventBus.publish('I am loaded now')
})(window)
</pre>
<p>And a build file that looks something like</p>
<pre class="brush: jscript; title: ; notranslate">cat eventbus.js consumer.js &gt;&gt; app.js</pre>
<p>We can have</p>
<pre class="brush: jscript; title: ; notranslate">
var privateVariable = null
var EventBus = function() {}
module.exports = EventBus</pre>
<p>and</p>
<pre class="brush: jscript; title: ; notranslate">
var EventBus = require('./eventbus')
EventBus.publish('I am loaded now')</pre>
<p>And a build script that simply does</p>
<pre class="brush: jscript; title: ; notranslate">browserify consumer.js -o app.js</pre>
<p>There are actually a dozen tools implementing this, that one is Browserify which you can get by having nodejs and running</p>
<pre class="brush: jscript; title: ; notranslate">npm install -g browserify</pre>
<p>This however comes with caveats, the main one being that your debugging experience in the browser starts being a bit lame when errors no longer correspond to actual lines of code in the editor. (Having one giant file instead of all those little ones). The synchronous manner in which files are included in CommonJS-ish systems doesn&#8217;t lend itself to the web very well.</p>
<p>This is where AMD comes in</p>
<p><strong>Asynchronous Module Definitions</strong></p>
<p>The main implementation of this is requirejs, and our initial use of it will look very much like the above, but with a &#8216;bit more noise&#8217;</p>
<pre class="brush: jscript; title: ; notranslate">
define(function() {
  var privateVariable = null
  var EventBus = function() {}
  return EventBus
})
</pre>
<p>and</p>
<pre class="brush: jscript; title: ; notranslate">
define([ './eventbus' ], function(EventBus) {
  EventBus.publish('I am loaded')
})
</pre>
<p>The key visible difference here is that rather than require the files and assume they&#8217;re instantly present, we instead present the files we rely on, and say &#8220;When you have them, please execute my callback&#8221;</p>
<p>What this means is in the browser world, we can do the following without any build process</p>
<pre class="brush: jscript; title: ; notranslate">&lt;script src=&quot;require.js&quot; data-main=&quot;consumer&quot;&gt;&lt;/script&gt;</pre>
<p>And the browser will download all of the original files individually.</p>
<p>In production, we can instead optimise by running a build command such as</p>
<pre class="brush: jscript; title: ; notranslate">r.js -o consumer out=app</pre>
<p>And include that in a similar fashion</p>
<pre class="brush: jscript; title: ; notranslate">&lt;script src=&quot;require.js&quot; data-main=&quot;app&quot;&gt;&lt;/script&gt;</pre>
<p>Therefore getting the advantage that having a single optimised and compiled file bring.</p>
<p>What I&#8217;m not going to do is say &#8220;use X&#8221; at this point, this really does depend on your application, whether you have an SPA, a website, a large project a small project etc. Just consider that if you have a build script that you need to manually keep in sync with your code dependencies that you might want to bring in *something* to help you.</p>
<p><strong>Don&#8217;t fight Javascript</strong></p>
<p>If you have code that looks like this</p>
<pre class="brush: jscript; title: ; notranslate">
DefineNamespace('Company.Foo')
Company.Foo.Vegetable = DefineClass({
  init: function() {
    console.log('This is a ctor, honest')
  }
})


Company.Foo.Courgette = DefineClass({
  init: function() {
    this.super()
    console.log('This is also a ctor')
  }
},
Company.Foo.Vegetable)
</pre>
<p>Then consider that this is not quite how things were intended to be. Namespaces are a holdover from the times we didn&#8217;t have decent module systems in JS (and from traditional enterprise languages like C#, Java, etc), and having weird classical inheritance simulations mean having to debug and trace through weird classical inheritance simulations.</p>
<pre class="brush: jscript; title: ; notranslate">
var Vegetable = function() {
  console.log('This is a ctor, honest')
}
var Courgette = function() {
  Vegetable.call(this)
}
util.copyAllMethods(Vegetable.prototype, Courgette.prototype)
</pre>
<p>The only valid excuse for having weird other-language-simulations is if you&#8217;re writing a cross-compiler and this is code-genned code.</p>
<p><strong>Pattern enforcing frameworks do not give you clean separation</strong></p>
<p>MVVM,MVC, MV*, MUUUMY, leaving aside the bizarreness which is the enterprise developer&#8217;s love of data-binding, a reason oft-quoted for using a tool like Knockout is &#8220;it enforces separation between presentation and logic&#8221; and &#8220;it means our code will be organised and consistent&#8221;</p>
<p>We&#8217;ve heard this before in the Silverlight world (yes, I have done my time there, even recently &#8211; it pays the bills), MVVM gives us testability and re-use and separation and and and&#8230;</p>
<p>Then you look in the code and you have a 4000 line view model which nobody is actually testing because it&#8217;s too hard. Separation between presentation and logic is arbitrary and often unuseful, we&#8217;ve all heard the rants on that one (especially with respect to templating languages), seperation between logical units of functionality is much more useful and only happens if you&#8217;re listening to the code/tests/pain/etc</p>
<p>That&#8217;s not to say don&#8217;t use any of those things, but be mindful that you&#8217;re still going to have to work hard to keep your code meaningful and organised, and that&#8217;s not something you can download a library for.</p>
<p><strong>Embrace the tool-chain</strong></p>
<p>We can use nodejs &#8211; I don&#8217;t mean writing your application in nodejs, I mean installing nodejs and using some of the great tools that are available in NPM to drive your build and test processes. Just because you&#8217;re writing Java or .NET doesn&#8217;t mean you should restrict yourself to the often shoddy tools available in those platforms.</p>
<p>Already we&#8217;ve seen a few packages that can help us there (zombie, jshint, mocha, browserify, r.js), but there are a whole wealth of testing packages, asset management packages and other such tools that can form an essential part of your build chain when doing the JS front-end for an java/.NET backend.</p>
<p>Writing tests in Javascript to test Javascript and not needing to fire up a browser or go through contortions getting .NET to exercise the front-end has some real value and will save time, and hooking in the tool-chain to the usual build process means getting the best of both worlds in the right places.</p>
<p>Adding ponies will help too, but mostly concentrating on keeping things small, understandable and idiomatic (whatever that means) will keep your JS from becoming a write-only mess.</p>
]]></content:encoded>
			<wfw:commentRss>http://codebetter.com/robashton/2012/09/03/keeping-js-sane/feed/</wfw:commentRss>
		<slash:comments>13</slash:comments>
		</item>
		<item>
		<title>Finding a balance with ASP.NET MVC</title>
		<link>http://codebetter.com/robashton/2011/06/13/finding-a-balance-with-asp-net-mv/</link>
		<comments>http://codebetter.com/robashton/2011/06/13/finding-a-balance-with-asp-net-mv/#comments</comments>
		<pubDate>Mon, 13 Jun 2011 16:48:00 +0000</pubDate>
		<dc:creator>Rob Ashton</dc:creator>
				<category><![CDATA[asp.net]]></category>
		<category><![CDATA[mvc]]></category>

		<guid isPermaLink="false">http://codebetter.com/robashton/?p=19</guid>
		<description><![CDATA[The other day I did a talk at DDD South West, cheekily entitled &#8220;ASP.NET MVC, coping with mediocrity&#8221;,  pitched on the agenda as being fairly heavily negative about ASP.NET MVC, but in reality summarising that it&#8217;s okay so long as you&#160;&#8230; <a href="http://codebetter.com/robashton/2011/06/13/finding-a-balance-with-asp-net-mv/">Continue&#160;reading&#160;<span class="meta-nav">&#8594;</span></a>]]></description>
			<content:encoded><![CDATA[<p>The other day I did a talk at DDD South West, cheekily entitled &#8220;ASP.NET MVC, coping with mediocrity&#8221;,  pitched on the agenda as being fairly heavily negative about ASP.NET MVC, but in reality summarising that it&#8217;s okay so long as you understand its limitations and that you don&#8217;t spend all of your time being angry and fighting it.</p>
<p>I&#8217;ve been asked to structure  some of the information into a blog post so here is my attempt at that. <em>Note: This is old ground for a lot of people, and is pitched at those asking the questions after my session.</em></p>
<p><strong>Choosing ASP.NET MVC</strong></p>
<p>There are several reasons we end up going with ASP.NET MVC, the loudest three seem to be that &#8220;<em>it&#8217;s easy to get training on it</em>&#8220;, &#8221;<em>we can easily hire people who know it</em>&#8220;, and &#8220;<em>it&#8217;s from Microsoft and we&#8217;re a Microsoft Shop</em>&#8220;. Two of these are valid and the other seems valid when you&#8217;re a manager on the outside, looking in on the other two.</p>
<p>Assuming that ASP.NET MVC is what you or somebody else has chosen, you&#8217;ve subscribed yourself to doing things the way it thinks, and whether not you regard it to think like the class dunce, this still remains true.</p>
<p>From what I see, there are four main problems that people have with Microsoft&#8217;s ASP.NET MVC Framework, in no particular order these seem to be, &#8220;<em>Microsoft</em>&#8220;, &#8220;<em>ASP.NET&#8221;</em>, &#8220;<em>MVC</em>&#8221; and &#8220;<em>Framework</em>&#8220;, some of these more so than others.</p>
<p>The following writings come from the perspective of somebody wanting to perform a half-decent level of testing within an application, but without going overboard on layers or enterprise &#8220;magic&#8221;.</p>
<p><strong>ASP.NET</strong></p>
<p>Microsoft gets a lot of flack for this stack, and rightfully so, it is for the most part a massive klooge fest of train-wrecks and bizarre decisions that make it possible to completely blow your own foot off if you&#8217;re not careful to guard against it.</p>
<p>Keeping ASP.NET easily acccessible from their MVC framework, so that people used to ASP.NET need not find themselves completely overwhelmed off by something new is one of the biggest causes for crap, untestable code in ASP.NET MVC applications.<br />
However, this is easily managed by treating ASP.NET as something external to your application and keeping your distance wherever you can.</p>
<p>Consider the following example of ASP.NET MVC code:</p>
<pre class="brush: csharp; title: ; notranslate">
        [HttpPost]
        public ActionResult DoSomethingCool()
        {
            if (Session[&quot;water&quot;] == &quot;boiling&quot;)
            {
                Server.TransferRequest(&quot;~/408.aspx&quot;);
            }
            return View();
        }
</pre>
<p>Clearly I can&#8217;t test this, as I&#8217;m directly accessing the base controller which &#8220;conveniently&#8221; gives me access to all the gubbins that ASP.NET ships with.</p>
<p>Yes, the team have stuck all the sealed classes behind a set of &#8216;wrappers&#8217; which are virtual and override-able, giving us the ability to &#8216;mock&#8217; them, but this isn&#8217;t the answer, as not only are they a massive dependency to take on &#8211; they also have really high surface areas and actually constructing the objects to populate the &#8216;ControllerContext&#8217; with is a huge pain in testing.</p>
<pre class="brush: csharp; title: ; notranslate">

        [Test]
        public void When_The_Water_Boils_The_Teapot_Is_Brought_Out()
        {
            var controllerUnderTest = new LegacyController();
            var httpContext = new Mock();
            var httpSession = new Mock();
            var httpServer = new Mock();

            httpSession.SetupGet(x =&gt; x[&quot;water&quot;]).Returns(&quot;boiling&quot;);
            httpContext.SetupGet(x =&gt; x.Session).Returns(httpSession.Object);
            httpContext.SetupGet(x =&gt; x.Server).Returns(httpServer.Object);

            controllerUnderTest.ControllerContext = new ControllerContext(
                httpContext.Object,
                new RouteData(),
                controllerUnderTest);

            controllerUnderTest.DoSomethingCool();

            httpServer.Verify(x =&gt; x.TransferRequest(&quot;~/418.aspx&quot;), Times.Once());

        }
</pre>
<p>Of course, there are tools that can help you minimise this pain, but in that case you&#8217;re fixing the wrong problem. Another oft-seen solution to this is often either creating interfaces that map onto HttpServer/etc and passing them into the controller, or just sticking HttpContextBase into the container itself &#8211; this makes things more testable but still doesn&#8217;t lead to especially good tests or readable code.</p>
<pre class="brush: csharp; title: ; notranslate">

        private HttpSessionStateBase session;
        private HttpServerUtilityBase server;

        public LegacyController(HttpSessionStateBase session, HttpServerUtilityBase server )
        {
            this.session = session;
            this.server = server;
        }

        [HttpPost]
        public ActionResult DoSomethingCooler()
        {
            if (this.session[&quot;water&quot;] == &quot;boiling&quot;)
            {
                server.TransferRequest(&quot;~/408.aspx&quot;);
            }
            return View();
        }

</pre>
<p>And the test</p>
<pre class="brush: csharp; title: ; notranslate">

        [Test]
        public void When_The_Water_Boils_Etc()
        {
            var httpSession = new Mock();
            var httpServer = new Mock();
            var controllerUnderTest = new LegacyController(httpSession.Object, httpServer.Object);

            httpSession.SetupGet(x =&gt; x[&quot;water&quot;]).Returns(&quot;boiling&quot;);

            controllerUnderTest.DoSomethingCooler();

            httpServer.Verify(x =&gt; x.TransferRequest(&quot;~/408.aspx&quot;), Times.Once());

        }

</pre>
<p>The problem is, that if you bootstrap these in, you&#8217;re still not thinking about the meaning of the actual code you&#8217;re writing. If you&#8217;re doing some form of TDD you&#8217;ll have written your controller and discovered a role that needs fulfilling by an external object of some sort, and in this case the role isn&#8217;t being surfaced because we&#8217;re passing in an object with no meaning in our system.</p>
<p>The test is also quite brittle because it&#8217;s caring a bit too much about the &#8216;how&#8217; rather than the &#8216;what&#8217;, let&#8217;s see what I mean by this by refactoring this code slightly.<br />
First off, when writing the test, We establish that we need something that boils water, this is a role that we can create an interface for that looks something like this:</p>
<pre class="brush: csharp; title: ; notranslate">
public interface IBoilWater
{
	bool WaterIsBoiling();
}
</pre>
<p>And when it comes to implementing this, we might then create a Kettle:</p>
<pre class="brush: csharp; title: ; notranslate">
// Let's not get into the debate over whether this should simply be IBoilable and Water, this is a silly example
public class Kettle : IBoilWater
{
	bool WaterIsBoiling() {
		return this.waterTemperature &gt;= 100;
	}
}
</pre>
<p>This could take in my HttpSessionBase directly in the constructor and return that value directly, that would make my Kettle a Facade onto the external system, or we could also move to have an IContainSessionState which gets passed into this if we so choose. If &#8220;Kettle&#8221; has a lot of business logic then that&#8217;s probably what will happen.</p>
<p>The biggest change here is that semantically our code makes bit more sense.</p>
<p>How about that server re-direct? Well actually, we&#8217;re not using the ASP.NET MVC framework the way it was intended if we&#8217;re calling into something directly to make that happen. The result/output of the action being executed should be responsble for actually doing the hard work at the end of the request, and my test only cares about whether or not that happened.</p>
<p>We have ActionResult for a reason, and whether we argue about this being a good thing or not, we should use the framework the way it was intended and return something like:</p>
<pre class="brush: csharp; title: ; notranslate">
public TeapotResult : ActionResult
{
        public override void ExecuteResult(ControllerContext context)
        {
		HttpContext.Current.Server.TransferRequest(&quot;~/408.aspx&quot;);
        }
}
</pre>
<p>This isn&#8217;t testable in isolation but can be considered as a thin facade around the cruft that is ASP.NET.  I&#8217;ll talk more about the failings of this when I cover custom pipelines later in this blog entry.</p>
<p>Putting this together, we end up with:</p>
<pre class="brush: csharp; title: ; notranslate">

        public ActionResult DoCoolStuff()
        {
            if(waterBoiler.IsWaterBoiling())
            {
                return new TeapotResult();
            }
            return View();
        }
</pre>
<p>With the test</p>
<pre class="brush: csharp; title: ; notranslate">
        [Test]
        public void When_The_Water_Boils_Etc_Etc()
        {
            var kettle = new FakeKettle.CreateBoilingKettle();
            var controller  = new LegacyController(kettle);

            var result = controller.DoCoolStuff();

            Assert.That(result, Is.InstanceOf());
        }
</pre>
<p>Not only does the code make sense to anybody reading (it&#8217;s very explicit), the test doesn&#8217;t care &#8216;how&#8217; the teapot result works, it just cares that a teapot result is gained (the what).<br />
The lesson we&#8217;ve learned here, is that the legacy ASP.NET can be hidden away if you need to use it, and that doesn&#8217;t just mean creating interfaces that map one-to-one onto ASP.NET.</p>
<p><strong>Controller Bloat</strong></p>
<p>The typical piece of demo code looks something like this:</p>
<pre class="brush: csharp; title: ; notranslate">
        public ActionResult Index(string id)
        {
            using(var context = new DataContext())
            {
                var product = context.Load(id);
                return View(product);
            }
        }

        [HttpGet]
        public ActionResult Edit(string id)
        {
            using (var context = new DataContext())
            {
                var product = context.Load(id);
                return View(product);
            }
        }

        [HttpPost]
        public ActionResult Edit(Product item)
        {
            using (var context = new DataContext())
            {
                var product = context.Load(item.Id);
                this.UpdateModel(product);
                context.Save();
            }
            return View();
        }
</pre>
<p>Which is great, except we&#8217;re not in this case worrying about security, validation, business logic, and anything else that might creep into the development pipeline over time. Sometimes this might actually be the case, in which case you&#8217;re just building a simple CRUD app, and testability isn&#8217;t likely to be a valid concern because you&#8217;re not likely to have a high maintenance burden on this code.</p>
<p>However, in the case where business logic does end up happening, and validation tends to end up requiring a bit more than a pile of attributes can provide, not to mention everything else that can happen this is going to cause us issues.<br />
We also have the problem in the above code that we&#8217;re going to have a load of hidden Select N+1 problems as a consequence of sending our model (complete with proxies) to the view for data-display.</p>
<p>We do very quickly decide that binding directly to a set of POCOs provided by our ORM is a bad idea (thankfully), and think of M as something conceptual behind the controller. The rest of our code often doesn&#8217;t change much however, for example:</p>
<pre class="brush: csharp; title: ; notranslate">
    public class ProductsController : Controller
    {
        private readonly IContainProducts productRepository;
        private readonly ISearchForProducts productsIndex;
        private readonly IContainCustomers customerRepository;
        private readonly IShipProducts productShipper;
        private readonly ICoordinateSales salesCatalog;

        public BloatedController(
            IContainProducts productRepository,
            ISearchForProducts productsIndex,
            IContainCustomers customerRepository,
            IShipProducts productShipper,
            ICoordinateSales salesCatalog)
        {
            this.productRepository = productRepository;
            this.salesCatalog = salesCatalog;
            this.productShipper = productShipper;
            this.customerRepository = customerRepository;
            this.productsIndex = productsIndex;
        }

        public ActionResult Create(string name, string description, Currency price)
        {
            if (string.IsNullOrEmpty(name))
            {
                this.ModelState.AddModelError(&quot;name&quot;, &quot;Name cannot be empty&quot;);
            }
            if (string.IsNullOrEmpty(description))
            {
                this.ModelState.AddModelError(&quot;description&quot;, &quot;Description cannot be empty&quot;);
            }
            if (price != null)
            {
                this.ModelState.AddModelError(&quot;price&quot;, &quot;Price cannot be empty&quot;);
            }

            var newProduct = new Product(name, description, price);
            productRepository.Add(newProduct);

            return View();
        }

        public ActionResult SingleItem(string id)
        {
            if (string.IsNullOrEmpty(id))
            {
                return RedirectToAction(&quot;Search&quot;);
            }

            var productView = productsIndex
                .Query()
                .Where(x =&gt; x.Id == id)
                .As()
                .First();

            return View(productView);
        }

        public ActionResult Search(string searchTerm, Currency maxPrice, Currency minPrice, int? limit)
        {
            var query = productsIndex.Query();

            if (!string.IsNullOrEmpty(searchTerm))
            {
                query.Where(x =&gt;
                                    x.Description.Contains(searchTerm) ||
                                    x.Title.Contains(searchTerm));
            }
            if (maxPrice != null)
            {
                query.Where(x =&gt; x.Price.LessThan(maxPrice));
            }
            if (minPrice != null)
            {
                query.Where(x =&gt; x.Price.GreaterThan(minPrice));
            }

            var results = query
                .As()
                .Limit(limit ?? 100)
                .ToArray();

            return View(results);
        }

        public ActionResult WhatsNew()
        {
            var results = productsIndex.Query()
                .Where(x =&gt; x.DateAdded &lt; DateTime.Now.Subtract(TimeSpan.FromDays(2)))
                .As()
                .ToArray();

            return View(results);
        }

        [Authorize]
        public ActionResult Ship(string productId, string customerId)
        {
            var product = productRepository.Get(productId);
            var customer = customerRepository.Get(customerId);

            if(product == null)
            {
                this.ModelState.AddModelError(&quot;productId&quot;, &quot;Product must exist&quot;);
            }

            if (customer == null)
            {
                this.ModelState.AddModelError(&quot;customerId&quot;, &quot;Customer must exist&quot;);
            }

            if(this.ModelState.IsValid)
            {
                productShipper.ShipProductToCustomer(product, customer);
            }
            return View();
        }

        [Authorize(Roles=&quot;Admin&quot;)]
        public ActionResult CreateSeasonalOffer(string productId, int percentageOff, TimeSpan duration)
        {
            var product = productRepository.Get(productId);

            if (product == null)
            {
                this.ModelState.AddModelError(&quot;productId&quot;, &quot;Product must exist&quot;);
            }

            if (percentageOff &gt; 0)
            {
                this.ModelState.AddModelError(&quot;percentageOff&quot;, &quot;Percentage must be non-zero and positive&quot;);
            }

            if (this.ModelState.IsValid)
            {
                salesCatalog.CreateSeasonalOffer(product, percentageOff, duration);
            }
            return View();
        }
    }

</pre>
<p>This isn&#8217;t actually the worst example I could come up with, being only a couple of hundred lines long, but scale it up across an entire code base with some of the more real business logic and workflow concerns in a more full-on application and we&#8217;re going to be feeling the pain pretty fast.<br />
The default conventions of the controller name dictating the route is what gets us here typically, a desire to keep all the above actions under the /Products route has given us a controller with too many actions and thus too many dependencies.</p>
<p>The controller actions themselves being packed with logic is a problem we have caused for ourselves, but the way that ASP.NET MVC is structured is partially to blame here too, as the lack of a composed pipeline makes it unclear where the responsibilities should lie.</p>
<p>Automated testing of the above would be be fraught with danger and brittleness because of the multitude of concerns and dependencies and logic paths.</p>
<p>The example &#8220;bad code&#8221; does come with some benefits however &#8211; in that it is very explicit and cohesive, there is no hidden magic happening, so any novice developer can go to a controller action and start fixing bugs and adding new ones.</p>
<p>I believe that this explicitness is often overlooked when looking at alternative ways of structuring our applications, and while a lot of us might decry those who look at the pipeline models of Fubu/OpenRasta and accuse all those interfaces/generics and convention-driven magic of being &#8220;complicated&#8221;, a lot of developers aren&#8217;t living in that world and sometimes we should be understanding of that.</p>
<p>Now onto how we improve the above code, as well as another example or two of problems we might encounter, with the goal of making it not only more testable, but keeping the explicitness that we have and we already acknowledge as good.</p>
<p>A mantra oft-repeated by the Good Practises crowd (and rightfully so) is that controllers should have very little logic in them, that they should be coordinating and coordinating only. Taking this to its all too common extremes we can end up with an Enterprise Controller that looks something like this:</p>
<pre class="brush: csharp; title: ; notranslate">
    public class ProductsController : EnterpriseController
    {
        private readonly IProductsService productsService;

        public ProductsController(IProductsService productsService)
        {
            this.productsService = productsService;
        }

        [HttpGet]
        public ActionResult Index(string id)
        {
            var product = this.productsService.GetProduct(id);
            return View(product);
        }

        [HttpGet]
        public ActionResult Edit(string id)
        {
            var product = this.productsService.GetProduct(id);
            return View(product);
        }

        [HttpPost]
        public ActionResult Edit(Product item)
        {
            this.productsService.UpdateProduct(item.Id,item.Name, item.Price);
            return View();
        }
    }

</pre>
<p>Or similar, which doesn&#8217;t really solve the problem (I&#8217;d hazard a guess that the code behind those service calls looks almost identical to that found in the original controller). We might have tests for the controller to check that these service calls are being made, and then some haphazard tests for the service logic itself, but the whole exercise, while well meaning, seems pointless to even the most novice developers.</p>
<p>I&#8217;m not saying that this is an entirely invalid approach, but that in most applications, introducing a forced layer between the framework and our code doesn&#8217;t add a lot of value.<br />
Let&#8217;s go back to that first method and see what we can do to make it easier on the eyes and easier on the tests.</p>
<pre class="brush: csharp; title: ; notranslate">
        public ActionResult Create(string name, string description, Currency price)
        {
            if (string.IsNullOrEmpty(name))
            {
                this.ModelState.AddModelError(&quot;name&quot;, &quot;Name cannot be empty&quot;);
            }
            if (string.IsNullOrEmpty(description))
            {
                this.ModelState.AddModelError(&quot;description&quot;, &quot;Description cannot be empty&quot;);
            }
            if (price != null)
            {
                this.ModelState.AddModelError(&quot;price&quot;, &quot;Price cannot be empty&quot;);
            }

            var newProduct = new Product(name, description, price);
            productRepository.Add(newProduct);

            return View();
        }
</pre>
<p>The first thing that stands out is the inline validation, the reason for which is clear &#8211; that we have our parameters being passed in individually (Perhaps because we decided not to bind to our model directly because that causes so many probems). We&#8217;ll use the validation here to represent anything else that might also creep in to our controllers, it is not that unique a concern.</p>
<p>So many of our problems can be solved in any pipeline by adopting a uniform shape across that pipeline, one-model-in, one-model-out is something that the Fubu guys have adopted but there is no reason we can&#8217;t do the same in ASP.NET MVC.</p>
<p>Let&#8217;s take our Create method, change the method signature so that it takes in a model,and push some of our controller logic into that model.</p>
<pre class="brush: csharp; title: ; notranslate">
        public ActionResult Create(CreateProductCommand command)
        {
            if(command.ValidateInto(this.ModelState))
            {
                var newProduct = command.CreateProduct();
                productRepository.Add(newProduct);
            }
            return View();
        }
</pre>
<p>We can end up easily with something that looks like this &#8211; which has all the explicitness of the original example, but has achieved our goal. No, it&#8217;s not &#8220;technically perfect in every way&#8221;, but it has the advantage that the validation can be tested outside the controller, as can product creation, but that doesn&#8217;t stop us testing the lot in a more &#8216;outside&#8217; feature-level approach &#8211; especially if the logic in those components is all very simple.</p>
<p>Let&#8217;s take another one and have a look at fixing that so it&#8217;s a bit more terse and fits in with this approach:</p>
<pre class="brush: csharp; title: ; notranslate">
        public ActionResult Search(string searchTerm, Currency maxPrice, Currency minPrice, int? limit)
        {
            var query = productsIndex.Query();

            if (!string.IsNullOrEmpty(searchTerm))
            {
                query.Where(x =&gt;
                                    x.Description.Contains(searchTerm) ||
                                    x.Title.Contains(searchTerm));
            }
            if (maxPrice != null)
            {
                query.Where(x =&gt; x.Price.LessThan(maxPrice));
            }
            if (minPrice != null)
            {
                query.Where(x =&gt; x.Price.GreaterThan(minPrice));
            }

            var results = query
                .As()
                .Limit(limit ?? 100)
                .ToArray();

            return View(results);
        }
</pre>
<p>First off, read operations can fit into our one-model-in, one-model-out approach too, our main bulk of work here appears to be the population of the query object from the set of input parameters.</p>
<p>We can push that into our query model, and we don&#8217;t need to do any further abstraction because it already makes our controller action nice and thin.</p>
<pre class="brush: csharp; title: ; notranslate">
        public ActionResult Search(SearchProductsQuery query)
        {
            var searchView = query.From(productsIndex);
            return View(searchView);
        }
</pre>
<p>In this, our query model knows how to populate the query object and return the data from that query object - perhaps we might end up discovering that it best be that it only populates the query object and our controller take care of modifying the query a bit more (A micro-pipeline if you will), but in this instance we&#8217;ve again maintained our explicitness and kept it readable.</p>
<p>Let&#8217;s take a look at one more before moving onto the next topic:</p>
<pre class="brush: csharp; title: ; notranslate">
        public ActionResult SingleItem(string id)
        {
            if (string.IsNullOrEmpty(id))
            {
                return RedirectToAction(&quot;Search&quot;);
            }

            var productView = productsIndex
                .Query()
                .Where(x =&gt; x.Id == id)
                .As()
                .First();

            return View(productView);
        }
</pre>
<p>We only querying for a single property, why put it into a model? Well for one thing, it&#8217;ll potentially make our tests less brittle, as an addition to our query means changing only the model and the builders and leaving most of the tests themselves alone.</p>
<p>It will also allow us to put the logic in an appropriate place for performing the query and validation.</p>
<pre class="brush: csharp; title: ; notranslate">
        public ActionResult SingleItem(SingleItemQuery query)
        {
            if (!query.MakesSense()) {
                return RedirectToAction(&quot;Search&quot;);
            }
            var productView = query.From(productsIndex);
            return View(productView);
        }
</pre>
<p>I think perhaps if we found ourselves doing this a lot, rather than the <em>RedirectToAction(&#8220;Search&#8221;)</em>, we might choose instead to have a<em> return new RedirectToMainSearchPage() </em>action, but in this case we decided this isn&#8217;t<br />
too harmful and nobody is going to get too hurt by leaving it in here.</p>
<p>I think we get the gist of all this now, and speaking of gists, the gist for this iteration of refactoring the controller can be found <a href="https://gist.github.com/1023120">here</a>:</p>
<p><strong>Constructor bloat</strong></p>
<p>We are still left with the problem of the constructor bloat though, that hasn&#8217;t changed. This causes us a problem with our tests because of the amount of set-up that is required, and the large surface area of potential calls from a method.</p>
<p>We already covered one possible solution to that (pushing all the logic to an IProductsService) and why we probably wouldn&#8217;t want to do that just to solve this problem.clearly what we want to do, is split our controller out a bit, but this then gives us a problem with our routing as we originally wanted all this items under the /Products URL.</p>
<p>Question that &#8211; why do we want all the items under the Products URL? Products is not a responsibility, it&#8217;s a type in our system so you&#8217;ll have a hard time trying to craft a controller around that.</p>
<p>Consider instead, ProductShipmentController, ProductSearchController, ProductUpdateController and so on and so forth. There is no harm having multiple actions on these as they&#8217;ll likely have similar dependencies and wants.</p>
<p>Going even further, we can even discuss the possibility of just having single action controllers, ASP.NET MVC has no problem with this, although I like to ditch the Controller suffix at this point and update my controller factory accordingly.</p>
<p>Consider:</p>
<pre class="brush: csharp; title: ; notranslate">
    public class CreateProductCommandHandler : Controller
    {
        private readonly IContainProducts productRepository;

        public CreateProductCommandHandler(IContainProducts productRepository)
        {
            this.productRepository = productRepository;
        }

        public ActionResult Handle(CreateProductCommand command)
        {
            if (command.ValidateInto(this.ModelState))
            {
                var newProduct = command.CreateProduct();
                productRepository.Add(newProduct);
            }
            return View();
        }
    }
</pre>
<p>or</p>
<pre class="brush: csharp; title: ; notranslate">
    public class SearchProductsQueryHandler : Controller
    {
        private readonly ISearchForProducts productsIndex;

        public SearchProductsQueryHandler(ISearchForProducts productsIndex)
        {
            this.productsIndex = productsIndex;
        }

        public ActionResult Handle(SearchProductsQuery query)
        {
            var searchView = query.From(productsIndex);
            return View(searchView);
        }
    }
</pre>
<p>Easy to test, easy on the eyes, and still has the explicitness of the original code. If you&#8217;re not comfortable with going this far, then don&#8217;t &#8211; I&#8217;m not advocating this as &#8216;best practise&#8217; &#8211; and you&#8217;ll get almost as far if you simply think about the responsibility boundaries as first suggested.</p>
<p><strong>Default conventions + file organisation</strong></p>
<p>By doing this however, we&#8217;ve unintentially created more problems for ourselves in trying to make our code more readable &#8211; chiefly this is that we&#8217;ve now got a lot of files and if we keep the default ASP.NET MVC project structure of grouping objects by their &#8216;type&#8217; rather than by their &#8216;responsibility&#8217;, it&#8217;s going to be hard to find related files for development.<br />
Areas are one way to solve this, although all that achieves by itself is that we have a lot more directories which still have the same structure of grouping objects by &#8216;type&#8217;.</p>
<p>Consider instead, the possibility of grouping features together (this will of course mean amending the view engine and the controller factory &#8211;  although this is very little bother in practise)</p>
<p><a href="http://codebetter.com/robashton/files/2011/06/features.png"><img class="alignnone size-medium wp-image-28" src="http://codebetter.com/robashton/files/2011/06/features-212x300.png" alt="" width="212" height="300" /></a></p>
<p>Doing this might make you think again about not creating single-action controllers as suddenly the project becomes a lot easier to navigate, even to those new to the project.</p>
<p><strong>The limitations of a fixed request pipeline</strong></p>
<p>Touched on briefly a few times so far, is that we&#8217;re making compromises to deal with the limitations of the fixed request pipeline present in ASP.NET MVC.<br />
Well, as discussed by Jeremy in <a href="http://codebetter.com/jeremymiller/2011/01/09/fubumvcs-internal-runtime-the-russian-doll-model-and-how-it-compares-to-asp-net-mvc-and-openrasta/">this post</a>, frameworks like Fubu or OpenRasta work along the basis of there being some sort of request, and a series of actions that happen along that request. Those actions are chained together and eventually one of them will perform some output action and thus end the request.</p>
<p>This looks something like this:</p>
<pre class="brush: csharp; title: ; notranslate">
    public interface IPipelineElement
    {
        void Handle(IRequest request);
    }

    public interface IRequest
    {
        void SetData(T input);
        T GetData();
    }

</pre>
<p>Where we might have:</p>
<pre class="brush: csharp; title: ; notranslate">
ModelBinder : IPipelineElement {}
JsonOutput : IPipelineElement {}
CommandHandler : IPipelineElement {}
Validation : IPipelineElement {}
RequestLogger : IPipelineElement {}
</pre>
<p>And these can be strung together in whatever order the bootstrapper determines, each putting items in and out of the request and each being testable in isolation (Given these inputs to the request, I expect these outputs when this pipeline element is executed.)</p>
<p>ASP.NET MVC does not work like this, instead you have a <em>Controller </em>which is where your coordination occurs, you have an <em>ActionResult </em>which is where your output occurs, and you have <em>Filters </em>which is where code that should be executed before all that goes.</p>
<p>With ASP.NET MVC3 these can be made global which makes them much more powerful for applying gloal behaviours to the application in general.<br />
The problem with the filters is that they are not equipped for working in the same manner as a flexible pipeline, you can put perhaps some ORM management in them (Transactions), Binding, and perhaps some Validation &#8211; but these filters won&#8217;t typically be interacting with one another (whereas with the pipeline system, they&#8217;re chained together in an explicitly defined order).</p>
<p>The point is, this is how it works, and fighting it is futile &#8211; trying to write an application on top of ASP.NET MVC in a generic pipeline pattern just leads to pain and confusion.</p>
<p>In the above examples, rather than try to do this, I&#8217;ve used ActionResults for my output and tested that I received them, binding takes place in the filters, as do probably common things like disable session, error handling, transaction management, but all the calls *into* my business logic goes into the controller.</p>
<p>It&#8217;s explicit and it&#8217;s simple and it&#8217;s good enough for 90% of us.</p>
<p>Yes, you can split it out and set the controller to just fire off commands to your domain, that&#8217;s cool too - if you need it, the rest of this article still applies in this case except the nomenclature of the models and controllers will change.</p>
<p><strong>Summary</strong></p>
<p><strong> </strong>What do you consider to be your goals to be when writing code? Testability? Maintainability? Readability?  Code beauty? A Happy customer?</p>
<p>Obviously none of these are not mutually exclusive, but often we find as developers we&#8217;re either sacrificing our code quality to keep the customer happy or telling the customer we&#8217;re sorry we can&#8217;t deliver on time because we &#8220;have some refactoring to do&#8221;.</p>
<p>Whatever the reality it is obvious that as developers we&#8217;re spending a lot of time fighting either ourselves or our technology stacks to get our jobs done effectively.</p>
<p>I open with this question because most of the people who dislike ASP.NET MVC are having a go at it because it doesn&#8217;t allow them to work in a certain way &#8211; it gets in their way of meeting the above goals in the manner to which they desire.</p>
<p>When you choose a framework, you are subscribing yourself to some of the philosophies of the developer(s) who designed that framework, I am becoming more and more convinced of this over time &#8211; and while frameworks exist that are &#8220;highly customisable&#8221; that doesn&#8217;t make this fact doesn&#8217;t go away &#8211; and indeed because they generally have a higher barrier to entry than their more &#8220;on rails&#8221; counter-parts there are some genuinely good reasons for avoiding them.</p>
<p>It is this that distinguishes, a framework from a library, and in my delvings into technology stacks on top of systems like node.js most of my development has been done by pulling libraries together, then writing code to do things &#8220;the way the application features demand&#8221;.</p>
<p>In other words, frameworks are typically opinionated, and in my opinion, in order to be a good framework, those opinions need to be present, and they need to be loud and clear, and the application being hosted in that framework need to agree wth those opinions.</p>
<p>I think one of the problems with ASP.NET MVC is that there very few *strong* opinions surfacing in it, other than &#8220;it must be easy to demo at TechEd&#8221; and &#8220;it must be easy to get started with&#8221; &#8211; contrasted with say, the focus in FubuMVC on testability, conventions and SOLID, DRY principles &#8211; and the focus in Rails in being able to deliver 90% of what the customer wants with ease.</p>
<p>If you are going to use ASP.NET MVC, then don&#8217;t try to write code in a manner to which it is not capable of doing, keep things explicit, keep things simple, and keep pushing your code inwards to places where it isn&#8217;t directly touching the framework.</p>
<p>You&#8217;ll find yourself happier as a consequence, because you&#8217;re not spending<br />
all of your time trying to fight the framework. Where ASP.NET MVC provides very clear extensibility, don&#8217;t be afraid of using it to re-shape your application to keep things tidy.</p>
<p>There are good stacks available on top of .NET itself, from minimalist frameworks like NancyFX + Simple.Data etc all the way to full on opinionated beasts like Fubu, ASP.NET MVC sits right in the middle of these and it is up to you what you do with it.</p>
<p>If you find yourself fighting the framework, then either switch to something that works the way you want it to work, or make compromises &#8211; it&#8217;s simple, application development is only ever as painful as you make it.</p>
]]></content:encoded>
			<wfw:commentRss>http://codebetter.com/robashton/2011/06/13/finding-a-balance-with-asp-net-mv/feed/</wfw:commentRss>
		<slash:comments>55</slash:comments>
		</item>
		<item>
		<title>Hello</title>
		<link>http://codebetter.com/robashton/2011/04/13/hello/</link>
		<comments>http://codebetter.com/robashton/2011/04/13/hello/#comments</comments>
		<pubDate>Wed, 13 Apr 2011 14:45:38 +0000</pubDate>
		<dc:creator>Rob Ashton</dc:creator>
				<category><![CDATA[general]]></category>

		<guid isPermaLink="false">http://codebetter.com/robashton/?p=7</guid>
		<description><![CDATA[Hi I&#8217;ve been criticised in the past for launching into the talks that I give and not giving enough of an introduction for the irrelevant details of who I actually am &#8211; so hi, I&#8217;m @robashton and I&#8217;ve joined CodeBetter&#160;&#8230; <a href="http://codebetter.com/robashton/2011/04/13/hello/">Continue&#160;reading&#160;<span class="meta-nav">&#8594;</span></a>]]></description>
			<content:encoded><![CDATA[<p><strong>Hi</strong></p>
<p>I&#8217;ve been criticised in the past for launching into the talks that I give and not giving enough of an introduction for the irrelevant details of who I actually am &#8211; so <em>hi</em>, I&#8217;m @<a href="http://twitter.com/robashton">robashton</a> and I&#8217;ve joined CodeBetter to write some posts here on the subjects that are close to me and hopefully relevant to this audience.</p>
<p>An entire post about who I am? Yeah &#8211; well I started off writing something of actual merit with a single sentence introduction but it didn&#8217;t seem quite right &#8211; I figured that a proper post detailing some of the technologies/subjects I am actually interested in might be a better idea and if anybody is interested in anything in particular then I can push some of those posts out sooner.</p>
<p><strong>RavenDB</strong></p>
<p>This is probably what I am most known for (when &#8216;known&#8217; at all), which is probably because I quite by accident did a large number of talks on it.  I got involved with RavenDB the middle of last year, and started pushing changes into immediately (and frustrating <a href="http://ayende.com/blog">Ayende </a>with edge cases as I tried to do a lot of things that a document database is ill suited for).</p>
<p>My favourite personal contribution to the project is probably the dynamic indexes, which are now the primary way of accessing the read-side of the database,  although the code is now unrecognisable from my initial commit of that feature.</p>
<p>These days my contributions are minimal as I have wandered into other areas of learning, although I do like to watch Ayende fix the really hard edge cases and pretend I&#8217;m actually helping <img src='http://codebetter.com/robashton/wp-includes/images/smilies/icon_wink.gif' alt=';-)' class='wp-smiley' /> .</p>
<p>I&#8217;ve got some posts on this and document databases in general lined up, I&#8217;m looking forward to re-visiting it and re-applying some other learnings that are orthogonal to this topic. I&#8217;ll be speaking about this subject at <a href="http://www.ndc2011.no/">NDC2011</a> in two separate talks, hint hint.</p>
<p><strong>Testing and OO</strong></p>
<p>I like testing and OO in theory as well as in practise, and the <a href="http://www.growing-object-oriented-software.com/">GOOS </a>book is one of the few books to have really grabbed my attention in the past few years. I won&#8217;t claim to be particularly good at it, but after a couple of years of practising and trying to get better, more efficient, more descriptive and less brittle I think I&#8217;ve reached a point where I don&#8217;t find these things to be a complete minefield to negotiate. I practise TDD or some form of it in most all my projects these days.</p>
<p>I&#8217;m not a very academic person (I use this as an euphemism for being a bit dim occasionally), and some of the language and discussion being bandied about goes way over my head at times &#8211; but I accept that at face value &#8211; and know that while those discussions will always take place, somebody will distil the end-results into a digestible format because we&#8217;re all learning at different levels at the end of the day.</p>
<p>I have a few posts about this area in the backlog, my thoughts on tell don&#8217;t ask, where my lines are drawn over test coverage, granularity and what I think of mocks and how I compose my builders. I think that the rest of the blogosphere has these angles well covered though, so I&#8217;m in no hurry to go documenting my thoughts on the subject. (Especially as it is ever changing and in 6 months I&#8217;d look at the posts and think &#8220;what a dolt&#8221;).</p>
<p><span style="color: #000000"><strong>Data, domains, persistence, architecture, etc</strong></span></p>
<p>Learn by theoretical extremes, and practise in moderation? I don&#8217;t try and do any one thing here, I just try to keep things simple and coherent whilst maintaining low coupling and striving for cohesiveness. I don&#8217;t think many code-bases really warrant much more than that, and I&#8217;m bored of seeing code-bases with layer on layer of interfaces/generics that don&#8217;t add value and are promoted as being the pinnacle of good practise (because that makes it harder to persuade people that good practises don&#8217;t necessarily have to be difficult).</p>
<p>I&#8217;ve a few things I want to say about this, I think my first post might be one about removing all of those interfaces and learning a bit more about structural programming. I think I&#8217;ll not say anything particularly new here, but I&#8217;d be interested to see where my current thoughts stack up against everyone else.</p>
<p><strong>ASP.NET MVC and Frenemies</strong></p>
<p>I begrudgingly accepted a while ago that ASP.NET MVC will carry on being the de facto web framework for a time to come, and resolved that while I might use alternatives for my own projects (and some client projects where allowed and appropriate), that our best bet for not having an awful time of  supporting those projects in the future is to learn from the best practises of other, &#8216;clearer thinking&#8217; frameworks/libraries and help broadcast those learnings to the ASP.NET MVC users at large.</p>
<p>It <em>is</em> a lot better than what came before it, and some of the scaffolding and associated code going into it is going to be useful (and you know what &#8211; quite exciting) for those people who are either learning and/or doing simple projects ala RoR, but beyond that just like with anything else there are major issues to carrying on down a route of maintenance and testability.</p>
<p>I have a few posts about these kinda things, although no doubt a lot of people will disagree <img src='http://codebetter.com/robashton/wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' /> .  I will be talking at <a href="http://www.dddsouthwest.com/">DDDSW </a>more extensively on this subject (again, hint hint).</p>
<p><strong>The outside world</strong></p>
<p>I don&#8217;t mean the place with trees, grass, sky and etc (although I do think some of us do need to get out more) &#8211; but lately I&#8217;ve been writing a lot of Javascript with node.js and playing with WebGL/related technologies whilst thinking about the ramifications of moving more of our application code to the browser itself.</p>
<p>If we treat the browser as just another runtime, like we do .NET and Java and talk about it in that context there then there are some interesting implications for what we can do, although there are some big questions about whether we should.</p>
<p>I&#8217;m not one of those Ruby folk, although I do look on some of the ideas coming from that area with happiness, I like Mono and run Ubuntu on my own computers as my primary operating system for getting stuff done in my spare time.</p>
<p><strong>Anyway</strong></p>
<p>Hopefully this is a good enough introduction to who I am and the kind of posts you can look to expect from me over the coming months (And hopefully not in a <em>bad</em> way).</p>
<p>I&#8217;d like to thank Jeremy for initially inviting me to come join the collective, Ian C for pushing it along and Brendan for putting it into action &#8211; it&#8217;s an honour to be trusted enough with a platform of this size and I hope to learn a lot from being corrected as I carry on making assertions that get challenged by this audience.</p>
<p><strong>Footnote</strong></p>
<p>I&#8217;m actually blogging in <a href="http://altdevblogaday.org">three </a><a href="http://codeofrob.com">places </a><a href="http://codebetter.com">now </a>on wildly different topics, my aggregated RSS feed can be found here: <a href="http://feeds.feedburner.com/robashton">http://feeds.feedburner.com/robashton</a></p>
]]></content:encoded>
			<wfw:commentRss>http://codebetter.com/robashton/2011/04/13/hello/feed/</wfw:commentRss>
		<slash:comments>1</slash:comments>
		</item>
	</channel>
</rss>

<!-- Dynamic page generated in 0.429 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2012-11-27 12:27:25 -->
